{"remainingRequest":"/home/vignesh/DIVRT/guest-webapp/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vignesh/DIVRT/guest-webapp/src/views/SuccessCheck.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vignesh/DIVRT/guest-webapp/src/views/SuccessCheck.vue","mtime":1674198327950},{"path":"/home/vignesh/DIVRT/guest-webapp/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vignesh/DIVRT/guest-webapp/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/vignesh/DIVRT/guest-webapp/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vignesh/DIVRT/guest-webapp/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IG1hcEdldHRlcnMgfSBmcm9tICJ2dWV4IjsKaW1wb3J0IEFQSUhlbHBlciBmcm9tICIuLi9hcGlIZWxwZXIiOwovLyBpbXBvcnQgbG9nZ2VySGVscGVyIGZyb20gIi4uL2xvZ2dlckhlbHBlciI7CgpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogIlN1Y2Nlc3NDaGVjayIsCiAgZGF0YTogKCkgPT4gKHsKICAgIHJlZW50ZXJTdGF0ZTogJycsCiAgfSksCiAgY29tcHV0ZWQ6IHsKICAgIC4uLm1hcEdldHRlcnMoewogICAgICBib29raW5nSWQ6ICJnZXR0ZXJCb29raW5nSWQiLAogICAgICBib29raW5nRGV0YWlsczogImdldHRlckJvb2tpbmdEZXRhaWxzIiwKICAgIH0pLAogIH0sCiAgbW91bnRlZCgpIHsKICAgIHNldFRpbWVvdXQoYXN5bmMgKCkgPT4gewogICAgICBhd2FpdCB0aGlzLmdldEJvb2tpbmdTdGF0ZSgpOwogICAgfSwgNjAwMCk7CiAgfSwKICBtZXRob2RzOiB7CiAgICBhc3luYyByZUVudGVyKCkgewogICAgICBpZiAodGhpcy5ib29raW5nSWQgIT0gbnVsbCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICB2YXIgYkRldGFpbHMgPSBhd2FpdCBBUElIZWxwZXIoCiAgICAgICAgICAgICJHRVQiLAogICAgICAgICAgICAiL2FwaS92MS9ib29raW5nL2NvbmZpZy8iICsgdGhpcy5ib29raW5nSWQgKyAiP3JlRW50ZXI9MSIKICAgICAgICAgICk7CiAgICAgICAgICB0aGlzLiRzdG9yZS5jb21taXQoCiAgICAgICAgICAgICJTRVRfQk9PS0lOR19ERVRBSUxTIiwKICAgICAgICAgICAgYkRldGFpbHMuZGF0YT8uZGF0YSA/IGJEZXRhaWxzLmRhdGEuZGF0YSA6IG51bGwKICAgICAgICAgICk7CiAgICAgICAgICBsZXQgYm9va2luZ1N0YXRlID0gYkRldGFpbHMuZGF0YT8uZGF0YT8uYm9va2luZz8uc3RhdGUKICAgICAgICAgIGlmIChib29raW5nU3RhdGUgPT0gOCB8fCBib29raW5nU3RhdGUgPT0gMTAgfHwgYm9va2luZ1N0YXRlID09IDExKSB7CiAgICAgICAgICAgIHRoaXMuJHJvdXRlci5yZXBsYWNlKHsgcGF0aDogIi9jaGVja291dCIgfSk7CiAgICAgICAgICB9IGVsc2UgaWYgKGJvb2tpbmdTdGF0ZSA9PSAyKSB7CiAgICAgICAgICAgIHRoaXMuJHJvdXRlci5yZXBsYWNlKHsgcGF0aDogIi9jaGVja2VkaW4iIH0pOwogICAgICAgICAgfSBlbHNlIGlmIChib29raW5nU3RhdGUgPT0gMCkgewogICAgICAgICAgICB0aGlzLiRyb3V0ZXIucmVwbGFjZSh7IHBhdGg6ICIvY2hlY2tpbiIgfSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzZXRUaW1lb3V0KGFzeW5jICgpID0+IHsKICAgICAgICAgICAgICBhd2FpdCBzZWxmLnJlRW50ZXIoKTsKICAgICAgICAgICAgfSwgNDAwMCk7CiAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBhc3luYyBnZXRCb29raW5nU3RhdGUoKSB7CiAgICAgIGlmICh0aGlzLmJvb2tpbmdJZCAhPSBudWxsKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGlmICh0aGlzLmJvb2tpbmdEZXRhaWxzLmJvb2tpbmc/LnR5cGUgPT0gMTMgJiYgdGhpcy5jaGVja1Jlc2VydmF0aW9uRW5kRGF0ZSgpKSB7CiAgICAgICAgICAgIHRoaXMucmVFbnRlcigpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgYkRldGFpbHMgPSBhd2FpdCBBUElIZWxwZXIoCiAgICAgICAgICAgICJHRVQiLAogICAgICAgICAgICAiL2FwaS92MS9ib29raW5nL2NvbmZpZy8iICsgdGhpcy5ib29raW5nSWQKICAgICAgICAgICk7CiAgICAgICAgICBsZXQgYm9va2luZ1N0YXRlID0gYkRldGFpbHMuZGF0YT8uZGF0YT8uYm9va2luZz8uc3RhdGUKICAgICAgICAgICAgPyBiRGV0YWlscy5kYXRhLmRhdGEuYm9va2luZy5zdGF0ZQogICAgICAgICAgICA6IG51bGw7CgogICAgICAgICAgaWYgKGJvb2tpbmdTdGF0ZSA9PSA4IHx8IGJvb2tpbmdTdGF0ZSA9PSAxMCB8fCBib29raW5nU3RhdGUgPT0gMTEpIHsKICAgICAgICAgICAgLy8gdGhpcy5wb3N0VG9Mb2dnZXJBUEkoewogICAgICAgICAgICAvLyAgICAgcGhvbmU6IGJEZXRhaWxzLmRhdGEuZGF0YS51c2VyLmNvbnRhY3QsCiAgICAgICAgICAgIC8vICAgICByZWZJZDogdGhpcy5ib29raW5nSWQsCiAgICAgICAgICAgIC8vICAgICBzdGF0dXNUZXh0OiAiTG9hZGVkIGNoZWNrZWQgb3V0IHN1Y2Nlc3MgcGFnZS4iLAogICAgICAgICAgICAvLyAgIH0pCiAgICAgICAgICAgIHRoaXMuJHJvdXRlci5yZXBsYWNlKHsgcGF0aDogIi9jaGVja291dCIgfSk7CiAgICAgICAgICB9IGVsc2UgaWYgKGJvb2tpbmdTdGF0ZSA9PSAyKSB7CiAgICAgICAgICAgIHRoaXMuJHJvdXRlci5yZXBsYWNlKHsgcGF0aDogIi9jaGVja2VkaW4iIH0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc2V0VGltZW91dChhc3luYyAoKSA9PiB7CiAgICAgICAgICAgICAgYXdhaXQgdGhpcy5nZXRCb29raW5nU3RhdGUoKTsKICAgICAgICAgICAgfSwgNDAwMCk7CiAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBjaGVja1Jlc2VydmF0aW9uRW5kRGF0ZSgpIHsKICAgICAgcmV0dXJuIHRoaXMuYm9va2luZ0RldGFpbHM/LmJvb2tpbmc/LnJldkVuZCAmJgogICAgICAgIG5ldyBEYXRlKChOdW1iZXIodGhpcy5ib29raW5nRGV0YWlscy5ib29raW5nLnJldkVuZCkgLSBOdW1iZXIodGhpcy5ib29raW5nRGV0YWlscy56b25lLnRpbWV6b25lb2Zmc2V0KSkgKiAxMDAwKS5nZXRUaW1lKCkgLSBuZXcgRGF0ZSgpLmdldFRpbWUoKSA+IDAKICAgICAgICA/IHRydWUKICAgICAgICA6IGZhbHNlOwogICAgfSwKICB9LAp9Owo="},{"version":3,"sources":["SuccessCheck.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;AAqBA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"SuccessCheck.vue","sourceRoot":"src/views","sourcesContent":["<template>\n  <v-container class=\"pa-0 text-center fill-height\" fluid>\n    <v-row class=\"white fill-height\" style=\"padding-top: 30%\" align-content=\"start\" justify=\"center\" no-gutters>\n      <v-col cols=\"12\">\n        <v-img alt=\"Success\" contain height=\"175\" src=\"../assets/success_check.gif\" />\n      </v-col>\n      <v-col cols=\"12\">\n        <p class=\"font-weight-bold\" style=\"color: #3d3f3c\">Opening Gate</p>\n      </v-col>\n      <v-col cols=\"12\" style=\"color: #3d3f3c\">\n        <p>Please proceed to exit</p>\n      </v-col>\n      <v-col cols=\"12\" class=\"place_bottom\">\n        <v-progress-circular indeterminate :size=\"20\" :width=\"3\" color=\"red\"></v-progress-circular>\n        <span class=\"ml-4\">Preparing receipt</span>\n      </v-col>\n    </v-row>\n  </v-container>\n</template>\n\n<script>\nimport { mapGetters } from \"vuex\";\nimport APIHelper from \"../apiHelper\";\n// import loggerHelper from \"../loggerHelper\";\n\nexport default {\n  name: \"SuccessCheck\",\n  data: () => ({\n    reenterState: '',\n  }),\n  computed: {\n    ...mapGetters({\n      bookingId: \"getterBookingId\",\n      bookingDetails: \"getterBookingDetails\",\n    }),\n  },\n  mounted() {\n    setTimeout(async () => {\n      await this.getBookingState();\n    }, 6000);\n  },\n  methods: {\n    async reEnter() {\n      if (this.bookingId != null) {\n        try {\n          var self = this;\n          var bDetails = await APIHelper(\n            \"GET\",\n            \"/api/v1/booking/config/\" + this.bookingId + \"?reEnter=1\"\n          );\n          this.$store.commit(\n            \"SET_BOOKING_DETAILS\",\n            bDetails.data?.data ? bDetails.data.data : null\n          );\n          let bookingState = bDetails.data?.data?.booking?.state\n          if (bookingState == 8 || bookingState == 10 || bookingState == 11) {\n            this.$router.replace({ path: \"/checkout\" });\n          } else if (bookingState == 2) {\n            this.$router.replace({ path: \"/checkedin\" });\n          } else if (bookingState == 0) {\n            this.$router.replace({ path: \"/checkin\" });\n          } else {\n            setTimeout(async () => {\n              await self.reEnter();\n            }, 4000);\n          }\n        } catch (error) {\n          console.log(error);\n        }\n      }\n    },\n    async getBookingState() {\n      if (this.bookingId != null) {\n        try {\n          if (this.bookingDetails.booking?.type == 13 && this.checkReservationEndDate()) {\n            this.reEnter();\n            return;\n          }\n          var bDetails = await APIHelper(\n            \"GET\",\n            \"/api/v1/booking/config/\" + this.bookingId\n          );\n          let bookingState = bDetails.data?.data?.booking?.state\n            ? bDetails.data.data.booking.state\n            : null;\n\n          if (bookingState == 8 || bookingState == 10 || bookingState == 11) {\n            // this.postToLoggerAPI({\n            //     phone: bDetails.data.data.user.contact,\n            //     refId: this.bookingId,\n            //     statusText: \"Loaded checked out success page.\",\n            //   })\n            this.$router.replace({ path: \"/checkout\" });\n          } else if (bookingState == 2) {\n            this.$router.replace({ path: \"/checkedin\" });\n          } else {\n            setTimeout(async () => {\n              await this.getBookingState();\n            }, 4000);\n          }\n        } catch (error) {\n          console.log(error);\n        }\n      }\n    },\n    checkReservationEndDate() {\n      return this.bookingDetails?.booking?.revEnd &&\n        new Date((Number(this.bookingDetails.booking.revEnd) - Number(this.bookingDetails.zone.timezoneoffset)) * 1000).getTime() - new Date().getTime() > 0\n        ? true\n        : false;\n    },\n  },\n};\n</script>\n<style lang=\"less\">\n.place_bottom {\n  position: absolute;\n  bottom: 12%;\n}\n</style>\n"]}]}