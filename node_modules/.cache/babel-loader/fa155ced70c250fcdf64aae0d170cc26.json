{"remainingRequest":"/home/vignesh/DIVRT/guest-webapp/node_modules/thread-loader/dist/cjs.js!/home/vignesh/DIVRT/guest-webapp/node_modules/babel-loader/lib/index.js!/home/vignesh/DIVRT/guest-webapp/node_modules/eslint-loader/index.js??ref--13-0!/home/vignesh/DIVRT/guest-webapp/src/plugins/securesubmit.js","dependencies":[{"path":"/home/vignesh/DIVRT/guest-webapp/src/plugins/securesubmit.js","mtime":1673262692530},{"path":"/home/vignesh/DIVRT/guest-webapp/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vignesh/DIVRT/guest-webapp/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vignesh/DIVRT/guest-webapp/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/vignesh/DIVRT/guest-webapp/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF90eXBlb2YgZnJvbSAiL2hvbWUvdmlnbmVzaC9ESVZSVC9ndWVzdC13ZWJhcHAvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL3R5cGVvZiI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm51bWJlci5jb25zdHJ1Y3Rvci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC5leGVjLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnJlcGxhY2UuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zbGljZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmcuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAudG8tc3RyaW5nLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLnVybC50by1qc29uLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuam9pbi5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5zcGxpdC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5tYXRjaC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmZ1bmN0aW9uLm5hbWUuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5jb25jYXQuanMiOwoKLyogZXNsaW50LWRpc2FibGUgKi8KdmFyIEhlYXJ0bGFuZCA9IGZ1bmN0aW9uICgpIHsKICAndXNlIHN0cmljdCc7CiAgLyogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICBUaGlzIGZpbGUgaXMgYmFzZWQgb24gb3IgaW5jb3Jwb3JhdGVzIG1hdGVyaWFsIGZyb20gdGhlIHByb2plY3RzIGxpc3RlZCBiZWxvdwogIChjb2xsZWN0aXZlbHksICJUaGlyZCBQYXJ0eSBDb2RlIikuIE1pY3Jvc29mdCBpcyBub3QgdGhlIG9yaWdpbmFsIGF1dGhvciBvZiB0aGUKICBUaGlyZCBQYXJ0eSBDb2RlLiBUaGUgb3JpZ2luYWwgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhlIGxpY2Vuc2UsIHVuZGVyIHdoaWNoCiAgTWljcm9zb2Z0IHJlY2VpdmVkIHN1Y2ggVGhpcmQgUGFydHkgQ29kZSwgYXJlIHNldCBmb3J0aCBiZWxvdy4gU3VjaCBsaWNlbnNlcwogIGFuZCBub3RpY2VzIGFyZSBwcm92aWRlZCBmb3IgaW5mb3JtYXRpb25hbCBwdXJwb3NlcyBvbmx5LiBNaWNyb3NvZnQsIG5vdCB0aGUKICB0aGlyZCBwYXJ0eSwgbGljZW5zZXMgdGhlIFRoaXJkIFBhcnR5IENvZGUgdG8geW91IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUKICBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAuIFNlZSBMaWNlbnNlLnR4dCBpbiB0aGUgcHJvamVjdCByb290IGZvciBjb21wbGV0ZQogIGxpY2Vuc2UgaW5mb3JtYXRpb24uIE1pY3Jvc29mdCByZXNlcnZlcyBhbGwgcmlnaHRzIG5vdCBleHByZXNzbHkgZ3JhbnRlZCB1bmRlcgogIHRoZSBBcGFjaGUgMi4wIExpY2Vuc2UsIHdoZXRoZXIgYnkgaW1wbGljYXRpb24sIGVzdG9wcGVsIG9yIG90aGVyd2lzZS4KICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqLwoKICAvKgogICAgICBqc29uMi5qcwogICAgICAyMDExLTEwLTE5CiAgCiAgICAgIFB1YmxpYyBEb21haW4uCiAgCiAgICAgIE5PIFdBUlJBTlRZIEVYUFJFU1NFRCBPUiBJTVBMSUVELiBVU0UgQVQgWU9VUiBPV04gUklTSy4KICAKICAgICAgU2VlIGh0dHA6Ly93d3cuSlNPTi5vcmcvanMuaHRtbAogIAogIAogICAgICBUaGlzIGNvZGUgc2hvdWxkIGJlIG1pbmlmaWVkIGJlZm9yZSBkZXBsb3ltZW50LgogICAgICBTZWUgaHR0cDovL2phdmFzY3JpcHQuY3JvY2tmb3JkLmNvbS9qc21pbi5odG1sCiAgCiAgICAgIFVTRSBZT1VSIE9XTiBDT1BZLiBJVCBJUyBFWFRSRU1FTFkgVU5XSVNFIFRPIExPQUQgQ09ERSBGUk9NIFNFUlZFUlMgWU9VIERPCiAgICAgIE5PVCBDT05UUk9MLgogIAogIAogICAgICBUaGlzIGZpbGUgY3JlYXRlcyBhIGdsb2JhbCBKU09OIG9iamVjdCBjb250YWluaW5nIHR3byBtZXRob2RzOiBzdHJpbmdpZnkKICAgICAgYW5kIHBhcnNlLgogIAogICAgICAgICAgSlNPTi5zdHJpbmdpZnkodmFsdWUsIHJlcGxhY2VyLCBzcGFjZSkKICAgICAgICAgICAgICB2YWx1ZSAgICAgICBhbnkgSmF2YVNjcmlwdCB2YWx1ZSwgdXN1YWxseSBhbiBvYmplY3Qgb3IgYXJyYXkuCiAgCiAgICAgICAgICAgICAgcmVwbGFjZXIgICAgYW4gb3B0aW9uYWwgcGFyYW1ldGVyIHRoYXQgZGV0ZXJtaW5lcyBob3cgb2JqZWN0CiAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVzIGFyZSBzdHJpbmdpZmllZCBmb3Igb2JqZWN0cy4gSXQgY2FuIGJlIGEKICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiBvciBhbiBhcnJheSBvZiBzdHJpbmdzLgogIAogICAgICAgICAgICAgIHNwYWNlICAgICAgIGFuIG9wdGlvbmFsIHBhcmFtZXRlciB0aGF0IHNwZWNpZmllcyB0aGUgaW5kZW50YXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgICBvZiBuZXN0ZWQgc3RydWN0dXJlcy4gSWYgaXQgaXMgb21pdHRlZCwgdGhlIHRleHQgd2lsbAogICAgICAgICAgICAgICAgICAgICAgICAgIGJlIHBhY2tlZCB3aXRob3V0IGV4dHJhIHdoaXRlc3BhY2UuIElmIGl0IGlzIGEgbnVtYmVyLAogICAgICAgICAgICAgICAgICAgICAgICAgIGl0IHdpbGwgc3BlY2lmeSB0aGUgbnVtYmVyIG9mIHNwYWNlcyB0byBpbmRlbnQgYXQgZWFjaAogICAgICAgICAgICAgICAgICAgICAgICAgIGxldmVsLiBJZiBpdCBpcyBhIHN0cmluZyAoc3VjaCBhcyAnXHQnIG9yICcmbmJzcDsnKSwKICAgICAgICAgICAgICAgICAgICAgICAgICBpdCBjb250YWlucyB0aGUgY2hhcmFjdGVycyB1c2VkIHRvIGluZGVudCBhdCBlYWNoIGxldmVsLgogIAogICAgICAgICAgICAgIFRoaXMgbWV0aG9kIHByb2R1Y2VzIGEgSlNPTiB0ZXh0IGZyb20gYSBKYXZhU2NyaXB0IHZhbHVlLgogIAogICAgICAgICAgICAgIFdoZW4gYW4gb2JqZWN0IHZhbHVlIGlzIGZvdW5kLCBpZiB0aGUgb2JqZWN0IGNvbnRhaW5zIGEgdG9KU09OCiAgICAgICAgICAgICAgbWV0aG9kLCBpdHMgdG9KU09OIG1ldGhvZCB3aWxsIGJlIGNhbGxlZCBhbmQgdGhlIHJlc3VsdCB3aWxsIGJlCiAgICAgICAgICAgICAgc3RyaW5naWZpZWQuIEEgdG9KU09OIG1ldGhvZCBkb2VzIG5vdCBzZXJpYWxpemU6IGl0IHJldHVybnMgdGhlCiAgICAgICAgICAgICAgdmFsdWUgcmVwcmVzZW50ZWQgYnkgdGhlIG5hbWUvdmFsdWUgcGFpciB0aGF0IHNob3VsZCBiZSBzZXJpYWxpemVkLAogICAgICAgICAgICAgIG9yIHVuZGVmaW5lZCBpZiBub3RoaW5nIHNob3VsZCBiZSBzZXJpYWxpemVkLiBUaGUgdG9KU09OIG1ldGhvZAogICAgICAgICAgICAgIHdpbGwgYmUgcGFzc2VkIHRoZSBrZXkgYXNzb2NpYXRlZCB3aXRoIHRoZSB2YWx1ZSwgYW5kIHRoaXMgd2lsbCBiZQogICAgICAgICAgICAgIGJvdW5kIHRvIHRoZSB2YWx1ZQogIAogICAgICAgICAgICAgIEZvciBleGFtcGxlLCB0aGlzIHdvdWxkIHNlcmlhbGl6ZSBEYXRlcyBhcyBJU08gc3RyaW5ncy4KICAKICAgICAgICAgICAgICAgICAgRGF0ZS5wcm90b3R5cGUudG9KU09OID0gZnVuY3Rpb24gKGtleSkgewogICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gZihuKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRm9ybWF0IGludGVnZXJzIHRvIGhhdmUgYXQgbGVhc3QgdHdvIGRpZ2l0cy4KICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbiA8IDEwID8gJzAnICsgbiA6IG47CiAgICAgICAgICAgICAgICAgICAgICB9CiAgCiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRVVENGdWxsWWVhcigpICAgKyAnLScgKwogICAgICAgICAgICAgICAgICAgICAgICAgICBmKHRoaXMuZ2V0VVRDTW9udGgoKSArIDEpICsgJy0nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgZih0aGlzLmdldFVUQ0RhdGUoKSkgICAgICArICdUJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgIGYodGhpcy5nZXRVVENIb3VycygpKSAgICAgKyAnOicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICBmKHRoaXMuZ2V0VVRDTWludXRlcygpKSAgICsgJzonICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgZih0aGlzLmdldFVUQ1NlY29uZHMoKSkgICArICdaJzsKICAgICAgICAgICAgICAgICAgfTsKICAKICAgICAgICAgICAgICBZb3UgY2FuIHByb3ZpZGUgYW4gb3B0aW9uYWwgcmVwbGFjZXIgbWV0aG9kLiBJdCB3aWxsIGJlIHBhc3NlZCB0aGUKICAgICAgICAgICAgICBrZXkgYW5kIHZhbHVlIG9mIGVhY2ggbWVtYmVyLCB3aXRoIHRoaXMgYm91bmQgdG8gdGhlIGNvbnRhaW5pbmcKICAgICAgICAgICAgICBvYmplY3QuIFRoZSB2YWx1ZSB0aGF0IGlzIHJldHVybmVkIGZyb20geW91ciBtZXRob2Qgd2lsbCBiZQogICAgICAgICAgICAgIHNlcmlhbGl6ZWQuIElmIHlvdXIgbWV0aG9kIHJldHVybnMgdW5kZWZpbmVkLCB0aGVuIHRoZSBtZW1iZXIgd2lsbAogICAgICAgICAgICAgIGJlIGV4Y2x1ZGVkIGZyb20gdGhlIHNlcmlhbGl6YXRpb24uCiAgCiAgICAgICAgICAgICAgSWYgdGhlIHJlcGxhY2VyIHBhcmFtZXRlciBpcyBhbiBhcnJheSBvZiBzdHJpbmdzLCB0aGVuIGl0IHdpbGwgYmUKICAgICAgICAgICAgICB1c2VkIHRvIHNlbGVjdCB0aGUgbWVtYmVycyB0byBiZSBzZXJpYWxpemVkLiBJdCBmaWx0ZXJzIHRoZSByZXN1bHRzCiAgICAgICAgICAgICAgc3VjaCB0aGF0IG9ubHkgbWVtYmVycyB3aXRoIGtleXMgbGlzdGVkIGluIHRoZSByZXBsYWNlciBhcnJheSBhcmUKICAgICAgICAgICAgICBzdHJpbmdpZmllZC4KICAKICAgICAgICAgICAgICBWYWx1ZXMgdGhhdCBkbyBub3QgaGF2ZSBKU09OIHJlcHJlc2VudGF0aW9ucywgc3VjaCBhcyB1bmRlZmluZWQgb3IKICAgICAgICAgICAgICBmdW5jdGlvbnMsIHdpbGwgbm90IGJlIHNlcmlhbGl6ZWQuIFN1Y2ggdmFsdWVzIGluIG9iamVjdHMgd2lsbCBiZQogICAgICAgICAgICAgIGRyb3BwZWQ7IGluIGFycmF5cyB0aGV5IHdpbGwgYmUgcmVwbGFjZWQgd2l0aCBudWxsLiBZb3UgY2FuIHVzZQogICAgICAgICAgICAgIGEgcmVwbGFjZXIgZnVuY3Rpb24gdG8gcmVwbGFjZSB0aG9zZSB3aXRoIEpTT04gdmFsdWVzLgogICAgICAgICAgICAgIEpTT04uc3RyaW5naWZ5KHVuZGVmaW5lZCkgcmV0dXJucyB1bmRlZmluZWQuCiAgCiAgICAgICAgICAgICAgVGhlIG9wdGlvbmFsIHNwYWNlIHBhcmFtZXRlciBwcm9kdWNlcyBhIHN0cmluZ2lmaWNhdGlvbiBvZiB0aGUKICAgICAgICAgICAgICB2YWx1ZSB0aGF0IGlzIGZpbGxlZCB3aXRoIGxpbmUgYnJlYWtzIGFuZCBpbmRlbnRhdGlvbiB0byBtYWtlIGl0CiAgICAgICAgICAgICAgZWFzaWVyIHRvIHJlYWQuCiAgCiAgICAgICAgICAgICAgSWYgdGhlIHNwYWNlIHBhcmFtZXRlciBpcyBhIG5vbi1lbXB0eSBzdHJpbmcsIHRoZW4gdGhhdCBzdHJpbmcgd2lsbAogICAgICAgICAgICAgIGJlIHVzZWQgZm9yIGluZGVudGF0aW9uLiBJZiB0aGUgc3BhY2UgcGFyYW1ldGVyIGlzIGEgbnVtYmVyLCB0aGVuCiAgICAgICAgICAgICAgdGhlIGluZGVudGF0aW9uIHdpbGwgYmUgdGhhdCBtYW55IHNwYWNlcy4KICAKICAgICAgICAgICAgICBFeGFtcGxlOgogIAogICAgICAgICAgICAgIHRleHQgPSBKU09OLnN0cmluZ2lmeShbJ2UnLCB7cGx1cmlidXM6ICd1bnVtJ31dKTsKICAgICAgICAgICAgICAvLyB0ZXh0IGlzICdbImUiLHsicGx1cmlidXMiOiJ1bnVtIn1dJwogIAogIAogICAgICAgICAgICAgIHRleHQgPSBKU09OLnN0cmluZ2lmeShbJ2UnLCB7cGx1cmlidXM6ICd1bnVtJ31dLCBudWxsLCAnXHQnKTsKICAgICAgICAgICAgICAvLyB0ZXh0IGlzICdbXG5cdCJlIixcblx0e1xuXHRcdCJwbHVyaWJ1cyI6ICJ1bnVtIlxuXHR9XG5dJwogIAogICAgICAgICAgICAgIHRleHQgPSBKU09OLnN0cmluZ2lmeShbbmV3IERhdGUoKV0sIGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzW2tleV0gaW5zdGFuY2VvZiBEYXRlID8KICAgICAgICAgICAgICAgICAgICAgICdEYXRlKCcgKyB0aGlzW2tleV0gKyAnKScgOiB2YWx1ZTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAvLyB0ZXh0IGlzICdbIkRhdGUoLS0tY3VycmVudCB0aW1lLS0tKSJdJwogIAogIAogICAgICAgICAgSlNPTi5wYXJzZSh0ZXh0LCByZXZpdmVyKQogICAgICAgICAgICAgIFRoaXMgbWV0aG9kIHBhcnNlcyBhIEpTT04gdGV4dCB0byBwcm9kdWNlIGFuIG9iamVjdCBvciBhcnJheS4KICAgICAgICAgICAgICBJdCBjYW4gdGhyb3cgYSBTeW50YXhFcnJvciBleGNlcHRpb24uCiAgCiAgICAgICAgICAgICAgVGhlIG9wdGlvbmFsIHJldml2ZXIgcGFyYW1ldGVyIGlzIGEgZnVuY3Rpb24gdGhhdCBjYW4gZmlsdGVyIGFuZAogICAgICAgICAgICAgIHRyYW5zZm9ybSB0aGUgcmVzdWx0cy4gSXQgcmVjZWl2ZXMgZWFjaCBvZiB0aGUga2V5cyBhbmQgdmFsdWVzLAogICAgICAgICAgICAgIGFuZCBpdHMgcmV0dXJuIHZhbHVlIGlzIHVzZWQgaW5zdGVhZCBvZiB0aGUgb3JpZ2luYWwgdmFsdWUuCiAgICAgICAgICAgICAgSWYgaXQgcmV0dXJucyB3aGF0IGl0IHJlY2VpdmVkLCB0aGVuIHRoZSBzdHJ1Y3R1cmUgaXMgbm90IG1vZGlmaWVkLgogICAgICAgICAgICAgIElmIGl0IHJldHVybnMgdW5kZWZpbmVkIHRoZW4gdGhlIG1lbWJlciBpcyBkZWxldGVkLgogIAogICAgICAgICAgICAgIEV4YW1wbGU6CiAgCiAgICAgICAgICAgICAgLy8gUGFyc2UgdGhlIHRleHQuIFZhbHVlcyB0aGF0IGxvb2sgbGlrZSBJU08gZGF0ZSBzdHJpbmdzIHdpbGwKICAgICAgICAgICAgICAvLyBiZSBjb252ZXJ0ZWQgdG8gRGF0ZSBvYmplY3RzLgogIAogICAgICAgICAgICAgIG15RGF0YSA9IEpTT04ucGFyc2UodGV4dCwgZnVuY3Rpb24gKGtleSwgdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgbGV0IGE7CiAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgICAgICAgICAgICBhID0KICAvXihcZHs0fSktKFxkezJ9KS0oXGR7Mn0pVChcZHsyfSk6KFxkezJ9KTooXGR7Mn0oPzpcLlxkKik/KVokLy5leGVjKHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgIGlmIChhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBEYXRlKERhdGUuVVRDKCthWzFdLCArYVsyXSAtIDEsICthWzNdLCArYVs0XSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgK2FbNV0sICthWzZdKSk7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICAgICAgICAgIH0pOwogIAogICAgICAgICAgICAgIG15RGF0YSA9IEpTT04ucGFyc2UoJ1siRGF0ZSgwOS8wOS8yMDAxKSJdJywgZnVuY3Rpb24gKGtleSwgdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgbGV0IGQ7CiAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUuc2xpY2UoMCwgNSkgPT09ICdEYXRlKCcgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZS5zbGljZSgtMSkgPT09ICcpJykgewogICAgICAgICAgICAgICAgICAgICAgZCA9IG5ldyBEYXRlKHZhbHVlLnNsaWNlKDUsIC0xKSk7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgICAgICAgICB9KTsKICAKICAKICAgICAgVGhpcyBpcyBhIHJlZmVyZW5jZSBpbXBsZW1lbnRhdGlvbi4gWW91IGFyZSBmcmVlIHRvIGNvcHksIG1vZGlmeSwgb3IKICAgICAgcmVkaXN0cmlidXRlLgogICovCgogIC8qanNsaW50IGV2aWw6IHRydWUsIHJlZ2V4cDogdHJ1ZSAqLwoKICAvKm1lbWJlcnMgIiIsICJcYiIsICJcdCIsICJcbiIsICJcZiIsICJcciIsICJcIiIsIEpTT04sICJcXCIsIGFwcGx5LAogICAgICBjYWxsLCBjaGFyQ29kZUF0LCBnZXRVVENEYXRlLCBnZXRVVENGdWxsWWVhciwgZ2V0VVRDSG91cnMsCiAgICAgIGdldFVUQ01pbnV0ZXMsIGdldFVUQ01vbnRoLCBnZXRVVENTZWNvbmRzLCBoYXNPd25Qcm9wZXJ0eSwgam9pbiwKICAgICAgbGFzdEluZGV4LCBsZW5ndGgsIHBhcnNlLCBwcm90b3R5cGUsIHB1c2gsIHJlcGxhY2UsIHNsaWNlLCBzdHJpbmdpZnksCiAgICAgIHRlc3QsIHRvSlNPTiwgdG9TdHJpbmcsIHZhbHVlT2YKICAqLwogIC8vIGNyZWF0ZSBhIEpTT04gb2JqZWN0IG9ubHkgaWYgb25lIGRvZXMgbm90IGFscmVhZHkgZXhpc3QuIFdlIGNyZWF0ZSB0aGUKICAvLyBtZXRob2RzIGluIGEgY2xvc3VyZSB0byBhdm9pZCBjcmVhdGluZyBnbG9iYWwgdmFyaWFibGVzLgoKICB2YXIgSlNPTjIgPSB7fTsKCiAgKGZ1bmN0aW9uICgpIHsKICAgICd1c2Ugc3RyaWN0JzsKCiAgICBmdW5jdGlvbiBmKG4pIHsKICAgICAgLy8gZm9ybWF0IGludGVnZXJzIHRvIGhhdmUgYXQgbGVhc3QgdHdvIGRpZ2l0cy4KICAgICAgcmV0dXJuIG4gPCAxMCA/ICcwJyArIG4gOiBuOwogICAgfQoKICAgIGlmICh0eXBlb2YgRGF0ZS5wcm90b3R5cGUudG9KU09OICE9PSAnZnVuY3Rpb24nKSB7CiAgICAgIERhdGUucHJvdG90eXBlLnRvSlNPTiA9IGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICByZXR1cm4gaXNGaW5pdGUodGhpcy52YWx1ZU9mKCkpID8gdGhpcy5nZXRVVENGdWxsWWVhcigpICsgJy0nICsgZih0aGlzLmdldFVUQ01vbnRoKCkgKyAxKSArICctJyArIGYodGhpcy5nZXRVVENEYXRlKCkpICsgJ1QnICsgZih0aGlzLmdldFVUQ0hvdXJzKCkpICsgJzonICsgZih0aGlzLmdldFVUQ01pbnV0ZXMoKSkgKyAnOicgKyBmKHRoaXMuZ2V0VVRDU2Vjb25kcygpKSArICdaJyA6IG51bGw7CiAgICAgIH07CgogICAgICB2YXIgc3RyUHJvdG8gPSBTdHJpbmcucHJvdG90eXBlOwogICAgICB2YXIgbnVtUHJvdG8gPSBOdW1iZXIucHJvdG90eXBlOwoKICAgICAgbnVtUHJvdG8uSlNPTiA9IHN0clByb3RvLkpTT04gPSBCb29sZWFuLnByb3RvdHlwZS50b0pTT04gPSBmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgcmV0dXJuIHRoaXMudmFsdWVPZigpOwogICAgICB9OwogICAgfQoKICAgIHZhciBjeCA9IC9bXHUwMDAwXHUwMGFkXHUwNjAwLVx1MDYwNFx1MDcwZlx1MTdiNFx1MTdiNVx1MjAwYy1cdTIwMGZcdTIwMjgtXHUyMDJmXHUyMDYwLVx1MjA2Zlx1ZmVmZlx1ZmZmMC1cdWZmZmZdL2csCiAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lCiAgICBlc2MgPSAvW1xcXCJceDAwLVx4MWZceDdmLVx4OWZcdTAwYWRcdTA2MDAtXHUwNjA0XHUwNzBmXHUxN2I0XHUxN2I1XHUyMDBjLVx1MjAwZlx1MjAyOC1cdTIwMmZcdTIwNjAtXHUyMDZmXHVmZWZmXHVmZmYwLVx1ZmZmZl0vZywKICAgICAgICBnYXAsCiAgICAgICAgaW5kZW50LAogICAgICAgIG1ldGEgPSB7CiAgICAgICdcYic6ICdcXGInLAogICAgICAnXHQnOiAnXFx0JywKICAgICAgJ1xuJzogJ1xcbicsCiAgICAgICdcZic6ICdcXGYnLAogICAgICAnXHInOiAnXFxyJywKICAgICAgJyInOiAnXFwiJywKICAgICAgJ1xcJzogJ1xcXFwnCiAgICB9LAogICAgICAgIHJlcDsKCiAgICBmdW5jdGlvbiBxdW90ZShzdHJpbmcpIHsKICAgICAgLy8gaWYgdGhlIHN0cmluZyBjb250YWlucyBubyBjb250cm9sIGNoYXJhY3RlcnMsIG5vIHF1b3RlIGNoYXJhY3RlcnMsIGFuZCBubwogICAgICAvLyBiYWNrc2xhc2ggY2hhcmFjdGVycywgdGhlbiB3ZSBjYW4gc2FmZWx5IHNsYXAgc29tZSBxdW90ZXMgYXJvdW5kIGl0LgogICAgICAvLyBvdGhlcndpc2Ugd2UgbXVzdCBhbHNvIHJlcGxhY2UgdGhlIG9mZmVuZGluZyBjaGFyYWN0ZXJzIHdpdGggc2FmZSBlc2NhcGUKICAgICAgLy8gc2VxdWVuY2VzLgogICAgICBlc2MubGFzdEluZGV4ID0gMDsKICAgICAgcmV0dXJuIGVzYy50ZXN0KHN0cmluZykgPyAnIicgKyBzdHJpbmcucmVwbGFjZShlc2MsIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgdmFyIGMgPSBtZXRhW2FdOwogICAgICAgIHJldHVybiB0eXBlb2YgYyA9PT0gJ3N0cmluZycgPyBjIDogIlxcdSIgKyAoJzAwMDAnICsgYS5jaGFyQ29kZUF0KDApLnRvU3RyaW5nKDE2KSkuc2xpY2UoLTQpOwogICAgICB9KSArICciJyA6ICciJyArIHN0cmluZyArICciJzsKICAgIH0KCiAgICBmdW5jdGlvbiBzdHIoa2V5LCBob2xkZXIpIHsKICAgICAgLy8gcHJvZHVjZSBhIHN0cmluZyBmcm9tIGhvbGRlcltrZXldLgogICAgICB2YXIgaSwKICAgICAgICAgIC8vIHRoZSBsb29wIGNvdW50ZXIuCiAgICAgIGsgPSBudWxsLAogICAgICAgICAgLy8gdGhlIG1lbWJlciBrZXkuCiAgICAgIHYsCiAgICAgICAgICAvLyB0aGUgbWVtYmVyIHZhbHVlLgogICAgICBsZW5ndGgsCiAgICAgICAgICBtaW5kID0gZ2FwLAogICAgICAgICAgcGFydGlhbCwKICAgICAgICAgIHZhbHVlID0gaG9sZGVyW2tleV07IC8vIGlmIHRoZSB2YWx1ZSBoYXMgYSB0b0pTT04gbWV0aG9kLCBjYWxsIGl0IHRvIG9idGFpbiBhIHJlcGxhY2VtZW50IHZhbHVlLgoKICAgICAgaWYgKHZhbHVlICYmIF90eXBlb2YodmFsdWUpID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgdmFsdWUudG9KU09OID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgdmFsdWUgPSB2YWx1ZS50b0pTT04oa2V5KTsKICAgICAgfSAvLyBpZiB3ZSB3ZXJlIGNhbGxlZCB3aXRoIGEgcmVwbGFjZXIgZnVuY3Rpb24sIHRoZW4gY2FsbCB0aGUgcmVwbGFjZXIgdG8KICAgICAgLy8gb2J0YWluIGEgcmVwbGFjZW1lbnQgdmFsdWUuCgoKICAgICAgaWYgKHR5cGVvZiByZXAgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICB2YWx1ZSA9IHJlcC5jYWxsKGhvbGRlciwga2V5LCB2YWx1ZSk7CiAgICAgIH0gLy8gd2hhdCBoYXBwZW5zIG5leHQgZGVwZW5kcyBvbiB0aGUgdmFsdWUncyB0eXBlLgoKCiAgICAgIHN3aXRjaCAoX3R5cGVvZih2YWx1ZSkpIHsKICAgICAgICBjYXNlICdzdHJpbmcnOgogICAgICAgICAgcmV0dXJuIHF1b3RlKHZhbHVlKTsKCiAgICAgICAgY2FzZSAnbnVtYmVyJzoKICAgICAgICAgIC8vIGpzb24gbnVtYmVycyBtdXN0IGJlIGZpbml0ZS4gRW5jb2RlIG5vbi1maW5pdGUgbnVtYmVycyBhcyBudWxsLgogICAgICAgICAgcmV0dXJuIGlzRmluaXRlKHZhbHVlKSA/IFN0cmluZyh2YWx1ZSkgOiAnbnVsbCc7CgogICAgICAgIGNhc2UgJ2Jvb2xlYW4nOgogICAgICAgIGNhc2UgJ251bGwnOgogICAgICAgICAgLy8gaWYgdGhlIHZhbHVlIGlzIGEgYm9vbGVhbiBvciBudWxsLCBjb252ZXJ0IGl0IHRvIGEgc3RyaW5nLiBOb3RlOgogICAgICAgICAgLy8gdHlwZW9mIG51bGwgZG9lcyBub3QgcHJvZHVjZSAnbnVsbCcuIFRoZSBjYXNlIGlzIGluY2x1ZGVkIGhlcmUgaW4KICAgICAgICAgIC8vIHRoZSByZW1vdGUgY2hhbmNlIHRoYXQgdGhpcyBnZXRzIGZpeGVkIHNvbWVkYXkuCiAgICAgICAgICByZXR1cm4gU3RyaW5nKHZhbHVlKTsKICAgICAgICAvLyBpZiB0aGUgdHlwZSBpcyAnb2JqZWN0Jywgd2UgbWlnaHQgYmUgZGVhbGluZyB3aXRoIGFuIG9iamVjdCBvciBhbiBhcnJheSBvcgogICAgICAgIC8vIG51bGwuCgogICAgICAgIGNhc2UgJ29iamVjdCc6CiAgICAgICAgICAvLyBkdWUgdG8gYSBzcGVjaWZpY2F0aW9uIGJsdW5kZXIgaW4gRUNNQVNjcmlwdCwgdHlwZW9mIG51bGwgaXMgJ29iamVjdCcsCiAgICAgICAgICAvLyBzbyB3YXRjaCBvdXQgZm9yIHRoYXQgY2FzZS4KICAgICAgICAgIGlmICghdmFsdWUpIHsKICAgICAgICAgICAgcmV0dXJuICdudWxsJzsKICAgICAgICAgIH0gLy8gbWFrZSBhbiBhcnJheSB0byBob2xkIHRoZSBwYXJ0aWFsOiBzdHJpbmdbXSByZXN1bHRzIG9mIHN0cmluZ2lmeWluZyB0aGlzIG9iamVjdCB2YWx1ZS4KCgogICAgICAgICAgZ2FwICs9IGluZGVudDsKICAgICAgICAgIHBhcnRpYWwgPSBbXTsgLy8gaXMgdGhlIHZhbHVlIGFuIGFycmF5PwoKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmFwcGx5KHZhbHVlLCBbXSkgPT09ICdbb2JqZWN0IEFycmF5XScpIHsKICAgICAgICAgICAgLy8gdGhlIHZhbHVlIGlzIGFuIGFycmF5LiBTdHJpbmdpZnkgZXZlcnkgZWxlbWVudC4gVXNlIG51bGwgYXMgYSBwbGFjZWhvbGRlcgogICAgICAgICAgICAvLyBmb3Igbm9uLUpTT04gdmFsdWVzLgogICAgICAgICAgICBsZW5ndGggPSB2YWx1ZS5sZW5ndGg7CgogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbGVuZ3RoOyBpICs9IDEpIHsKICAgICAgICAgICAgICBwYXJ0aWFsW2ldID0gc3RyKGkudG9TdHJpbmcoKSwgdmFsdWUpIHx8ICdudWxsJzsKICAgICAgICAgICAgfSAvLyBqb2luIGFsbCBvZiB0aGUgZWxlbWVudHMgdG9nZXRoZXIsIHNlcGFyYXRlZCB3aXRoIGNvbW1hcywgYW5kIHdyYXAgdGhlbSBpbgogICAgICAgICAgICAvLyBicmFja2V0cy4KCgogICAgICAgICAgICB2ID0gcGFydGlhbC5sZW5ndGggPT09IDAgPyAnW10nIDogZ2FwID8gJ1tcbicgKyBnYXAgKyBwYXJ0aWFsLmpvaW4oJyxcbicgKyBnYXApICsgJ1xuJyArIG1pbmQgKyAnXScgOiAnWycgKyBwYXJ0aWFsLmpvaW4oJywnKSArICddJzsKICAgICAgICAgICAgZ2FwID0gbWluZDsKICAgICAgICAgICAgcmV0dXJuIHY7CiAgICAgICAgICB9IC8vIGlmIHRoZSByZXBsYWNlciBpcyBhbiBhcnJheSwgdXNlIGl0IHRvIHNlbGVjdCB0aGUgbWVtYmVycyB0byBiZSBzdHJpbmdpZmllZC4KCgogICAgICAgICAgaWYgKHJlcCAmJiBfdHlwZW9mKHJlcCkgPT09ICdvYmplY3QnKSB7CiAgICAgICAgICAgIGxlbmd0aCA9IHJlcC5sZW5ndGg7CgogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbGVuZ3RoOyBpICs9IDEpIHsKICAgICAgICAgICAgICBpZiAodHlwZW9mIHJlcFtpXSA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgICAgICAgIGsgPSByZXBbaV07CiAgICAgICAgICAgICAgICB2ID0gc3RyKGssIHZhbHVlKTsKCiAgICAgICAgICAgICAgICBpZiAodikgewogICAgICAgICAgICAgICAgICBwYXJ0aWFsLnB1c2gocXVvdGUoaykgKyAoZ2FwID8gJzogJyA6ICc6JykgKyB2KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIG90aGVyd2lzZSwgaXRlcmF0ZSB0aHJvdWdoIGFsbCBvZiB0aGUga2V5cyBpbiB0aGUgb2JqZWN0LgogICAgICAgICAgICBmb3IgKGsgaW4gdmFsdWUpIHsKICAgICAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHZhbHVlLCBrKSkgewogICAgICAgICAgICAgICAgdiA9IHN0cihrLCB2YWx1ZSk7CgogICAgICAgICAgICAgICAgaWYgKHYpIHsKICAgICAgICAgICAgICAgICAgcGFydGlhbC5wdXNoKHF1b3RlKGspICsgKGdhcCA/ICc6ICcgOiAnOicpICsgdik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9IC8vIGpvaW4gYWxsIG9mIHRoZSBtZW1iZXIgdGV4dHMgdG9nZXRoZXIsIHNlcGFyYXRlZCB3aXRoIGNvbW1hcywKICAgICAgICAgIC8vIGFuZCB3cmFwIHRoZW0gaW4gYnJhY2VzLgoKCiAgICAgICAgICB2ID0gcGFydGlhbC5sZW5ndGggPT09IDAgPyAne30nIDogZ2FwID8gJ3tcbicgKyBnYXAgKyBwYXJ0aWFsLmpvaW4oJyxcbicgKyBnYXApICsgJ1xuJyArIG1pbmQgKyAnfScgOiAneycgKyBwYXJ0aWFsLmpvaW4oJywnKSArICd9JzsKICAgICAgICAgIGdhcCA9IG1pbmQ7CiAgICAgICAgICByZXR1cm4gdjsKICAgICAgfQogICAgfSAvLyBpZiB0aGUgSlNPTiBvYmplY3QgZG9lcyBub3QgeWV0IGhhdmUgYSBzdHJpbmdpZnkgbWV0aG9kLCBnaXZlIGl0IG9uZS4KCgogICAgaWYgKHR5cGVvZiBKU09OMi5zdHJpbmdpZnkgIT09ICdmdW5jdGlvbicpIHsKICAgICAgSlNPTjIuc3RyaW5naWZ5ID0gZnVuY3Rpb24gKHZhbHVlLCByZXBsYWNlciwgc3BhY2UpIHsKICAgICAgICAvLyB0aGUgc3RyaW5naWZ5IG1ldGhvZCB0YWtlcyBhIHZhbHVlIGFuZCBhbiBvcHRpb25hbCByZXBsYWNlciwgYW5kIGFuIG9wdGlvbmFsCiAgICAgICAgLy8gc3BhY2UgcGFyYW1ldGVyLCBhbmQgcmV0dXJucyBhIEpTT04gdGV4dC4gVGhlIHJlcGxhY2VyIGNhbiBiZSBhIGZ1bmN0aW9uCiAgICAgICAgLy8gdGhhdCBjYW4gcmVwbGFjZSB2YWx1ZXMsIG9yIGFuIGFycmF5IG9mIHN0cmluZ3MgdGhhdCB3aWxsIHNlbGVjdCB0aGUga2V5cy4KICAgICAgICAvLyBhIGRlZmF1bHQgcmVwbGFjZXIgbWV0aG9kIGNhbiBiZSBwcm92aWRlZC4gVXNlIG9mIHRoZSBzcGFjZSBwYXJhbWV0ZXIgY2FuCiAgICAgICAgLy8gcHJvZHVjZSB0ZXh0IHRoYXQgaXMgbW9yZSBlYXNpbHkgcmVhZGFibGUuCiAgICAgICAgdmFyIGk7CiAgICAgICAgZ2FwID0gJyc7CiAgICAgICAgaW5kZW50ID0gJyc7IC8vIGlmIHRoZSBzcGFjZSBwYXJhbWV0ZXIgaXMgYSBudW1iZXIsIG1ha2UgYW4gaW5kZW50IHN0cmluZyBjb250YWluaW5nIHRoYXQKICAgICAgICAvLyBtYW55IHNwYWNlcy4KCiAgICAgICAgaWYgKHR5cGVvZiBzcGFjZSA9PT0gJ251bWJlcicpIHsKICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBzcGFjZTsgaSArPSAxKSB7CiAgICAgICAgICAgIGluZGVudCArPSAnICc7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2Ygc3BhY2UgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICBpbmRlbnQgPSBzcGFjZTsKICAgICAgICB9IC8vIGlmIHRoZXJlIGlzIGEgcmVwbGFjZXIsIGl0IG11c3QgYmUgYSBmdW5jdGlvbiBvciBhbiBhcnJheS4KICAgICAgICAvLyBvdGhlcndpc2UsIHRocm93IGFuIGVycm9yLgoKCiAgICAgICAgcmVwID0gcmVwbGFjZXI7CgogICAgICAgIGlmIChyZXBsYWNlciAmJiB0eXBlb2YgcmVwbGFjZXIgIT09ICdmdW5jdGlvbicgJiYgKF90eXBlb2YocmVwbGFjZXIpICE9PSAnb2JqZWN0JyB8fCB0eXBlb2YgcmVwbGFjZXIubGVuZ3RoICE9PSAnbnVtYmVyJykpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcignSlNPTi5zdHJpbmdpZnknKTsKICAgICAgICB9IC8vIG1ha2UgYSBmYWtlIHJvb3Qgb2JqZWN0IGNvbnRhaW5pbmcgb3VyIHZhbHVlIHVuZGVyIHRoZSBrZXkgb2YgJycuCiAgICAgICAgLy8gcmV0dXJuIHRoZSByZXN1bHQgb2Ygc3RyaW5naWZ5aW5nIHRoZSB2YWx1ZS4KCgogICAgICAgIHJldHVybiBzdHIoJycsIHsKICAgICAgICAgICcnOiB2YWx1ZQogICAgICAgIH0pOwogICAgICB9OwogICAgfSAvLyBpZiB0aGUgSlNPTiBvYmplY3QgZG9lcyBub3QgeWV0IGhhdmUgYSBwYXJzZSBtZXRob2QsIGdpdmUgaXQgb25lLgoKCiAgICBpZiAodHlwZW9mIEpTT04yLnBhcnNlICE9PSAnZnVuY3Rpb24nKSB7CiAgICAgIEpTT04yLnBhcnNlID0gZnVuY3Rpb24gKHRleHQsIHJldml2ZXIpIHsKICAgICAgICAvLyB0aGUgcGFyc2UgbWV0aG9kIHRha2VzIGEgdGV4dCBhbmQgYW4gb3B0aW9uYWwgcmV2aXZlciBmdW5jdGlvbiwgYW5kIHJldHVybnMKICAgICAgICAvLyBhIEphdmFTY3JpcHQgdmFsdWUgaWYgdGhlIHRleHQgaXMgYSB2YWxpZCBKU09OIHRleHQuCiAgICAgICAgdmFyIGo7CgogICAgICAgIGZ1bmN0aW9uIHdhbGsoaG9sZGVyLCBrZXkpIHsKICAgICAgICAgIC8vIHRoZSB3YWxrIG1ldGhvZCBpcyB1c2VkIHRvIHJlY3Vyc2l2ZWx5IHdhbGsgdGhlIHJlc3VsdGluZyBzdHJ1Y3R1cmUgc28KICAgICAgICAgIC8vIHRoYXQgbW9kaWZpY2F0aW9ucyBjYW4gYmUgbWFkZS4KICAgICAgICAgIHZhciBrID0gbnVsbCwKICAgICAgICAgICAgICB2LAogICAgICAgICAgICAgIHZhbHVlID0gaG9sZGVyW2tleV07CgogICAgICAgICAgaWYgKHZhbHVlICYmIF90eXBlb2YodmFsdWUpID09PSAnb2JqZWN0JykgewogICAgICAgICAgICBmb3IgKGsgaW4gdmFsdWUpIHsKICAgICAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHZhbHVlLCBrKSkgewogICAgICAgICAgICAgICAgdiA9IHdhbGsodmFsdWUsIGspOwoKICAgICAgICAgICAgICAgIGlmICh2ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgdmFsdWVba10gPSB2OwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgdmFsdWVba10gPSB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHJldml2ZXIuY2FsbChob2xkZXIsIGtleSwgdmFsdWUpOwogICAgICAgIH0gLy8gcGFyc2luZyBoYXBwZW5zIGluIGZvdXIgc3RhZ2VzLiBJbiB0aGUgZmlyc3Qgc3RhZ2UsIHdlIHJlcGxhY2UgY2VydGFpbgogICAgICAgIC8vIHVuaWNvZGUgY2hhcmFjdGVycyB3aXRoIGVzY2FwZSBzZXF1ZW5jZXMuIEphdmFTY3JpcHQgaGFuZGxlcyBtYW55IGNoYXJhY3RlcnMKICAgICAgICAvLyBpbmNvcnJlY3RseSwgZWl0aGVyIHNpbGVudGx5IGRlbGV0aW5nIHRoZW0sIG9yIHRyZWF0aW5nIHRoZW0gYXMgbGluZSBlbmRpbmdzLgoKCiAgICAgICAgdGV4dCA9IFN0cmluZyh0ZXh0KTsKICAgICAgICBjeC5sYXN0SW5kZXggPSAwOwoKICAgICAgICBpZiAoY3gudGVzdCh0ZXh0KSkgewogICAgICAgICAgdGV4dCA9IHRleHQucmVwbGFjZShjeCwgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgcmV0dXJuICJcXHUiICsgKCcwMDAwJyArIGEuY2hhckNvZGVBdCgwKS50b1N0cmluZygxNikpLnNsaWNlKC00KTsKICAgICAgICAgIH0pOwogICAgICAgIH0gLy8gaW4gdGhlIHNlY29uZCBzdGFnZSwgd2UgcnVuIHRoZSB0ZXh0IGFnYWluc3QgcmVndWxhciBleHByZXNzaW9ucyB0aGF0IGxvb2sKICAgICAgICAvLyBmb3Igbm9uLUpTT04gcGF0dGVybnMuIFdlIGFyZSBlc3BlY2lhbGx5IGNvbmNlcm5lZCB3aXRoICcoKScgYW5kICduZXcnCiAgICAgICAgLy8gYmVjYXVzZSB0aGV5IGNhbiBjYXVzZSBpbnZvY2F0aW9uLCBhbmQgJz0nIGJlY2F1c2UgaXQgY2FuIGNhdXNlIG11dGF0aW9uLgogICAgICAgIC8vIGJ1dCBqdXN0IHRvIGJlIHNhZmUsIHdlIHdhbnQgdG8gcmVqZWN0IGFsbCB1bmV4cGVjdGVkIGZvcm1zLgogICAgICAgIC8vIHdlIHNwbGl0IHRoZSBzZWNvbmQgc3RhZ2UgaW50byA0IHJlZ2V4cCBvcGVyYXRpb25zIGluIG9yZGVyIHRvIHdvcmsgYXJvdW5kCiAgICAgICAgLy8gY3JpcHBsaW5nIGluZWZmaWNpZW5jaWVzIGluIElFJ3MgYW5kIFNhZmFyaSdzIHJlZ2V4cCBlbmdpbmVzLiBGaXJzdCB3ZQogICAgICAgIC8vIHJlcGxhY2UgdGhlIEpTT04gYmFja3NsYXNoIHBhaXJzIHdpdGggJ0AnIChhIG5vbi1KU09OIGNoYXJhY3RlcikuIFNlY29uZCwgd2UKICAgICAgICAvLyByZXBsYWNlIGFsbCBzaW1wbGUgdmFsdWUgdG9rZW5zIHdpdGggJ10nIGNoYXJhY3RlcnMuIFRoaXJkLCB3ZSBkZWxldGUgYWxsCiAgICAgICAgLy8gb3BlbiBicmFja2V0cyB0aGF0IGZvbGxvdyBhIGNvbG9uIG9yIGNvbW1hIG9yIHRoYXQgYmVnaW4gdGhlIHRleHQuIEZpbmFsbHksCiAgICAgICAgLy8gd2UgbG9vayB0byBzZWUgdGhhdCB0aGUgcmVtYWluaW5nIGNoYXJhY3RlcnMgYXJlIG9ubHkgd2hpdGVzcGFjZSBvciAnXScgb3IKICAgICAgICAvLyAnLCcgb3IgJzonIG9yICd7JyBvciAnfScuIElmIHRoYXQgaXMgc28sIHRoZW4gdGhlIHRleHQgaXMgc2FmZSBmb3IgZXZhbC4KCgogICAgICAgIGlmICgvXltcXSw6e31cc10qJC8udGVzdCh0ZXh0LnJlcGxhY2UoL1xcKD86WyJcXFwvYmZucnRdfHVbMC05YS1mQS1GXXs0fSkvZywgJ0AnKS5yZXBsYWNlKC8iW14iXFxcblxyXSoifHRydWV8ZmFsc2V8bnVsbHwtP1xkKyg/OlwuXGQqKT8oPzpbZUVdWytcLV0/XGQrKT8vZywgJ10nKS5yZXBsYWNlKC8oPzpefDp8LCkoPzpccypcWykrL2csICcnKSkpIHsKICAgICAgICAgIC8vIGluIHRoZSB0aGlyZCBzdGFnZSB3ZSB1c2UgdGhlIGV2YWwgZnVuY3Rpb24gdG8gY29tcGlsZSB0aGUgdGV4dCBpbnRvIGEKICAgICAgICAgIC8vIGphdmFzY3JpcHQgc3RydWN0dXJlLiBUaGUgJ3snIG9wZXJhdG9yIGlzIHN1YmplY3QgdG8gYSBzeW50YWN0aWMgYW1iaWd1aXR5CiAgICAgICAgICAvLyBpbiBKYXZhU2NyaXB0OiBpdCBjYW4gYmVnaW4gYSBibG9jayBvciBhbiBvYmplY3QgbGl0ZXJhbC4gV2Ugd3JhcCB0aGUgdGV4dAogICAgICAgICAgLy8gaW4gcGFyZW5zIHRvIGVsaW1pbmF0ZSB0aGUgYW1iaWd1aXR5LgogICAgICAgICAgaiA9IG5ldyBGdW5jdGlvbigncmV0dXJuICgnICsgdGV4dCArICcpJykoKTsgLy8gaW4gdGhlIG9wdGlvbmFsIGZvdXJ0aCBzdGFnZSwgd2UgcmVjdXJzaXZlbHkgd2FsayB0aGUgbmV3IHN0cnVjdHVyZSwgcGFzc2luZwogICAgICAgICAgLy8gZWFjaCBuYW1lL3ZhbHVlIHBhaXIgdG8gYSByZXZpdmVyIGZ1bmN0aW9uIGZvciBwb3NzaWJsZSB0cmFuc2Zvcm1hdGlvbi4KCiAgICAgICAgICByZXR1cm4gdHlwZW9mIHJldml2ZXIgPT09ICdmdW5jdGlvbicgPyB3YWxrKHsKICAgICAgICAgICAgJyc6IGoKICAgICAgICAgIH0sICcnKSA6IGo7CiAgICAgICAgfSAvLyBpZiB0aGUgdGV4dCBpcyBub3QgSlNPTiBwYXJzZWFibGUsIHRoZW4gYSBTeW50YXhFcnJvciBpcyB0aHJvd24uCgoKICAgICAgICB0aHJvdyBuZXcgU3ludGF4RXJyb3IoJ0pTT04ucGFyc2UnKTsKICAgICAgfTsKICAgIH0KICB9KSgpOwoKICB2YXIgSnNvbnBSZXF1ZXN0ID0gZnVuY3Rpb24gKCkgewogICAgZnVuY3Rpb24gSnNvbnBSZXF1ZXN0KHVybCwgcGF5bG9hZCkgewogICAgICBpZiAodXJsID09PSB2b2lkIDApIHsKICAgICAgICB1cmwgPSAiIjsKICAgICAgfQoKICAgICAgaWYgKHBheWxvYWQgPT09IHZvaWQgMCkgewogICAgICAgIHBheWxvYWQgPSAiIjsKICAgICAgfQoKICAgICAgdGhpcy51cmwgPSB1cmw7CiAgICAgIHRoaXMucGF5bG9hZCA9IHBheWxvYWQ7CiAgICAgIHRoaXMudHlwZSA9ICJqc29ucCI7CiAgICB9CgogICAgcmV0dXJuIEpzb25wUmVxdWVzdDsKICB9KCk7CgogIHZhciBOdWxsUmVxdWVzdCA9IGZ1bmN0aW9uICgpIHsKICAgIGZ1bmN0aW9uIE51bGxSZXF1ZXN0KHBheWxvYWQpIHsKICAgICAgaWYgKHBheWxvYWQgPT09IHZvaWQgMCkgewogICAgICAgIHBheWxvYWQgPSB7fTsKICAgICAgfQoKICAgICAgdGhpcy5wYXlsb2FkID0gcGF5bG9hZDsKICAgICAgdGhpcy50eXBlID0gIm51bGwiOwogICAgfQoKICAgIHJldHVybiBOdWxsUmVxdWVzdDsKICB9KCk7CiAgLyoqCiAgICogQG5hbWVzcGFjZSBIZWFydGxhbmQuQWpheAogICAqLwoKCiAgdmFyIEFqYXggPSBmdW5jdGlvbiAoKSB7CiAgICBmdW5jdGlvbiBBamF4KCkge30KICAgIC8qKgogICAgICogSGVhcnRsYW5kLkFqYXguanNvbnAKICAgICAqCiAgICAgKiBDcmVhdGVzIGEgbmV3IERPTSBub2RlIGNvbnRhaW5pbmcgYSBjcmVhdGVkIEpTT05QIGNhbGxiYWNrIGhhbmRsZXIgZm9yIGFuCiAgICAgKiBpbXBlbmRpbmcgQWpheCBKU09OUCByZXF1ZXN0LiBSZW1vdmVzIG5lZWQgZm9yIGBYTUxIdHRwUmVxdWVzdGAuCiAgICAgKgogICAgICogQHBhcmFtIHtzdHJpbmd9IHVybAogICAgICogQHBhcmFtIHtmdW5jdGlvbn0gY2FsbGJhY2sKICAgICAqLwoKCiAgICBBamF4Lmpzb25wID0gZnVuY3Rpb24gKHJlcXVlc3QsIGNhbGxiYWNrKSB7CiAgICAgIHZhciBzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTsKICAgICAgdmFyIGNhbGxiYWNrTmFtZSA9ICdqc29ucF9jYWxsYmFja18nICsgTWF0aC5yb3VuZCgxMDAwMDAgKiBNYXRoLnJhbmRvbSgpKTsKCiAgICAgIHdpbmRvd1tjYWxsYmFja05hbWVdID0gZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICB3aW5kb3dbY2FsbGJhY2tOYW1lXSA9IHVuZGVmaW5lZDsKICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKHNjcmlwdCk7CiAgICAgICAgY2FsbGJhY2soZGF0YSk7CiAgICAgIH07CgogICAgICBzY3JpcHQuc3JjID0gcmVxdWVzdC51cmwgKyAocmVxdWVzdC51cmwuaW5kZXhPZignPycpID49IDAgPyAnJicgOiAnPycpICsgJ2NhbGxiYWNrPScgKyBjYWxsYmFja05hbWUgKyAnJicgKyByZXF1ZXN0LnBheWxvYWQ7CiAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoc2NyaXB0KTsKICAgIH07CiAgICAvKioKICAgICAqIEhlYXJ0bGFuZC5BamF4LmNvcnMKICAgICAqCiAgICAgKiBDcmVhdGVzIGEgbmV3IGBYTUxIdHRwUmVxdWVzdGAgb2JqZWN0IGZvciBhIFBPU1QgcmVxdWVzdCB0byB0aGUgZ2l2ZW4gYHVybGAuCiAgICAgKgogICAgICogQHBhcmFtIHtzdHJpbmd9IHVybAogICAgICogQHBhcmFtIHtmdW5jdGlvbn0gY2FsbGJhY2sKICAgICAqLwoKCiAgICBBamF4LmNvcnMgPSBmdW5jdGlvbiAocmVxdWVzdCwgY2FsbGJhY2spIHsKICAgICAgdmFyIHhocjsKICAgICAgdmFyIG1ldGhvZCA9ICdQT1NUJzsKICAgICAgdmFyIHRpbWVvdXQ7CgogICAgICBpZiAobmV3IFhNTEh0dHBSZXF1ZXN0KCkud2l0aENyZWRlbnRpYWxzID09PSB1bmRlZmluZWQpIHsKICAgICAgICB4aHIgPSBuZXcgd2luZG93LlhEb21haW5SZXF1ZXN0KCk7CiAgICAgICAgbWV0aG9kID0gJ0dFVCc7CiAgICAgICAgcmVxdWVzdC51cmwgPSByZXF1ZXN0LnVybC5zcGxpdCgnPycpWzBdOwogICAgICAgIHJlcXVlc3QudXJsID0gcmVxdWVzdC51cmwgKyAnPycgKyByZXF1ZXN0LnBheWxvYWQ7CiAgICAgICAgeGhyLm9wZW4obWV0aG9kLCByZXF1ZXN0LnVybCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7CiAgICAgICAgeGhyLm9wZW4obWV0aG9kLCByZXF1ZXN0LnVybCk7CiAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnKTsKICAgICAgfQoKICAgICAgdmFyIGNiID0gZnVuY3Rpb24gY2IoZSkgewogICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0KTsKCiAgICAgICAgaWYgKGUudHlwZSA9PT0gJ2Vycm9yJykgewogICAgICAgICAgY2FsbGJhY2soewogICAgICAgICAgICBlcnJvcjogewogICAgICAgICAgICAgIG1lc3NhZ2U6ICdjb21tdW5pY2F0aW9uIGVycm9yJwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlmICh4aHIucmVhZHlTdGF0ZSA9PT0gNCB8fCB4aHIucmVhZHlTdGF0ZSAhPT0gNCAmJiB4aHIucmVzcG9uc2VUZXh0ICE9PSAnJykgewogICAgICAgICAgdmFyIGRhdGEgPSBKU09OMi5wYXJzZSh4aHIucmVzcG9uc2VUZXh0KTsKICAgICAgICAgIGNhbGxiYWNrKGRhdGEpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjYWxsYmFjayh7CiAgICAgICAgICAgIGVycm9yOiB7CiAgICAgICAgICAgICAgbWVzc2FnZTogJ25vIGRhdGEnCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfTsKCiAgICAgIHhoci5vbmxvYWQgPSBjYjsKICAgICAgeGhyLm9uZXJyb3IgPSBjYjsKICAgICAgeGhyLnNlbmQocmVxdWVzdC5wYXlsb2FkKTsKICAgICAgdGltZW91dCA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgIHhoci5hYm9ydCgpOwogICAgICAgIGNhbGxiYWNrKHsKICAgICAgICAgIGVycm9yOiB7CiAgICAgICAgICAgIG1lc3NhZ2U6ICd0aW1lb3V0JwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9LCA1MDAwKTsKICAgIH07CgogICAgcmV0dXJuIEFqYXg7CiAgfSgpOwoKICB2YXIgY2FyZFR5cGVzID0gW3sKICAgIGNvZGU6ICd2aXNhJywKICAgIGZvcm1hdDogLyhcZHsxLDR9KS9nLAogICAgbGVuZ3RoOiAxNiwKICAgIHJlZ2V4OiAvXjQvCiAgfSwgewogICAgY29kZTogJ21hc3RlcmNhcmQnLAogICAgZm9ybWF0OiAvKFxkezEsNH0pL2csCiAgICBsZW5ndGg6IDE2LAogICAgcmVnZXg6IC9eKDVbMS01XXwyWzItN10pLwogIH0sIHsKICAgIGNvZGU6ICdhbWV4JywKICAgIGZvcm1hdDogLyhcZHsxLDR9KShcZHsxLDZ9KT8oXGR7MSw1fSk/LywKICAgIGxlbmd0aDogMTUsCiAgICByZWdleDogL14zWzQ3XS8KICB9LCB7CiAgICBjb2RlOiAnZGluZXJzJywKICAgIGZvcm1hdDogLyhcZHsxLDR9KShcZHsxLDZ9KT8oXGR7MSw0fSk/LywKICAgIGxlbmd0aDogMTQsCiAgICByZWdleDogL14zWzA2ODldLwogIH0sIHsKICAgIGNvZGU6ICdkaXNjb3ZlcicsCiAgICBmb3JtYXQ6IC8oXGR7MSw0fSkvZywKICAgIGxlbmd0aDogMTYsCiAgICByZWdleDogL142KFswNDVdfDIyKS8KICB9LCB7CiAgICBjb2RlOiAnamNiJywKICAgIGZvcm1hdDogLyhcZHsxLDR9KS9nLAogICAgbGVuZ3RoOiAxNiwKICAgIHJlZ2V4OiAvXjM1LwogIH1dOwoKICB2YXIgQ2FyZE51bWJlciA9IGZ1bmN0aW9uICgpIHsKICAgIGZ1bmN0aW9uIENhcmROdW1iZXIoKSB7fQoKICAgIENhcmROdW1iZXIucHJvdG90eXBlLmZvcm1hdCA9IGZ1bmN0aW9uIChudW1iZXIpIHsKICAgICAgbnVtYmVyID0gbnVtYmVyLnJlcGxhY2UoL1xEL2csICcnKTsKICAgICAgdmFyIHR5cGUgPSBDYXJkLnR5cGVCeU51bWJlcihudW1iZXIpOwoKICAgICAgaWYgKCF0eXBlKSB7CiAgICAgICAgcmV0dXJuIG51bWJlcjsKICAgICAgfQoKICAgICAgdmFyIG1hdGNoZXMgPSBudW1iZXIubWF0Y2godHlwZS5mb3JtYXQpOwoKICAgICAgaWYgKCFtYXRjaGVzKSB7CiAgICAgICAgcmV0dXJuIG51bWJlcjsKICAgICAgfQoKICAgICAgaWYgKCF0eXBlLmZvcm1hdC5nbG9iYWwpIHsKICAgICAgICBtYXRjaGVzLnNoaWZ0KCk7CiAgICAgIH0KCiAgICAgIHJldHVybiBtYXRjaGVzLmpvaW4oJyAnKS5yZXBsYWNlKC9eXHMrfFxzKyQvZ20sICcnKTsKICAgIH07CgogICAgcmV0dXJuIENhcmROdW1iZXI7CiAgfSgpOwoKICB2YXIgRXhwaXJhdGlvbiA9IGZ1bmN0aW9uICgpIHsKICAgIGZ1bmN0aW9uIEV4cGlyYXRpb24oKSB7fQoKICAgIEV4cGlyYXRpb24ucHJvdG90eXBlLmZvcm1hdCA9IGZ1bmN0aW9uIChleHAsIGZpbmFsKSB7CiAgICAgIGlmIChmaW5hbCA9PT0gdm9pZCAwKSB7CiAgICAgICAgZmluYWwgPSBmYWxzZTsKICAgICAgfQoKICAgICAgdmFyIHBhdCA9IC9eXEQqKFxkezEsMn0pKFxEKyk/KFxkezEsNH0pPy87CiAgICAgIHZhciBncm91cHMgPSBleHAubWF0Y2gocGF0KTsKICAgICAgdmFyIG1vbnRoOwogICAgICB2YXIgZGVsOwogICAgICB2YXIgeWVhcjsKCiAgICAgIGlmICghZ3JvdXBzKSB7CiAgICAgICAgcmV0dXJuICcnOwogICAgICB9CgogICAgICBtb250aCA9IGdyb3Vwc1sxXSB8fCAnJzsKICAgICAgZGVsID0gZ3JvdXBzWzJdIHx8ICcnOwogICAgICB5ZWFyID0gZ3JvdXBzWzNdIHx8ICcnOwoKICAgICAgaWYgKHllYXIubGVuZ3RoID4gMCkgewogICAgICAgIGRlbCA9ICcgLyAnOwogICAgICB9IGVsc2UgaWYgKG1vbnRoLmxlbmd0aCA9PT0gMiB8fCBkZWwubGVuZ3RoID4gMCkgewogICAgICAgIGRlbCA9ICcgLyAnOwogICAgICB9IGVsc2UgaWYgKG1vbnRoLmxlbmd0aCA9PT0gMSAmJiBtb250aCAhPT0gJzAnICYmIG1vbnRoICE9PSAnMScpIHsKICAgICAgICBkZWwgPSAnIC8gJzsKICAgICAgfQoKICAgICAgaWYgKG1vbnRoLmxlbmd0aCA9PT0gMSAmJiBkZWwgIT09ICcnKSB7CiAgICAgICAgbW9udGggPSAnMCcgKyBtb250aDsKICAgICAgfQoKICAgICAgaWYgKGZpbmFsICYmIHllYXIubGVuZ3RoID09PSAyKSB7CiAgICAgICAgeWVhciA9IG5ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKS50b1N0cmluZygpLnNsaWNlKDAsIDIpICsgeWVhcjsKICAgICAgfQoKICAgICAgcmV0dXJuIG1vbnRoICsgZGVsICsgeWVhcjsKICAgIH07CgogICAgcmV0dXJuIEV4cGlyYXRpb247CiAgfSgpOwoKICB2YXIgQ2FyZE51bWJlciQxID0gZnVuY3Rpb24gKCkgewogICAgZnVuY3Rpb24gQ2FyZE51bWJlcigpIHt9CgogICAgQ2FyZE51bWJlci5wcm90b3R5cGUudmFsaWRhdGUgPSBmdW5jdGlvbiAobnVtYmVyKSB7CiAgICAgIGlmICghbnVtYmVyKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICBudW1iZXIgPSBudW1iZXIucmVwbGFjZSgvWy1cc10vZywgJycpOwogICAgICB2YXIgdHlwZSA9IENhcmQudHlwZUJ5TnVtYmVyKG51bWJlcik7CgogICAgICBpZiAoIXR5cGUpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHJldHVybiBDYXJkLmx1aG5DaGVjayhudW1iZXIpICYmIG51bWJlci5sZW5ndGggPT09IHR5cGUubGVuZ3RoOwogICAgfTsKCiAgICByZXR1cm4gQ2FyZE51bWJlcjsKICB9KCk7CgogIHZhciBDdnYgPSBmdW5jdGlvbiAoKSB7CiAgICBmdW5jdGlvbiBDdnYoKSB7fQoKICAgIEN2di5wcm90b3R5cGUudmFsaWRhdGUgPSBmdW5jdGlvbiAoY3Z2KSB7CiAgICAgIGlmICghY3Z2KSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICBjdnYgPSBjdnYucmVwbGFjZSgvXlxzK3xccyskL2csICcnKTsKCiAgICAgIGlmICghL15cZCskLy50ZXN0KGN2dikpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHJldHVybiAzIDw9IGN2di5sZW5ndGggJiYgY3Z2Lmxlbmd0aCA8PSA0OwogICAgfTsKCiAgICByZXR1cm4gQ3Z2OwogIH0oKTsKCiAgdmFyIEV4cGlyYXRpb24kMSA9IGZ1bmN0aW9uICgpIHsKICAgIGZ1bmN0aW9uIEV4cGlyYXRpb24oKSB7fQoKICAgIEV4cGlyYXRpb24ucHJvdG90eXBlLnZhbGlkYXRlID0gZnVuY3Rpb24gKGV4cCkgewogICAgICB2YXIgbSwgeTsKCiAgICAgIGlmICghZXhwKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICB2YXIgc3BsaXQgPSBleHAuc3BsaXQoJy8nKTsKICAgICAgbSA9IHNwbGl0WzBdLCB5ID0gc3BsaXRbMV07CgogICAgICBpZiAoIW0gfHwgIXkpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIG0gPSBtLnJlcGxhY2UoL15ccyt8XHMrJC9nLCAnJyk7CiAgICAgIHkgPSB5LnJlcGxhY2UoL15ccyt8XHMrJC9nLCAnJyk7CgogICAgICBpZiAoIS9eXGQrJC8udGVzdChtKSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgaWYgKCEvXlxkKyQvLnRlc3QoeSkpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIGlmICh5Lmxlbmd0aCA9PT0gMikgewogICAgICAgIHkgPSBuZXcgRGF0ZSgpLmdldEZ1bGxZZWFyKCkudG9TdHJpbmcoKS5zbGljZSgwLCAyKSArIHk7CiAgICAgIH0KCiAgICAgIHZhciBtb250aCA9IHBhcnNlSW50KG0sIDEwKTsKICAgICAgdmFyIHllYXIgPSBwYXJzZUludCh5LCAxMCk7CgogICAgICBpZiAoISgxIDw9IG1vbnRoICYmIG1vbnRoIDw9IDEyKSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfSAvLyBjcmVhdGVzIGRhdGUgYXMgMSBkYXkgcGFzdCBlbmQgb2YKICAgICAgLy8gZXhwaXJhdGlvbiBtb250aCBzaW5jZSBKUyBtb250aHMKICAgICAgLy8gYXJlIDAgaW5kZXhlZAoKCiAgICAgIHJldHVybiBuZXcgRGF0ZSh5ZWFyLCBtb250aCwgMSkgPiBuZXcgRGF0ZSgpOwogICAgfTsKCiAgICByZXR1cm4gRXhwaXJhdGlvbjsKICB9KCk7CiAgLyoqCiAgICogQG5hbWVzcGFjZSBIZWFydGxhbmQuRE9NCiAgICovCgoKICB2YXIgRE9NID0gZnVuY3Rpb24gKCkgewogICAgZnVuY3Rpb24gRE9NKCkge30KICAgIC8qKgogICAgICogSGVhcnRsYW5kLkRPTS5jb25maWd1cmVGaWVsZAogICAgICoKICAgICAqIENvbmZpZ3VyZXMgYW4gaW5wdXQgZmllbGQgaW4gYSBzaW5nbGUgZmllbGQgaUZyYW1lLgogICAgICoKICAgICAqIEBwYXJhbSB7SGVhcnRsYW5kLkhQU30gaHBzCiAgICAgKi8KCgogICAgRE9NLmNvbmZpZ3VyZUZpZWxkID0gZnVuY3Rpb24gKGhwcykgewogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGVhcnRsYW5kLWZpZWxkJykuc2V0QXR0cmlidXRlKCduYW1lJywgaHBzLmZpZWxkKTsKICAgIH07CiAgICAvKioKICAgICAqIEhlYXJ0bGFuZC5ET00ubWFrZUZyYW1lCiAgICAgKgogICAgICogQ3JlYXRlcyBhIHNpbmdsZSBpRnJhbWUgZWxlbWVudCB3aXRoIHRoZSBhcHByb3ByaWF0ZSBkZWZhdWx0cy4KICAgICAqCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gbmFtZQogICAgICogQHJldHVybnMge0hUTUxJZnJhbWVFbGVtZW50fQogICAgICovCgoKICAgIERPTS5tYWtlRnJhbWUgPSBmdW5jdGlvbiAobmFtZSkgewogICAgICB2YXIgZnJhbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpZnJhbWUnKTsKICAgICAgZnJhbWUuaWQgPSAnaGVhcnRsYW5kLWZyYW1lLScgKyBuYW1lOwogICAgICBmcmFtZS5uYW1lID0gbmFtZTsKICAgICAgZnJhbWUuc3R5bGUuYm9yZGVyID0gJzAnOwogICAgICBmcmFtZS5mcmFtZUJvcmRlciA9ICcwJzsKICAgICAgZnJhbWUuc2Nyb2xsaW5nID0gJ25vJzsKICAgICAgcmV0dXJuIGZyYW1lOwogICAgfTsKICAgIC8qKgogICAgICogSGVhcnRsYW5kLkRPTS5hZGRGaWVsZAogICAgICoKICAgICAqIEFkZHMgYSBET00gYGlucHV0YCBub2RlIHRvIGBmb3JtUGFyZW50YCB3aXRoIHR5cGUgYGZpZWxkVHlwZWAsIG5hbWUKICAgICAqIGBmaWVsZE5hbWVgLCBhbmQgdmFsdWUgYGZpZWxkVmFsdWVgLgogICAgICoKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBmb3JtUGFyZW50CiAgICAgKiBAcGFyYW0ge3N0cmluZ30gZmllbGRUeXBlCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gZmllbGROYW1lCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gZmllbGRWYWx1ZQogICAgICovCgoKICAgIERPTS5hZGRGaWVsZCA9IGZ1bmN0aW9uIChmb3JtUGFyZW50LCBmaWVsZFR5cGUsIGZpZWxkTmFtZSwgZmllbGRWYWx1ZSkgewogICAgICB2YXIgaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpOwogICAgICBpbnB1dC5zZXRBdHRyaWJ1dGUoJ3R5cGUnLCBmaWVsZFR5cGUpOwogICAgICBpbnB1dC5zZXRBdHRyaWJ1dGUoJ25hbWUnLCBmaWVsZE5hbWUpOwogICAgICBpbnB1dC5zZXRBdHRyaWJ1dGUoJ3ZhbHVlJywgZmllbGRWYWx1ZSk7CiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGZvcm1QYXJlbnQpLmFwcGVuZENoaWxkKGlucHV0KTsKICAgIH07CiAgICAvKioKICAgICAqIEhlYXJ0bGFuZC5ET00uc2V0U3R5bGUKICAgICAqCiAgICAgKiBTZXRzIGFuIGVsZW1lbnQncyBzdHlsZSBhdHRyaWJ1dGUgd2l0aGluIGEgY2hpbGQgaWZyYW1lIHdpbmRvdy4KICAgICAqCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gZWxlbWVudGlkCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gaHRtbHN0eWxlCiAgICAgKi8KCgogICAgRE9NLnNldFN0eWxlID0gZnVuY3Rpb24gKGVsZW1lbnRpZCwgaHRtbHN0eWxlKSB7CiAgICAgIHZhciBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGVsZW1lbnRpZCk7CgogICAgICBpZiAoZWwpIHsKICAgICAgICBlbC5zZXRBdHRyaWJ1dGUoJ3N0eWxlJywgRE9NLmVuY29kZUVudGl0aWVzKGh0bWxzdHlsZSkpOwogICAgICB9CiAgICB9OwogICAgLyoqCiAgICAgKiBIZWFydGxhbmQuRE9NLmFwcGVuZFN0eWxlCiAgICAgKgogICAgICogQXBwZW5kcyBhbiBlbGVtZW50J3Mgc3R5bGUgYXR0cmlidXRlIHdpdGhpbiBhIGNoaWxkIGlmcmFtZSB3aW5kb3cuCiAgICAgKgogICAgICogQHBhcmFtIHtzdHJpbmd9IGVsZW1lbnRpZAogICAgICogQHBhcmFtIHtTdHJpbmd9IGh0bWxzdHlsZQogICAgICovCgoKICAgIERPTS5hcHBlbmRTdHlsZSA9IGZ1bmN0aW9uIChlbGVtZW50aWQsIGh0bWxzdHlsZSkgewogICAgICB2YXIgZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChlbGVtZW50aWQpOwoKICAgICAgaWYgKGVsKSB7CiAgICAgICAgdmFyIGN1cnJzdHlsZSA9IGVsLmdldEF0dHJpYnV0ZSgnc3R5bGUnKTsKICAgICAgICB2YXIgbmV3c3R5bGUgPSAoY3VycnN0eWxlID8gY3VycnN0eWxlIDogJycpICsgaHRtbHN0eWxlOwogICAgICAgIGVsLnNldEF0dHJpYnV0ZSgnc3R5bGUnLCBET00uZW5jb2RlRW50aXRpZXMobmV3c3R5bGUpKTsKICAgICAgfQogICAgfTsKICAgIC8qKgogICAgICogSGVhcnRsYW5kLkRPTS5zZXRUZXh0CiAgICAgKgogICAgICogU2V0cyBhbiBlbGVtZW50J3MgaW5uZXIgdGV4dCB3aXRoaW4gYSBjaGlsZCBpZnJhbWUgd2luZG93LgogICAgICoKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBlbGVtZW50aWQKICAgICAqIEBwYXJhbSB7c3RyaW5nfSB0ZXh0CiAgICAgKi8KCgogICAgRE9NLnNldFRleHQgPSBmdW5jdGlvbiAoZWxlbWVudGlkLCB0ZXh0KSB7CiAgICAgIHZhciBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGVsZW1lbnRpZCk7CgogICAgICBpZiAoZWwpIHsKICAgICAgICBlbC50ZXh0Q29udGVudCA9IERPTS5lbmNvZGVFbnRpdGllcyh0ZXh0KTsKICAgICAgfQogICAgfTsKICAgIC8qKgogICAgICogSGVhcnRsYW5kLkRPTS5zZXRWYWx1ZQogICAgICoKICAgICAqIFNldHMgYW4gZWxlbWVudCdzIHZhbHVlIHdpdGhpbiBhIGNoaWxkIGlmcmFtZSB3aW5kb3cKICAgICAqCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gZWxlbWVudGlkCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdmFsdWUKICAgICAqLwoKCiAgICBET00uc2V0VmFsdWUgPSBmdW5jdGlvbiAoZWxlbWVudGlkLCB0ZXh0KSB7CiAgICAgIHZhciBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGVsZW1lbnRpZCk7CgogICAgICBpZiAoZWwgJiYgdHlwZW9mIGVsLnZhbHVlICE9PSAidW5kZWZpbmVkIikgewogICAgICAgIGVsLnZhbHVlID0gRE9NLmVuY29kZUVudGl0aWVzKHRleHQpOwogICAgICB9CiAgICB9OwogICAgLyoqCiAgICAgKiBIZWFydGxhbmQuRE9NLnNldFBsYWNlaG9sZGVyCiAgICAgKgogICAgICogU2V0cyBhbiBlbGVtZW50J3MgcGxhY2Vob2xkZXIgYXR0cmlidXRlIHdpdGhpbiBhIGNoaWxkIGlmcmFtZSB3aW5kb3cuCiAgICAgKgogICAgICogQHBhcmFtIHtzdHJpbmd9IGVsZW1lbnRpZAogICAgICogQHBhcmFtIHtzdHJpbmd9IHRleHQKICAgICAqLwoKCiAgICBET00uc2V0UGxhY2Vob2xkZXIgPSBmdW5jdGlvbiAoZWxlbWVudGlkLCB0ZXh0KSB7CiAgICAgIHZhciBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGVsZW1lbnRpZCk7CgogICAgICBpZiAoZWwpIHsKICAgICAgICBpZiAodGV4dCA9PT0gJ+KAouKAouKAouKAoiDigKLigKLigKLigKIg4oCi4oCi4oCi4oCiIOKAouKAouKAouKAoicgfHwgdGV4dCA9PT0gJ+KAouKAouKAouKAoicgfHwgdGV4dCA9PT0gJ+KAouKAouKAoicgfHwgdGV4dCA9PT0gJ8K3wrfCt8K3IMK3wrfCt8K3IMK3wrfCt8K3IMK3wrfCt8K3JykgewogICAgICAgICAgZWwuc2V0QXR0cmlidXRlKCdwbGFjZWhvbGRlcicsIHRleHQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBlbC5zZXRBdHRyaWJ1dGUoJ3BsYWNlaG9sZGVyJywgRE9NLmVuY29kZUVudGl0aWVzKHRleHQpKTsKICAgICAgICB9CiAgICAgIH0KICAgIH07CiAgICAvKioKICAgICAqIEhlYXJ0bGFuZC5ET00ucmVzaXplRnJhbWUKICAgICAqCiAgICAgKiBBbGVydHMgYSBwYXJlbnQgd2luZG93IHRvIHJlc2l6ZSB0aGUgaWZyYW1lLgogICAgICoKICAgICAqIEBwYXJhbSB7SGVhcnRsYW5kLkhQU30gaHBzCiAgICAgKi8KCgogICAgRE9NLnJlc2l6ZUZyYW1lID0gZnVuY3Rpb24gKGhwcykgewogICAgICB2YXIgZG9jSGVpZ2h0ID0gZG9jdW1lbnQuYm9keS5vZmZzZXRIZWlnaHQgKyAxOyAvLyBvZmYgYnkgb25lIGVycm9yCgogICAgICBocHMuTWVzc2FnZXMucG9zdCh7CiAgICAgICAgYWN0aW9uOiAncmVzaXplJywKICAgICAgICBoZWlnaHQ6IGRvY0hlaWdodAogICAgICB9LCAncGFyZW50Jyk7CiAgICB9OwogICAgLyoqCiAgICAgKiBIZWFydGxhbmQuRE9NLnNldEZpZWxkRGF0YQogICAgICoKICAgICAqIFJlY2VpdmVzIGEgZmllbGQgdmFsdWUgZnJvbSBhbm90aGVyIGZyYW1lIHByaW9yIHRvIHRoZSB0b2tlbml6YXRpb24gcHJvY2Vzcy4KICAgICAqCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gZWxlbWVudGlkCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdmFsdWUKICAgICAqLwoKCiAgICBET00uc2V0RmllbGREYXRhID0gZnVuY3Rpb24gKGVsZW1lbnRpZCwgdmFsdWUpIHsKICAgICAgdmFyIGVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZWxlbWVudGlkKTsKCiAgICAgIGlmICghZWwgJiYgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hlYXJ0bGFuZC1maWVsZCcpKSB7CiAgICAgICAgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpOwogICAgICAgIGVsLnNldEF0dHJpYnV0ZSgnaWQnLCBET00uZW5jb2RlRW50aXRpZXMoZWxlbWVudGlkKSk7CiAgICAgICAgZWwuc2V0QXR0cmlidXRlKCd0eXBlJywgJ2hpZGRlbicpOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZWFydGxhbmQtZmllbGQtd3JhcHBlcicpLmFwcGVuZENoaWxkKGVsKTsKICAgICAgfQoKICAgICAgaWYgKGVsKSB7CiAgICAgICAgZWwuc2V0QXR0cmlidXRlKCd2YWx1ZScsIERPTS5lbmNvZGVFbnRpdGllcyh2YWx1ZSkpOwogICAgICB9CiAgICB9OwogICAgLyoqCiAgICAgKiBIZWFydGxhbmQuRE9NLmdldEZpZWxkRGF0YQogICAgICoKICAgICAqIFJldHJpZXZlcyBhIGZpZWxkIHZhbHVlIGZvciBhbm90aGVyIGZyYW1lIHByaW9yIHRvIHRoZSB0b2tlbml6YXRpb24gcHJvY2Vzcy4KICAgICAqCiAgICAgKiBAcGFyYW0ge0hlYXJ0bGFuZC5IUFN9IGhwcwogICAgICogQHBhcmFtIHtzdHJpbmd9IGVsZW1lbnRpZAogICAgICovCgoKICAgIERPTS5nZXRGaWVsZERhdGEgPSBmdW5jdGlvbiAoaHBzLCBlbGVtZW50aWQpIHsKICAgICAgdmFyIGVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZWxlbWVudGlkKTsKCiAgICAgIGlmIChlbCkgewogICAgICAgIGhwcy5NZXNzYWdlcy5wb3N0KHsKICAgICAgICAgIGFjdGlvbjogJ3Bhc3NEYXRhJywKICAgICAgICAgIHZhbHVlOiBlbC52YWx1ZQogICAgICAgIH0sICdwYXJlbnQnKTsKICAgICAgfQogICAgfTsKICAgIC8qKgogICAgICogSGVhcnRsYW5kLkRPTS5hZGRTdHlsZXNoZWV0CiAgICAgKgogICAgICogQ3JlYXRlcyBhIGBzdHlsZWAgbm9kZSBpbiB0aGUgRE9NIHdpdGggdGhlIGdpdmVuIGBjc3NgLgogICAgICoKICAgICAqIEBwYXJhbSB7SGVhcnRsYW5kLkhQU30gaHBzCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gZWxlbWVudGlkCiAgICAgKi8KCgogICAgRE9NLmFkZFN0eWxlc2hlZXQgPSBmdW5jdGlvbiAoY3NzKSB7CiAgICAgIHZhciBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3N0eWxlJyk7CiAgICAgIHZhciBlbGVtZW50cyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdoZWFkJyk7CiAgICAgIGVsLnR5cGUgPSAndGV4dC9jc3MnOwogICAgICBlbC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShjc3MpKTsKCiAgICAgIGlmIChlbGVtZW50cyAmJiBlbGVtZW50c1swXSkgewogICAgICAgIGVsZW1lbnRzWzBdLmFwcGVuZENoaWxkKGVsKTsKICAgICAgfQogICAgfTsKICAgIC8qKgogICAgICogSGVhcnRsYW5kLkRPTS5qc29uMmNzcwogICAgICoKICAgICAqIENvbnZlcnRzIGEgSlNPTiBub2RlIHRvIHRleHQgcmVwcmVzZW50aW5nIENTUy4KICAgICAqCiAgICAgKiBAcGFyYW0ge3N0cmluZ30ganNvbgogICAgICogQHJldHVybnMge3N0cmluZ30KICAgICAqLwoKCiAgICBET00uanNvbjJjc3MgPSBmdW5jdGlvbiAoanNvbikgewogICAgICB2YXIgY3NzID0gJyc7CiAgICAgIHZhciBhdHRyaWJ1dGVzOwogICAgICB2YXIgY2hpbGRyZW47CiAgICAgIHZhciBpLCBqOwogICAgICB2YXIga2V5LCB2YWx1ZTsKCiAgICAgIGlmIChhdHRyaWJ1dGVzID0gRE9NLmpzb25BdHRyaWJ1dGVzKGpzb24pKSB7CiAgICAgICAgdmFyIGF0dHJpYnV0ZXNMZW5ndGggPSBhdHRyaWJ1dGVzLmxlbmd0aDsKCiAgICAgICAgZm9yIChpID0gMDsgaSA8IGF0dHJpYnV0ZXNMZW5ndGg7IGkrKykgewogICAgICAgICAga2V5ID0gYXR0cmlidXRlc1tpXTsKICAgICAgICAgIHZhbHVlID0ganNvbltrZXldOwoKICAgICAgICAgIGlmIChET00uaXNBcnJheSh2YWx1ZSkpIHsKICAgICAgICAgICAgdmFyIGFyckxlbmd0aCA9IHZhbHVlLmxlbmd0aDsKCiAgICAgICAgICAgIGZvciAoaiA9IDA7IGogPCBhcnJMZW5ndGg7IGorKykgewogICAgICAgICAgICAgIGNzcyArPSBrZXkgKyAnOicgKyB2YWx1ZVtqXSArICc7JzsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY3NzICs9IGtleSArICc6JyArIHZhbHVlICsgJzsnOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKGNoaWxkcmVuID0gRE9NLmpzb25DaGlsZHJlbihqc29uKSkgewogICAgICAgIHZhciBjaGlsZHJlbkxlbmd0aCA9IGNoaWxkcmVuLmxlbmd0aDsKCiAgICAgICAgZm9yIChpID0gMDsgaSA8IGNoaWxkcmVuTGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGtleSA9IGNoaWxkcmVuW2ldOwogICAgICAgICAgdmFsdWUgPSBqc29uW2tleV07CiAgICAgICAgICBjc3MgKz0ga2V5ICsgJ3snICsgRE9NLmpzb24yY3NzKHZhbHVlKSArICd9JzsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBjc3M7CiAgICB9OwogICAgLyoqCiAgICAgKiBIZWFydGxhbmQuRE9NLnNldEZvY3VzCiAgICAgKgogICAgICogU2V0cyB0aGUgZm9jdXMgb24gYW4gaWZyYW1lJ3MgZmllbGQuCiAgICAgKgogICAgICogQHBhcmFtIHtIZWFydGxhbmQuSFBTfSBocHMKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBlbGVtZW50aWQKICAgICAqLwoKCiAgICBET00uc2V0Rm9jdXMgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZWFydGxhbmQtZmllbGQnKTsKCiAgICAgIGlmIChlbCkgewogICAgICAgIGVsLmZvY3VzKCk7CiAgICAgIH0KICAgIH07CiAgICAvKioKICAgICAqIEhlYXJ0bGFuZC5ET00uYWRkQ2VydEFsZXJ0CiAgICAgKgogICAgICogQWRkcyBhbiBhbGVydCBsZXR0aW5nIHRoZSBkZXZlbG9wZXIga25vdyB0aGV5J3JlIGluIHNhbmRib3ggbW9kZQogICAgICoKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBlbGVtZW50aWQKICAgICAqCiAgICAgKi8KCgogICAgRE9NLmFkZENlcnRBbGVydCA9IGZ1bmN0aW9uIChlbGVtZW50aWQpIHsKICAgICAgdmFyIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgIHZhciB0ZXh0ID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoIlRoaXMgcGFnZSBpcyBjdXJyZW50bHkgaW4gdGVzdCBtb2RlLiBEbyBub3QgdXNlIHJlYWwvYWN0aXZlIGNhcmQgbnVtYmVycy4iKTsKICAgICAgZWwuYXBwZW5kQ2hpbGQodGV4dCk7CiAgICAgIGVsLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwogICAgICBlbC5zdHlsZS53aWR0aCA9ICIxMDAlIjsKICAgICAgZWwuc3R5bGUubWFyZ2luQm90dG9tID0gIjVweCI7CiAgICAgIGVsLnN0eWxlLmNvbG9yID0gIiNmZmYiOwogICAgICBlbC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAiIzc3MDAwMCI7CiAgICAgIGVsLnN0eWxlLnBhZGRpbmcgPSAiOHB4IDVweCI7CiAgICAgIGVsLnN0eWxlLmZvbnRGYW1pbHkgPSAiVmVyZGFuYSI7CiAgICAgIGVsLnN0eWxlLmZvbnRXZWlnaHQgPSAiMTAwIjsKICAgICAgZWwuc3R5bGUuZm9udFNpemUgPSAiMTJweCI7CiAgICAgIGVsLnN0eWxlLnRleHRBbGlnbiA9ICJjZW50ZXIiOwogICAgICBlbC5zdHlsZS5ib3hTaXppbmcgPSAiYm9yZGVyLWJveCI7CiAgICAgIHZhciBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChlbGVtZW50aWQpOwogICAgICB2YXIgZnJhbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGVhcnRsYW5kLWZyYW1lLWNhcmROdW1iZXInKTsKCiAgICAgIGlmIChmcmFtZSkgewogICAgICAgIGNvbnRhaW5lci5pbnNlcnRCZWZvcmUoZWwsIGZyYW1lKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgZnJhbWUyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hlYXJ0bGFuZC1mcmFtZS1oZWFydGxhbmQtZnJhbWUtc2VjdXJlc3VibWl0Jyk7CiAgICAgICAgY29udGFpbmVyLmluc2VydEJlZm9yZShlbCwgZnJhbWUyKTsKICAgICAgfQogICAgfTsKICAgIC8qKioqKioqKioqKgogICAgICogSGVscGVycyAqCiAgICAgKioqKioqKioqKiovCgogICAgLyoqCiAgICAgKiBFc2NhcGVzIGFsbCBwb3RlbnRpYWxseSBkYW5nZXJvdXMgY2hhcmFjdGVycywgc28gdGhhdCB0aGUKICAgICAqIHJlc3VsdGluZyBzdHJpbmcgY2FuIGJlIHNhZmVseSBpbnNlcnRlZCBpbnRvIGF0dHJpYnV0ZSBvcgogICAgICogZWxlbWVudCB0ZXh0LgogICAgICoKICAgICAqIEBwYXJhbSB2YWx1ZQogICAgICogQHJldHVybnMge3N0cmluZ30gZXNjYXBlZCB0ZXh0CiAgICAgKi8KCgogICAgRE9NLmVuY29kZUVudGl0aWVzID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgIHJldHVybiB2YWx1ZS5yZXBsYWNlKC8mL2csICcmYW1wOycpLnJlcGxhY2UoL1tcdUQ4MDAtXHVEQkZGXVtcdURDMDAtXHVERkZGXS9nLCBmdW5jdGlvbiAodikgewogICAgICAgIHZhciBoaSA9IHYuY2hhckNvZGVBdCgwKTsKICAgICAgICB2YXIgbG93ID0gdi5jaGFyQ29kZUF0KDEpOwogICAgICAgIHJldHVybiAnJiMnICsgKChoaSAtIDB4RDgwMCkgKiAweDQwMCArIChsb3cgLSAweERDMDApICsgMHgxMDAwMCkgKyAnOyc7CiAgICAgIH0pLnJlcGxhY2UoLyhbXlwjLX58IHwhXSkvZywgZnVuY3Rpb24gKHYpIHsKICAgICAgICByZXR1cm4gJyYjJyArIHYuY2hhckNvZGVBdCgwKSArICc7JzsKICAgICAgfSkucmVwbGFjZSgvPC9nLCAnJmx0OycpLnJlcGxhY2UoLz4vZywgJyZndDsnKTsKICAgIH07CgogICAgRE9NLmlzQXJyYXkgPSBmdW5jdGlvbiAob2JqKSB7CiAgICAgIHJldHVybiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwob2JqKSA9PT0gJ1tvYmplY3QgQXJyYXldJzsKICAgIH07CgogICAgRE9NLmpzb25BdHRyaWJ1dGVzID0gZnVuY3Rpb24gKGpzb24pIHsKICAgICAgdmFyIHNldCA9IFtdOwoKICAgICAgZm9yICh2YXIgaSBpbiBqc29uKSB7CiAgICAgICAgaWYgKGpzb24uaGFzT3duUHJvcGVydHkoaSkgJiYgKHR5cGVvZiBqc29uW2ldID09PSAnc3RyaW5nJyB8fCBET00uaXNBcnJheShqc29uW2ldKSkpIHsKICAgICAgICAgIHNldC5wdXNoKGkpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHNldDsKICAgIH07CgogICAgRE9NLmpzb25DaGlsZHJlbiA9IGZ1bmN0aW9uIChqc29uKSB7CiAgICAgIHZhciBzZXQgPSBbXTsKCiAgICAgIGZvciAodmFyIGkgaW4ganNvbikgewogICAgICAgIGlmIChqc29uLmhhc093blByb3BlcnR5KGkpICYmIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChqc29uW2ldKSA9PT0gJ1tvYmplY3QgT2JqZWN0XScpIHsKICAgICAgICAgIHNldC5wdXNoKGkpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHNldDsKICAgIH07CgogICAgcmV0dXJuIERPTTsKICB9KCk7CgogIHZhciBFeHBpcmF0aW9uJDIgPSBmdW5jdGlvbiAoKSB7CiAgICBmdW5jdGlvbiBFeHBpcmF0aW9uKCkge30KCiAgICBFeHBpcmF0aW9uLnByb3RvdHlwZS5mb3JtYXQgPSBmdW5jdGlvbiAoZXhwLCBmaW5hbCkgewogICAgICBpZiAoZmluYWwgPT09IHZvaWQgMCkgewogICAgICAgIGZpbmFsID0gZmFsc2U7CiAgICAgIH0KCiAgICAgIHZhciBwYXQgPSAvXlxEKihcZHsxLDJ9KShcRCspPyhcZHsxLDR9KT8vOwogICAgICB2YXIgZ3JvdXBzID0gZXhwLm1hdGNoKHBhdCk7CiAgICAgIHZhciBtb250aDsKICAgICAgdmFyIGRlbDsKICAgICAgdmFyIHllYXI7CgogICAgICBpZiAoIWdyb3VwcykgewogICAgICAgIHJldHVybiAnJzsKICAgICAgfQoKICAgICAgbW9udGggPSBncm91cHNbMV0gfHwgJyc7CiAgICAgIGRlbCA9IGdyb3Vwc1syXSB8fCAnJzsKICAgICAgeWVhciA9IGdyb3Vwc1szXSB8fCAnJzsKCiAgICAgIGlmICh5ZWFyLmxlbmd0aCA+IDApIHsKICAgICAgICBkZWwgPSAnIC8gJzsKICAgICAgfSBlbHNlIGlmIChtb250aC5sZW5ndGggPT09IDIgfHwgZGVsLmxlbmd0aCA+IDApIHsKICAgICAgICBkZWwgPSAnIC8gJzsKICAgICAgfSBlbHNlIGlmIChtb250aC5sZW5ndGggPT09IDEgJiYgbW9udGggIT09ICcwJyAmJiBtb250aCAhPT0gJzEnKSB7CiAgICAgICAgZGVsID0gJyAvICc7CiAgICAgIH0KCiAgICAgIGlmIChtb250aC5sZW5ndGggPT09IDEgJiYgZGVsICE9PSAnJykgewogICAgICAgIG1vbnRoID0gJzAnICsgbW9udGg7CiAgICAgIH0KCiAgICAgIGlmIChmaW5hbCAmJiB5ZWFyLmxlbmd0aCA9PT0gMikgewogICAgICAgIHllYXIgPSBuZXcgRGF0ZSgpLmdldEZ1bGxZZWFyKCkudG9TdHJpbmcoKS5zbGljZSgwLCAyKSArIHllYXI7CiAgICAgIH0KCiAgICAgIHJldHVybiBtb250aCArIGRlbCArIHllYXI7CiAgICB9OwoKICAgIHJldHVybiBFeHBpcmF0aW9uOwogIH0oKTsKCiAgdmFyIEV2ID0gZnVuY3Rpb24gKCkgewogICAgZnVuY3Rpb24gRXYoKSB7fQoKICAgIEV2Lmxpc3RlbiA9IGZ1bmN0aW9uIChub2RlLCBldmVudE5hbWUsIGNhbGxiYWNrKSB7CiAgICAgIGlmIChkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKSB7CiAgICAgICAgbm9kZS5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgY2FsbGJhY2ssIGZhbHNlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAobm9kZSA9PT0gZG9jdW1lbnQpIHsKICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5hdHRhY2hFdmVudCgnb25wcm9wZXJ0eWNoYW5nZScsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIGlmIChlLnByb3BlcnR5TmFtZSA9PT0gZXZlbnROYW1lKSB7CiAgICAgICAgICAgICAgY2FsbGJhY2soZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBub2RlLmF0dGFjaEV2ZW50KCdvbicgKyBldmVudE5hbWUsIGNhbGxiYWNrKTsKICAgICAgICB9CiAgICAgIH0KICAgIH07CgogICAgRXYudHJpZ2dlciA9IGZ1bmN0aW9uIChub2RlLCBldmVudE5hbWUpIHsKICAgICAgaWYgKGRvY3VtZW50LmNyZWF0ZUV2ZW50KSB7CiAgICAgICAgdmFyIGV2ZW50ID0gZG9jdW1lbnQuY3JlYXRlRXZlbnQoJ0V2ZW50Jyk7CiAgICAgICAgZXZlbnQuaW5pdEV2ZW50KGV2ZW50TmFtZSwgdHJ1ZSwgdHJ1ZSk7CiAgICAgICAgbm9kZS5kaXNwYXRjaEV2ZW50KGV2ZW50KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnRbZXZlbnROYW1lXSsrOwogICAgICB9CiAgICB9OwoKICAgIEV2Lmlnbm9yZSA9IGZ1bmN0aW9uIChldmVudE5hbWUsIGNhbGxiYWNrKSB7CiAgICAgIGlmIChkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKSB7CiAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIGNhbGxiYWNrLCBmYWxzZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmRldGFjaEV2ZW50KCdvbnByb3BlcnR5Y2hhbmdlJywgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIGlmIChlLnByb3BlcnR5TmFtZSA9PT0gZXZlbnROYW1lKSB7CiAgICAgICAgICAgIGNhbGxiYWNrKGUpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICB9OwoKICAgIHJldHVybiBFdjsKICB9KCk7CiAgLyoqCiAgICogQG5hbWVzcGFjZSBIZWFydGxhbmQuRXZlbnRzCiAgICovCgoKICB2YXIgRXZlbnRzID0gZnVuY3Rpb24gKCkgewogICAgZnVuY3Rpb24gRXZlbnRzKCkge30KICAgIC8qKgogICAgICogSGVhcnRsYW5kLkV2ZW50cy5hZGRIYW5kbGVyCiAgICAgKgogICAgICogQWRkcyBhbiBgZXZlbnRgIGhhbmRsZXIgZm9yIGEgZ2l2ZW4gYHRhcmdldGAgZWxlbWVudC4KICAgICAqCiAgICAgKiBAcGFyYW0ge3N0cmluZyB8IEV2ZW50VGFyZ2V0fSB0YXJnZXQKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBldmVudAogICAgICogQHBhcmFtIHtFdmVudExpc3RlbmVyfSBjYWxsYmFjawogICAgICovCgoKICAgIEV2ZW50cy5hZGRIYW5kbGVyID0gZnVuY3Rpb24gKHRhcmdldCwgZXZlbnQsIGNhbGxiYWNrKSB7CiAgICAgIHZhciBub2RlOwoKICAgICAgaWYgKHR5cGVvZiB0YXJnZXQgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgbm9kZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRhcmdldCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbm9kZSA9IHRhcmdldDsKICAgICAgfQoKICAgICAgaWYgKGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIpIHsKICAgICAgICBub2RlLmFkZEV2ZW50TGlzdGVuZXIoZXZlbnQsIGNhbGxiYWNrLCBmYWxzZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgRXYubGlzdGVuKG5vZGUsIGV2ZW50LCBjYWxsYmFjayk7CiAgICAgIH0KICAgIH07CiAgICAvKioKICAgICAqIEhlYXJ0bGFuZC5FdmVudHMucmVtb3ZlSGFuZGxlcgogICAgICoKICAgICAqIFJlbW92ZXMgYW4gYGV2ZW50YCBoYW5kbGVyIGZvciBhIGdpdmVuIGB0YXJnZXRgIGVsZW1lbnQuCiAgICAgKgogICAgICogQHBhcmFtIHtzdHJpbmcgfCBFdmVudFRhcmdldH0gdGFyZ2V0CiAgICAgKiBAcGFyYW0ge3N0cmluZ30gZXZlbnQKICAgICAqIEBwYXJhbSB7RXZlbnRMaXN0ZW5lcn0gY2FsbGJhY2sKICAgICAqLwoKCiAgICBFdmVudHMucmVtb3ZlSGFuZGxlciA9IGZ1bmN0aW9uICh0YXJnZXQsIGV2ZW50LCBjYWxsYmFjaykgewogICAgICB2YXIgbm9kZTsKCiAgICAgIGlmICh0eXBlb2YgdGFyZ2V0ID09PSAnc3RyaW5nJykgewogICAgICAgIG5vZGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0YXJnZXQpOwogICAgICB9IGVsc2UgewogICAgICAgIG5vZGUgPSB0YXJnZXQ7CiAgICAgIH0KCiAgICAgIGlmIChkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKSB7CiAgICAgICAgbm9kZS5yZW1vdmVFdmVudExpc3RlbmVyKGV2ZW50LCBjYWxsYmFjaywgZmFsc2UpOwogICAgICB9IGVsc2UgewogICAgICAgIEV2Lmlnbm9yZShldmVudCwgY2FsbGJhY2spOwogICAgICB9CiAgICB9OwogICAgLyoqCiAgICAgKiBIZWFydGxhbmQuRXZlbnRzLnRyaWdnZXIKICAgICAqCiAgICAgKiBGaXJlcyBvZmYgYW4gYGV2ZW50YCBmb3IgYSBnaXZlbiBgdGFyZ2V0YCBlbGVtZW50LgogICAgICoKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lCiAgICAgKiBAcGFyYW0ge2FueX0gdGFyZ2V0CiAgICAgKiBAcGFyYW0ge2FueX0gZGF0YSBbb3B0aW9uYWxdCiAgICAgKi8KCgogICAgRXZlbnRzLnRyaWdnZXIgPSBmdW5jdGlvbiAobmFtZSwgdGFyZ2V0LCBkYXRhLCBidWJibGUpIHsKICAgICAgaWYgKGJ1YmJsZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgYnViYmxlID0gZmFsc2U7CiAgICAgIH0KCiAgICAgIGlmIChkb2N1bWVudC5jcmVhdGVFdmVudCkgewogICAgICAgIHZhciBldmVudCA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50KCdFdmVudCcpOwogICAgICAgIGV2ZW50LmluaXRFdmVudChuYW1lLCB0cnVlLCB0cnVlKTsKICAgICAgICB0YXJnZXQuZGlzcGF0Y2hFdmVudChldmVudCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgRXYudHJpZ2dlcih0YXJnZXQsIG5hbWUpOwogICAgICB9CiAgICB9OwogICAgLyoqCiAgICAgKiBIZWFydGxhbmQuRXZlbnRzLmZyYW1lSGFuZGxlV2l0aAogICAgICoKICAgICAqIFdyYXBzIGBocHNgIHN0YXRlIGluIGEgY2xvc3VyZSB0byBwcm92aWRlIGEgYEhlYXJ0bGFuZC5NZXNzYWdlcy5yZWNlaXZlYAogICAgICogY2FsbGJhY2sgaGFuZGxlciBmb3IgaUZyYW1lIGNoaWxkcmVuLgogICAgICoKICAgICAqIEBwYXJhbSB7SGVhcnRsYW5kLkhQU30gaHBzCiAgICAgKi8KCgogICAgRXZlbnRzLmZyYW1lSGFuZGxlV2l0aCA9IGZ1bmN0aW9uIChocHMpIHsKICAgICAgcmV0dXJuIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgc3dpdGNoIChkYXRhLmFjdGlvbikgewogICAgICAgICAgY2FzZSAndG9rZW5pemUnOgogICAgICAgICAgICBpZiAoZGF0YS5hY2N1bXVsYXRlRGF0YSkgewogICAgICAgICAgICAgIGhwcy5NZXNzYWdlcy5wb3N0KHsKICAgICAgICAgICAgICAgIGFjdGlvbjogJ2FjY3VtdWxhdGVEYXRhJwogICAgICAgICAgICAgIH0sICdwYXJlbnQnKTsKICAgICAgICAgICAgICB2YXIgZWxPcHRzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Rva2VuaXplT3B0aW9ucycpOwoKICAgICAgICAgICAgICBpZiAoIWVsT3B0cykgewogICAgICAgICAgICAgICAgZWxPcHRzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTsKICAgICAgICAgICAgICAgIGVsT3B0cy5pZCA9ICd0b2tlbml6ZU9wdGlvbnMnOwogICAgICAgICAgICAgICAgZWxPcHRzLnR5cGUgPSAnaGlkZGVuJzsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZhciBlbFBLID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3B1YmxpY0tleScpOwoKICAgICAgICAgICAgICBpZiAoIWVsUEspIHsKICAgICAgICAgICAgICAgIGVsUEsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpOwogICAgICAgICAgICAgICAgZWxQSy5pZCA9ICdwdWJsaWNLZXknOwogICAgICAgICAgICAgICAgZWxQSy50eXBlID0gJ2hpZGRlbic7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoZGF0YS5kYXRhKSB7CiAgICAgICAgICAgICAgICBlbE9wdHMudmFsdWUgPSBKU09OMi5zdHJpbmdpZnkoZGF0YS5kYXRhKTsKICAgICAgICAgICAgICAgIGVsUEsudmFsdWUgPSBkYXRhLmRhdGEucHVibGljS2V5OwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBlbE9wdHMudmFsdWUgPSBKU09OMi5zdHJpbmdpZnkoewogICAgICAgICAgICAgICAgICBwdWJsaWNLZXk6IGRhdGEubWVzc2FnZQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBlbFBLLnZhbHVlID0gZGF0YS5tZXNzYWdlOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hlYXJ0bGFuZC1maWVsZC13cmFwcGVyJykuYXBwZW5kQ2hpbGQoZWxPcHRzKTsKICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGVhcnRsYW5kLWZpZWxkLXdyYXBwZXInKS5hcHBlbmRDaGlsZChlbFBLKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBFdmVudHMudG9rZW5pemVJZnJhbWUoaHBzLCBkYXRhLmRhdGEpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlICdzZXRTdHlsZSc6CiAgICAgICAgICAgIERPTS5zZXRTdHlsZShkYXRhLmlkLCBkYXRhLnN0eWxlKTsKICAgICAgICAgICAgRE9NLnJlc2l6ZUZyYW1lKGhwcyk7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgJ2FwcGVuZFN0eWxlJzoKICAgICAgICAgICAgRE9NLmFwcGVuZFN0eWxlKGRhdGEuaWQsIGRhdGEuc3R5bGUpOwogICAgICAgICAgICBET00ucmVzaXplRnJhbWUoaHBzKTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAnc2V0VGV4dCc6CiAgICAgICAgICAgIERPTS5zZXRUZXh0KGRhdGEuaWQsIGRhdGEudGV4dCk7CiAgICAgICAgICAgIERPTS5yZXNpemVGcmFtZShocHMpOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlICdzZXRWYWx1ZSc6CiAgICAgICAgICAgIERPTS5zZXRWYWx1ZShkYXRhLmlkLCBkYXRhLnRleHQpOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlICdzZXRQbGFjZWhvbGRlcic6CiAgICAgICAgICAgIERPTS5zZXRQbGFjZWhvbGRlcihkYXRhLmlkLCBkYXRhLnRleHQpOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlICdzZXRGaWVsZERhdGEnOgogICAgICAgICAgICBET00uc2V0RmllbGREYXRhKGRhdGEuaWQsIGRhdGEudmFsdWUpOwoKICAgICAgICAgICAgaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZWFydGxhbmQtZmllbGQnKSAmJiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FyZEN2dicpICYmIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYXJkRXhwaXJhdGlvbicpKSB7CiAgICAgICAgICAgICAgdmFyIG9wdHMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndG9rZW5pemVPcHRpb25zJyk7CiAgICAgICAgICAgICAgdmFyIHBrID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3B1YmxpY0tleScpOwogICAgICAgICAgICAgIEV2ZW50cy50b2tlbml6ZUlmcmFtZShocHMsIG9wdHMgJiYgb3B0cy5nZXRBdHRyaWJ1dGUoJ3ZhbHVlJykgIT09ICd1bmRlZmluZWQnID8gSlNPTjIucGFyc2Uob3B0cy5nZXRBdHRyaWJ1dGUoJ3ZhbHVlJykpIDogewogICAgICAgICAgICAgICAgcHVibGljS2V5OiBway5nZXRBdHRyaWJ1dGUoJ3ZhbHVlJykKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAnZ2V0RmllbGREYXRhJzoKICAgICAgICAgICAgRE9NLmdldEZpZWxkRGF0YShocHMsIGRhdGEuaWQpOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlICdhZGRTdHlsZXNoZWV0JzoKICAgICAgICAgICAgRE9NLmFkZFN0eWxlc2hlZXQoZGF0YS5kYXRhKTsKICAgICAgICAgICAgRE9NLnJlc2l6ZUZyYW1lKGhwcyk7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgJ3NldEZvY3VzJzoKICAgICAgICAgICAgRE9NLnNldEZvY3VzKCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfTsKICAgIH07CiAgICAvKioKICAgICAqIHRva2VuaXplSWZyYW1lCiAgICAgKgogICAgICogVG9rZW5pemVzIGNhcmQgZGF0YS4gVXNlZCBpbiBpZnJhbWUgaW50ZWdyYXRpb25zIHRvIHRva2VuaXplIG9uIEhlYXJ0bGFuZCdzCiAgICAgKiBzZXJ2ZXJzLgogICAgICoKICAgICAqIEBwYXJhbSB7SGVhcnRsYW5kLkhQU30gaHBzCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gcHVibGljS2V5CiAgICAgKi8KCgogICAgRXZlbnRzLnRva2VuaXplSWZyYW1lID0gZnVuY3Rpb24gKGhwcywgZGF0YSkgewogICAgICB2YXIgY2FyZCA9IHt9OwogICAgICB2YXIgbnVtYmVyRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZWFydGxhbmQtZmllbGQnKSB8fCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGVhcnRsYW5kLWNhcmQtbnVtYmVyJyk7CiAgICAgIHZhciBjdnZFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhcmRDdnYnKSB8fCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGVhcnRsYW5kLWN2dicpOwogICAgICB2YXIgZXhwRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYXJkRXhwaXJhdGlvbicpOwoKICAgICAgdmFyIHRva2VuUmVzcG9uc2UgPSBmdW5jdGlvbiB0b2tlblJlc3BvbnNlKGFjdGlvbikgewogICAgICAgIHJldHVybiBmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIGhwcy5NZXNzYWdlcy5wb3N0KHsKICAgICAgICAgICAgYWN0aW9uOiBhY3Rpb24sCiAgICAgICAgICAgIHJlc3BvbnNlOiByZXNwb25zZQogICAgICAgICAgfSwgJ3BhcmVudCcpOwoKICAgICAgICAgIGlmIChjdnZFbGVtZW50KSB7CiAgICAgICAgICAgIGlmIChjdnZFbGVtZW50LnBhcmVudE5vZGUpIHsKICAgICAgICAgICAgICBjdnZFbGVtZW50LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoY3Z2RWxlbWVudCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgY3Z2RWxlbWVudC5yZW1vdmUoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGlmIChleHBFbGVtZW50KSB7CiAgICAgICAgICAgIGlmIChleHBFbGVtZW50LnBhcmVudE5vZGUpIHsKICAgICAgICAgICAgICBleHBFbGVtZW50LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZXhwRWxlbWVudCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgZXhwRWxlbWVudC5yZW1vdmUoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH07CiAgICAgIH07CgogICAgICBjYXJkLm51bWJlciA9IG51bWJlckVsZW1lbnQgPyBudW1iZXJFbGVtZW50LnZhbHVlIDogJyc7CiAgICAgIGNhcmQuY3Z2ID0gY3Z2RWxlbWVudCA/IGN2dkVsZW1lbnQudmFsdWUgOiAnJzsKICAgICAgY2FyZC5leHAgPSBleHBFbGVtZW50OwoKICAgICAgaWYgKGNhcmQuZXhwKSB7CiAgICAgICAgdmFyIGZvcm1hdHRlciA9IG5ldyBFeHBpcmF0aW9uJDIoKTsKICAgICAgICB2YXIgY2FyZEV4cFNwbGl0ID0gZm9ybWF0dGVyLmZvcm1hdChjYXJkLmV4cC52YWx1ZSwgdHJ1ZSkuc3BsaXQoJy8nKTsKICAgICAgICBjYXJkLmV4cE1vbnRoID0gY2FyZEV4cFNwbGl0WzBdOwogICAgICAgIGNhcmQuZXhwWWVhciA9IGNhcmRFeHBTcGxpdFsxXTsKICAgICAgICBjYXJkLmV4cCA9IHVuZGVmaW5lZDsKICAgICAgfSBlbHNlIHsKICAgICAgICBjYXJkLmV4cE1vbnRoID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hlYXJ0bGFuZC1leHBpcmF0aW9uLW1vbnRoJykudmFsdWU7CiAgICAgICAgY2FyZC5leHBZZWFyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hlYXJ0bGFuZC1leHBpcmF0aW9uLXllYXInKS52YWx1ZTsKICAgICAgfQoKICAgICAgaHBzLnRva2VuaXplKHsKICAgICAgICBjYXJkQ3Z2OiBjYXJkLmN2diA/IGNhcmQuY3Z2IDogJycsCiAgICAgICAgY2FyZEV4cE1vbnRoOiBjYXJkLmV4cE1vbnRoID8gY2FyZC5leHBNb250aCA6ICcnLAogICAgICAgIGNhcmRFeHBZZWFyOiBjYXJkLmV4cFllYXIgPyBjYXJkLmV4cFllYXIgOiAnJywKICAgICAgICBjYXJkTnVtYmVyOiBjYXJkLm51bWJlciA/IGNhcmQubnVtYmVyIDogJycsCiAgICAgICAgY2NhOiBkYXRhLmNjYSwKICAgICAgICBlcnJvcjogdG9rZW5SZXNwb25zZSgnb25Ub2tlbkVycm9yJyksCiAgICAgICAgcHVibGljS2V5OiBkYXRhLnB1YmxpY0tleSA/IGRhdGEucHVibGljS2V5IDogJycsCiAgICAgICAgc3VjY2VzczogdG9rZW5SZXNwb25zZSgnb25Ub2tlblN1Y2Nlc3MnKSwKICAgICAgICB0eXBlOiAncGFuJwogICAgICB9KTsKICAgIH07CgogICAgcmV0dXJuIEV2ZW50czsKICB9KCk7CiAgLyoqCiAgICogQG5hbWVzcGFjZSBIZWFydGxhbmQuQ2FyZAogICAqLwoKCiAgdmFyIENhcmQgPSBmdW5jdGlvbiAoKSB7CiAgICBmdW5jdGlvbiBDYXJkKCkge30KICAgIC8qKgogICAgICogSGVhcnRsYW5kLkNhcmQudHlwZUJ5TnVtYmVyCiAgICAgKgogICAgICogSGVscGVyIGZ1bmN0aW9uIHRvIGdyYWIgdGhlIENhcmRUeXBlIGZvciBhIGdpdmVuIGNhcmQgbnVtYmVyLgogICAgICoKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBudW1iZXIgLSBUaGUgY2FyZCBudW1iZXIKICAgICAqIEByZXR1cm5zIHtIZWFydGxhbmQuQ2FyZFR5cGV9CiAgICAgKi8KCgogICAgQ2FyZC50eXBlQnlOdW1iZXIgPSBmdW5jdGlvbiAobnVtYmVyKSB7CiAgICAgIHZhciBjYXJkVHlwZTsKICAgICAgdmFyIGk7CgogICAgICBpZiAoIW51bWJlcikgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CgogICAgICBpZiAobnVtYmVyLnJlcGxhY2UoL15ccyt8XHMrJC9nbSwgJycpLmxlbmd0aCA8IDQpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQoKICAgICAgZm9yIChpIGluIGNhcmRUeXBlcykgewogICAgICAgIGNhcmRUeXBlID0gY2FyZFR5cGVzW2ldOwoKICAgICAgICBpZiAoY2FyZFR5cGUgJiYgY2FyZFR5cGUucmVnZXggJiYgY2FyZFR5cGUucmVnZXgudGVzdChudW1iZXIpKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBjYXJkVHlwZTsKICAgIH07CiAgICAvKioKICAgICAqIEhlYXJ0bGFuZC5DYXJkLnR5cGVCeVRyYWNrCiAgICAgKgogICAgICogQHBhcmFtIHtzdHJpbmd9IGRhdGEgLSB0cmFjayBkYXRhCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IGlzRW5jcnlwdGVkIC0gKGRlZmF1bHQ6IGZhbHNlKQogICAgICogQHBhcmFtIHtzdHJpbmd9IHRyYWNrTnVtYmVyCiAgICAgKgogICAgICogQHJldHVybnMgQ2FyZFR5cGUKICAgICAqLwoKCiAgICBDYXJkLnR5cGVCeVRyYWNrID0gZnVuY3Rpb24gKGRhdGEsIGlzRW5jcnlwdGVkLCB0cmFja051bWJlcikgewogICAgICBpZiAoaXNFbmNyeXB0ZWQgPT09IHZvaWQgMCkgewogICAgICAgIGlzRW5jcnlwdGVkID0gZmFsc2U7CiAgICAgIH0KCiAgICAgIHZhciBudW1iZXI7CgogICAgICBpZiAoaXNFbmNyeXB0ZWQgJiYgdHJhY2tOdW1iZXIgJiYgdHJhY2tOdW1iZXIgPT09ICcwMicpIHsKICAgICAgICBudW1iZXIgPSBkYXRhLnNwbGl0KCc9JylbMF07CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIHRlbXAgPSBkYXRhLnNwbGl0KCclJyk7CgogICAgICAgIGlmICh0ZW1wWzFdKSB7CiAgICAgICAgICB0ZW1wID0gdGVtcFsxXS5zcGxpdCgnXicpOwoKICAgICAgICAgIGlmICh0ZW1wWzBdKSB7CiAgICAgICAgICAgIG51bWJlciA9IHRlbXBbMF0udG9TdHJpbmcoKS5zdWJzdHIoMSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gQ2FyZC50eXBlQnlOdW1iZXIobnVtYmVyKTsKICAgIH07CiAgICAvKioKICAgICAqIEhlYXJ0bGFuZC5DYXJkLmx1aG5DaGVjawogICAgICoKICAgICAqIFJ1bnMgYSBtb2QgMTAgY2hlY2sgb24gYSBnaXZlbiBjYXJkIG51bWJlci4KICAgICAqCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gbnVtYmVyIC0gVGhlIGNhcmQgbnVtYmVyCiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0KICAgICAqLwoKCiAgICBDYXJkLmx1aG5DaGVjayA9IGZ1bmN0aW9uIChudW1iZXIpIHsKICAgICAgdmFyIG9kZCA9IHRydWU7CiAgICAgIHZhciBpID0gMDsKICAgICAgdmFyIHN1bSA9IDA7CiAgICAgIHZhciBkaWdpdDsKCiAgICAgIGlmICghbnVtYmVyKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICB2YXIgZGlnaXRzID0gbnVtYmVyLnNwbGl0KCcnKS5yZXZlcnNlKCk7CiAgICAgIHZhciBsZW5ndGggPSBkaWdpdHMubGVuZ3RoOwoKICAgICAgZm9yIChpOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICBkaWdpdCA9IHBhcnNlSW50KGRpZ2l0c1tpXSwgMTApOwoKICAgICAgICBpZiAob2RkID0gIW9kZCkgewogICAgICAgICAgZGlnaXQgKj0gMjsKICAgICAgICB9CgogICAgICAgIGlmIChkaWdpdCA+IDkpIHsKICAgICAgICAgIGRpZ2l0IC09IDk7CiAgICAgICAgfQoKICAgICAgICBzdW0gKz0gZGlnaXQ7CiAgICAgIH0KCiAgICAgIHJldHVybiBzdW0gJSAxMCA9PT0gMDsKICAgIH07CiAgICAvKioKICAgICAqIEhlYXJ0bGFuZC5DYXJkLmFkZFR5cGUKICAgICAqCiAgICAgKiBBZGRzIGEgY2xhc3MgdG8gdGhlIHRhcmdldCBlbGVtZW50IHdpdGggdGhlIGNhcmQgdHlwZQogICAgICogaW5mZXJyZWQgZnJvbSB0aGUgdGFyZ2V0J3MgY3VycmVudCB2YWx1ZS4KICAgICAqCiAgICAgKiBAcGFyYW0ge0V2ZW50fSBlCiAgICAgKi8KCgogICAgQ2FyZC5hZGRUeXBlID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHRhcmdldCA9IGUuY3VycmVudFRhcmdldCA/IGUuY3VycmVudFRhcmdldCA6IGUuc3JjRWxlbWVudDsKICAgICAgdmFyIHR5cGUgPSBDYXJkLnR5cGVCeU51bWJlcih0YXJnZXQudmFsdWUpOwogICAgICB2YXIgY2xhc3NMaXN0ID0gdGFyZ2V0LmNsYXNzTmFtZS5zcGxpdCgnICcpOwogICAgICB2YXIgbGVuZ3RoID0gY2xhc3NMaXN0Lmxlbmd0aDsKICAgICAgdmFyIGkgPSAwOwogICAgICB2YXIgYyA9ICcnOwoKICAgICAgZm9yIChpOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICBjID0gY2xhc3NMaXN0W2ldOwoKICAgICAgICBpZiAoYyAmJiBjLmluZGV4T2YoJ2NhcmQtdHlwZS0nKSAhPT0gLTEpIHsKICAgICAgICAgIGRlbGV0ZSBjbGFzc0xpc3RbaV07CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAodHlwZSkgewogICAgICAgIGNsYXNzTGlzdC5wdXNoKCdjYXJkLXR5cGUtJyArIHR5cGUuY29kZSk7CiAgICAgIH0KCiAgICAgIHRhcmdldC5jbGFzc05hbWUgPSBjbGFzc0xpc3Quam9pbignICcpLnJlcGxhY2UoL15ccyt8XHMrJC9nbSwgJycpOwogICAgfTsKICAgIC8qKgogICAgICogSGVhcnRsYW5kLkNhcmQuZm9ybWF0TnVtYmVyCiAgICAgKgogICAgICogRm9ybWF0cyBhIHRhcmdldCBlbGVtZW50J3MgdmFsdWUgYmFzZWQgb24gdGhlCiAgICAgKiBpbmZlcnJlZCBjYXJkIHR5cGUncyBmb3JtYXR0aW5nIHJlZ2V4LgogICAgICoKICAgICAqIEBwYXJhbSB7RXZlbnR9IGUKICAgICAqLwoKCiAgICBDYXJkLmZvcm1hdE51bWJlciA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0YXJnZXQgPSBlLmN1cnJlbnRUYXJnZXQgPyBlLmN1cnJlbnRUYXJnZXQgOiBlLnNyY0VsZW1lbnQ7CiAgICAgIHZhciB2YWx1ZSA9IHRhcmdldC52YWx1ZTsKCiAgICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDApIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciBmb3JtYXR0ZWQgPSBuZXcgQ2FyZE51bWJlcigpLmZvcm1hdCh2YWx1ZSk7CiAgICAgIHRhcmdldC52YWx1ZSA9IGZvcm1hdHRlZDsKCiAgICAgIGlmICghdGFyZ2V0LnNldFNlbGVjdGlvblJhbmdlKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgY3Vyc29yID0gdGFyZ2V0LnNlbGVjdGlvblN0YXJ0OyAvLyBjb3B5IGFuZCBwYXN0ZSwgc3BhY2UgaW5zZXJ0ZWQgb24gZm9ybWF0dGVyCgogICAgICBpZiAodmFsdWUubGVuZ3RoIDwgZm9ybWF0dGVkLmxlbmd0aCkgewogICAgICAgIGN1cnNvciArPSBmb3JtYXR0ZWQubGVuZ3RoIC0gdmFsdWUubGVuZ3RoOwogICAgICB9IC8vIGNoZWNrIGlmIGJlZm9yZSBuZXcgaW5zZXJ0ZWQgZGlnaXQgaXMgYSBzcGFjZQoKCiAgICAgIGlmICh2YWx1ZS5jaGFyQXQoY3Vyc29yKSA9PT0gJyAnICYmIGZvcm1hdHRlZC5jaGFyQXQoY3Vyc29yIC0gMSkgPT09ICcgJykgewogICAgICAgIGN1cnNvciArPSAxOwogICAgICB9CgogICAgICB0YXJnZXQuc2V0U2VsZWN0aW9uUmFuZ2UoY3Vyc29yLCBjdXJzb3IpOwogICAgfTsKICAgIC8qKgogICAgICogSGVhcnRsYW5kLkNhcmQuZm9ybWF0RXhwaXJhdGlvbgogICAgICoKICAgICAqIEZvcm1hdHMgYSB0YXJnZXQgZWxlbWVudCdzIHZhbHVlLgogICAgICoKICAgICAqIEBwYXJhbSB7S2V5Ym9hcmRFdmVudH0gZQogICAgICovCgoKICAgIENhcmQuZm9ybWF0RXhwaXJhdGlvbiA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0YXJnZXQgPSBlLmN1cnJlbnRUYXJnZXQgPyBlLmN1cnJlbnRUYXJnZXQgOiBlLnNyY0VsZW1lbnQ7CiAgICAgIHZhciB2YWx1ZSA9IHRhcmdldC52YWx1ZTsgLy8gYWxsb3c6IGRlbGV0ZSwgYmFja3NwYWNlCgogICAgICBpZiAoWzQ2LCA4XS5pbmRleE9mKGUua2V5Q29kZSkgIT09IC0xIHx8IC8vIGFsbG93OiBob21lLCBlbmQsIGxlZnQsIHJpZ2h0CiAgICAgIGUua2V5Q29kZSA+PSAzNSAmJiBlLmtleUNvZGUgPD0gMzkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHRhcmdldC52YWx1ZSA9IG5ldyBFeHBpcmF0aW9uKCkuZm9ybWF0KHZhbHVlLCBlLnR5cGUgPT09ICdibHVyJyk7CiAgICB9OwogICAgLyoqCiAgICAgKiBIZWFydGxhbmQuQ2FyZC5yZXN0cmljdExlbmd0aAogICAgICoKICAgICAqIFJlc3RyaWN0cyBpbnB1dCBpbiBhIHRhcmdldCBlbGVtZW50IHRvIGEKICAgICAqIGNlcnRhaW4gbGVuZ3RoIGRhdGEuCiAgICAgKgogICAgICogQHBhcmFtIHtudW1iZXJ9IGxlbmd0aAogICAgICoKICAgICAqIEByZXR1cm5zIHsoZTogS2V5Ym9hcmRFdmVudCkgPT4gKCl9CiAgICAgKi8KCgogICAgQ2FyZC5yZXN0cmljdExlbmd0aCA9IGZ1bmN0aW9uIChsZW5ndGgpIHsKICAgICAgcmV0dXJuIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgdmFyIHRhcmdldCA9IGUuY3VycmVudFRhcmdldCA/IGUuY3VycmVudFRhcmdldCA6IGUuc3JjRWxlbWVudDsKICAgICAgICB2YXIgdmFsdWUgPSB0YXJnZXQudmFsdWU7IC8vIGFsbG93OiBiYWNrc3BhY2UsIGRlbGV0ZSwgdGFiLCBlc2NhcGUgYW5kIGVudGVyCgogICAgICAgIGlmIChbNDYsIDgsIDksIDI3LCAxMywgMTEwXS5pbmRleE9mKGUua2V5Q29kZSkgIT09IC0xIHx8IC8vIGFsbG93OiBDdHJsK0EKICAgICAgICBlLmtleUNvZGUgPT09IDY1ICYmIGUuY3RybEtleSA9PT0gdHJ1ZSB8fCAvLyBhbGxvdzogaG9tZSwgZW5kLCBsZWZ0LCByaWdodAogICAgICAgIGUua2V5Q29kZSA+PSAzNSAmJiBlLmtleUNvZGUgPD0gMzkpIHsKICAgICAgICAgIC8vIGxldCBpdCBoYXBwZW4sIGRvbid0IGRvIGFueXRoaW5nCiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBpZiAodmFsdWUubGVuZ3RoID49IGxlbmd0aCkgewogICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCA/IGUucHJldmVudERlZmF1bHQoKSA6IGUucmV0dXJuVmFsdWUgPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH07CiAgICB9OwogICAgLyoqCiAgICAgKiBIZWFydGxhbmQuQ2FyZC5yZXN0cmljdE51bWVyaWMKICAgICAqCiAgICAgKiBSZXN0cmljdHMgaW5wdXQgaW4gYSB0YXJnZXQgZWxlbWVudCB0byBvbmx5CiAgICAgKiBudW1lcmljIGRhdGEuCiAgICAgKgogICAgICogQHBhcmFtIHtLZXlib2FyZEV2ZW50fSBlCiAgICAgKi8KCgogICAgQ2FyZC5yZXN0cmljdE51bWVyaWMgPSBmdW5jdGlvbiAoZSkgewogICAgICAvLyBhbGxvdzogYmFja3NwYWNlLCBkZWxldGUsIHRhYiwgZXNjYXBlIGFuZCBlbnRlcgogICAgICBpZiAoWzQ2LCA4LCA5LCAyNywgMTMsIDExMF0uaW5kZXhPZihlLmtleUNvZGUpICE9PSAtMSB8fCAvLyBhbGxvdzogQ3RybCtBCiAgICAgIGUua2V5Q29kZSA9PT0gNjUgJiYgZS5jdHJsS2V5ID09PSB0cnVlIHx8IC8vIGFsbG93OiBob21lLCBlbmQsIGxlZnQsIHJpZ2h0CiAgICAgIGUua2V5Q29kZSA+PSAzNSAmJiBlLmtleUNvZGUgPD0gMzkgfHwgLy8gYWxsb3c6IHdlaXJkIEFuZHJvaWQvQ2hyb21lIGlzc3VlCiAgICAgIGUua2V5Q29kZSA9PT0gMjI5KSB7CiAgICAgICAgLy8gbGV0IGl0IGhhcHBlbiwgZG9uJ3QgZG8gYW55dGhpbmcKICAgICAgICByZXR1cm47CiAgICAgIH0gLy8gZW5zdXJlIHRoYXQgaXQgaXMgYSBudW1iZXIgYW5kIHN0b3AgdGhlIGtleXByZXNzCgoKICAgICAgaWYgKChlLnNoaWZ0S2V5IHx8IGUua2V5Q29kZSA8IDQ4IHx8IGUua2V5Q29kZSA+IDU3KSAmJiAoZS5rZXlDb2RlIDwgOTYgfHwgZS5rZXlDb2RlID4gMTA1KSkgewogICAgICAgIGUucHJldmVudERlZmF1bHQgPyBlLnByZXZlbnREZWZhdWx0KCkgOiBlLnJldHVyblZhbHVlID0gZmFsc2U7CiAgICAgIH0KICAgIH07CiAgICAvKioKICAgICAqIEhlYXJ0bGFuZC5DYXJkLmRlbGV0ZVByb3Blcmx5CiAgICAgKgogICAgICogUGxhY2VzIGN1cnNvciBvbiB0aGUgY29ycmVjdCBwb3NpdGlvbiB0bwogICAgICogbGV0IHRoZSBicm93c2VyIGRlbGV0ZSB0aGUgZGlnaXQgaW5zdGVhZAogICAgICogb2YgdGhlIHNwYWNlLgogICAgICoKICAgICAqIEBwYXJhbSB7S2V5Ym9hcmRFdmVudH0gZQogICAgICovCgoKICAgIENhcmQuZGVsZXRlUHJvcGVybHkgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdGFyZ2V0ID0gZS5jdXJyZW50VGFyZ2V0ID8gZS5jdXJyZW50VGFyZ2V0IDogZS5zcmNFbGVtZW50OwogICAgICB2YXIgdmFsdWUgPSB0YXJnZXQudmFsdWU7CgogICAgICBpZiAoIXRhcmdldC5zZXRTZWxlY3Rpb25SYW5nZSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIGN1cnNvciA9IHRhcmdldC5zZWxlY3Rpb25TdGFydDsgLy8gYWxsb3c6IGRlbGV0ZSwgYmFja3NwYWNlCgogICAgICBpZiAoWzQ2LCA4XS5pbmRleE9mKGUua2V5Q29kZSkgIT09IC0xICYmIC8vIGlmIHNwYWNlIHRvIGJlIGRlbGV0ZWQKICAgICAgdmFsdWUuY2hhckF0KGN1cnNvciAtIDEpID09PSAnICcpIHsKICAgICAgICAvLyBwbGFjaW5nIGN1cnNvciBiZWZvcmUgc3BhY2UgdG8gZGVsZXRlIGRpZ2l0IGluc3RlYWQKICAgICAgICB0YXJnZXQuc2V0U2VsZWN0aW9uUmFuZ2UoY3Vyc29yIC0gMSwgY3Vyc29yIC0gMSk7CiAgICAgIH0KICAgIH07CiAgICAvKioKICAgICAqIEhlYXJ0bGFuZC5DYXJkLnZhbGlkYXRlTnVtYmVyCiAgICAgKgogICAgICogVmFsaWRhdGVzIGEgdGFyZ2V0IGVsZW1lbnQncyB2YWx1ZSBiYXNlZCBvbiB0aGUKICAgICAqIGluZmVycmVkIGNhcmQgdHlwZSdzIHZhbGlkYXRpb24gcmVnZXguIEFkZHMgYQogICAgICogY2xhc3MgdG8gdGhlIHRhcmdldCBlbGVtZW50IHRvIG5vdGUgYHZhbGlkYCBvcgogICAgICogYGludmFsaWRgLgogICAgICoKICAgICAqIEBwYXJhbSB7RXZlbnR9IGUKICAgICAqLwoKCiAgICBDYXJkLnZhbGlkYXRlTnVtYmVyID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHRhcmdldCA9IGUuY3VycmVudFRhcmdldCA/IGUuY3VycmVudFRhcmdldCA6IGUuc3JjRWxlbWVudDsKICAgICAgdmFyIHZhbHVlID0gdGFyZ2V0LnZhbHVlOwogICAgICB2YXIgY2xhc3NMaXN0ID0gdGFyZ2V0LmNsYXNzTmFtZS5zcGxpdCgnICcpOwogICAgICB2YXIgbGVuZ3RoID0gY2xhc3NMaXN0Lmxlbmd0aDsKICAgICAgdmFyIGMgPSAnJzsKCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICBjID0gY2xhc3NMaXN0W2ldOwoKICAgICAgICBpZiAoYy5pbmRleE9mKCd2YWxpZCcpICE9PSAtMSkgewogICAgICAgICAgZGVsZXRlIGNsYXNzTGlzdFtpXTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmIChuZXcgQ2FyZE51bWJlciQxKCkudmFsaWRhdGUodmFsdWUpKSB7CiAgICAgICAgY2xhc3NMaXN0LnB1c2goJ3ZhbGlkJyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY2xhc3NMaXN0LnB1c2goJ2ludmFsaWQnKTsKICAgICAgfQoKICAgICAgdGFyZ2V0LmNsYXNzTmFtZSA9IGNsYXNzTGlzdC5qb2luKCcgJykucmVwbGFjZSgvXlxzK3xccyskL2dtLCAnJyk7CiAgICB9OwogICAgLyoqCiAgICAgKiBIZWFydGxhbmQuQ2FyZC52YWxpZGF0ZUN2dgogICAgICoKICAgICAqIFZhbGlkYXRlcyBhIHRhcmdldCBlbGVtZW50J3MgdmFsdWUgYmFzZWQgb24gdGhlCiAgICAgKiBwb3NzaWJsZSBDVlYgbGVuZ3Rocy4gQWRkcyBhIGNsYXNzIHRvIHRoZSB0YXJnZXQKICAgICAqIGVsZW1lbnQgdG8gbm90ZSBgdmFsaWRgIG9yIGBpbnZhbGlkYC4KICAgICAqCiAgICAgKiBAcGFyYW0ge0V2ZW50fSBlCiAgICAgKi8KCgogICAgQ2FyZC52YWxpZGF0ZUN2diA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0YXJnZXQgPSBlLmN1cnJlbnRUYXJnZXQgPyBlLmN1cnJlbnRUYXJnZXQgOiBlLnNyY0VsZW1lbnQ7CiAgICAgIHZhciB2YWx1ZSA9IHRhcmdldC52YWx1ZTsKICAgICAgdmFyIGNsYXNzTGlzdCA9IHRhcmdldC5jbGFzc05hbWUuc3BsaXQoJyAnKTsKICAgICAgdmFyIGxlbmd0aCA9IGNsYXNzTGlzdC5sZW5ndGg7CiAgICAgIHZhciBjID0gJyc7CgogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgICAgYyA9IGNsYXNzTGlzdFtpXTsKCiAgICAgICAgaWYgKGMuaW5kZXhPZigndmFsaWQnKSAhPT0gLTEpIHsKICAgICAgICAgIGRlbGV0ZSBjbGFzc0xpc3RbaV07CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAobmV3IEN2digpLnZhbGlkYXRlKHZhbHVlKSkgewogICAgICAgIGNsYXNzTGlzdC5wdXNoKCd2YWxpZCcpOwogICAgICB9IGVsc2UgewogICAgICAgIGNsYXNzTGlzdC5wdXNoKCdpbnZhbGlkJyk7CiAgICAgIH0KCiAgICAgIHRhcmdldC5jbGFzc05hbWUgPSBjbGFzc0xpc3Quam9pbignICcpLnJlcGxhY2UoL15ccyt8XHMrJC9nbSwgJycpOwogICAgfTsKICAgIC8qKgogICAgICogSGVhcnRsYW5kLkNhcmQudmFsaWRhdGVFeHBpcmF0aW9uCiAgICAgKgogICAgICogVmFsaWRhdGVzIGEgdGFyZ2V0IGVsZW1lbnQncyB2YWx1ZSBiYXNlZCBvbiB0aGUKICAgICAqIGN1cnJlbnQgZGF0ZS4gQWRkcyBhIGNsYXNzIHRvIHRoZSB0YXJnZXQgZWxlbWVudAogICAgICogdG8gbm90ZSBgdmFsaWRgIG9yIGBpbnZhbGlkYC4KICAgICAqCiAgICAgKiBAcGFyYW0ge0V2ZW50fSBlCiAgICAgKi8KCgogICAgQ2FyZC52YWxpZGF0ZUV4cGlyYXRpb24gPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdGFyZ2V0ID0gZS5jdXJyZW50VGFyZ2V0ID8gZS5jdXJyZW50VGFyZ2V0IDogZS5zcmNFbGVtZW50OwogICAgICB2YXIgdmFsdWUgPSB0YXJnZXQudmFsdWU7CiAgICAgIHZhciBjbGFzc0xpc3QgPSB0YXJnZXQuY2xhc3NOYW1lLnNwbGl0KCcgJyk7CiAgICAgIHZhciBsZW5ndGggPSBjbGFzc0xpc3QubGVuZ3RoOwogICAgICB2YXIgYyA9ICcnOwoKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICAgIGMgPSBjbGFzc0xpc3RbaV07CgogICAgICAgIGlmIChjLmluZGV4T2YoJ3ZhbGlkJykgIT09IC0xKSB7CiAgICAgICAgICBkZWxldGUgY2xhc3NMaXN0W2ldOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKG5ldyBFeHBpcmF0aW9uJDEoKS52YWxpZGF0ZSh2YWx1ZSkpIHsKICAgICAgICBjbGFzc0xpc3QucHVzaCgndmFsaWQnKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjbGFzc0xpc3QucHVzaCgnaW52YWxpZCcpOwogICAgICB9CgogICAgICB0YXJnZXQuY2xhc3NOYW1lID0gY2xhc3NMaXN0LmpvaW4oJyAnKS5yZXBsYWNlKC9eXHMrfFxzKyQvZ20sICcnKTsKICAgIH07CiAgICAvKioKICAgICAqIEhlYXJ0bGFuZC5DYXJkLmF0dGFjaE51bWJlckV2ZW50cwogICAgICoKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBzZWxlY3RvcgogICAgICovCgoKICAgIENhcmQuYXR0YWNoTnVtYmVyRXZlbnRzID0gZnVuY3Rpb24gKHNlbGVjdG9yKSB7CiAgICAgIEV2ZW50cy5hZGRIYW5kbGVyKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3IpLCAna2V5ZG93bicsIENhcmQucmVzdHJpY3ROdW1lcmljKTsKICAgICAgRXZlbnRzLmFkZEhhbmRsZXIoZG9jdW1lbnQucXVlcnlTZWxlY3RvcihzZWxlY3RvciksICdrZXlkb3duJywgQ2FyZC5yZXN0cmljdExlbmd0aCgxOSkpOwogICAgICBFdmVudHMuYWRkSGFuZGxlcihkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKSwgJ2tleWRvd24nLCBDYXJkLmRlbGV0ZVByb3Blcmx5KTsKICAgICAgRXZlbnRzLmFkZEhhbmRsZXIoZG9jdW1lbnQucXVlcnlTZWxlY3RvcihzZWxlY3RvciksICdrZXl1cCcsIENhcmQuZm9ybWF0TnVtYmVyKTsKICAgICAgRXZlbnRzLmFkZEhhbmRsZXIoZG9jdW1lbnQucXVlcnlTZWxlY3RvcihzZWxlY3RvciksICdpbnB1dCcsIENhcmQuZm9ybWF0TnVtYmVyKTsKICAgICAgRXZlbnRzLmFkZEhhbmRsZXIoZG9jdW1lbnQucXVlcnlTZWxlY3RvcihzZWxlY3RvciksICdpbnB1dCcsIENhcmQudmFsaWRhdGVOdW1iZXIpOwogICAgICBFdmVudHMuYWRkSGFuZGxlcihkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKSwgJ2lucHV0JywgQ2FyZC5hZGRUeXBlKTsKICAgIH07CiAgICAvKioKICAgICAqIEhlYXJ0bGFuZC5DYXJkLmF0dGFjaEV4cGlyYXRpb25FdmVudHMKICAgICAqCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gc2VsZWN0b3IKICAgICAqLwoKCiAgICBDYXJkLmF0dGFjaEV4cGlyYXRpb25FdmVudHMgPSBmdW5jdGlvbiAoc2VsZWN0b3IpIHsKICAgICAgRXZlbnRzLmFkZEhhbmRsZXIoZG9jdW1lbnQucXVlcnlTZWxlY3RvcihzZWxlY3RvciksICdrZXlkb3duJywgQ2FyZC5yZXN0cmljdE51bWVyaWMpOwogICAgICBFdmVudHMuYWRkSGFuZGxlcihkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKSwgJ2tleWRvd24nLCBDYXJkLnJlc3RyaWN0TGVuZ3RoKDkpKTsKICAgICAgRXZlbnRzLmFkZEhhbmRsZXIoZG9jdW1lbnQucXVlcnlTZWxlY3RvcihzZWxlY3RvciksICdrZXl1cCcsIENhcmQuZm9ybWF0RXhwaXJhdGlvbik7CiAgICAgIEV2ZW50cy5hZGRIYW5kbGVyKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3IpLCAnYmx1cicsIENhcmQuZm9ybWF0RXhwaXJhdGlvbik7CiAgICAgIEV2ZW50cy5hZGRIYW5kbGVyKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3IpLCAnaW5wdXQnLCBDYXJkLnZhbGlkYXRlRXhwaXJhdGlvbik7CiAgICAgIEV2ZW50cy5hZGRIYW5kbGVyKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3IpLCAnYmx1cicsIENhcmQudmFsaWRhdGVFeHBpcmF0aW9uKTsKICAgIH07CiAgICAvKioKICAgICAqIEhlYXJ0bGFuZC5DYXJkLmF0dGFjaEN2dkV2ZW50cwogICAgICoKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBzZWxlY3RvcgogICAgICovCgoKICAgIENhcmQuYXR0YWNoQ3Z2RXZlbnRzID0gZnVuY3Rpb24gKHNlbGVjdG9yKSB7CiAgICAgIEV2ZW50cy5hZGRIYW5kbGVyKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3IpLCAna2V5ZG93bicsIENhcmQucmVzdHJpY3ROdW1lcmljKTsKICAgICAgRXZlbnRzLmFkZEhhbmRsZXIoZG9jdW1lbnQucXVlcnlTZWxlY3RvcihzZWxlY3RvciksICdrZXlkb3duJywgQ2FyZC5yZXN0cmljdExlbmd0aCg0KSk7CiAgICAgIEV2ZW50cy5hZGRIYW5kbGVyKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3IpLCAnaW5wdXQnLCBDYXJkLnZhbGlkYXRlQ3Z2KTsKICAgIH07CgogICAgcmV0dXJuIENhcmQ7CiAgfSgpOwoKICBpZiAoIUFycmF5LnByb3RvdHlwZS5pbmRleE9mKSB7CiAgICBBcnJheS5wcm90b3R5cGUuaW5kZXhPZiA9IGZ1bmN0aW9uIChvYmosIHN0YXJ0KSB7CiAgICAgIGZvciAodmFyIGkgPSBzdGFydCB8fCAwLCBqID0gdGhpcy5sZW5ndGg7IGkgPCBqOyBpKyspIHsKICAgICAgICBpZiAodGhpc1tpXSA9PT0gb2JqKSB7CiAgICAgICAgICByZXR1cm4gaTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiAtMTsKICAgIH07CiAgfQoKICB2YXIgRm9ybWF0dGVyID0gewogICAgQ2FyZE51bWJlcjogQ2FyZE51bWJlciwKICAgIEV4cGlyYXRpb246IEV4cGlyYXRpb24KICB9OwogIHZhciBkZWZhdWx0cyA9IHsKICAgIF9tZXRob2Q6ICdwb3N0JywKICAgIGJ1dHRvblRhcmdldDogJycsCiAgICBjYXJkQ3Z2OiAnJywKICAgIGNhcmRFeHBNb250aDogJycsCiAgICBjYXJkRXhwWWVhcjogJycsCiAgICBjYXJkTnVtYmVyOiAnJywKICAgIGNhcmRUeXBlOiAnJywKICAgIGVudjogJ3Byb2QnLAogICAgZXJyb3I6IG51bGwsCiAgICBmaWVsZHM6IHt9LAogICAgZm9ybUlkOiAnJywKICAgIGdhdGV3YXlVcmw6ICcnLAogICAgaWZyYW1lVGFyZ2V0OiAnJywKICAgIGt0YjogJycsCiAgICBvYmplY3Q6ICd0b2tlbicsCiAgICBvbkV2ZW50OiBudWxsLAogICAgb25Ub2tlbkVycm9yOiBudWxsLAogICAgb25Ub2tlblN1Y2Nlc3M6IG51bGwsCiAgICBwaW5CbG9jazogJycsCiAgICBwdWJsaWNLZXk6ICcnLAogICAgc3VjY2VzczogbnVsbCwKICAgIHRhcmdldFR5cGU6ICcnLAogICAgdG9rZW5UeXBlOiAnc3VwdCcsCiAgICB0cmFjazogJycsCiAgICB0cmFja051bWJlcjogJycsCiAgICB0eXBlOiAncGFuJywKICAgIHVzZURlZmF1bHRTdHlsZXM6IHRydWUKICB9OwogIHZhciBmaWVsZHMgPSBbJ2NhcmROdW1iZXInLCAnY2FyZEN2dicsICdjYXJkRXhwaXJhdGlvbicsICdzdWJtaXQnXTsKICB2YXIgdXJscyA9IHsKICAgIENFUlQ6ICdodHRwczovL2NlcnQuYXBpMi5oZWFydGxhbmRwb3J0aWNvLmNvbS9IcHMuRXhjaGFuZ2UuUG9zR2F0ZXdheS5IcGYudjEvYXBpL3Rva2VuJywKICAgIFBST0Q6ICdodHRwczovL2FwaS5oZWFydGxhbmRwb3J0aWNvLmNvbS9TZWN1cmVTdWJtaXQudjEvYXBpL3Rva2VuJywKICAgIGlmcmFtZUNFUlQ6ICdodHRwczovL2hwcy5naXRodWIuaW8vdG9rZW4vMi4xLycsCiAgICBpZnJhbWVQUk9EOiAnaHR0cHM6Ly9hcGkuaGVhcnRsYW5kcG9ydGljby5jb20vU2VjdXJlU3VibWl0LnYxL3Rva2VuLzIuMS8nCiAgfTsKICAvKioKICAgKiBIZWFydGxhbmQuTWVzc2FnZXMKICAgKgogICAqIEluaXRpYWxpemVzIGEgbmV3IG9iamVjdCBmb3Igd3JhcHBpbmcgYHdpbmRvdy5wb3N0TWVzc2FnZWAgYW5kIGEgZmFsbGJhY2sKICAgKiBtZXRob2QgZm9yIGxlZ2FjeSBicm93c2Vycy4KICAgKi8KCiAgdmFyIE1lc3NhZ2VzID0gZnVuY3Rpb24gKCkgewogICAgLyoqCiAgICAgKiBIZWFydGxhbmQuTWVzc2FnZXMgKGNvbnN0cnVjdG9yKQogICAgICoKICAgICAqIEBjb25zdHJ1Y3RvcgogICAgICogQHBhcmFtIHtIZWFydGxhbmQuSFBTfSBocHMKICAgICAqIEByZXR1cm5zIHtIZWFydGxhbmQuTWVzc2FnZXN9CiAgICAgKi8KICAgIGZ1bmN0aW9uIE1lc3NhZ2VzKGhwcykgewogICAgICB0aGlzLmhwcyA9IGhwczsKICAgICAgdGhpcy5pbnRlcnZhbElkID0gbnVsbDsKICAgICAgdGhpcy5sYXN0SGFzaCA9ICcnOwogICAgICB0aGlzLnB1c2hJbnRlcnZhbFN0YXJ0ZWQgPSBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogSGVhcnRsYW5kLk1lc3NhZ2VzLnB1c2hNZXNzYWdlcwogICAgICoKICAgICAqIEZvciBsZWdhY3kgYnJvd3NlcnMsIGEgbWFpbGJveCAoYnVmZmVyKSBtdXN0IGJlIHVzZWQgdG8gZW5zdXJlIGFsbCBtZXNzYWdlcwogICAgICogYXJlIHNlbnQgYmV0d2VlbiBwYXJlbnQgYW5kIGNoaWxkIHdpbmRvd3MuIFdoZW4gcmVhZHksIHRoaXMgZnVuY3Rpb24gYnVpbGRzCiAgICAgKiB0aGUgZmluYWwgbWVzc2FnZSwgZW5jb2RlcyBpdCwgc2VuZHMgaXQsIGFuZCByZXNldHMgdGhlIG1haWxib3ggdG8gYFtdYC4KICAgICAqCiAgICAgKiBAcGFyYW0ge0hlYXJ0bGFuZC5IUFN9IGhwcwogICAgICogQHJldHVybnMge2Z1bmN0aW9ufQogICAgICovCgoKICAgIE1lc3NhZ2VzLnByb3RvdHlwZS5wdXNoTWVzc2FnZXMgPSBmdW5jdGlvbiAoaHBzKSB7CiAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGRhdGEgPSBbXTsKICAgICAgICB2YXIgbWVzc2FnZUFyciA9IFtdOwogICAgICAgIHZhciBpID0gMDsKICAgICAgICB2YXIgdGFyZ2V0VXJsID0gJyc7CiAgICAgICAgdmFyIGN1cnJlbnQ7CiAgICAgICAgdmFyIHRhcmdldE5vZGU7CiAgICAgICAgdmFyIHJlID0gL14jP1xkKyYvOwogICAgICAgIHZhciBsZW5ndGggPSBocHMubWFpbGJveC5sZW5ndGg7CgogICAgICAgIGlmICghbGVuZ3RoKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGN1cnJlbnQgPSBocHMubWFpbGJveC5zaGlmdCgpOwoKICAgICAgICAgIGlmICghdGFyZ2V0VXJsKSB7CiAgICAgICAgICAgIHRhcmdldFVybCA9IGN1cnJlbnQudGFyZ2V0VXJsOwogICAgICAgICAgICB0YXJnZXROb2RlID0gY3VycmVudC50YXJnZXROb2RlOwogICAgICAgICAgfQoKICAgICAgICAgIG1lc3NhZ2VBcnIucHVzaChjdXJyZW50Lm1lc3NhZ2UpOwogICAgICAgIH0KCiAgICAgICAgY3VycmVudCA9IG51bGw7CgogICAgICAgIGlmIChyZS50ZXN0KHdpbmRvdy5sb2NhdGlvbi5oYXNoKSkgewogICAgICAgICAgY3VycmVudCA9IEpTT04yLnBhcnNlKGRlY29kZVVSSUNvbXBvbmVudCh3aW5kb3cubG9jYXRpb24uaGFzaC5yZXBsYWNlKHJlLCAnJykpKTsKICAgICAgICAgIGRhdGEuY29uY2F0KGN1cnJlbnQpOwogICAgICAgIH0KCiAgICAgICAgaWYgKG1lc3NhZ2VBcnIgIT09IFtdKSB7CiAgICAgICAgICBocHMuY2FjaGVCdXN0ID0gaHBzLmNhY2hlQnVzdCB8fCAxOwogICAgICAgICAgZGF0YS5wdXNoKHsKICAgICAgICAgICAgZGF0YTogbWVzc2FnZUFyciwKICAgICAgICAgICAgc291cmNlOiB7CiAgICAgICAgICAgICAgbmFtZTogaHBzLmZpZWxkIHx8ICdwYXJlbnQnCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgICAgdmFyIG1lc3NhZ2UgPSBKU09OMi5zdHJpbmdpZnkoZGF0YSk7CiAgICAgICAgICB2YXIgdXJsID0gdGFyZ2V0VXJsLnJlcGxhY2UoLyMuKiQvLCAnJykgKyAnIycgKyArbmV3IERhdGUoKSArIGhwcy5jYWNoZUJ1c3QrKyArICcmJyArIGVuY29kZVVSSUNvbXBvbmVudChtZXNzYWdlKTsKCiAgICAgICAgICBpZiAodGFyZ2V0Tm9kZS5sb2NhdGlvbikgewogICAgICAgICAgICB0YXJnZXROb2RlLmxvY2F0aW9uLmhyZWYgPSB1cmw7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0YXJnZXROb2RlLnNyYyA9IHVybDsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIG1lc3NhZ2VBcnIubGVuZ3RoID0gMDsKICAgICAgICBocHMubWFpbGJveC5sZW5ndGggPSAwOwogICAgICB9OwogICAgfTsKICAgIC8qKgogICAgICogSGVhcnRsYW5kLk1lc3NhZ2VzLnBvc3QKICAgICAqCiAgICAgKiBXaGVuIHByZXNlbnQsIHdyYXBzIHRoZSBidWlsdC1pbiBgd2luZG93LnBvc3RNZXNzYWdlYC4gV2hlbiBub3QgcHJlc2VudCwKICAgICAqIHB1c2hlcyB0aGUgbWVzc2FnZSBvbnRvIHRoZSBtYWlsYm94IGZvciBldmVudHVhbCBzZW5kaW5nLCBhbmQgb24gZmlyc3QgdXNlLAogICAgICogc3RhcnRzIHRoZSBpbnRlcnZhbCBmb3IgYE1lc3NhZ2VzLnB1c2hNZXNzYWdlc2AuCiAgICAgKgogICAgICogQHBhcmFtIHtPYmplY3QgfCBzdHJpbmd9IG1lc3NhZ2UKICAgICAqIEBwYXJhbSB7c3RyaW5nfSB0YXJnZXQKICAgICAqLwoKCiAgICBNZXNzYWdlcy5wcm90b3R5cGUucG9zdCA9IGZ1bmN0aW9uIChtZXNzYWdlLCB0YXJnZXQpIHsKICAgICAgdmFyIHRhcmdldE5vZGU7CiAgICAgIG1lc3NhZ2Uuc291cmNlID0gbWVzc2FnZS5zb3VyY2UgfHwge307CiAgICAgIG1lc3NhZ2Uuc291cmNlLm5hbWUgPSB3aW5kb3cubmFtZTsKCiAgICAgIGlmICghdGhpcy5ocHMuZnJhbWVzKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgZnJhbWUgPSB0aGlzLmhwcy5mcmFtZXNbdGFyZ2V0XSB8fCB0aGlzLmhwc1t0YXJnZXRdOwoKICAgICAgaWYgKCFmcmFtZSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIHRhcmdldFVybCA9IHRoaXMuaHBzLmZyYW1lc1t0YXJnZXRdLnVybDsKCiAgICAgIHRyeSB7CiAgICAgICAgaWYgKHR5cGVvZiBmcmFtZS50YXJnZXROb2RlICE9PSAndW5kZWZpbmVkJykgewogICAgICAgICAgdGFyZ2V0Tm9kZSA9IGZyYW1lLnRhcmdldE5vZGU7CiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgZnJhbWUuZnJhbWUgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICB0YXJnZXROb2RlID0gZnJhbWUuZnJhbWU7CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgdGFyZ2V0Tm9kZSA9IGZyYW1lOwogICAgICB9CgogICAgICBpZiAod2luZG93LnBvc3RNZXNzYWdlKSB7CiAgICAgICAgdGFyZ2V0Tm9kZS5wb3N0TWVzc2FnZShKU09OMi5zdHJpbmdpZnkobWVzc2FnZSksIHRhcmdldFVybCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5ocHMubWFpbGJveCA9IHRoaXMuaHBzLm1haWxib3ggfHwgW107CiAgICAgICAgdGhpcy5ocHMubWFpbGJveC5wdXNoKHsKICAgICAgICAgIG1lc3NhZ2U6IG1lc3NhZ2UsCiAgICAgICAgICB0YXJnZXROb2RlOiB0YXJnZXROb2RlLAogICAgICAgICAgdGFyZ2V0VXJsOiB0YXJnZXRVcmwKICAgICAgICB9KTsKCiAgICAgICAgaWYgKCF0aGlzLnB1c2hJbnRlcnZhbFN0YXJ0ZWQpIHsKICAgICAgICAgIHNldEludGVydmFsKHRoaXMucHVzaE1lc3NhZ2VzKHRoaXMuaHBzKSwgMTApOwogICAgICAgIH0KICAgICAgfQogICAgfTsKICAgIC8qKgogICAgICogSGVhcnRsYW5kLk1lc3NhZ2VzLnJlY2VpdmUKICAgICAqCiAgICAgKiBXaGVuIHByZXNlbnQsIHdyYXBzIHRoZSBidWlsdC1pbiBgd2luZG93LnBvc3RNZXNhZ2VgJ3MgYG1lc3NhZ2VgIG9yCiAgICAgKiBgb25tZXNzYWdlYCB3aW5kb3cgZXZlbnRzLiBXaGVuIG5vdCBwcmVzZW50LCB1c2VzIGEgc2luZ2xlIGludGVydmFsIHRvCiAgICAgKiBjaGVjayBmb3IgY2hhbmdlcyB0byBgd2luZG93LmxvY2F0aW9uLmhhc2hgIHdoZW4gdGhlIG90aGVyIHdpbmRvdyBzZW5kcyBhCiAgICAgKiBtZXNzYWdlIGFuZCB3aWxsIGRlY29kZSB0aGUgSlNPTiBhbmQgVVJJIGVuY29kZWQgaGFzaC4KICAgICAqCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjawogICAgICogQHBhcmFtIHtzdHJpbmd9IHNvdXJjZU9yaWdpbgogICAgICovCgoKICAgIE1lc3NhZ2VzLnByb3RvdHlwZS5yZWNlaXZlID0gZnVuY3Rpb24gKGNhbGxiYWNrLCBzb3VyY2VPcmlnaW4pIHsKICAgICAgaWYgKHdpbmRvdy5wb3N0TWVzc2FnZSkgewogICAgICAgIHRoaXMuY2FsbGJhY2sgPSBmdW5jdGlvbiAobSkgewogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgY2FsbGJhY2soSlNPTjIucGFyc2UobS5kYXRhKSk7CiAgICAgICAgICB9IGNhdGNoIChlKSB7fQogICAgICAgIH07CgogICAgICAgIGlmICh3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcikgewogICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCB0aGlzLmNhbGxiYWNrLCAhMSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHdpbmRvdy5hdHRhY2hFdmVudCgnb25tZXNzYWdlJywgdGhpcy5jYWxsYmFjayk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGlmICh0aGlzLmludGVydmFsSWQpIHsKICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5pbnRlcnZhbElkKTsKICAgICAgICB9CgogICAgICAgIHRoaXMuaW50ZXJ2YWxJZCA9IG51bGw7CgogICAgICAgIGlmIChjYWxsYmFjaykgewogICAgICAgICAgdGhpcy5pbnRlcnZhbElkID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgaGFzaCA9IGRvY3VtZW50LmxvY2F0aW9uLmhhc2gsCiAgICAgICAgICAgICAgICByZSA9IC9eIz9cZCsmLzsKCiAgICAgICAgICAgIGlmIChoYXNoICE9PSB0aGlzLmxhc3RIYXNoICYmIHJlLnRlc3QoaGFzaCkpIHsKICAgICAgICAgICAgICB2YXIgZGF0YSA9IEpTT04yLnBhcnNlKGRlY29kZVVSSUNvbXBvbmVudChoYXNoLnJlcGxhY2UocmUsICcnKSkpOwogICAgICAgICAgICAgIHRoaXMubGFzdEhhc2ggPSBoYXNoOwoKICAgICAgICAgICAgICBmb3IgKHZhciBpIGluIGRhdGEpIHsKICAgICAgICAgICAgICAgIHZhciBtID0gZGF0YVtpXTsKCiAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG0uZGF0YSkgIT09ICdbb2JqZWN0IEFycmF5XScpIHsKICAgICAgICAgICAgICAgICAgY2FsbGJhY2sobSk7CiAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGZvciAodmFyIGogaW4gbS5kYXRhKSB7CiAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKHsKICAgICAgICAgICAgICAgICAgICBkYXRhOiBtLmRhdGFbal0sCiAgICAgICAgICAgICAgICAgICAgc291cmNlOiBtLnNvdXJjZQogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sIDEwMCk7CiAgICAgICAgfQogICAgICB9CgogICAgICBFdmVudHMudHJpZ2dlcigncmVjZWl2ZU1lc3NhZ2VIYW5kbGVyQWRkZWQnLCBkb2N1bWVudCk7CiAgICB9OwogICAgLyoqCiAgICAgKiBIZWFydGxhbmQuTWVzc2FnZXMucmVtb3ZlUmVjZWl2ZXIKICAgICAqCiAgICAgKiBSZW1vdmVzIGFjdGl2ZSBgbWVzc2FnZWAgZXZlbnQgaGFuZGxlciBmdW5jdGlvbi4KICAgICAqLwoKCiAgICBNZXNzYWdlcy5wcm90b3R5cGUucmVtb3ZlUmVjZWl2ZXIgPSBmdW5jdGlvbiAoKSB7CiAgICAgIGlmICh3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcikgewogICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgdGhpcy5jYWxsYmFjaywgITEpOwogICAgICB9IGVsc2UgewogICAgICAgIHdpbmRvdy5kZXRhY2hFdmVudCgnb25tZXNzYWdlJywgdGhpcy5jYWxsYmFjayk7CiAgICAgIH0KICAgIH07CiAgICAvKioKICAgICAqIEhlYXJ0bGFuZC5NZXNzYWdlcy5kaXNwb3NlCiAgICAgKgogICAgICogUmVtb3ZlcyBhY3RpdmUgYG1lc3NhZ2VgIGV2ZW50IGhhbmRsZXIgZnVuY3Rpb24gYW5kIGFueQogICAgICogYWN0aXZlIGludGVydmFscy4KICAgICAqLwoKCiAgICBNZXNzYWdlcy5wcm90b3R5cGUuZGlzcG9zZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy5yZW1vdmVSZWNlaXZlcigpOwoKICAgICAgaWYgKHRoaXMuaW50ZXJ2YWxJZCkgewogICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5pbnRlcnZhbElkKTsKICAgICAgfQogICAgfTsKCiAgICByZXR1cm4gTWVzc2FnZXM7CiAgfSgpOwogIC8qKgogICAqIEBuYW1lc3BhY2UgSGVhcnRsYW5kLlN0eWxlcwogICAqLwoKCiAgdmFyIFN0eWxlczsKCiAgKGZ1bmN0aW9uIChTdHlsZXMpIHsKICAgIC8qKgogICAgICogSGVhcnRsYW5kLlN0eWxlcy5EZWZhdWx0cwogICAgICoKICAgICAqIENvbGxlY3Rpb24gb2YgaGVscGVyIGZ1bmN0aW9ucyBmb3IgYXBwbHlpbmcgZGVmYXVsdCBzdHlsZXMgdG8gYSBjaGlsZAogICAgICogd2luZG93J3MgZmllbGRzLiBTZXJ2ZXMgYXMgYW4gZXhhbXBsZSBvZiB0aGVzZSBtZXRob2RzJyB1c2UgaW4gbWVyY2hhbnQKICAgICAqIG1vZGlmaWNhdGlvbnMuIEVhY2ggZnVuY3Rpb24gZXhwZWN0cyBhIGBIZWFydGxhbmQuSFBTYCBvYmplY3QgdG8gYmUgcGFzc2VkCiAgICAgKiBhcyBhbiBhcmd1bWVudC4KICAgICAqLwogICAgU3R5bGVzLkRlZmF1bHRzID0gewogICAgICBib2R5OiBmdW5jdGlvbiBib2R5KGhwcykgewogICAgICAgIGhwcy5zZXRTdHlsZSgnaGVhcnRsYW5kLWJvZHknLCAnbWFyZ2luOiAwOycgKyAnZm9udC1mYW1pbHk6IEFyaWFsLCBcJ0hlbHZldGljYSBOZXVlXCcsIEhlbHZldGljYSwgc2Fucy1zZXJpZjsnICsgJ2NvbG9yOiAjNjY2OycpOwogICAgICB9LAogICAgICBjdnY6IGZ1bmN0aW9uIGN2dihocHMpIHsKICAgICAgICBocHMuYXBwZW5kU3R5bGUoJ2hlYXJ0bGFuZC1jdnYnLCAnd2lkdGg6IDExMHB4OycpOwogICAgICB9LAogICAgICBjdnZDb250YWluZXI6IGZ1bmN0aW9uIGN2dkNvbnRhaW5lcihocHMpIHsKICAgICAgICBocHMuc2V0U3R5bGUoJ2hlYXJ0bGFuZC1jdnYtY29udGFpbmVyJywgJ3dpZHRoOiAxMTBweDsnICsgJ2Rpc3BsYXk6IGlubGluZS1ibG9jazsnICsgJ2Zsb2F0OiBsZWZ0OycpOwogICAgICB9LAogICAgICBmaWVsZHNldDogZnVuY3Rpb24gZmllbGRzZXQoaHBzKSB7CiAgICAgICAgaHBzLnNldFN0eWxlKCdoZWFydGxhbmQtZXhwaXJhdGlvbi1kYXRlLWNvbnRhaW5lcicsICdib3JkZXI6IDA7JyArICdtYXJnaW46IDAgMjVweCAwcHggMXB4OycgKyAncGFkZGluZzogMDsnICsgJ3dpZHRoOiAxNzNweDsnICsgJ2Rpc3BsYXk6IGlubGluZS1ibG9jazsnICsgJ2Zsb2F0OiAgbGVmdDsnKTsKICAgICAgfSwKICAgICAgaW5wdXRzQW5kU2VsZWN0czogZnVuY3Rpb24gaW5wdXRzQW5kU2VsZWN0cyhocHMpIHsKICAgICAgICB2YXIgaWRzID0gWydoZWFydGxhbmQtY2FyZC1udW1iZXInLCAnaGVhcnRsYW5kLWV4cGlyYXRpb24tbW9udGgnLCAnaGVhcnRsYW5kLWV4cGlyYXRpb24teWVhcicsICdoZWFydGxhbmQtY3Z2J107CiAgICAgICAgdmFyIGxlbmd0aCA9IGlkcy5sZW5ndGg7CiAgICAgICAgdmFyIGkgPSAwOwoKICAgICAgICBmb3IgKGk7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICAgICAgaHBzLnNldFN0eWxlKGlkc1tpXSwgJ3dpZHRoOiAzMDlweDsnICsgJ3BhZGRpbmc6IDVweDsnICsgJ2ZvbnQtc2l6ZTogMTRweDsnICsgJ21hcmdpbjogM3B4IDBweCAxNXB4IDBweDsnICsgJ2JvcmRlcjogMXB4ICNjY2Mgc29saWQ7JyArCiAgICAgICAgICAvKiBJRTEwIENvbnN1bWVyIFByZXZpZXcgKi8KICAgICAgICAgICdiYWNrZ3JvdW5kLWltYWdlOiAtbXMtbGluZWFyLWdyYWRpZW50KGJvdHRvbSwgI0Y3RjdGNyAwJSwgI0VGRUZFRiAxMDAlKTsnICsKICAgICAgICAgIC8qIE1vemlsbGEgRmlyZWZveCAqLwogICAgICAgICAgJ2JhY2tncm91bmQtaW1hZ2U6IC1tb3otbGluZWFyLWdyYWRpZW50KGJvdHRvbSwgI0Y3RjdGNyAwJSwgI0VGRUZFRiAxMDAlKTsnICsKICAgICAgICAgIC8qIE9wZXJhICovCiAgICAgICAgICAnYmFja2dyb3VuZC1pbWFnZTogLW8tbGluZWFyLWdyYWRpZW50KGJvdHRvbSwgI0Y3RjdGNyAwJSwgI0VGRUZFRiAxMDAlKTsnICsKICAgICAgICAgIC8qIFdlYmtpdCAoU2FmYXJpL0Nocm9tZSAxMCkgKi8KICAgICAgICAgICdiYWNrZ3JvdW5kLWltYWdlOiAtd2Via2l0LWdyYWRpZW50KGxpbmVhciwgbGVmdCBib3R0b20sIGxlZnQgdG9wLCBjb2xvci1zdG9wKDAsICNGN0Y3RjcpLCBjb2xvci1zdG9wKDEsICNFRkVGRUYpKTsnICsKICAgICAgICAgIC8qIFdlYmtpdCAoQ2hyb21lIDExKykgKi8KICAgICAgICAgICdiYWNrZ3JvdW5kLWltYWdlOiAtd2Via2l0LWxpbmVhci1ncmFkaWVudChib3R0b20sICNGN0Y3RjcgMCUsICNFRkVGRUYgMTAwJSk7JyArCiAgICAgICAgICAvKiBXM0MgTWFya3VwLCBJRTEwIFJlbGVhc2UgUHJldmlldyAqLwogICAgICAgICAgJ2JhY2tncm91bmQtaW1hZ2U6IGxpbmVhci1ncmFkaWVudCh0byB0b3AsICNGN0Y3RjcgMCUsICNFRkVGRUYgMTAwJSk7Jyk7CiAgICAgICAgfQogICAgICB9LAogICAgICBsYWJlbHNBbmRMZWdlbmQ6IGZ1bmN0aW9uIGxhYmVsc0FuZExlZ2VuZChocHMpIHsKICAgICAgICB2YXIgaWRzID0gWydoZWFydGxhbmQtY2FyZC1udW1iZXItbGFiZWwnLCAnaGVhcnRsYW5kLWV4cGlyYXRpb24tZGF0ZS1sZWdlbmQnLCAnaGVhcnRsYW5kLWV4cGlyYXRpb24tbW9udGgtbGFiZWwnLCAnaGVhcnRsYW5kLWV4cGlyYXRpb24teWVhci1sYWJlbCcsICdoZWFydGxhbmQtY3Z2LWxhYmVsJ107CiAgICAgICAgdmFyIGxlbmd0aCA9IGlkcy5sZW5ndGg7CiAgICAgICAgdmFyIGkgPSAwOwoKICAgICAgICBmb3IgKGk7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICAgICAgaHBzLnNldFN0eWxlKGlkc1tpXSwgJ2ZvbnQtc2l6ZTogMTNweDsnICsgJ3RleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7JyArICdmb250LXdlaWdodDogYm9sZDsnICsgJ2Rpc3BsYXk6IGJsb2NrOycgKyAnd2lkdGg6IDEwMCU7JyArICdjbGVhcjogYm90aDsnKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHNlbGVjdExhYmVsczogZnVuY3Rpb24gc2VsZWN0TGFiZWxzKGhwcykgewogICAgICAgIHZhciBpZHMgPSBbJ2hlYXJ0bGFuZC1leHBpcmF0aW9uLW1vbnRoLWxhYmVsJywgJ2hlYXJ0bGFuZC1leHBpcmF0aW9uLXllYXItbGFiZWwnXTsKICAgICAgICB2YXIgbGVuZ3RoID0gaWRzLmxlbmd0aDsKICAgICAgICB2YXIgaSA9IDA7CgogICAgICAgIGZvciAoaTsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBocHMuc2V0U3R5bGUoaWRzW2ldLCAncG9zaXRpb246YWJzb2x1dGU7JyArICd3aWR0aDoxcHg7JyArICdoZWlnaHQ6MXB4OycgKyAncGFkZGluZzowOycgKyAnbWFyZ2luOi0xcHg7JyArICdvdmVyZmxvdzpoaWRkZW47JyArICdjbGlwOnJlY3QoMCwwLDAsMCk7JyArICdib3JkZXI6MDsnKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHNlbGVjdHM6IGZ1bmN0aW9uIHNlbGVjdHMoaHBzKSB7CiAgICAgICAgdmFyIGlkcyA9IFsnaGVhcnRsYW5kLWV4cGlyYXRpb24tbW9udGgnLCAnaGVhcnRsYW5kLWV4cGlyYXRpb24teWVhciddOwogICAgICAgIHZhciBsZW5ndGggPSBpZHMubGVuZ3RoOwogICAgICAgIHZhciBpID0gMDsKCiAgICAgICAgZm9yIChpOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGhwcy5hcHBlbmRTdHlsZShpZHNbaV0sICdib3JkZXI6IDA7JyArICdvdXRsaW5lOiAxcHggc29saWQgI2NjYzsnICsgJ2hlaWdodDogMjhweDsnICsgJ3dpZHRoOiA4MHB4OycgKyAnLXdlYmtpdC1hcHBlYXJhbmNlOiBub25lOycgKyAnLW1vei1hcHBlYXJhbmNlOiBub25lOycgKyAnLXdlYmtpdC1ib3JkZXItcmFkaXVzOiAwcHg7JyArCiAgICAgICAgICAvKiB0c2xpbnQ6ZGlzYWJsZTptYXgtbGluZS1sZW5ndGggKi8KICAgICAgICAgICdiYWNrZ3JvdW5kLWltYWdlOiB1cmwoZGF0YTppbWFnZS9wbmc7YmFzZTY0LGlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFBb0FBQUFHQ0FZQUFBRDY4QS9HQUFBQUdYUkZXSFJUYjJaMGQyRnlaUUJCWkc5aVpTQkpiV0ZuWlZKbFlXUjVjY2xsUEFBQUF5aHBWRmgwV0UxTU9tTnZiUzVoWkc5aVpTNTRiWEFBQUFBQUFEdy9lSEJoWTJ0bGRDQmlaV2RwYmowaTc3dS9JaUJwWkQwaVZ6Vk5NRTF3UTJWb2FVaDZjbVZUZWs1VVkzcHJZemxrSWo4K0lEeDRPbmh0Y0cxbGRHRWdlRzFzYm5NNmVEMGlZV1J2WW1VNmJuTTZiV1YwWVM4aUlIZzZlRzF3ZEdzOUlrRmtiMkpsSUZoTlVDQkRiM0psSURVdU5pMWpNREUwSURjNUxqRTFOamM1Tnl3Z01qQXhOQzh3T0M4eU1DMHdPVG8xTXpvd01pQWdJQ0FnSUNBZ0lqNGdQSEprWmpwU1JFWWdlRzFzYm5NNmNtUm1QU0pvZEhSd09pOHZkM2QzTG5jekxtOXlaeTh4T1RrNUx6QXlMekl5TFhKa1ppMXplVzUwWVhndGJuTWpJajRnUEhKa1pqcEVaWE5qY21sd2RHbHZiaUJ5WkdZNllXSnZkWFE5SWlJZ2VHMXNibk02ZUcxd1BTSm9kSFJ3T2k4dmJuTXVZV1J2WW1VdVkyOXRMM2hoY0M4eExqQXZJaUI0Yld4dWN6cDRiWEJOVFQwaWFIUjBjRG92TDI1ekxtRmtiMkpsTG1OdmJTOTRZWEF2TVM0d0wyMXRMeUlnZUcxc2JuTTZjM1JTWldZOUltaDBkSEE2THk5dWN5NWhaRzlpWlM1amIyMHZlR0Z3THpFdU1DOXpWSGx3WlM5U1pYTnZkWEpqWlZKbFppTWlJSGh0Y0RwRGNtVmhkRzl5Vkc5dmJEMGlRV1J2WW1VZ1VHaHZkRzl6YUc5d0lFTkRJREl3TVRRZ0tFMWhZMmx1ZEc5emFDa2lJSGh0Y0UxTk9rbHVjM1JoYm1ObFNVUTlJbmh0Y0M1cGFXUTZRekE1TVRaRk4wUkZNRFkyTVRGRk5FSXlPRFpGTVVSRlJUQTNSRVV4TWpjaUlIaHRjRTFOT2tSdlkzVnRaVzUwU1VROUluaHRjQzVrYVdRNlF6QTVNVFpGTjBWRk1EWTJNVEZGTkVJeU9EWkZNVVJGUlRBM1JFVXhNamNpUGlBOGVHMXdUVTA2UkdWeWFYWmxaRVp5YjIwZ2MzUlNaV1k2YVc1emRHRnVZMlZKUkQwaWVHMXdMbWxwWkRwRE1Ea3hOa1UzUWtVd05qWXhNVVUwUWpJNE5rVXhSRVZGTURkRVJURXlOeUlnYzNSU1pXWTZaRzlqZFcxbGJuUkpSRDBpZUcxd0xtUnBaRHBETURreE5rVTNRMFV3TmpZeE1VVTBRakk0TmtVeFJFVkZNRGRFUlRFeU55SXZQaUE4TDNKa1pqcEVaWE5qY21sd2RHbHZiajRnUEM5eVpHWTZVa1JHUGlBOEwzZzZlRzF3YldWMFlUNGdQRDk0Y0dGamEyVjBJR1Z1WkQwaWNpSS9Qdk1yZFVBQUFBQmlTVVJCVkhqYVlreExTM3ZOd01BZ3dvQWZ2R1VDRWprTWhFRTI4NWt6WjY1dTJiTGxKNURqZ2tOUnhVd2dZUHovL3orWWw1NmVQaE5JcGFFcEFxbkpBREdZa0FTemdIZ25FbjhIeUVvWUIyNGkxRlJlSUxVUHluVUVtdllGSmdjUVlBQ1lhaCt1RGhwS0dBQUFBQUJKUlU1RXJrSmdnZz09KTsnICsKICAgICAgICAgIC8qIHRzbGludDplbmFibGU6bWF4LWxpbmUtbGVuZ3RoICovCiAgICAgICAgICAnYmFja2dyb3VuZC1wb3NpdGlvbjogNjVweCAxMnB4OycgKyAnYmFja2dyb3VuZC1yZXBlYXQ6IG5vLXJlcGVhdDsnICsgJ2JhY2tncm91bmQtY29sb3I6ICAjRjdGN0Y3OycgKyAnZmxvYXQ6IGxlZnQ7JyArICdtYXJnaW4tcmlnaHQ6IDZweCcpOwogICAgICAgIH0KICAgICAgfQogICAgfTsKICB9KShTdHlsZXMgfHwgKFN0eWxlcyA9IHt9KSk7CiAgLyoqCiAgICogQG5hbWVzcGFjZSBIZWFydGxhbmQuRnJhbWVzCiAgICovCgoKICB2YXIgRnJhbWVzID0gZnVuY3Rpb24gKCkgewogICAgZnVuY3Rpb24gRnJhbWVzKCkge30KICAgIC8qKgogICAgICogSGVhcnRsYW5kLkZyYW1lcy5jb25maWd1cmVJZnJhbWUKICAgICAqCiAgICAgKiBQcmVwYXJlcyB0aGUgcGFnZXMgaUZyYW1lcyBmb3IgY29tbXVuaWNhdGlvbiB3aXRoIHRoZSBwYXJlbnQgd2luZG93LgogICAgICoKICAgICAqIEBwYXJhbSB7SGVhcnRsYW5kLkhQU30gaHBzCiAgICAgKiBAbGlzdGVucyBjbGljawogICAgICogQGxpc3RlbnMgbWVzc2FnZQogICAgICovCgoKICAgIEZyYW1lcy5jb25maWd1cmVJZnJhbWUgPSBmdW5jdGlvbiAoaHBzKSB7CiAgICAgIHZhciBmcmFtZTsKICAgICAgdmFyIG9wdGlvbnMgPSBocHMub3B0aW9uczsKICAgICAgdmFyIHRhcmdldDsKICAgICAgdmFyIHVzZURlZmF1bHRTdHlsZXMgPSB0cnVlOwogICAgICBocHMuTWVzc2FnZXMgPSBocHMuTWVzc2FnZXMgfHwgbmV3IE1lc3NhZ2VzKGhwcyk7CgogICAgICBpZiAob3B0aW9ucy5lbnYgPT09ICdjZXJ0JykgewogICAgICAgIGhwcy5pZnJhbWVfdXJsID0gdXJscy5pZnJhbWVDRVJUOwogICAgICB9IGVsc2UgewogICAgICAgIGhwcy5pZnJhbWVfdXJsID0gdXJscy5pZnJhbWVQUk9EOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy5maWVsZHMgIT09IGRlZmF1bHRzLmZpZWxkcykgewogICAgICAgIEZyYW1lcy5tYWtlRmllbGRzQW5kTGluayhocHMpOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy5maWVsZHMgPT09IGRlZmF1bHRzLmZpZWxkcyAmJiBvcHRpb25zLmlmcmFtZVRhcmdldCkgewogICAgICAgIHRhcmdldCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG9wdGlvbnMuaWZyYW1lVGFyZ2V0KTsKCiAgICAgICAgaWYgKG9wdGlvbnMudGFyZ2V0VHlwZSA9PT0gJ215ZnJhbWUnKSB7CiAgICAgICAgICBmcmFtZSA9IHRhcmdldDsKICAgICAgICAgIGhwcy5pZnJhbWVfdXJsID0gZnJhbWUuc3JjOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBmcmFtZSA9IERPTS5tYWtlRnJhbWUoJ2hlYXJ0bGFuZC1mcmFtZS1zZWN1cmVzdWJtaXQnKTsKICAgICAgICAgIHRhcmdldC5hcHBlbmRDaGlsZChmcmFtZSk7CiAgICAgICAgfQoKICAgICAgICBocHMuaWZyYW1lX3VybCA9IGhwcy5pZnJhbWVfdXJsICsgJyMnICsgZW5jb2RlVVJJQ29tcG9uZW50KGRvY3VtZW50LmxvY2F0aW9uLmhyZWYuc3BsaXQoJyMnKVswXSk7CiAgICAgICAgZnJhbWUuc3JjID0gaHBzLmlmcmFtZV91cmw7CiAgICAgICAgaHBzLmZyYW1lcy5jaGlsZCA9IHsKICAgICAgICAgIGZyYW1lOiB3aW5kb3cucG9zdE1lc3NhZ2UgPyBmcmFtZS5jb250ZW50V2luZG93IDogZnJhbWUsCiAgICAgICAgICBuYW1lOiAnY2hpbGQnLAogICAgICAgICAgdXJsOiBocHMuaWZyYW1lX3VybAogICAgICAgIH07CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLnVzZURlZmF1bHRTdHlsZXMgPT09IGZhbHNlKSB7CiAgICAgICAgdXNlRGVmYXVsdFN0eWxlcyA9IGZhbHNlOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy5idXR0b25UYXJnZXQpIHsKICAgICAgICBocHMuY2xpY2tIYW5kbGVyID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgIGhwcy5NZXNzYWdlcy5wb3N0KHsKICAgICAgICAgICAgYWNjdW11bGF0ZURhdGE6ICEhaHBzLmZyYW1lcy5jYXJkTnVtYmVyLAogICAgICAgICAgICBhY3Rpb246ICd0b2tlbml6ZScsCiAgICAgICAgICAgIGRhdGE6IHsKICAgICAgICAgICAgICBwdWJsaWNLZXk6IG9wdGlvbnMucHVibGljS2V5CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sIGhwcy5mcmFtZXMuY2FyZE51bWJlciA/ICdjYXJkTnVtYmVyJyA6ICdjaGlsZCcpOwogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH07CgogICAgICAgIEV2ZW50cy5hZGRIYW5kbGVyKG9wdGlvbnMuYnV0dG9uVGFyZ2V0LCAnY2xpY2snLCBocHMuY2xpY2tIYW5kbGVyKTsKICAgICAgfQoKICAgICAgaHBzLk1lc3NhZ2VzLnJlY2VpdmUoZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICB2YXIgZmllbGRGcmFtZTsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgIGZpZWxkRnJhbWUgPSBocHMuZnJhbWVzW2RhdGEuc291cmNlLm5hbWUgPT09ICdoZWFydGxhbmQtZnJhbWUtc2VjdXJlc3VibWl0JyA/ICdwYXJlbnQnIDogZGF0YS5zb3VyY2UubmFtZV07CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgc3dpdGNoIChkYXRhLmFjdGlvbikgewogICAgICAgICAgY2FzZSAncmVxdWVzdFRva2VuaXplJzoKICAgICAgICAgICAgaHBzLk1lc3NhZ2VzLnBvc3QoewogICAgICAgICAgICAgIGFjY3VtdWxhdGVEYXRhOiAhIWhwcy5mcmFtZXMuY2FyZE51bWJlciwKICAgICAgICAgICAgICBhY3Rpb246ICd0b2tlbml6ZScsCiAgICAgICAgICAgICAgZGF0YTogb3B0aW9ucwogICAgICAgICAgICB9LCBocHMuZnJhbWVzLmNhcmROdW1iZXIgPyAnY2FyZE51bWJlcicgOiAnY2hpbGQnKTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAnb25Ub2tlblN1Y2Nlc3MnOgogICAgICAgICAgICBvcHRpb25zLm9uVG9rZW5TdWNjZXNzKGRhdGEucmVzcG9uc2UpOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlICdvblRva2VuRXJyb3InOgogICAgICAgICAgICBvcHRpb25zLm9uVG9rZW5FcnJvcihkYXRhLnJlc3BvbnNlKTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAncmVzaXplJzoKICAgICAgICAgICAgaWYgKGZpZWxkRnJhbWUpIHsKICAgICAgICAgICAgICBocHMucmVzaXplSUZyYW1lKGZpZWxkRnJhbWUuZnJhbWUsIGRhdGEuaGVpZ2h0KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBocHMucmVzaXplSUZyYW1lKGZyYW1lLCBkYXRhLmhlaWdodCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgJ3JlY2VpdmVNZXNzYWdlSGFuZGxlckFkZGVkJzoKICAgICAgICAgICAgaWYgKCFvcHRpb25zLmZpZWxkcyAmJiB1c2VEZWZhdWx0U3R5bGVzKSB7CiAgICAgICAgICAgICAgU3R5bGVzLkRlZmF1bHRzLmJvZHkoaHBzKTsKICAgICAgICAgICAgICBTdHlsZXMuRGVmYXVsdHMubGFiZWxzQW5kTGVnZW5kKGhwcyk7CiAgICAgICAgICAgICAgU3R5bGVzLkRlZmF1bHRzLmlucHV0c0FuZFNlbGVjdHMoaHBzKTsKICAgICAgICAgICAgICBTdHlsZXMuRGVmYXVsdHMuZmllbGRzZXQoaHBzKTsKICAgICAgICAgICAgICBTdHlsZXMuRGVmYXVsdHMuc2VsZWN0cyhocHMpOwogICAgICAgICAgICAgIFN0eWxlcy5EZWZhdWx0cy5zZWxlY3RMYWJlbHMoaHBzKTsKICAgICAgICAgICAgICBTdHlsZXMuRGVmYXVsdHMuY3Z2Q29udGFpbmVyKGhwcyk7CiAgICAgICAgICAgICAgU3R5bGVzLkRlZmF1bHRzLmN2dihocHMpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZmllbGRGcmFtZSAmJiBmaWVsZEZyYW1lLm9wdGlvbnMucGxhY2Vob2xkZXIpIHsKICAgICAgICAgICAgICBocHMuTWVzc2FnZXMucG9zdCh7CiAgICAgICAgICAgICAgICBhY3Rpb246ICdzZXRQbGFjZWhvbGRlcicsCiAgICAgICAgICAgICAgICBpZDogJ2hlYXJ0bGFuZC1maWVsZCcsCiAgICAgICAgICAgICAgICB0ZXh0OiBmaWVsZEZyYW1lLm9wdGlvbnMucGxhY2Vob2xkZXIKICAgICAgICAgICAgICB9LCBmaWVsZEZyYW1lLm5hbWUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZmllbGRGcmFtZSAmJiBmaWVsZEZyYW1lLm9wdGlvbnMudmFsdWUpIHsKICAgICAgICAgICAgICBocHMuTWVzc2FnZXMucG9zdCh7CiAgICAgICAgICAgICAgICBhY3Rpb246ICdzZXRWYWx1ZScsCiAgICAgICAgICAgICAgICBpZDogJ2hlYXJ0bGFuZC1maWVsZCcsCiAgICAgICAgICAgICAgICB0ZXh0OiBmaWVsZEZyYW1lLm9wdGlvbnMudmFsdWUKICAgICAgICAgICAgICB9LCBmaWVsZEZyYW1lLm5hbWUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAob3B0aW9ucy5zdHlsZSkgewogICAgICAgICAgICAgIHZhciBjc3MgPSBvcHRpb25zLnN0eWxlU3RyaW5nIHx8IChvcHRpb25zLnN0eWxlU3RyaW5nID0gRE9NLmpzb24yY3NzKG9wdGlvbnMuc3R5bGUpKTsKICAgICAgICAgICAgICBocHMuTWVzc2FnZXMucG9zdCh7CiAgICAgICAgICAgICAgICBhY3Rpb246ICdhZGRTdHlsZXNoZWV0JywKICAgICAgICAgICAgICAgIGRhdGE6IGNzcwogICAgICAgICAgICAgIH0sIGZpZWxkRnJhbWUubmFtZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEV2ZW50cy50cmlnZ2VyKCdzZWN1cmVzdWJtaXRJZnJhbWVSZWFkeScsIGRvY3VtZW50KTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAnYWNjdW11bGF0ZURhdGEnOgogICAgICAgICAgICBmb3IgKHZhciBpIGluIGhwcy5mcmFtZXMpIHsKICAgICAgICAgICAgICBpZiAoJ3N1Ym1pdCcgPT09IGkgfHwgJ2NhcmROdW1iZXInID09PSBpKSB7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZhciBmaWVsZCA9IGhwcy5mcmFtZXNbaV07CiAgICAgICAgICAgICAgaHBzLk1lc3NhZ2VzLnBvc3QoewogICAgICAgICAgICAgICAgYWN0aW9uOiAnZ2V0RmllbGREYXRhJywKICAgICAgICAgICAgICAgIGlkOiAnaGVhcnRsYW5kLWZpZWxkJwogICAgICAgICAgICAgIH0sIGZpZWxkLm5hbWUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlICdwYXNzRGF0YSc6CiAgICAgICAgICAgIHZhciBjYXJkTnVtYmVyRmllbGRGcmFtZSA9IGhwcy5mcmFtZXMuY2FyZE51bWJlcjsKCiAgICAgICAgICAgIGlmICghY2FyZE51bWJlckZpZWxkRnJhbWUpIHsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaHBzLk1lc3NhZ2VzLnBvc3QoewogICAgICAgICAgICAgIGFjdGlvbjogJ3NldEZpZWxkRGF0YScsCiAgICAgICAgICAgICAgaWQ6IGZpZWxkRnJhbWUubmFtZSwKICAgICAgICAgICAgICB2YWx1ZTogZGF0YS52YWx1ZQogICAgICAgICAgICB9LCBjYXJkTnVtYmVyRmllbGRGcmFtZS5uYW1lKTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAnZmllbGRFdmVudCc6CiAgICAgICAgICAgIGlmICghb3B0aW9ucy5vbkV2ZW50KSB7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG9wdGlvbnMub25FdmVudChkYXRhLmV2ZW50KTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAnZXJyb3InOgogICAgICAgICAgICBpZiAoIW9wdGlvbnMub25FcnJvcikgewogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBvcHRpb25zLm9uRXJyb3IoZGF0YSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfSwgJyonKTsKICAgIH07CiAgICAvKioKICAgICAqIEhlYXJ0bGFuZC5GcmFtZXMubWFrZUZpZWxkc0FuZExpbmsKICAgICAqCiAgICAgKiBDcmVhdGVzIGEgc2V0IG9mIHNpbmdsZSBmaWVsZCBpRnJhbWVzIGFuZCBzdG9yZXMgYSByZWZlcmVuY2UgdG8KICAgICAqIHRoZW0gaW4gdGhlIHBhcmVudCB3aW5kb3cncyBzdGF0ZS4KICAgICAqCiAgICAgKiBAcGFyYW0ge0hlYXJ0bGFuZC5IUFN9IGhwcwogICAgICovCgoKICAgIEZyYW1lcy5tYWtlRmllbGRzQW5kTGluayA9IGZ1bmN0aW9uIChocHMpIHsKICAgICAgdmFyIG9wdGlvbnMgPSBocHMub3B0aW9uczsKICAgICAgdmFyIGZpZWxkc0xlbmd0aCA9IGZpZWxkcy5sZW5ndGg7CiAgICAgIHZhciBiYXNlVXJsID0gaHBzLmlmcmFtZV91cmwucmVwbGFjZSgnaW5kZXguaHRtbCcsICcnKTsKCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZmllbGRzTGVuZ3RoOyBpKyspIHsKICAgICAgICB2YXIgZmllbGQgPSBmaWVsZHNbaV07CiAgICAgICAgdmFyIGZpZWxkT3B0aW9ucyA9IG9wdGlvbnMuZmllbGRzW2ZpZWxkXTsKCiAgICAgICAgaWYgKCFmaWVsZE9wdGlvbnMpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciBmcmFtZSA9IERPTS5tYWtlRnJhbWUoZmllbGQpOwogICAgICAgIHZhciB1cmwgPSBiYXNlVXJsOwoKICAgICAgICBpZiAoZmllbGQgPT09ICdzdWJtaXQnKSB7CiAgICAgICAgICB1cmwgPSB1cmwgKyAnYnV0dG9uLmh0bWwnOwogICAgICAgIH0gZWxzZSBpZiAob3B0aW9ucy5jY2EgJiYgb3B0aW9ucy5lbnYgPT09ICdjZXJ0JykgewogICAgICAgICAgdXJsID0gdXJsICsgJ2ZpZWxkQ2NhLmNlcnQuaHRtbCc7CiAgICAgICAgfSBlbHNlIGlmIChvcHRpb25zLmNjYSAmJiBvcHRpb25zLmVudiA9PT0gJ3Byb2QnKSB7CiAgICAgICAgICB1cmwgPSB1cmwgKyAnZmllbGRDY2EucHJvZC5odG1sJzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdXJsID0gdXJsICsgJ2ZpZWxkLmh0bWwnOwogICAgICAgIH0KCiAgICAgICAgdXJsID0gdXJsICsgJyMnICsgZmllbGQgKyAnOicgKyBlbmNvZGVVUklDb21wb25lbnQoZG9jdW1lbnQubG9jYXRpb24uaHJlZi5zcGxpdCgnIycpWzBdKTsKICAgICAgICBmcmFtZS5zcmMgPSB1cmw7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZmllbGRPcHRpb25zLnRhcmdldCkuYXBwZW5kQ2hpbGQoZnJhbWUpOwogICAgICAgIGhwcy5mcmFtZXNbZmllbGRdID0gewogICAgICAgICAgZnJhbWU6IGZyYW1lLAogICAgICAgICAgbmFtZTogZmllbGQsCiAgICAgICAgICBvcHRpb25zOiBmaWVsZE9wdGlvbnMsCiAgICAgICAgICB0YXJnZXQ6IGZpZWxkT3B0aW9ucy50YXJnZXQsCiAgICAgICAgICB0YXJnZXROb2RlOiB3aW5kb3cucG9zdE1lc3NhZ2UgPyBmcmFtZS5jb250ZW50V2luZG93IDogZnJhbWUsCiAgICAgICAgICB1cmw6IHVybAogICAgICAgIH07CiAgICAgIH0KICAgIH07CiAgICAvKioKICAgICAqIEhlYXJ0bGFuZC5GcmFtZXMubW9uaXRvckZpZWxkRXZlbnRzCiAgICAgKgogICAgICogQHBhcmFtIHtIZWFydGxhbmQuSFBTfSBocHMKICAgICAqIEBwYXJhbSB7c3RyaW5nIHwgRXZlbnRUYXJnZXR9IHRhcmdldAogICAgICovCgoKICAgIEZyYW1lcy5tb25pdG9yRmllbGRFdmVudHMgPSBmdW5jdGlvbiAoaHBzLCB0YXJnZXQpIHsKICAgICAgdmFyIGV2ZW50cyA9IFsnY2xpY2snLCAnYmx1cicsICdmb2N1cycsICdjaGFuZ2UnLCAna2V5cHJlc3MnLCAna2V5ZG93bicsICdrZXl1cCddOwogICAgICB2YXIgaSA9IDAsCiAgICAgICAgICBsZW5ndGggPSBldmVudHMubGVuZ3RoOwoKICAgICAgZm9yIChpOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICB2YXIgZXZlbnQgPSBldmVudHNbaV07CiAgICAgICAgRXZlbnRzLmFkZEhhbmRsZXIodGFyZ2V0LCBldmVudCwgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIHZhciBmaWVsZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZWFydGxhbmQtZmllbGQnKTsKICAgICAgICAgIHZhciBjbGFzc2VzID0gW107CiAgICAgICAgICB2YXIgZGF0YSA9IHt9OwoKICAgICAgICAgIGlmIChmaWVsZC5jbGFzc05hbWUgIT09ICcnKSB7CiAgICAgICAgICAgIGNsYXNzZXMgPSBmaWVsZC5jbGFzc05hbWUuc3BsaXQoJyAnKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZS5rZXlDb2RlKSB7CiAgICAgICAgICAgIGRhdGEua2V5Q29kZSA9IGUua2V5Q29kZTsKICAgICAgICAgIH0KCiAgICAgICAgICBocHMuTWVzc2FnZXMucG9zdCh7CiAgICAgICAgICAgIGFjdGlvbjogJ2ZpZWxkRXZlbnQnLAogICAgICAgICAgICBldmVudDogewogICAgICAgICAgICAgIGNsYXNzZXM6IGNsYXNzZXMsCiAgICAgICAgICAgICAgZGF0YTogZGF0YSwKICAgICAgICAgICAgICBzb3VyY2U6IHdpbmRvdy5uYW1lLAogICAgICAgICAgICAgIHR5cGU6IGUudHlwZQogICAgICAgICAgICB9CiAgICAgICAgICB9LCAncGFyZW50Jyk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH07CgogICAgcmV0dXJuIEZyYW1lczsKICB9KCk7CiAgLyoqCiAgICogQG5hbWVzcGFjZSBIZWFydGxhbmQuVXRpbAogICAqLwoKCiAgdmFyIFV0aWwgPSBmdW5jdGlvbiAoKSB7CiAgICBmdW5jdGlvbiBVdGlsKCkge30KICAgIC8qKgogICAgICogSGVhcnRsYW5kLlV0aWwuZ2V0Q2FyZFR5cGUKICAgICAqCiAgICAgKiBQYXJzZXMgYSBjcmVkaXQgY2FyZCBudW1iZXIgdG8gb2J0YWluIHRoZSBjYXJkIHR5cGUvYnJhbmQuCiAgICAgKgogICAgICogQHBhcmFtIHtzdHJpbmd9IHRva2VuaXphdGlvblR5cGUKICAgICAqIEBwYXJhbSB7SGVhcnRsYW5kLk9wdGlvbnN9IG9wdGlvbnMKICAgICAqLwoKCiAgICBVdGlsLmdldENhcmRUeXBlID0gZnVuY3Rpb24gKHRva2VuaXphdGlvblR5cGUsIG9wdGlvbnMpIHsKICAgICAgdmFyIGNhcmRUeXBlOwogICAgICB2YXIgZGF0YSA9ICcnOwogICAgICB2YXIgdHlwZSA9ICd1bmtub3duJzsKCiAgICAgIHN3aXRjaCAodG9rZW5pemF0aW9uVHlwZSkgewogICAgICAgIGNhc2UgJ3N3aXBlJzoKICAgICAgICAgIGRhdGEgPSBvcHRpb25zLnRyYWNrOwogICAgICAgICAgY2FyZFR5cGUgPSBDYXJkLnR5cGVCeVRyYWNrKGRhdGEpOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgJ2VuY3J5cHRlZCc6CiAgICAgICAgICBkYXRhID0gb3B0aW9ucy50cmFjazsKICAgICAgICAgIGNhcmRUeXBlID0gQ2FyZC50eXBlQnlUcmFjayhkYXRhLCB0cnVlLCBvcHRpb25zLnRyYWNrTnVtYmVyKTsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgZGF0YSA9IG9wdGlvbnMuY2FyZE51bWJlcjsKICAgICAgICAgIGNhcmRUeXBlID0gQ2FyZC50eXBlQnlOdW1iZXIoZGF0YSk7CiAgICAgICAgICBicmVhazsKICAgICAgfQoKICAgICAgaWYgKGNhcmRUeXBlKSB7CiAgICAgICAgdHlwZSA9IGNhcmRUeXBlLmNvZGU7CiAgICAgIH0KCiAgICAgIHJldHVybiB0eXBlOwogICAgfTsKICAgIC8qKgogICAgICogSGVhcnRsYW5kLlV0aWwuYXBwbHlPcHRpb25zCiAgICAgKgogICAgICogQ3JlYXRlcyBhIHNpbmdsZSBvYmplY3QgYnkgbWVyZ2luZyBhIGBzb3VyY2VgIChkZWZhdWx0KSBhbmQgYHByb3BlcnRpZXNgCiAgICAgKiBvYnRhaW5lZCBlbHNld2hlcmUsIGUuZy4gYSBmdW5jdGlvbiBhcmd1bWVudCBpbiBgSFBTYC4gQW55IHByb3BlcnRpZXMgaW4KICAgICAqIGBwcm9wZXJ0aWVzYCB3aWxsIG92ZXJ3cml0ZSBtYXRjaGluZyBwcm9wZXJ0aWVzIGluIGBzb3VyY2VgLgogICAgICoKICAgICAqIEBwYXJhbSB7SGVhcnRsYW5kLk9wdGlvbnN9IHNvdXJjZQogICAgICogQHBhcmFtIHtIZWFydGxhbmQuT3B0aW9uc30gcHJvcGVydGllcwogICAgICogQHJldHVybnMge0hlYXJ0bGFuZC5PcHRpb25zfQogICAgICovCgoKICAgIFV0aWwuYXBwbHlPcHRpb25zID0gZnVuY3Rpb24gKHNvdXJjZSwgcHJvcGVydGllcykgewogICAgICB2YXIgZGVzdGluYXRpb24gPSB7fTsKCiAgICAgIGlmICghc291cmNlKSB7CiAgICAgICAgc291cmNlID0ge307CiAgICAgIH0KCiAgICAgIGZvciAodmFyIHByb3BlcnR5IGluIHNvdXJjZSkgewogICAgICAgIGlmIChzb3VyY2UuaGFzT3duUHJvcGVydHkocHJvcGVydHkpKSB7CiAgICAgICAgICBkZXN0aW5hdGlvbltwcm9wZXJ0eV0gPSBzb3VyY2VbcHJvcGVydHldOwogICAgICAgIH0KICAgICAgfQoKICAgICAgZm9yICh2YXIgcHJvcGVydHkgaW4gcHJvcGVydGllcykgewogICAgICAgIGlmIChwcm9wZXJ0aWVzLmhhc093blByb3BlcnR5KHByb3BlcnR5KSkgewogICAgICAgICAgZGVzdGluYXRpb25bcHJvcGVydHldID0gcHJvcGVydGllc1twcm9wZXJ0eV07CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gZGVzdGluYXRpb247CiAgICB9OwogICAgLyoqCiAgICAgKiBIZWFydGxhbmQuVXRpbC50aHJvd0Vycm9yCiAgICAgKgogICAgICogQWxsb3dzIGEgbWVyY2hhbnQtZGVmaW5lZCBlcnJvciBoYW5kbGVyIHRvIGJlIHVzZWQgaW4gY2FzZXMgd2hlcmUgdGhlCiAgICAgKiB0b2tlbml6YXRpb24gcHJvY2VzcyBmYWlscy4gSWYgbm90IHByb3ZpZGVkLCB3ZSB0aHJvdyB0aGUgbWVzc2FnZSBhcyBhCiAgICAgKiBKUyBydW50aW1lIGVycm9yLgogICAgICoKICAgICAqIEBwYXJhbSB7SGVhcnRsYW5kLk9wdGlvbnN9IG9wdGlvbnMKICAgICAqIEBwYXJhbSB7c3RyaW5nIHwgSGVhcnRsYW5kLlRva2VuaXphdGlvblJlc3BvbnNlfSBlcnJvck1lc3NhZ2UKICAgICAqLwoKCiAgICBVdGlsLnRocm93RXJyb3IgPSBmdW5jdGlvbiAob3B0aW9ucywgZXJyb3JNZXNzYWdlKSB7CiAgICAgIGlmICh0eXBlb2Ygb3B0aW9ucy5lcnJvciA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgIG9wdGlvbnMuZXJyb3IoZXJyb3JNZXNzYWdlKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmIChlcnJvck1lc3NhZ2UuZXJyb3IpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZXJyb3JNZXNzYWdlLmVycm9yLm1lc3NhZ2UpOwogICAgICB9CgogICAgICB0aHJvdyBuZXcgRXJyb3IoZXJyb3JNZXNzYWdlKTsKICAgIH07CiAgICAvKioKICAgICAqIEhlYXJ0bGFuZC5VdGlsLmdldEl0ZW1CeVByb3BlcnR5VmFsdWUKICAgICAqCiAgICAgKiBFbnVtZXJhdGVzIG92ZXIgYSBgY29sbGVjdGlvbmAgdG8gcmV0cmVpdmUgYW4gaXRlbSB3aG9zZSBgcHJvcGVydHlgIGlzCiAgICAgKiBhIGdpdmVuIGB2YWx1ZWAuCiAgICAgKgogICAgICogQHBhcmFtIHthbnl9IGNvbGxlY3Rpb24KICAgICAqIEBwYXJhbSB7c3RyaW5nfSBwcm9wZXJ0eQogICAgICogQHBhcmFtIHthbnl9IHZhbHVlCiAgICAgKiBAcmV0dXJucyB7YW55fQogICAgICovCgoKICAgIFV0aWwuZ2V0SXRlbUJ5UHJvcGVydHlWYWx1ZSA9IGZ1bmN0aW9uIChjb2xsZWN0aW9uLCBwcm9wZXJ0eSwgdmFsdWUpIHsKICAgICAgdmFyIGxlbmd0aCA9IGNvbGxlY3Rpb24ubGVuZ3RoOwogICAgICB2YXIgaSA9IDA7CgogICAgICBmb3IgKGk7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICAgIGlmIChjb2xsZWN0aW9uW2ldW3Byb3BlcnR5XSA9PT0gdmFsdWUpIHsKICAgICAgICAgIHJldHVybiBjb2xsZWN0aW9uW2ldOwogICAgICAgIH0KICAgICAgfQogICAgfTsKICAgIC8qKgogICAgICogSGVhcnRsYW5kLlV0aWwuZ2V0UGFyYW1zCiAgICAgKgogICAgICogQnVpbGRzIHBhcmFtIGxpc3QgZm9yIGEgcGFydGljdWxhciBgdHlwZWAgZnJvbSBleHBlY3RlZCBwcm9wZXJ0aWVzIGluCiAgICAgKiBgZGF0YWAuCiAgICAgKgogICAgICogQHBhcmFtIHtzdHJpbmd9IHR5cGUgLSBUaGUgdG9rZW5pemF0aW9uIHR5cGUKICAgICAqIEBwYXJhbSB7SGVhcnRsYW5kLk9wdGlvbnN9IGRhdGEKICAgICAqIEByZXR1cm5zIHtzdHJpbmd9CiAgICAgKi8KCgogICAgVXRpbC5nZXRQYXJhbXMgPSBmdW5jdGlvbiAodHlwZSwgZGF0YSkgewogICAgICB2YXIgcGFyYW1zID0gW107CgogICAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgICBjYXNlICdpZnJhbWUnOgogICAgICAgIGNhc2UgJ3Bhbic6CiAgICAgICAgICBwYXJhbXMucHVzaCgndG9rZW5fdHlwZT1zdXB0JywgJ29iamVjdD10b2tlbicsICdfbWV0aG9kPXBvc3QnLCAnYXBpX2tleT0nICsgZGF0YS5wdWJsaWNLZXkucmVwbGFjZSgvXlxzK3xccyskL2csICcnKSwgJ2NhcmQlNUJudW1iZXIlNUQ9JyArIGRhdGEuY2FyZE51bWJlci5yZXBsYWNlKC9ccy9nLCAnJyksICdjYXJkJTVCZXhwX21vbnRoJTVEPScgKyBkYXRhLmNhcmRFeHBNb250aC5yZXBsYWNlKC9eXHMrfFxzKyQvZywgJycpLCAnY2FyZCU1QmV4cF95ZWFyJTVEPScgKyBkYXRhLmNhcmRFeHBZZWFyLnJlcGxhY2UoL15ccyt8XHMrJC9nLCAnJyksICdjYXJkJTVCY3ZjJTVEPScgKyBkYXRhLmNhcmRDdnYucmVwbGFjZSgvXlxzK3xccyskL2csICcnKSk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAnc3dpcGUnOgogICAgICAgICAgcGFyYW1zLnB1c2goJ3Rva2VuX3R5cGU9c3VwdCcsICdvYmplY3Q9dG9rZW4nLCAnX21ldGhvZD1wb3N0JywgJ2FwaV9rZXk9JyArIGRhdGEucHVibGljS2V5LnJlcGxhY2UoL15ccyt8XHMrJC9nLCAnJyksICdjYXJkJTVCdHJhY2tfbWV0aG9kJTVEPXN3aXBlJywgJ2NhcmQlNUJ0cmFjayU1RD0nICsgZW5jb2RlVVJJQ29tcG9uZW50KGRhdGEudHJhY2sucmVwbGFjZSgvXlxzK3xccyskL2csICcnKSkpOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgJ2VuY3J5cHRlZCc6CiAgICAgICAgICBwYXJhbXMucHVzaCgndG9rZW5fdHlwZT1zdXB0JywgJ29iamVjdD10b2tlbicsICdfbWV0aG9kPXBvc3QnLCAnYXBpX2tleT0nICsgZGF0YS5wdWJsaWNLZXkucmVwbGFjZSgvXlxzK3xccyskL2csICcnKSwgJ2VuY3J5cHRlZGNhcmQlNUJ0cmFja19tZXRob2QlNUQ9c3dpcGUnLCAnZW5jcnlwdGVkY2FyZCU1QnRyYWNrJTVEPScgKyBlbmNvZGVVUklDb21wb25lbnQoZGF0YS50cmFjay5yZXBsYWNlKC9eXHMrfFxzKyQvZywgJycpKSwgJ2VuY3J5cHRlZGNhcmQlNUJ0cmFja19udW1iZXIlNUQ9JyArIGVuY29kZVVSSUNvbXBvbmVudChkYXRhLnRyYWNrTnVtYmVyLnJlcGxhY2UoL15ccyt8XHMrJC9nLCAnJykpLCAnZW5jcnlwdGVkY2FyZCU1Qmt0YiU1RD0nICsgZW5jb2RlVVJJQ29tcG9uZW50KGRhdGEua3RiLnJlcGxhY2UoL15ccyt8XHMrJC9nLCAnJykpLCAnZW5jcnlwdGVkY2FyZCU1QnBpbl9ibG9jayU1RD0nICsgZW5jb2RlVVJJQ29tcG9uZW50KGRhdGEucGluQmxvY2sucmVwbGFjZSgvXlxzK3xccyskL2csICcnKSkpOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICBVdGlsLnRocm93RXJyb3IoZGF0YSwgJ3Vua25vd24gcGFyYW1zIHR5cGUnKTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CgogICAgICByZXR1cm4gcGFyYW1zLmpvaW4oJyYnKTsKICAgIH07CiAgICAvKioKICAgICAqIEhlYXJ0bGFuZC5VdGlsLmdldFVybEJ5RW52CiAgICAgKgogICAgICogU2VsZWN0cyB0aGUgYXBwcm9wcmlhdGUgdG9rZW5pemF0aW9uIHNlcnZpY2UgVVJMIGZvciB0aGUKICAgICAqIGFjdGl2ZSBgcHVibGljS2V5YC4KICAgICAqCiAgICAgKiBAcGFyYW0ge0hlYXJ0bGFuZC5PcHRpb25zfSBvcHRpb25zCiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfQogICAgICovCgoKICAgIFV0aWwuZ2V0VXJsQnlFbnYgPSBmdW5jdGlvbiAob3B0aW9ucykgewogICAgICBvcHRpb25zLmVudiA9IG9wdGlvbnMucHVibGljS2V5LnNwbGl0KCdfJylbMV07CgogICAgICBpZiAob3B0aW9ucy5lbnYgPT09ICdjZXJ0JykgewogICAgICAgIG9wdGlvbnMuZ2F0ZXdheVVybCA9IHVybHMuQ0VSVDsKICAgICAgfSBlbHNlIHsKICAgICAgICBvcHRpb25zLmdhdGV3YXlVcmwgPSB1cmxzLlBST0Q7CiAgICAgIH0KCiAgICAgIHJldHVybiBvcHRpb25zOwogICAgfTsKICAgIC8qKgogICAgICogSGVhcnRsYW5kLlV0aWwuYWRkRm9ybUhhbmRsZXIKICAgICAqCiAgICAgKiBDcmVhdGVzIGFuZCBhZGRzIGFuIGV2ZW50IGhhbmRsZXIgZnVuY3Rpb24gZm9yIHRoZSBzdWJtaXNzaW9uIGZvciBhIGdpdmVuCiAgICAgKiBmb3JtIChgb3B0aW9ucy5mb3JtX2lkYCkuCiAgICAgKgogICAgICogQHBhcmFtIHtIZWFydGxhbmQuT3B0aW9uc30gb3B0aW9ucwogICAgICogQGxpc3RlbnMgc3VibWl0CiAgICAgKi8KCgogICAgVXRpbC5hZGRGb3JtSGFuZGxlciA9IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICAgIHZhciBwYXltZW50X2Zvcm0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChvcHRpb25zLmZvcm1JZCk7CgogICAgICB2YXIgY29kZSA9IGZ1bmN0aW9uIGNvZGUoZSkgewogICAgICAgIGlmIChlLnByZXZlbnREZWZhdWx0KSB7CiAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgfSBlbHNlIGlmICh3aW5kb3cuZXZlbnQpIHsKICAgICAgICAgIHdpbmRvdy5ldmVudC5yZXR1cm5WYWx1ZSA9IGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgdmFyIGZpZWxkcyA9IFV0aWwuZ2V0RmllbGRzKG9wdGlvbnMuZm9ybUlkKTsKICAgICAgICB2YXIgY2FyZFR5cGUgPSBVdGlsLmdldENhcmRUeXBlKGZpZWxkcy5udW1iZXIsICdwYW4nKTsKICAgICAgICBvcHRpb25zLmNhcmROdW1iZXIgPSBmaWVsZHMubnVtYmVyOwogICAgICAgIG9wdGlvbnMuY2FyZEV4cE1vbnRoID0gZmllbGRzLmV4cE1vbnRoOwogICAgICAgIG9wdGlvbnMuY2FyZEV4cFllYXIgPSBmaWVsZHMuZXhwWWVhcjsKICAgICAgICBvcHRpb25zLmNhcmRDdnYgPSBmaWVsZHMuY3Z2OwogICAgICAgIG9wdGlvbnMuY2FyZFR5cGUgPSBjYXJkVHlwZTsKICAgICAgICBBamF4LmNhbGwoJ3BhbicsIG9wdGlvbnMpOwogICAgICB9OwoKICAgICAgRXZlbnRzLmFkZEhhbmRsZXIocGF5bWVudF9mb3JtLCAnc3VibWl0JywgY29kZSk7CiAgICAgIERPTS5hZGRGaWVsZChvcHRpb25zLmZvcm1JZCwgJ2hpZGRlbicsICdwdWJsaWNLZXknLCBvcHRpb25zLnB1YmxpY0tleSk7CiAgICB9OwogICAgLyoqCiAgICAgKiBIZWFydGxhbmQuVXRpbC5nZXRGaWVsZHMKICAgICAqCiAgICAgKiBFeHRyYWN0cyBjYXJkIGluZm9ybWF0aW9uIGZyb20gdGhlIGZpZWxkcyB3aXRoIG5hbWVzIGBjYXJkX251bWJlcmAsCiAgICAgKiBgY2FyZF9leHBpcmF0aW9uX21vbnRoYCwgYGNhcmRfZXhwaXJhdGlvbl95ZWFyYCwgYW5kIGBjYXJkX2N2Y2AgYW5kCiAgICAgKiBleHBlY3RzIHRoZW0gdG8gYmUgcHJlc2VudCBhcyBjaGlsZHJlbiBvZiBgZm9ybVBhcmVudGAuCiAgICAgKgogICAgICogQHBhcmFtIHtzdHJpbmd9IGZvcm1QYXJlbnQKICAgICAqIEByZXR1cm5zIHtIZWFydGxhbmQuQ2FyZERhdGF9CiAgICAgKi8KCgogICAgVXRpbC5nZXRGaWVsZHMgPSBmdW5jdGlvbiAoZm9ybVBhcmVudCkgewogICAgICB2YXIgZm9ybSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGZvcm1QYXJlbnQpOwogICAgICB2YXIgZmllbGRzID0ge307CiAgICAgIHZhciBpOwogICAgICB2YXIgbGVuZ3RoID0gZm9ybS5jaGlsZEVsZW1lbnRDb3VudDsKCiAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICAgIHZhciBlbGVtZW50ID0gZm9ybS5jaGlsZHJlbltpXTsKCiAgICAgICAgaWYgKGVsZW1lbnQuaWQgPT09ICdjYXJkX251bWJlcicpIHsKICAgICAgICAgIGZpZWxkcy5udW1iZXIgPSBlbGVtZW50LnZhbHVlOwogICAgICAgIH0gZWxzZSBpZiAoZWxlbWVudC5pZCA9PT0gJ2NhcmRfZXhwaXJhdGlvbl9tb250aCcpIHsKICAgICAgICAgIGZpZWxkcy5leHBNb250aCA9IGVsZW1lbnQudmFsdWU7CiAgICAgICAgfSBlbHNlIGlmIChlbGVtZW50LmlkID09PSAnY2FyZF9leHBpcmF0aW9uX3llYXInKSB7CiAgICAgICAgICBmaWVsZHMuZXhwWWVhciA9IGVsZW1lbnQudmFsdWU7CiAgICAgICAgfSBlbHNlIGlmIChlbGVtZW50LmlkID09PSAnY2FyZF9jdmMnKSB7CiAgICAgICAgICBmaWVsZHMuY3Z2ID0gZWxlbWVudC52YWx1ZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBmaWVsZHM7CiAgICB9OwoKICAgIHJldHVybiBVdGlsOwogIH0oKTsKCiAgdmFyIEhlYXJ0bGFuZFRva2VuU2VydmljZSA9IGZ1bmN0aW9uICgpIHsKICAgIGZ1bmN0aW9uIEhlYXJ0bGFuZFRva2VuU2VydmljZSh1cmwsIHR5cGUpIHsKICAgICAgaWYgKHR5cGUgPT09IHZvaWQgMCkgewogICAgICAgIHR5cGUgPSAicGFuIjsKICAgICAgfQoKICAgICAgdGhpcy51cmwgPSB1cmw7CiAgICAgIHRoaXMudHlwZSA9IHR5cGU7CiAgICB9CgogICAgSGVhcnRsYW5kVG9rZW5TZXJ2aWNlLnByb3RvdHlwZS50b2tlbml6ZSA9IGZ1bmN0aW9uIChkYXRhLCBjYWxsYmFjaykgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgdGhpcy5yZXF1ZXN0RGF0YSA9IGRhdGE7CiAgICAgIEFqYXguanNvbnAodGhpcy5idWlsZFJlcXVlc3QoZGF0YSksIGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIGNhbGxiYWNrKF90aGlzLmRlc2VyaWFsaXplUmVzcG9uc2VEYXRhKHJlc3BvbnNlKSk7CiAgICAgIH0pOwogICAgfTsKCiAgICBIZWFydGxhbmRUb2tlblNlcnZpY2UucHJvdG90eXBlLmJ1aWxkUmVxdWVzdCA9IGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgIHJldHVybiBuZXcgSnNvbnBSZXF1ZXN0KHRoaXMudXJsLCB0aGlzLnNlcmlhbGl6ZVJlcXVlc3REYXRhKGRhdGEpKTsKICAgIH07CgogICAgSGVhcnRsYW5kVG9rZW5TZXJ2aWNlLnByb3RvdHlwZS5zZXJpYWxpemVSZXF1ZXN0RGF0YSA9IGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgIHJldHVybiBVdGlsLmdldFBhcmFtcyh0aGlzLnR5cGUsIGRhdGEpOwogICAgfTsKCiAgICBIZWFydGxhbmRUb2tlblNlcnZpY2UucHJvdG90eXBlLmRlc2VyaWFsaXplUmVzcG9uc2VEYXRhID0gZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgaWYgKGRhdGEuZXJyb3IpIHsKICAgICAgICByZXR1cm4gZGF0YTsKICAgICAgfQoKICAgICAgdmFyIGNhcmRUeXBlID0gVXRpbC5nZXRDYXJkVHlwZSh0aGlzLnR5cGUsIHRoaXMucmVxdWVzdERhdGEpOwogICAgICB2YXIgY2FyZCA9IGRhdGEuY2FyZCB8fCBkYXRhLmVuY3J5cHRlZGNhcmQ7CiAgICAgIHZhciBsYXN0Zm91ciA9IGNhcmQubnVtYmVyLnNsaWNlKC00KTsKICAgICAgZGF0YS5sYXN0X2ZvdXIgPSBsYXN0Zm91cjsKICAgICAgZGF0YS5jYXJkX3R5cGUgPSBjYXJkVHlwZTsKICAgICAgZGF0YS5leHBfbW9udGggPSB0aGlzLnJlcXVlc3REYXRhLmNhcmRFeHBNb250aDsKICAgICAgZGF0YS5leHBfeWVhciA9IHRoaXMucmVxdWVzdERhdGEuY2FyZEV4cFllYXI7CiAgICAgIHJldHVybiBkYXRhOwogICAgfTsKCiAgICByZXR1cm4gSGVhcnRsYW5kVG9rZW5TZXJ2aWNlOwogIH0oKTsKCiAgdmFyIENhcmRpbmFsVG9rZW5TZXJ2aWNlID0gZnVuY3Rpb24gKCkgewogICAgZnVuY3Rpb24gQ2FyZGluYWxUb2tlblNlcnZpY2Uoand0KSB7CiAgICAgIHRoaXMuand0ID0gand0OwogICAgfQoKICAgIENhcmRpbmFsVG9rZW5TZXJ2aWNlLnByb3RvdHlwZS50b2tlbml6ZSA9IGZ1bmN0aW9uIChkYXRhLCBjYWxsYmFjaykgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgdmFyIHJlcXVlc3QgPSB0aGlzLmJ1aWxkUmVxdWVzdChkYXRhKTsKICAgICAgdmFyIGNhcmRpbmFsID0gd2luZG93LkNhcmRpbmFsOwoKICAgICAgdmFyIGNiID0gZnVuY3Rpb24gY2IocmVzcG9uc2VEYXRhLCBqd3QpIHsKICAgICAgICByZXNwb25zZURhdGEuand0ID0gand0OwogICAgICAgIGNhbGxiYWNrKF90aGlzLmRlc2VyaWFsaXplUmVzcG9uc2VEYXRhKHJlc3BvbnNlRGF0YSkpOwogICAgICB9OyAvLyBpbml0IG9ubHkgb25jZSBwZXIgZnJhbWUKCgogICAgICBpZiAoIWNhcmRpbmFsLl9fc2VjdXJlU3VibWl0RnJhbWVJbml0KSB7CiAgICAgICAgY2FyZGluYWwuc2V0dXAoJ2luaXQnLCB7CiAgICAgICAgICBqd3Q6IHRoaXMuand0CiAgICAgICAgfSk7CiAgICAgICAgY2FyZGluYWwub24oJ3BheW1lbnRzLnZhbGlkYXRlZCcsIGNiKTsKICAgICAgICBjYXJkaW5hbC5fX3NlY3VyZVN1Ym1pdEZyYW1lSW5pdCA9IHRydWU7CiAgICAgIH0KCiAgICAgIGNhcmRpbmFsLnRyaWdnZXIoJ2p3dC51cGRhdGUnLCB0aGlzLmp3dCk7CiAgICAgIGNhcmRpbmFsLnN0YXJ0KCdjY2EnLCByZXF1ZXN0LnBheWxvYWQpOwogICAgfTsKCiAgICBDYXJkaW5hbFRva2VuU2VydmljZS5wcm90b3R5cGUuYnVpbGRSZXF1ZXN0ID0gZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgcmV0dXJuIG5ldyBOdWxsUmVxdWVzdCh7CiAgICAgICAgQ29uc3VtZXI6IHsKICAgICAgICAgIEFjY291bnQ6IHsKICAgICAgICAgICAgQWNjb3VudE51bWJlcjogZGF0YS5jYXJkTnVtYmVyLnJlcGxhY2UoL1xEL2csICcnKSwKICAgICAgICAgICAgQ2FyZENvZGU6IGRhdGEuY2FyZEN2di5yZXBsYWNlKC9eXHMrfFxzKyQvZywgJycpLAogICAgICAgICAgICBFeHBpcmF0aW9uTW9udGg6IGRhdGEuY2FyZEV4cE1vbnRoLnJlcGxhY2UoL15ccyt8XHMrJC9nLCAnJyksCiAgICAgICAgICAgIEV4cGlyYXRpb25ZZWFyOiBkYXRhLmNhcmRFeHBZZWFyLnJlcGxhY2UoL15ccyt8XHMrJC9nLCAnJykKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIE9wdGlvbnM6IHsKICAgICAgICAgIEVuYWJsZUNDQTogZmFsc2UKICAgICAgICB9LAogICAgICAgIE9yZGVyRGV0YWlsczogewogICAgICAgICAgT3JkZXJOdW1iZXI6IGRhdGEuY2NhLm9yZGVyTnVtYmVyCiAgICAgICAgfQogICAgICB9KTsKICAgIH07CgogICAgQ2FyZGluYWxUb2tlblNlcnZpY2UucHJvdG90eXBlLnNlcmlhbGl6ZVJlcXVlc3REYXRhID0gZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgcmV0dXJuIGRhdGE7CiAgICB9OwoKICAgIENhcmRpbmFsVG9rZW5TZXJ2aWNlLnByb3RvdHlwZS5kZXNlcmlhbGl6ZVJlc3BvbnNlRGF0YSA9IGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgIGlmICh0eXBlb2YgZGF0YS5Ub2tlbiAhPT0gInVuZGVmaW5lZCIgJiYgZGF0YS5Ub2tlbi5Ub2tlbiAhPT0gInVuZGVmaW5lZCIgJiYgZGF0YS5Ub2tlbi5SZWFzb25Db2RlID09PSAiMCIpIHsKICAgICAgICByZXR1cm4gdGhpcy5kZXNlcmlhbGl6ZVN1Y2Nlc3NSZXNwb25zZShkYXRhKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXMuZGVzZXJpYWxpemVGYWlsdXJlUmVzcG9uc2UoZGF0YSk7CiAgICB9OwoKICAgIENhcmRpbmFsVG9rZW5TZXJ2aWNlLnByb3RvdHlwZS5kZXNlcmlhbGl6ZVN1Y2Nlc3NSZXNwb25zZSA9IGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgand0OiBkYXRhLmp3dCwKICAgICAgICB0b2tlbl92YWx1ZTogZGF0YS5Ub2tlbi5Ub2tlbgogICAgICB9OwogICAgfTsKCiAgICBDYXJkaW5hbFRva2VuU2VydmljZS5wcm90b3R5cGUuZGVzZXJpYWxpemVGYWlsdXJlUmVzcG9uc2UgPSBmdW5jdGlvbiAoZGF0YSkgewogICAgICB2YXIgbWVzc2FnZSA9IGRhdGEuRXJyb3JEZXNjcmlwdGlvbjsKCiAgICAgIGlmIChkYXRhLlRva2VuICYmIGRhdGEuVG9rZW4uUmVhc29uRGVzY3JpcHRpb24gIT09ICIiKSB7CiAgICAgICAgbWVzc2FnZSA9IGRhdGEuVG9rZW4uUmVhc29uRGVzY3JpcHRpb247CiAgICAgIH0KCiAgICAgIHJldHVybiB7CiAgICAgICAgZXJyb3I6IHsKICAgICAgICAgIG1lc3NhZ2U6IG1lc3NhZ2UKICAgICAgICB9CiAgICAgIH07CiAgICB9OwoKICAgIHJldHVybiBDYXJkaW5hbFRva2VuU2VydmljZTsKICB9KCk7CiAgLyoqCiAgICogSGVhcnRsYW5kLkhQUwogICAqCiAgICogSW5pdGlhbGl6ZXMgb3B0aW9ucyBhbmQgYWRkcyB0aGUgZGVmYXVsdCBmb3JtIGhhbmRsZXIgaWYgYSBgZm9ybUlkYCBpcwogICAqIHBhc3NlZCBhcyBhbiBvcHRpb24uIFRoaXMgZXhwZWN0cyB0aGUgZGVmYXVsdCBmaWVsZHMgKHNlZSBgZ2V0RmllbGRzYCkgdG8KICAgKiBiZSBwcmVzZW50IGFzIGNoaWxkcmVuIG9mIGBmb3JtSWRgLgogICAqLwoKCiAgdmFyIEhQUyA9IGZ1bmN0aW9uICgpIHsKICAgIC8qKgogICAgICogSGVhcnRsYW5kLkhQUyAoY29uc3RydWN0b3IpCiAgICAgKgogICAgICogQGNvbnN0cnVjdG9yCiAgICAgKiBAcGFyYW0ge0hlYXJ0bGFuZC5PcHRpb25zfSBvcHRpb25zIFtvcHRpb25hbF0KICAgICAqIEByZXR1cm5zIHtIZWFydGxhbmQuSFBTfQogICAgICovCiAgICBmdW5jdGlvbiBIUFMob3B0aW9ucykgewogICAgICBpZiAoIW9wdGlvbnMgJiYgd2luZG93LnBhcmVudCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdGhpcy5vcHRpb25zID0gVXRpbC5hcHBseU9wdGlvbnMoZGVmYXVsdHMsIG9wdGlvbnMpOwogICAgICB0aGlzLm9wdGlvbnMgPSBVdGlsLmdldFVybEJ5RW52KHRoaXMub3B0aW9ucyk7CgogICAgICBpZiAodGhpcy5vcHRpb25zLmZvcm1JZC5sZW5ndGggPiAwKSB7CiAgICAgICAgVXRpbC5hZGRGb3JtSGFuZGxlcih0aGlzLm9wdGlvbnMpOwogICAgICB9CgogICAgICB0aGlzLmZyYW1lcyA9IHt9OwoKICAgICAgaWYgKHRoaXMub3B0aW9ucy50eXBlID09PSAnaWZyYW1lJykgewogICAgICAgIHRoaXMuaWZyYW1lX3VybCA9ICcnOwogICAgICAgIHRoaXMuTWVzc2FnZXMgPSBuZXcgTWVzc2FnZXModGhpcyk7CiAgICAgICAgdGhpcy5tYWlsYm94ID0gW107CiAgICAgICAgdGhpcy5jYWNoZUJ1c3QgPSAxOwogICAgICAgIEZyYW1lcy5jb25maWd1cmVJZnJhbWUodGhpcyk7CgogICAgICAgIGlmICh0aGlzLm9wdGlvbnMuZW52ID09PSAiY2VydCIpIHsKICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuaWZyYW1lVGFyZ2V0ICE9PSAiIikgewogICAgICAgICAgICBET00uYWRkQ2VydEFsZXJ0KHRoaXMub3B0aW9ucy5pZnJhbWVUYXJnZXQpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgRE9NLmFkZENlcnRBbGVydCh0aGlzLm9wdGlvbnMuZmllbGRzLmNhcmROdW1iZXIudGFyZ2V0KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBIZWFydGxhbmQuSFBTLnRva2VuaXplCiAgICAgKgogICAgICogVG9rZW5pemVzIGNhcmQgZGF0YS4gVXNlZCBpbiBtYW51YWwgaW50ZWdyYXRpb25zIHdoZXJlIHRoZSBtZXJjaGFudCdzCiAgICAgKiBjcmVkaXQgY2FyZCBmaWVsZHMgY2Fubm90L2RvIG5vdCBtYXRjaCB0aGUgbmFtZXMgZXhwZWN0ZWQgaW4gdGhlIGRlZmF1bHQKICAgICAqIGZvcm0gaGFuZGxlciAoc2VlIGBnZXRGaWVsZHNgKS4KICAgICAqCiAgICAgKiBAcGFyYW0ge0hlYXJ0bGFuZC5PcHRpb25zfSBvcHRpb25zIFtvcHRpb25hbF0KICAgICAqLwoKCiAgICBIUFMucHJvdG90eXBlLnRva2VuaXplID0gZnVuY3Rpb24gKG9wdGlvbnMpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwoKICAgICAgaWYgKG9wdGlvbnMpIHsKICAgICAgICB0aGlzLm9wdGlvbnMgPSBVdGlsLmFwcGx5T3B0aW9ucyh0aGlzLm9wdGlvbnMsIG9wdGlvbnMpOwogICAgICAgIHRoaXMub3B0aW9ucyA9IFV0aWwuZ2V0VXJsQnlFbnYodGhpcy5vcHRpb25zKTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMub3B0aW9ucy50eXBlID09PSAnaWZyYW1lJyAmJiAhIXRoaXMuZnJhbWVzLmNhcmROdW1iZXIpIHsKICAgICAgICB0aGlzLk1lc3NhZ2VzLnBvc3QoewogICAgICAgICAgYWNjdW11bGF0ZURhdGE6ICEhdGhpcy5mcmFtZXMuY2FyZE51bWJlciwKICAgICAgICAgIGFjdGlvbjogJ3Rva2VuaXplJywKICAgICAgICAgIGRhdGE6IHsKICAgICAgICAgICAgcHVibGljS2V5OiB0aGlzLm9wdGlvbnMucHVibGljS2V5CiAgICAgICAgICB9CiAgICAgICAgfSwgJ2NhcmROdW1iZXInKTsKICAgICAgICByZXR1cm47CiAgICAgIH0gZWxzZSBpZiAodGhpcy5vcHRpb25zLnR5cGUgPT09ICdpZnJhbWUnKSB7CiAgICAgICAgdGhpcy5NZXNzYWdlcy5wb3N0KHsKICAgICAgICAgIGFjdGlvbjogJ3Rva2VuaXplJywKICAgICAgICAgIGRhdGE6IHsKICAgICAgICAgICAgcHVibGljS2V5OiB0aGlzLm9wdGlvbnMucHVibGljS2V5CiAgICAgICAgICB9CiAgICAgICAgfSwgJ2NoaWxkJyk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgdG9rZW5zID0gewogICAgICAgIGNhcmRpbmFsOiBudWxsLAogICAgICAgIGhlYXJ0bGFuZDogbnVsbAogICAgICB9OwoKICAgICAgdmFyIGNhbGxiYWNrID0gZnVuY3Rpb24gY2FsbGJhY2socmVzcG9uc2UpIHsKICAgICAgICBpZiAocmVzcG9uc2UuZXJyb3IpIHsKICAgICAgICAgIFV0aWwudGhyb3dFcnJvcihfdGhpcy5vcHRpb25zLCByZXNwb25zZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChfdGhpcy5vcHRpb25zLmZvcm1JZCAmJiBfdGhpcy5vcHRpb25zLmZvcm1JZC5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHZhciBoZWFydGxhbmQgPSByZXNwb25zZS5oZWFydGxhbmQgfHwgcmVzcG9uc2U7CiAgICAgICAgICAgIERPTS5hZGRGaWVsZChfdGhpcy5vcHRpb25zLmZvcm1JZCwgJ2hpZGRlbicsICd0b2tlbl92YWx1ZScsIGhlYXJ0bGFuZC50b2tlbl92YWx1ZSk7CiAgICAgICAgICAgIERPTS5hZGRGaWVsZChfdGhpcy5vcHRpb25zLmZvcm1JZCwgJ2hpZGRlbicsICdsYXN0X2ZvdXInLCBoZWFydGxhbmQubGFzdF9mb3VyKTsKICAgICAgICAgICAgRE9NLmFkZEZpZWxkKF90aGlzLm9wdGlvbnMuZm9ybUlkLCAnaGlkZGVuJywgJ2NhcmRfZXhwX3llYXInLCBoZWFydGxhbmQuZXhwX3llYXIpOwogICAgICAgICAgICBET00uYWRkRmllbGQoX3RoaXMub3B0aW9ucy5mb3JtSWQsICdoaWRkZW4nLCAnY2FyZF9leHBfbW9udGgnLCBoZWFydGxhbmQuZXhwX21vbnRoKTsKICAgICAgICAgICAgRE9NLmFkZEZpZWxkKF90aGlzLm9wdGlvbnMuZm9ybUlkLCAnaGlkZGVuJywgJ2NhcmRfdHlwZScsIGhlYXJ0bGFuZC5jYXJkX3R5cGUpOwogICAgICAgICAgfQoKICAgICAgICAgIF90aGlzLm9wdGlvbnMuc3VjY2VzcyhyZXNwb25zZSk7CiAgICAgICAgfQogICAgICB9OwoKICAgICAgdmFyIGNhbGxiYWNrV3JhcHBlciA9IGZ1bmN0aW9uIGNhbGxiYWNrV3JhcHBlcih0eXBlKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgdG9rZW5zW3R5cGVdID0gcmVzcG9uc2U7CgogICAgICAgICAgaWYgKF90aGlzLm9wdGlvbnMuY2NhICYmIHRva2Vucy5jYXJkaW5hbCAmJiB0b2tlbnMuaGVhcnRsYW5kKSB7CiAgICAgICAgICAgIGNhbGxiYWNrKHRva2Vucyk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKCFfdGhpcy5vcHRpb25zLmNjYSAmJiB0b2tlbnMuaGVhcnRsYW5kKSB7CiAgICAgICAgICAgIGNhbGxiYWNrKHRva2Vucy5oZWFydGxhbmQpOwogICAgICAgICAgfQogICAgICAgIH07CiAgICAgIH07CgogICAgICBuZXcgSGVhcnRsYW5kVG9rZW5TZXJ2aWNlKHRoaXMub3B0aW9ucy5nYXRld2F5VXJsLCB0aGlzLm9wdGlvbnMudHlwZSkudG9rZW5pemUodGhpcy5vcHRpb25zLCBjYWxsYmFja1dyYXBwZXIoJ2hlYXJ0bGFuZCcpKTsKCiAgICAgIGlmICh0aGlzLm9wdGlvbnMuY2NhKSB7CiAgICAgICAgbmV3IENhcmRpbmFsVG9rZW5TZXJ2aWNlKHRoaXMub3B0aW9ucy5jY2Euand0KS50b2tlbml6ZSh0aGlzLm9wdGlvbnMsIGNhbGxiYWNrV3JhcHBlcignY2FyZGluYWwnKSk7CiAgICAgIH0KICAgIH07CiAgICAvKioKICAgICAqIEhlYXJ0bGFuZC5IUFMuY29uZmlndXJlSW50ZXJuYWxJZnJhbWUKICAgICAqCiAgICAgKiBTZXRzIHVwIGEgY2hpbGQgaWZyYW1lIHdpbmRvdyB0byBwcmVwYXJlIGl0IGZvciBjb21tdW5pY2F0aW9uIHdpdGggdGhlCiAgICAgKiBwYXJlbnQgYW5kIGZvciB0b2tlbml6YXRpb24uCiAgICAgKgogICAgICogQHBhcmFtIHtIZWFydGxhbmQuT3B0aW9uc30gb3B0aW9ucwogICAgICovCgoKICAgIEhQUy5wcm90b3R5cGUuY29uZmlndXJlSW50ZXJuYWxJZnJhbWUgPSBmdW5jdGlvbiAob3B0aW9ucykgewogICAgICB0aGlzLk1lc3NhZ2VzID0gbmV3IE1lc3NhZ2VzKHRoaXMpOwogICAgICB0aGlzLnBhcmVudCA9IHdpbmRvdy5wYXJlbnQ7CiAgICAgIHRoaXMuZnJhbWVzID0gdGhpcy5mcmFtZXMgfHwge307CiAgICAgIHRoaXMuZnJhbWVzLnBhcmVudCA9IHsKICAgICAgICBmcmFtZTogd2luZG93LnBhcmVudCwKICAgICAgICBuYW1lOiAncGFyZW50JywKICAgICAgICB1cmw6IGRlY29kZVVSSUNvbXBvbmVudChkb2N1bWVudC5sb2NhdGlvbi5oYXNoLnJlcGxhY2UoL14jLywgJycpKQogICAgICB9OwoKICAgICAgdGhpcy5sb2FkSGFuZGxlciA9IGZ1bmN0aW9uIChocHMpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgICAgRE9NLnJlc2l6ZUZyYW1lKGhwcyk7CiAgICAgICAgfTsKICAgICAgfSh0aGlzKTsKCiAgICAgIHRoaXMucmVjZWl2ZU1lc3NhZ2VIYW5kbGVyQWRkZWRIYW5kbGVyID0gZnVuY3Rpb24gKGhwcykgewogICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBocHMuTWVzc2FnZXMucG9zdCh7CiAgICAgICAgICAgIGFjdGlvbjogJ3JlY2VpdmVNZXNzYWdlSGFuZGxlckFkZGVkJwogICAgICAgICAgfSwgJ3BhcmVudCcpOwogICAgICAgIH07CiAgICAgIH0odGhpcyk7CgogICAgICBFdmVudHMuYWRkSGFuZGxlcih3aW5kb3csICdsb2FkJywgdGhpcy5sb2FkSGFuZGxlcik7CiAgICAgIEV2ZW50cy5hZGRIYW5kbGVyKGRvY3VtZW50LCAncmVjZWl2ZU1lc3NhZ2VIYW5kbGVyQWRkZWQnLCB0aGlzLnJlY2VpdmVNZXNzYWdlSGFuZGxlckFkZGVkSGFuZGxlcik7CiAgICAgIHRoaXMuTWVzc2FnZXMucmVjZWl2ZShFdmVudHMuZnJhbWVIYW5kbGVXaXRoKHRoaXMpLCAnKicpOwogICAgfTsKCiAgICA7CiAgICAvKioKICAgICAqIEhlYXJ0bGFuZC5IUFMuY29uZmlndXJlQnV0dG9uRmllbGRJZnJhbWUKICAgICAqCiAgICAgKiBTYW1lIGFzIGBIZWFydGxhbmQuSFBTLmNvbmZpZ3VyZUZpZWxkSWZyYW1lYCBleGNldCB0aGUgYWRkZWQgY2xpY2sgZXZlbnQKICAgICAqIGhhbmRsZXIgZm9yIHRoZSBidXR0b24uCiAgICAgKgogICAgICogQHBhcmFtIHtIZWFydGxhbmQuT3B0aW9uc30gb3B0aW9ucwogICAgICovCgogICAgSFBTLnByb3RvdHlwZS5jb25maWd1cmVCdXR0b25GaWVsZElmcmFtZSA9IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICAgIHRoaXMuY29uZmlndXJlRmllbGRJZnJhbWUob3B0aW9ucyk7CiAgICAgIEV2ZW50cy5hZGRIYW5kbGVyKCdoZWFydGxhbmQtZmllbGQnLCAnY2xpY2snLCBmdW5jdGlvbiAoaHBzKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICBlLnByZXZlbnREZWZhdWx0ID8gZS5wcmV2ZW50RGVmYXVsdCgpIDogZS5yZXR1cm5WYWx1ZSA9IGZhbHNlOwogICAgICAgICAgaHBzLk1lc3NhZ2VzLnBvc3QoewogICAgICAgICAgICBhY3Rpb246ICdyZXF1ZXN0VG9rZW5pemUnCiAgICAgICAgICB9LCAncGFyZW50Jyk7CiAgICAgICAgfTsKICAgICAgfSh0aGlzKSk7CiAgICB9OwogICAgLyoqCiAgICAgKiBIZWFydGxhbmQuSFBTLmNvbmZpZ3VyZUZpZWxkSWZyYW1lCiAgICAgKgogICAgICogU2V0cyB1cCBhIGNoaWxkIGlmcmFtZSB3aW5kb3cgdG8gcHJlcGFyZSBpdCBmb3IgY29tbXVuaWNhdGlvbiB3aXRoIHRoZQogICAgICogcGFyZW50IGFuZCBmb3IgdG9rZW5pemF0aW9uLgogICAgICoKICAgICAqIEBwYXJhbSB7SGVhcnRsYW5kLk9wdGlvbnN9IG9wdGlvbnMKICAgICAqLwoKCiAgICBIUFMucHJvdG90eXBlLmNvbmZpZ3VyZUZpZWxkSWZyYW1lID0gZnVuY3Rpb24gKG9wdGlvbnMpIHsKICAgICAgdmFyIGhhc2ggPSBkb2N1bWVudC5sb2NhdGlvbi5oYXNoLnJlcGxhY2UoL14jLywgJycpOwogICAgICB2YXIgc3BsaXQgPSBoYXNoLnNwbGl0KCc6Jyk7CiAgICAgIHRoaXMuTWVzc2FnZXMgPSBuZXcgTWVzc2FnZXModGhpcyk7CiAgICAgIHRoaXMuZmllbGQgPSBzcGxpdC5zaGlmdCgpOwogICAgICB0aGlzLnBhcmVudCA9IHdpbmRvdy5wYXJlbnQ7CiAgICAgIHRoaXMuZnJhbWVzID0gdGhpcy5mcmFtZXMgfHwge307CiAgICAgIHRoaXMuZnJhbWVzLnBhcmVudCA9IHsKICAgICAgICBmcmFtZTogd2luZG93LnBhcmVudCwKICAgICAgICBuYW1lOiAncGFyZW50JywKICAgICAgICB1cmw6IGRlY29kZVVSSUNvbXBvbmVudChzcGxpdC5qb2luKCc6JykucmVwbGFjZSgvXjovLCAnJykpCiAgICAgIH07CgogICAgICB3aW5kb3cub25lcnJvciA9IGZ1bmN0aW9uIChocHMpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGVycm9yTXNnLCB1cmwsIGxpbmVOdW1iZXIsIGNvbHVtbiwgZXJyb3JPYmopIHsKICAgICAgICAgIGhwcy5NZXNzYWdlcy5wb3N0KHsKICAgICAgICAgICAgYWN0aW9uOiAnZXJyb3InLAogICAgICAgICAgICBkYXRhOiB7CiAgICAgICAgICAgICAgY29sdW1uOiBjb2x1bW4sCiAgICAgICAgICAgICAgZXJyb3JNc2c6IGVycm9yTXNnLAogICAgICAgICAgICAgIGxpbmVOdW1iZXI6IGxpbmVOdW1iZXIsCiAgICAgICAgICAgICAgdXJsOiB1cmwKICAgICAgICAgICAgfQogICAgICAgICAgfSwgJ3BhcmVudCcpOwogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfTsKICAgICAgfSh0aGlzKTsKCiAgICAgIHRoaXMubG9hZEhhbmRsZXIgPSBmdW5jdGlvbiAoaHBzKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIERPTS5yZXNpemVGcmFtZShocHMpOwogICAgICAgICAgRE9NLmNvbmZpZ3VyZUZpZWxkKGhwcyk7CiAgICAgICAgICB2YXIgbWV0aG9kID0gJ2F0dGFjaCcgKyB3aW5kb3cubmFtZS5yZXBsYWNlKCdjYXJkJywgJycpICsgJ0V2ZW50cyc7CgogICAgICAgICAgaWYgKENhcmRbbWV0aG9kXSkgewogICAgICAgICAgICBDYXJkW21ldGhvZF0oJyNoZWFydGxhbmQtZmllbGQnKTsKICAgICAgICAgIH0KICAgICAgICB9OwogICAgICB9KHRoaXMpOwoKICAgICAgdGhpcy5yZWNlaXZlTWVzc2FnZUhhbmRsZXJBZGRlZEhhbmRsZXIgPSBmdW5jdGlvbiAoaHBzKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGhwcy5NZXNzYWdlcy5wb3N0KHsKICAgICAgICAgICAgYWN0aW9uOiAncmVjZWl2ZU1lc3NhZ2VIYW5kbGVyQWRkZWQnCiAgICAgICAgICB9LCAncGFyZW50Jyk7CiAgICAgICAgfTsKICAgICAgfSh0aGlzKTsKCiAgICAgIEV2ZW50cy5hZGRIYW5kbGVyKHdpbmRvdywgJ2xvYWQnLCB0aGlzLmxvYWRIYW5kbGVyKTsKICAgICAgRXZlbnRzLmFkZEhhbmRsZXIoZG9jdW1lbnQsICdyZWNlaXZlTWVzc2FnZUhhbmRsZXJBZGRlZCcsIHRoaXMucmVjZWl2ZU1lc3NhZ2VIYW5kbGVyQWRkZWRIYW5kbGVyKTsKICAgICAgRnJhbWVzLm1vbml0b3JGaWVsZEV2ZW50cyh0aGlzLCAnaGVhcnRsYW5kLWZpZWxkJyk7CiAgICAgIHRoaXMuTWVzc2FnZXMucmVjZWl2ZShFdmVudHMuZnJhbWVIYW5kbGVXaXRoKHRoaXMpLCAnKicpOwogICAgfTsKCiAgICA7CiAgICAvKioKICAgICAqIEhlYXJ0bGFuZC5IUFMucmVzaXplSUZyYW1lCiAgICAgKgogICAgICogQ2FsbGVkIGF1dG9tYXRpY2FsbHkgd2hlbiB0aGUgY2hpbGQgaWZyYW1lIHdpbmRvdyBhbGVydHMgdGhlIHBhcmVudCB0bwogICAgICogcmVzaXplLgogICAgICoKICAgICAqIEBwYXJhbSB7SFRNTElGcmFtZUVsZW1lbnR9IGZyYW1lCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gaGVpZ2h0CiAgICAgKi8KCiAgICBIUFMucHJvdG90eXBlLnJlc2l6ZUlGcmFtZSA9IGZ1bmN0aW9uIChmcmFtZSwgaGVpZ2h0KSB7CiAgICAgIGlmICghZnJhbWUpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGZyYW1lLnN0eWxlLmhlaWdodCA9IHBhcnNlSW50KGhlaWdodCwgMTApICsgJ3B4JzsKICAgIH07CgogICAgOwogICAgLyoqCiAgICAgKiBIZWFydGxhbmQuSFBTLnNldFRleHQKICAgICAqCiAgICAgKiBQdWJsaWMgQVBJIGZvciBzZXR0aW5nIGFuIGVsZW1lbnQncyBpbm5lciB0ZXh0LgogICAgICoKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBlbGVtZW50aWQKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBlbGVtZW50dGV4dAogICAgICovCgogICAgSFBTLnByb3RvdHlwZS5zZXRUZXh0ID0gZnVuY3Rpb24gKGVsZW1lbnRpZCwgZWxlbWVudHRleHQpIHsKICAgICAgdGhpcy5NZXNzYWdlcy5wb3N0KHsKICAgICAgICBhY3Rpb246ICdzZXRUZXh0JywKICAgICAgICBpZDogZWxlbWVudGlkLAogICAgICAgIHRleHQ6IGVsZW1lbnR0ZXh0CiAgICAgIH0sICdjaGlsZCcpOwogICAgfTsKCiAgICA7CiAgICAvKioKICAgICAqIEhlYXJ0bGFuZC5IUFMuc2V0U3R5bGUKICAgICAqCiAgICAgKiBQdWJsaWMgQVBJIGZvciBzZXR0aW5nIGFuIGVsZW1lbnQncyBzdHlsZS4KICAgICAqCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gZWxlbWVudGlkCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gZWxlbWVudHN0eWxlCiAgICAgKi8KCiAgICBIUFMucHJvdG90eXBlLnNldFN0eWxlID0gZnVuY3Rpb24gKGVsZW1lbnRpZCwgZWxlbWVudHN0eWxlKSB7CiAgICAgIHRoaXMuTWVzc2FnZXMucG9zdCh7CiAgICAgICAgYWN0aW9uOiAnc2V0U3R5bGUnLAogICAgICAgIGlkOiBlbGVtZW50aWQsCiAgICAgICAgc3R5bGU6IGVsZW1lbnRzdHlsZQogICAgICB9LCAnY2hpbGQnKTsKICAgIH07CgogICAgOwogICAgLyoqCiAgICAgKiBIZWFydGxhbmQuSFBTLmFwcGVuZFN0eWxlCiAgICAgKgogICAgICogUHVibGljIEFQSSBmb3IgYXBwZW5kaW5nIHRvIGFuIGVsZW1lbnQncyBzdHlsZS4KICAgICAqCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gZWxlbWVudGlkCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gZWxlbWVudHN0eWxlCiAgICAgKi8KCiAgICBIUFMucHJvdG90eXBlLmFwcGVuZFN0eWxlID0gZnVuY3Rpb24gKGVsZW1lbnRpZCwgZWxlbWVudHN0eWxlKSB7CiAgICAgIHRoaXMuTWVzc2FnZXMucG9zdCh7CiAgICAgICAgYWN0aW9uOiAnYXBwZW5kU3R5bGUnLAogICAgICAgIGlkOiBlbGVtZW50aWQsCiAgICAgICAgc3R5bGU6IGVsZW1lbnRzdHlsZQogICAgICB9LCAnY2hpbGQnKTsKICAgIH07CgogICAgOwogICAgLyoqCiAgICAgKiBIZWFydGxhbmQuSFBTLnNldEZvY3VzCiAgICAgKgogICAgICogUHVibGljIEFQSSBmb3IgYXBwZW5kaW5nIHRvIGFuIGVsZW1lbnQncyBzdHlsZS4KICAgICAqCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gZWxlbWVudGlkCiAgICAgKi8KCiAgICBIUFMucHJvdG90eXBlLnNldEZvY3VzID0gZnVuY3Rpb24gKGVsZW1lbnRpZCkgewogICAgICB0aGlzLk1lc3NhZ2VzLnBvc3QoewogICAgICAgIGFjdGlvbjogJ3NldEZvY3VzJwogICAgICB9LCBlbGVtZW50aWQpOwogICAgfTsKCiAgICA7CiAgICAvKioKICAgICAqIEhlYXJ0bGFuZC5IUFMuZGlzcG9zZQogICAgICoKICAgICAqIFJlbW92ZXMgYWxsIGlmcmFtZXMgYW5kIGV2ZW50IGxpc3RlbmVycyBmcm9tIHRoZSBET00uCiAgICAgKi8KCiAgICBIUFMucHJvdG90eXBlLmRpc3Bvc2UgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHRoaXMuTWVzc2FnZXMuZGlzcG9zZSgpOwogICAgICB0aGlzLk1lc3NhZ2VzID0gbnVsbDsKCiAgICAgIGlmICh0aGlzLmZyYW1lcy5jYXJkTnVtYmVyICYmIHRoaXMuZnJhbWVzLmNhcmROdW1iZXIudGFyZ2V0Tm9kZSkgewogICAgICAgIHRoaXMucmVtb3ZlTm9kZSh0aGlzLmZyYW1lcy5jYXJkTnVtYmVyLmZyYW1lKTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuZnJhbWVzLmNhcmRFeHBpcmF0aW9uICYmIHRoaXMuZnJhbWVzLmNhcmRFeHBpcmF0aW9uLmZyYW1lKSB7CiAgICAgICAgdGhpcy5yZW1vdmVOb2RlKHRoaXMuZnJhbWVzLmNhcmRFeHBpcmF0aW9uLmZyYW1lKTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuZnJhbWVzLmNhcmRDdnYgJiYgdGhpcy5mcmFtZXMuY2FyZEN2di5mcmFtZSkgewogICAgICAgIHRoaXMucmVtb3ZlTm9kZSh0aGlzLmZyYW1lcy5jYXJkQ3Z2LmZyYW1lKTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuZnJhbWVzLmNoaWxkICYmIHRoaXMuZnJhbWVzLmNoaWxkLmZyYW1lKSB7CiAgICAgICAgdGhpcy5yZW1vdmVOb2RlKHRoaXMuZnJhbWVzLmNoaWxkLmZyYW1lKTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuY2xpY2tIYW5kbGVyKSB7CiAgICAgICAgRXZlbnRzLnJlbW92ZUhhbmRsZXIodGhpcy5vcHRpb25zLmJ1dHRvblRhcmdldCwgJ2NsaWNrJywgdGhpcy5jbGlja0hhbmRsZXIpOwogICAgICB9CgogICAgICBpZiAodGhpcy5sb2FkSGFuZGxlcikgewogICAgICAgIEV2ZW50cy5yZW1vdmVIYW5kbGVyKHdpbmRvdywgJ2xvYWQnLCB0aGlzLmxvYWRIYW5kbGVyKTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMucmVjZWl2ZU1lc3NhZ2VIYW5kbGVyQWRkZWRIYW5kbGVyKSB7CiAgICAgICAgRXZlbnRzLnJlbW92ZUhhbmRsZXIoZG9jdW1lbnQsICdyZWNlaXZlTWVzc2FnZUhhbmRsZXJBZGRlZCcsIHRoaXMucmVjZWl2ZU1lc3NhZ2VIYW5kbGVyQWRkZWRIYW5kbGVyKTsKICAgICAgfQogICAgfTsKCiAgICA7CgogICAgSFBTLnByb3RvdHlwZS5yZW1vdmVOb2RlID0gZnVuY3Rpb24gKG5vZGUpIHsKICAgICAgaWYgKG5vZGUucmVtb3ZlKSB7CiAgICAgICAgbm9kZS5yZW1vdmUoKTsKICAgICAgfSBlbHNlIGlmIChub2RlLnBhcmVudE5vZGUgJiYgbm9kZS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKSB7CiAgICAgICAgbm9kZS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKG5vZGUpOwogICAgICB9CiAgICB9OwoKICAgIHJldHVybiBIUFM7CiAgfSgpOwoKICB2YXIgVmFsaWRhdG9yID0gewogICAgQ2FyZE51bWJlcjogQ2FyZE51bWJlciQxLAogICAgQ3Z2OiBDdnYsCiAgICBFeHBpcmF0aW9uOiBFeHBpcmF0aW9uJDEKICB9OwogIHdpbmRvdy5IUFMgPSBIUFM7CiAgdmFyIGluZGV4ID0gewogICAgQWpheDogQWpheCwKICAgIENhcmQ6IENhcmQsCiAgICBET006IERPTSwKICAgIEV2ZW50czogRXZlbnRzLAogICAgRm9ybWF0dGVyOiBGb3JtYXR0ZXIsCiAgICBGcmFtZXM6IEZyYW1lcywKICAgIEhQUzogSFBTLAogICAgSlNPTjogSlNPTjIsCiAgICBNZXNzYWdlczogTWVzc2FnZXMsCiAgICBTdHlsZXM6IFN0eWxlcywKICAgIFV0aWw6IFV0aWwsCiAgICBWYWxpZGF0b3I6IFZhbGlkYXRvcgogIH07CiAgcmV0dXJuIGluZGV4Owp9KCk7CgpleHBvcnQgZGVmYXVsdCBIZWFydGxhbmQ7"},{"version":3,"sources":["/home/vignesh/DIVRT/guest-webapp/src/plugins/securesubmit.js"],"names":["Heartland","JSON2","f","n","Date","prototype","toJSON","key","isFinite","valueOf","getUTCFullYear","getUTCMonth","getUTCDate","getUTCHours","getUTCMinutes","getUTCSeconds","strProto","String","numProto","Number","JSON","Boolean","cx","esc","gap","indent","meta","rep","quote","string","lastIndex","test","replace","a","c","charCodeAt","toString","slice","str","holder","i","k","v","length","mind","partial","value","call","Object","apply","join","push","hasOwnProperty","stringify","replacer","space","Error","parse","text","reviver","j","walk","undefined","Function","SyntaxError","JsonpRequest","url","payload","type","NullRequest","Ajax","jsonp","request","callback","script","document","createElement","callbackName","Math","round","random","window","data","body","removeChild","src","indexOf","appendChild","cors","xhr","method","timeout","XMLHttpRequest","withCredentials","XDomainRequest","split","open","setRequestHeader","cb","e","clearTimeout","error","message","readyState","responseText","onload","onerror","send","setTimeout","abort","cardTypes","code","format","regex","CardNumber","number","Card","typeByNumber","matches","match","global","shift","Expiration","exp","final","pat","groups","month","del","year","getFullYear","CardNumber$1","validate","luhnCheck","Cvv","cvv","Expiration$1","m","y","parseInt","DOM","configureField","hps","getElementById","setAttribute","field","makeFrame","name","frame","id","style","border","frameBorder","scrolling","addField","formParent","fieldType","fieldName","fieldValue","input","setStyle","elementid","htmlstyle","el","encodeEntities","appendStyle","currstyle","getAttribute","newstyle","setText","textContent","setValue","setPlaceholder","resizeFrame","docHeight","offsetHeight","Messages","post","action","height","setFieldData","getFieldData","addStylesheet","css","elements","getElementsByTagName","createTextNode","json2css","json","attributes","children","jsonAttributes","attributesLength","isArray","arrLength","jsonChildren","childrenLength","setFocus","focus","addCertAlert","display","width","marginBottom","color","backgroundColor","padding","fontFamily","fontWeight","fontSize","textAlign","boxSizing","container","insertBefore","frame2","hi","low","obj","set","Expiration$2","Ev","listen","node","eventName","addEventListener","documentElement","attachEvent","propertyName","trigger","createEvent","event","initEvent","dispatchEvent","ignore","removeEventListener","detachEvent","Events","addHandler","target","removeHandler","bubble","frameHandleWith","accumulateData","elOpts","elPK","publicKey","tokenizeIframe","opts","pk","card","numberElement","cvvElement","expElement","tokenResponse","response","parentNode","remove","formatter","cardExpSplit","expMonth","expYear","tokenize","cardCvv","cardExpMonth","cardExpYear","cardNumber","cca","success","cardType","typeByTrack","isEncrypted","trackNumber","temp","substr","odd","sum","digit","digits","reverse","addType","currentTarget","srcElement","classList","className","formatNumber","formatted","setSelectionRange","cursor","selectionStart","charAt","formatExpiration","keyCode","restrictLength","ctrlKey","preventDefault","returnValue","restrictNumeric","shiftKey","deleteProperly","validateNumber","validateCvv","validateExpiration","attachNumberEvents","selector","querySelector","attachExpirationEvents","attachCvvEvents","Array","start","Formatter","defaults","_method","buttonTarget","env","fields","formId","gatewayUrl","iframeTarget","ktb","object","onEvent","onTokenError","onTokenSuccess","pinBlock","targetType","tokenType","track","useDefaultStyles","urls","CERT","PROD","iframeCERT","iframePROD","intervalId","lastHash","pushIntervalStarted","pushMessages","messageArr","targetUrl","current","targetNode","re","mailbox","location","hash","decodeURIComponent","concat","cacheBust","source","encodeURIComponent","href","frames","postMessage","setInterval","receive","sourceOrigin","clearInterval","removeReceiver","dispose","Styles","Defaults","cvvContainer","fieldset","inputsAndSelects","ids","labelsAndLegend","selectLabels","selects","Frames","configureIframe","options","iframe_url","makeFieldsAndLink","child","contentWindow","clickHandler","fieldFrame","resizeIFrame","placeholder","styleString","cardNumberFieldFrame","onError","fieldsLength","baseUrl","fieldOptions","monitorFieldEvents","events","classes","Util","getCardType","tokenizationType","applyOptions","properties","destination","property","throwError","errorMessage","getItemByPropertyValue","collection","getParams","params","getUrlByEnv","addFormHandler","payment_form","getFields","form","childElementCount","element","HeartlandTokenService","_this","requestData","buildRequest","deserializeResponseData","serializeRequestData","encryptedcard","lastfour","last_four","card_type","exp_month","exp_year","CardinalTokenService","jwt","cardinal","Cardinal","responseData","__secureSubmitFrameInit","setup","on","Consumer","Account","AccountNumber","CardCode","ExpirationMonth","ExpirationYear","Options","EnableCCA","OrderDetails","OrderNumber","orderNumber","Token","ReasonCode","deserializeSuccessResponse","deserializeFailureResponse","token_value","ErrorDescription","ReasonDescription","HPS","parent","tokens","heartland","callbackWrapper","configureInternalIframe","loadHandler","receiveMessageHandlerAddedHandler","configureButtonFieldIframe","configureFieldIframe","errorMsg","lineNumber","column","errorObj","elementtext","elementstyle","removeNode","cardExpiration","Validator","index"],"mappings":";;;;;;;;;;;;;;AAAA;AACA,IAAIA,SAAS,GAAI,YAAY;AACzB;AAEA;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACI;;AACA;AACJ;AACA;AACA;AACA;AACA;AACI;AACA;;AACA,MAAIC,KAAK,GAAG,EAAZ;;AACC,eAAY;AACT;;AACA,aAASC,CAAT,CAAWC,CAAX,EAAc;AACV;AACA,aAAOA,CAAC,GAAG,EAAJ,GAAS,MAAMA,CAAf,GAAmBA,CAA1B;AACH;;AACD,QAAI,OAAOC,IAAI,CAACC,SAAL,CAAeC,MAAtB,KAAiC,UAArC,EAAiD;AAC7CF,MAAAA,IAAI,CAACC,SAAL,CAAeC,MAAf,GAAwB,UAAUC,GAAV,EAAe;AACnC,eAAOC,QAAQ,CAAC,KAAKC,OAAL,EAAD,CAAR,GA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","sourcesContent":["/* eslint-disable */\nvar Heartland = (function () {\n    'use strict';\n    \n    /* -----------------------------------------------------------------------------\n    This file is based on or incorporates material from the projects listed below\n    (collectively, \"Third Party Code\"). Microsoft is not the original author of the\n    Third Party Code. The original copyright notice and the license, under which\n    Microsoft received such Third Party Code, are set forth below. Such licenses\n    and notices are provided for informational purposes only. Microsoft, not the\n    third party, licenses the Third Party Code to you under the terms of the\n    Apache License, Version 2.0. See License.txt in the project root for complete\n    license information. Microsoft reserves all rights not expressly granted under\n    the Apache 2.0 License, whether by implication, estoppel or otherwise.\n    ----------------------------------------------------------------------------- */\n    /*\n        json2.js\n        2011-10-19\n    \n        Public Domain.\n    \n        NO WARRANTY EXPRESSED OR IMPLIED. USE AT YOUR OWN RISK.\n    \n        See http://www.JSON.org/js.html\n    \n    \n        This code should be minified before deployment.\n        See http://javascript.crockford.com/jsmin.html\n    \n        USE YOUR OWN COPY. IT IS EXTREMELY UNWISE TO LOAD CODE FROM SERVERS YOU DO\n        NOT CONTROL.\n    \n    \n        This file creates a global JSON object containing two methods: stringify\n        and parse.\n    \n            JSON.stringify(value, replacer, space)\n                value       any JavaScript value, usually an object or array.\n    \n                replacer    an optional parameter that determines how object\n                            values are stringified for objects. It can be a\n                            function or an array of strings.\n    \n                space       an optional parameter that specifies the indentation\n                            of nested structures. If it is omitted, the text will\n                            be packed without extra whitespace. If it is a number,\n                            it will specify the number of spaces to indent at each\n                            level. If it is a string (such as '\\t' or '&nbsp;'),\n                            it contains the characters used to indent at each level.\n    \n                This method produces a JSON text from a JavaScript value.\n    \n                When an object value is found, if the object contains a toJSON\n                method, its toJSON method will be called and the result will be\n                stringified. A toJSON method does not serialize: it returns the\n                value represented by the name/value pair that should be serialized,\n                or undefined if nothing should be serialized. The toJSON method\n                will be passed the key associated with the value, and this will be\n                bound to the value\n    \n                For example, this would serialize Dates as ISO strings.\n    \n                    Date.prototype.toJSON = function (key) {\n                        function f(n) {\n                            // Format integers to have at least two digits.\n                            return n < 10 ? '0' + n : n;\n                        }\n    \n                        return this.getUTCFullYear()   + '-' +\n                             f(this.getUTCMonth() + 1) + '-' +\n                             f(this.getUTCDate())      + 'T' +\n                             f(this.getUTCHours())     + ':' +\n                             f(this.getUTCMinutes())   + ':' +\n                             f(this.getUTCSeconds())   + 'Z';\n                    };\n    \n                You can provide an optional replacer method. It will be passed the\n                key and value of each member, with this bound to the containing\n                object. The value that is returned from your method will be\n                serialized. If your method returns undefined, then the member will\n                be excluded from the serialization.\n    \n                If the replacer parameter is an array of strings, then it will be\n                used to select the members to be serialized. It filters the results\n                such that only members with keys listed in the replacer array are\n                stringified.\n    \n                Values that do not have JSON representations, such as undefined or\n                functions, will not be serialized. Such values in objects will be\n                dropped; in arrays they will be replaced with null. You can use\n                a replacer function to replace those with JSON values.\n                JSON.stringify(undefined) returns undefined.\n    \n                The optional space parameter produces a stringification of the\n                value that is filled with line breaks and indentation to make it\n                easier to read.\n    \n                If the space parameter is a non-empty string, then that string will\n                be used for indentation. If the space parameter is a number, then\n                the indentation will be that many spaces.\n    \n                Example:\n    \n                text = JSON.stringify(['e', {pluribus: 'unum'}]);\n                // text is '[\"e\",{\"pluribus\":\"unum\"}]'\n    \n    \n                text = JSON.stringify(['e', {pluribus: 'unum'}], null, '\\t');\n                // text is '[\\n\\t\"e\",\\n\\t{\\n\\t\\t\"pluribus\": \"unum\"\\n\\t}\\n]'\n    \n                text = JSON.stringify([new Date()], function (key, value) {\n                    return this[key] instanceof Date ?\n                        'Date(' + this[key] + ')' : value;\n                });\n                // text is '[\"Date(---current time---)\"]'\n    \n    \n            JSON.parse(text, reviver)\n                This method parses a JSON text to produce an object or array.\n                It can throw a SyntaxError exception.\n    \n                The optional reviver parameter is a function that can filter and\n                transform the results. It receives each of the keys and values,\n                and its return value is used instead of the original value.\n                If it returns what it received, then the structure is not modified.\n                If it returns undefined then the member is deleted.\n    \n                Example:\n    \n                // Parse the text. Values that look like ISO date strings will\n                // be converted to Date objects.\n    \n                myData = JSON.parse(text, function (key, value) {\n                    let a;\n                    if (typeof value === 'string') {\n                        a =\n    /^(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2}(?:\\.\\d*)?)Z$/.exec(value);\n                        if (a) {\n                            return new Date(Date.UTC(+a[1], +a[2] - 1, +a[3], +a[4],\n                                +a[5], +a[6]));\n                        }\n                    }\n                    return value;\n                });\n    \n                myData = JSON.parse('[\"Date(09/09/2001)\"]', function (key, value) {\n                    let d;\n                    if (typeof value === 'string' &&\n                            value.slice(0, 5) === 'Date(' &&\n                            value.slice(-1) === ')') {\n                        d = new Date(value.slice(5, -1));\n                        if (d) {\n                            return d;\n                        }\n                    }\n                    return value;\n                });\n    \n    \n        This is a reference implementation. You are free to copy, modify, or\n        redistribute.\n    */\n    /*jslint evil: true, regexp: true */\n    /*members \"\", \"\\b\", \"\\t\", \"\\n\", \"\\f\", \"\\r\", \"\\\"\", JSON, \"\\\\\", apply,\n        call, charCodeAt, getUTCDate, getUTCFullYear, getUTCHours,\n        getUTCMinutes, getUTCMonth, getUTCSeconds, hasOwnProperty, join,\n        lastIndex, length, parse, prototype, push, replace, slice, stringify,\n        test, toJSON, toString, valueOf\n    */\n    // create a JSON object only if one does not already exist. We create the\n    // methods in a closure to avoid creating global variables.\n    var JSON2 = {};\n    (function () {\n        'use strict';\n        function f(n) {\n            // format integers to have at least two digits.\n            return n < 10 ? '0' + n : n;\n        }\n        if (typeof Date.prototype.toJSON !== 'function') {\n            Date.prototype.toJSON = function (key) {\n                return isFinite(this.valueOf())\n                    ? this.getUTCFullYear() + '-' +\n                        f(this.getUTCMonth() + 1) + '-' +\n                        f(this.getUTCDate()) + 'T' +\n                        f(this.getUTCHours()) + ':' +\n                        f(this.getUTCMinutes()) + ':' +\n                        f(this.getUTCSeconds()) + 'Z'\n                    : null;\n            };\n            var strProto = String.prototype;\n            var numProto = Number.prototype;\n            numProto.JSON = strProto.JSON =\n                Boolean.prototype.toJSON = function (key) {\n                    return this.valueOf();\n                };\n        }\n        var cx = /[\\u0000\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g, \n        // tslint:disable-next-line\n        esc = /[\\\\\\\"\\x00-\\x1f\\x7f-\\x9f\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g, gap, indent, meta = {\n            '\\b': '\\\\b',\n            '\\t': '\\\\t',\n            '\\n': '\\\\n',\n            '\\f': '\\\\f',\n            '\\r': '\\\\r',\n            '\"': '\\\\\"',\n            '\\\\': '\\\\\\\\'\n        }, rep;\n        function quote(string) {\n            // if the string contains no control characters, no quote characters, and no\n            // backslash characters, then we can safely slap some quotes around it.\n            // otherwise we must also replace the offending characters with safe escape\n            // sequences.\n            esc.lastIndex = 0;\n            return esc.test(string) ? '\"' + string.replace(esc, function (a) {\n                var c = meta[a];\n                return typeof c === 'string'\n                    ? c\n                    : '\\\\u' + ('0000' + a.charCodeAt(0).toString(16)).slice(-4);\n            }) + '\"' : '\"' + string + '\"';\n        }\n        function str(key, holder) {\n            // produce a string from holder[key].\n            var i, // the loop counter.\n            k = null, // the member key.\n            v, // the member value.\n            length, mind = gap, partial, value = holder[key];\n            // if the value has a toJSON method, call it to obtain a replacement value.\n            if (value && typeof value === 'object' &&\n                typeof value.toJSON === 'function') {\n                value = value.toJSON(key);\n            }\n            // if we were called with a replacer function, then call the replacer to\n            // obtain a replacement value.\n            if (typeof rep === 'function') {\n                value = rep.call(holder, key, value);\n            }\n            // what happens next depends on the value's type.\n            switch (typeof value) {\n                case 'string':\n                    return quote(value);\n                case 'number':\n                    // json numbers must be finite. Encode non-finite numbers as null.\n                    return isFinite(value) ? String(value) : 'null';\n                case 'boolean':\n                case 'null':\n                    // if the value is a boolean or null, convert it to a string. Note:\n                    // typeof null does not produce 'null'. The case is included here in\n                    // the remote chance that this gets fixed someday.\n                    return String(value);\n                // if the type is 'object', we might be dealing with an object or an array or\n                // null.\n                case 'object':\n                    // due to a specification blunder in ECMAScript, typeof null is 'object',\n                    // so watch out for that case.\n                    if (!value) {\n                        return 'null';\n                    }\n                    // make an array to hold the partial: string[] results of stringifying this object value.\n                    gap += indent;\n                    partial = [];\n                    // is the value an array?\n                    if (Object.prototype.toString.apply(value, []) === '[object Array]') {\n                        // the value is an array. Stringify every element. Use null as a placeholder\n                        // for non-JSON values.\n                        length = value.length;\n                        for (i = 0; i < length; i += 1) {\n                            partial[i] = str(i.toString(), value) || 'null';\n                        }\n                        // join all of the elements together, separated with commas, and wrap them in\n                        // brackets.\n                        v = partial.length === 0\n                            ? '[]'\n                            : gap\n                                ? '[\\n' + gap + partial.join(',\\n' + gap) + '\\n' + mind + ']'\n                                : '[' + partial.join(',') + ']';\n                        gap = mind;\n                        return v;\n                    }\n                    // if the replacer is an array, use it to select the members to be stringified.\n                    if (rep && typeof rep === 'object') {\n                        length = rep.length;\n                        for (i = 0; i < length; i += 1) {\n                            if (typeof rep[i] === 'string') {\n                                k = rep[i];\n                                v = str(k, value);\n                                if (v) {\n                                    partial.push(quote(k) + (gap ? ': ' : ':') + v);\n                                }\n                            }\n                        }\n                    }\n                    else {\n                        // otherwise, iterate through all of the keys in the object.\n                        for (k in value) {\n                            if (Object.prototype.hasOwnProperty.call(value, k)) {\n                                v = str(k, value);\n                                if (v) {\n                                    partial.push(quote(k) + (gap ? ': ' : ':') + v);\n                                }\n                            }\n                        }\n                    }\n                    // join all of the member texts together, separated with commas,\n                    // and wrap them in braces.\n                    v = partial.length === 0\n                        ? '{}'\n                        : gap\n                            ? '{\\n' + gap + partial.join(',\\n' + gap) + '\\n' + mind + '}'\n                            : '{' + partial.join(',') + '}';\n                    gap = mind;\n                    return v;\n            }\n        }\n        // if the JSON object does not yet have a stringify method, give it one.\n        if (typeof JSON2.stringify !== 'function') {\n            JSON2.stringify = function (value, replacer, space) {\n                // the stringify method takes a value and an optional replacer, and an optional\n                // space parameter, and returns a JSON text. The replacer can be a function\n                // that can replace values, or an array of strings that will select the keys.\n                // a default replacer method can be provided. Use of the space parameter can\n                // produce text that is more easily readable.\n                var i;\n                gap = '';\n                indent = '';\n                // if the space parameter is a number, make an indent string containing that\n                // many spaces.\n                if (typeof space === 'number') {\n                    for (i = 0; i < space; i += 1) {\n                        indent += ' ';\n                    }\n                }\n                else if (typeof space === 'string') {\n                    indent = space;\n                }\n                // if there is a replacer, it must be a function or an array.\n                // otherwise, throw an error.\n                rep = replacer;\n                if (replacer && typeof replacer !== 'function' &&\n                    (typeof replacer !== 'object' ||\n                        typeof replacer.length !== 'number')) {\n                    throw new Error('JSON.stringify');\n                }\n                // make a fake root object containing our value under the key of ''.\n                // return the result of stringifying the value.\n                return str('', { '': value });\n            };\n        }\n        // if the JSON object does not yet have a parse method, give it one.\n        if (typeof JSON2.parse !== 'function') {\n            JSON2.parse = function (text, reviver) {\n                // the parse method takes a text and an optional reviver function, and returns\n                // a JavaScript value if the text is a valid JSON text.\n                var j;\n                function walk(holder, key) {\n                    // the walk method is used to recursively walk the resulting structure so\n                    // that modifications can be made.\n                    var k = null, v, value = holder[key];\n                    if (value && typeof value === 'object') {\n                        for (k in value) {\n                            if (Object.prototype.hasOwnProperty.call(value, k)) {\n                                v = walk(value, k);\n                                if (v !== undefined) {\n                                    value[k] = v;\n                                }\n                                else {\n                                    value[k] = undefined;\n                                }\n                            }\n                        }\n                    }\n                    return reviver.call(holder, key, value);\n                }\n                // parsing happens in four stages. In the first stage, we replace certain\n                // unicode characters with escape sequences. JavaScript handles many characters\n                // incorrectly, either silently deleting them, or treating them as line endings.\n                text = String(text);\n                cx.lastIndex = 0;\n                if (cx.test(text)) {\n                    text = text.replace(cx, function (a) {\n                        return '\\\\u' +\n                            ('0000' + a.charCodeAt(0).toString(16)).slice(-4);\n                    });\n                }\n                // in the second stage, we run the text against regular expressions that look\n                // for non-JSON patterns. We are especially concerned with '()' and 'new'\n                // because they can cause invocation, and '=' because it can cause mutation.\n                // but just to be safe, we want to reject all unexpected forms.\n                // we split the second stage into 4 regexp operations in order to work around\n                // crippling inefficiencies in IE's and Safari's regexp engines. First we\n                // replace the JSON backslash pairs with '@' (a non-JSON character). Second, we\n                // replace all simple value tokens with ']' characters. Third, we delete all\n                // open brackets that follow a colon or comma or that begin the text. Finally,\n                // we look to see that the remaining characters are only whitespace or ']' or\n                // ',' or ':' or '{' or '}'. If that is so, then the text is safe for eval.\n                if (/^[\\],:{}\\s]*$/\n                    .test(text.replace(/\\\\(?:[\"\\\\\\/bfnrt]|u[0-9a-fA-F]{4})/g, '@')\n                    .replace(/\"[^\"\\\\\\n\\r]*\"|true|false|null|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?/g, ']')\n                    .replace(/(?:^|:|,)(?:\\s*\\[)+/g, ''))) {\n                    // in the third stage we use the eval function to compile the text into a\n                    // javascript structure. The '{' operator is subject to a syntactic ambiguity\n                    // in JavaScript: it can begin a block or an object literal. We wrap the text\n                    // in parens to eliminate the ambiguity.\n                    j = (new Function('return (' + text + ')')());\n                    // in the optional fourth stage, we recursively walk the new structure, passing\n                    // each name/value pair to a reviver function for possible transformation.\n                    return typeof reviver === 'function'\n                        ? walk({ '': j }, '')\n                        : j;\n                }\n                // if the text is not JSON parseable, then a SyntaxError is thrown.\n                throw new SyntaxError('JSON.parse');\n            };\n        }\n    }());\n    \n    var JsonpRequest = (function () {\n        function JsonpRequest(url, payload) {\n            if (url === void 0) { url = \"\"; }\n            if (payload === void 0) { payload = \"\"; }\n            this.url = url;\n            this.payload = payload;\n            this.type = \"jsonp\";\n        }\n        return JsonpRequest;\n    }());\n    var NullRequest = (function () {\n        function NullRequest(payload) {\n            if (payload === void 0) { payload = {}; }\n            this.payload = payload;\n            this.type = \"null\";\n        }\n        return NullRequest;\n    }());\n    /**\n     * @namespace Heartland.Ajax\n     */\n    var Ajax = (function () {\n        function Ajax() {\n        }\n        /**\n         * Heartland.Ajax.jsonp\n         *\n         * Creates a new DOM node containing a created JSONP callback handler for an\n         * impending Ajax JSONP request. Removes need for `XMLHttpRequest`.\n         *\n         * @param {string} url\n         * @param {function} callback\n         */\n        Ajax.jsonp = function (request, callback) {\n            var script = document.createElement('script');\n            var callbackName = 'jsonp_callback_' + Math.round(100000 * Math.random());\n            window[callbackName] = function (data) {\n                window[callbackName] = undefined;\n                document.body.removeChild(script);\n                callback(data);\n            };\n            script.src = request.url + (request.url.indexOf('?') >= 0 ? '&' : '?') + 'callback=' + callbackName\n                + '&' + request.payload;\n            document.body.appendChild(script);\n        };\n        /**\n         * Heartland.Ajax.cors\n         *\n         * Creates a new `XMLHttpRequest` object for a POST request to the given `url`.\n         *\n         * @param {string} url\n         * @param {function} callback\n         */\n        Ajax.cors = function (request, callback) {\n            var xhr;\n            var method = 'POST';\n            var timeout;\n            if ((new XMLHttpRequest()).withCredentials === undefined) {\n                xhr = new window.XDomainRequest();\n                method = 'GET';\n                request.url = request.url.split('?')[0];\n                request.url = request.url + '?' + request.payload;\n                xhr.open(method, request.url);\n            }\n            else {\n                xhr = new XMLHttpRequest();\n                xhr.open(method, request.url);\n                xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');\n            }\n            var cb = function (e) {\n                clearTimeout(timeout);\n                if (e.type === 'error') {\n                    callback({ error: { message: 'communication error' } });\n                    return;\n                }\n                if (xhr.readyState === 4 || (xhr.readyState !== 4 && xhr.responseText !== '')) {\n                    var data = JSON2.parse(xhr.responseText);\n                    callback(data);\n                }\n                else {\n                    callback({ error: { message: 'no data' } });\n                }\n            };\n            xhr.onload = cb;\n            xhr.onerror = cb;\n            xhr.send(request.payload);\n            timeout = setTimeout(function () {\n                xhr.abort();\n                callback({ error: { message: 'timeout' } });\n            }, 5000);\n        };\n        return Ajax;\n    }());\n    \n    var cardTypes = [\n        {\n            code: 'visa',\n            format: /(\\d{1,4})/g,\n            length: 16,\n            regex: /^4/\n        },\n        {\n            code: 'mastercard',\n            format: /(\\d{1,4})/g,\n            length: 16,\n            regex: /^(5[1-5]|2[2-7])/\n        },\n        {\n            code: 'amex',\n            format: /(\\d{1,4})(\\d{1,6})?(\\d{1,5})?/,\n            length: 15,\n            regex: /^3[47]/\n        },\n        {\n            code: 'diners',\n            format: /(\\d{1,4})(\\d{1,6})?(\\d{1,4})?/,\n            length: 14,\n            regex: /^3[0689]/\n        },\n        {\n            code: 'discover',\n            format: /(\\d{1,4})/g,\n            length: 16,\n            regex: /^6([045]|22)/\n        },\n        {\n            code: 'jcb',\n            format: /(\\d{1,4})/g,\n            length: 16,\n            regex: /^35/\n        }\n    ];\n    \n    var CardNumber = (function () {\n        function CardNumber() {\n        }\n        CardNumber.prototype.format = function (number) {\n            number = number.replace(/\\D/g, '');\n            var type = Card.typeByNumber(number);\n            if (!type) {\n                return number;\n            }\n            var matches = number.match(type.format);\n            if (!matches) {\n                return number;\n            }\n            if (!type.format.global) {\n                matches.shift();\n            }\n            return matches.join(' ').replace(/^\\s+|\\s+$/gm, '');\n        };\n        return CardNumber;\n    }());\n    \n    var Expiration = (function () {\n        function Expiration() {\n        }\n        Expiration.prototype.format = function (exp, final) {\n            if (final === void 0) { final = false; }\n            var pat = /^\\D*(\\d{1,2})(\\D+)?(\\d{1,4})?/;\n            var groups = exp.match(pat);\n            var month;\n            var del;\n            var year;\n            if (!groups) {\n                return '';\n            }\n            month = groups[1] || '';\n            del = groups[2] || '';\n            year = groups[3] || '';\n            if (year.length > 0) {\n                del = ' / ';\n            }\n            else if (month.length === 2 || del.length > 0) {\n                del = ' / ';\n            }\n            else if (month.length === 1 && (month !== '0' && month !== '1')) {\n                del = ' / ';\n            }\n            if (month.length === 1 && del !== '') {\n                month = '0' + month;\n            }\n            if (final && year.length === 2) {\n                year = (new Date).getFullYear().toString().slice(0, 2) + year;\n            }\n            return month + del + year;\n        };\n        return Expiration;\n    }());\n    \n    var CardNumber$1 = (function () {\n        function CardNumber() {\n        }\n        CardNumber.prototype.validate = function (number) {\n            if (!number) {\n                return false;\n            }\n            number = number.replace(/[-\\s]/g, '');\n            var type = Card.typeByNumber(number);\n            if (!type) {\n                return false;\n            }\n            return Card.luhnCheck(number)\n                && number.length === type.length;\n        };\n        return CardNumber;\n    }());\n    \n    var Cvv = (function () {\n        function Cvv() {\n        }\n        Cvv.prototype.validate = function (cvv) {\n            if (!cvv) {\n                return false;\n            }\n            cvv = cvv.replace(/^\\s+|\\s+$/g, '');\n            if (!/^\\d+$/.test(cvv)) {\n                return false;\n            }\n            return 3 <= cvv.length && cvv.length <= 4;\n        };\n        return Cvv;\n    }());\n    \n    var Expiration$1 = (function () {\n        function Expiration() {\n        }\n        Expiration.prototype.validate = function (exp) {\n            var m, y;\n            if (!exp) {\n                return false;\n            }\n            var split = exp.split('/');\n            m = split[0], y = split[1];\n            if (!m || !y) {\n                return false;\n            }\n            m = m.replace(/^\\s+|\\s+$/g, '');\n            y = y.replace(/^\\s+|\\s+$/g, '');\n            if (!/^\\d+$/.test(m)) {\n                return false;\n            }\n            if (!/^\\d+$/.test(y)) {\n                return false;\n            }\n            if (y.length === 2) {\n                y = (new Date).getFullYear().toString().slice(0, 2) + y;\n            }\n            var month = parseInt(m, 10);\n            var year = parseInt(y, 10);\n            if (!(1 <= month && month <= 12)) {\n                return false;\n            }\n            // creates date as 1 day past end of\n            // expiration month since JS months\n            // are 0 indexed\n            return (new Date(year, month, 1)) > (new Date);\n        };\n        return Expiration;\n    }());\n    \n    /**\n     * @namespace Heartland.DOM\n     */\n    var DOM = (function () {\n        function DOM() {\n        }\n        /**\n         * Heartland.DOM.configureField\n         *\n         * Configures an input field in a single field iFrame.\n         *\n         * @param {Heartland.HPS} hps\n         */\n        DOM.configureField = function (hps) {\n            document.getElementById('heartland-field').setAttribute('name', hps.field);\n        };\n        /**\n         * Heartland.DOM.makeFrame\n         *\n         * Creates a single iFrame element with the appropriate defaults.\n         *\n         * @param {string} name\n         * @returns {HTMLIframeElement}\n         */\n        DOM.makeFrame = function (name) {\n            var frame = document.createElement('iframe');\n            frame.id = 'heartland-frame-' + name;\n            frame.name = name;\n            frame.style.border = '0';\n            frame.frameBorder = '0';\n            frame.scrolling = 'no';\n            return frame;\n        };\n        /**\n         * Heartland.DOM.addField\n         *\n         * Adds a DOM `input` node to `formParent` with type `fieldType`, name\n         * `fieldName`, and value `fieldValue`.\n         *\n         * @param {string} formParent\n         * @param {string} fieldType\n         * @param {string} fieldName\n         * @param {string} fieldValue\n         */\n        DOM.addField = function (formParent, fieldType, fieldName, fieldValue) {\n            var input = document.createElement('input');\n            input.setAttribute('type', fieldType);\n            input.setAttribute('name', fieldName);\n            input.setAttribute('value', fieldValue);\n            document.getElementById(formParent).appendChild(input);\n        };\n        /**\n         * Heartland.DOM.setStyle\n         *\n         * Sets an element's style attribute within a child iframe window.\n         *\n         * @param {string} elementid\n         * @param {string} htmlstyle\n         */\n        DOM.setStyle = function (elementid, htmlstyle) {\n            var el = document.getElementById(elementid);\n            if (el) {\n                el.setAttribute('style', DOM.encodeEntities(htmlstyle));\n            }\n        };\n        /**\n         * Heartland.DOM.appendStyle\n         *\n         * Appends an element's style attribute within a child iframe window.\n         *\n         * @param {string} elementid\n         * @param {String} htmlstyle\n         */\n        DOM.appendStyle = function (elementid, htmlstyle) {\n            var el = document.getElementById(elementid);\n            if (el) {\n                var currstyle = el.getAttribute('style');\n                var newstyle = (currstyle ? currstyle : '') + htmlstyle;\n                el.setAttribute('style', DOM.encodeEntities(newstyle));\n            }\n        };\n        /**\n         * Heartland.DOM.setText\n         *\n         * Sets an element's inner text within a child iframe window.\n         *\n         * @param {string} elementid\n         * @param {string} text\n         */\n        DOM.setText = function (elementid, text) {\n            var el = document.getElementById(elementid);\n            if (el) {\n                el.textContent = DOM.encodeEntities(text);\n            }\n        };\n        /**\n         * Heartland.DOM.setValue\n         *\n         * Sets an element's value within a child iframe window\n         *\n         * @param {string} elementid\n         * @param {string} value\n         */\n        DOM.setValue = function (elementid, text) {\n            var el = document.getElementById(elementid);\n            if (el && typeof el.value !== \"undefined\") {\n                el.value = DOM.encodeEntities(text);\n            }\n        };\n        /**\n         * Heartland.DOM.setPlaceholder\n         *\n         * Sets an element's placeholder attribute within a child iframe window.\n         *\n         * @param {string} elementid\n         * @param {string} text\n         */\n        DOM.setPlaceholder = function (elementid, text) {\n            var el = document.getElementById(elementid);\n            if (el) {\n                if (text === '•••• •••• •••• ••••' || text === '••••' || text === '•••'\n                    || text === '···· ···· ···· ····') {\n                    el.setAttribute('placeholder', text);\n                }\n                else {\n                    el.setAttribute('placeholder', DOM.encodeEntities(text));\n                }\n            }\n        };\n        /**\n         * Heartland.DOM.resizeFrame\n         *\n         * Alerts a parent window to resize the iframe.\n         *\n         * @param {Heartland.HPS} hps\n         */\n        DOM.resizeFrame = function (hps) {\n            var docHeight = document.body.offsetHeight + 1; // off by one error\n            hps.Messages.post({ action: 'resize', height: docHeight }, 'parent');\n        };\n        /**\n         * Heartland.DOM.setFieldData\n         *\n         * Receives a field value from another frame prior to the tokenization process.\n         *\n         * @param {string} elementid\n         * @param {string} value\n         */\n        DOM.setFieldData = function (elementid, value) {\n            var el = document.getElementById(elementid);\n            if (!el && document.getElementById('heartland-field')) {\n                el = document.createElement('input');\n                el.setAttribute('id', DOM.encodeEntities(elementid));\n                el.setAttribute('type', 'hidden');\n                document.getElementById('heartland-field-wrapper').appendChild(el);\n            }\n            if (el) {\n                el.setAttribute('value', DOM.encodeEntities(value));\n            }\n        };\n        /**\n         * Heartland.DOM.getFieldData\n         *\n         * Retrieves a field value for another frame prior to the tokenization process.\n         *\n         * @param {Heartland.HPS} hps\n         * @param {string} elementid\n         */\n        DOM.getFieldData = function (hps, elementid) {\n            var el = document.getElementById(elementid);\n            if (el) {\n                hps.Messages.post({ action: 'passData', value: el.value }, 'parent');\n            }\n        };\n        /**\n         * Heartland.DOM.addStylesheet\n         *\n         * Creates a `style` node in the DOM with the given `css`.\n         *\n         * @param {Heartland.HPS} hps\n         * @param {string} elementid\n         */\n        DOM.addStylesheet = function (css) {\n            var el = document.createElement('style');\n            var elements = document.getElementsByTagName('head');\n            el.type = 'text/css';\n            el.appendChild(document.createTextNode(css));\n            if (elements && elements[0]) {\n                elements[0].appendChild(el);\n            }\n        };\n        /**\n         * Heartland.DOM.json2css\n         *\n         * Converts a JSON node to text representing CSS.\n         *\n         * @param {string} json\n         * @returns {string}\n         */\n        DOM.json2css = function (json) {\n            var css = '';\n            var attributes;\n            var children;\n            var i, j;\n            var key, value;\n            if (attributes = DOM.jsonAttributes(json)) {\n                var attributesLength = attributes.length;\n                for (i = 0; i < attributesLength; i++) {\n                    key = attributes[i];\n                    value = json[key];\n                    if (DOM.isArray(value)) {\n                        var arrLength = value.length;\n                        for (j = 0; j < arrLength; j++) {\n                            css += key + ':' + value[j] + ';';\n                        }\n                    }\n                    else {\n                        css += key + ':' + value + ';';\n                    }\n                }\n            }\n            if (children = DOM.jsonChildren(json)) {\n                var childrenLength = children.length;\n                for (i = 0; i < childrenLength; i++) {\n                    key = children[i];\n                    value = json[key];\n                    css += key + '{' + DOM.json2css(value) + '}';\n                }\n            }\n            return css;\n        };\n        /**\n         * Heartland.DOM.setFocus\n         *\n         * Sets the focus on an iframe's field.\n         *\n         * @param {Heartland.HPS} hps\n         * @param {string} elementid\n         */\n        DOM.setFocus = function () {\n            var el = document.getElementById('heartland-field');\n            if (el) {\n                el.focus();\n            }\n        };\n        /**\n         * Heartland.DOM.addCertAlert\n         *\n         * Adds an alert letting the developer know they're in sandbox mode\n         *\n         * @param {string} elementid\n         *\n         */\n        DOM.addCertAlert = function (elementid) {\n            var el = document.createElement('div');\n            var text = document.createTextNode(\"This page is currently in test mode. Do not use real/active card numbers.\");\n            el.appendChild(text);\n            el.style.display = \"block\";\n            el.style.width = \"100%\";\n            el.style.marginBottom = \"5px\";\n            el.style.color = \"#fff\";\n            el.style.backgroundColor = \"#770000\";\n            el.style.padding = \"8px 5px\";\n            el.style.fontFamily = \"Verdana\";\n            el.style.fontWeight = \"100\";\n            el.style.fontSize = \"12px\";\n            el.style.textAlign = \"center\";\n            el.style.boxSizing = \"border-box\";\n            var container = document.getElementById(elementid);\n            var frame = document.getElementById('heartland-frame-cardNumber');\n            if (frame) {\n                container.insertBefore(el, frame);\n            }\n            else {\n                var frame2 = document.getElementById('heartland-frame-heartland-frame-securesubmit');\n                container.insertBefore(el, frame2);\n            }\n        };\n        /***********\n         * Helpers *\n         ***********/\n        /**\n         * Escapes all potentially dangerous characters, so that the\n         * resulting string can be safely inserted into attribute or\n         * element text.\n         *\n         * @param value\n         * @returns {string} escaped text\n         */\n        DOM.encodeEntities = function (value) {\n            return value.\n                replace(/&/g, '&amp;').\n                replace(/[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]/g, function (v) {\n                var hi = v.charCodeAt(0);\n                var low = v.charCodeAt(1);\n                return '&#' + (((hi - 0xD800) * 0x400) + (low - 0xDC00) + 0x10000) + ';';\n            }).\n                replace(/([^\\#-~| |!])/g, function (v) {\n                return '&#' + v.charCodeAt(0) + ';';\n            }).\n                replace(/</g, '&lt;').\n                replace(/>/g, '&gt;');\n        };\n        DOM.isArray = function (obj) {\n            return Object.prototype.toString.call(obj) === '[object Array]';\n        };\n        DOM.jsonAttributes = function (json) {\n            var set = [];\n            for (var i in json) {\n                if (json.hasOwnProperty(i)\n                    && (typeof json[i] === 'string' || DOM.isArray(json[i]))) {\n                    set.push(i);\n                }\n            }\n            return set;\n        };\n        DOM.jsonChildren = function (json) {\n            var set = [];\n            for (var i in json) {\n                if (json.hasOwnProperty(i)\n                    && (Object.prototype.toString.call(json[i]) === '[object Object]')) {\n                    set.push(i);\n                }\n            }\n            return set;\n        };\n        return DOM;\n    }());\n    \n    var Expiration$2 = (function () {\n        function Expiration() {\n        }\n        Expiration.prototype.format = function (exp, final) {\n            if (final === void 0) { final = false; }\n            var pat = /^\\D*(\\d{1,2})(\\D+)?(\\d{1,4})?/;\n            var groups = exp.match(pat);\n            var month;\n            var del;\n            var year;\n            if (!groups) {\n                return '';\n            }\n            month = groups[1] || '';\n            del = groups[2] || '';\n            year = groups[3] || '';\n            if (year.length > 0) {\n                del = ' / ';\n            }\n            else if (month.length === 2 || del.length > 0) {\n                del = ' / ';\n            }\n            else if (month.length === 1 && (month !== '0' && month !== '1')) {\n                del = ' / ';\n            }\n            if (month.length === 1 && del !== '') {\n                month = '0' + month;\n            }\n            if (final && year.length === 2) {\n                year = (new Date).getFullYear().toString().slice(0, 2) + year;\n            }\n            return month + del + year;\n        };\n        return Expiration;\n    }());\n    \n    var Ev = (function () {\n        function Ev() {\n        }\n        Ev.listen = function (node, eventName, callback) {\n            if (document.addEventListener) {\n                node.addEventListener(eventName, callback, false);\n            }\n            else {\n                if (node === document) {\n                    document.documentElement.attachEvent('onpropertychange', function (e) {\n                        if (e.propertyName === eventName) {\n                            callback(e);\n                        }\n                    });\n                }\n                else {\n                    node.attachEvent('on' + eventName, callback);\n                }\n            }\n        };\n        Ev.trigger = function (node, eventName) {\n            if (document.createEvent) {\n                var event = document.createEvent('Event');\n                event.initEvent(eventName, true, true);\n                node.dispatchEvent(event);\n            }\n            else {\n                document.documentElement[eventName]++;\n            }\n        };\n        Ev.ignore = function (eventName, callback) {\n            if (document.removeEventListener) {\n                document.removeEventListener(eventName, callback, false);\n            }\n            else {\n                document.documentElement.detachEvent('onpropertychange', function (e) {\n                    if (e.propertyName === eventName) {\n                        callback(e);\n                    }\n                });\n            }\n        };\n        return Ev;\n    }());\n    /**\n     * @namespace Heartland.Events\n     */\n    var Events = (function () {\n        function Events() {\n        }\n        /**\n         * Heartland.Events.addHandler\n         *\n         * Adds an `event` handler for a given `target` element.\n         *\n         * @param {string | EventTarget} target\n         * @param {string} event\n         * @param {EventListener} callback\n         */\n        Events.addHandler = function (target, event, callback) {\n            var node;\n            if (typeof target === 'string') {\n                node = document.getElementById(target);\n            }\n            else {\n                node = target;\n            }\n            if (document.addEventListener) {\n                node.addEventListener(event, callback, false);\n            }\n            else {\n                Ev.listen(node, event, callback);\n            }\n        };\n        /**\n         * Heartland.Events.removeHandler\n         *\n         * Removes an `event` handler for a given `target` element.\n         *\n         * @param {string | EventTarget} target\n         * @param {string} event\n         * @param {EventListener} callback\n         */\n        Events.removeHandler = function (target, event, callback) {\n            var node;\n            if (typeof target === 'string') {\n                node = document.getElementById(target);\n            }\n            else {\n                node = target;\n            }\n            if (document.removeEventListener) {\n                node.removeEventListener(event, callback, false);\n            }\n            else {\n                Ev.ignore(event, callback);\n            }\n        };\n        /**\n         * Heartland.Events.trigger\n         *\n         * Fires off an `event` for a given `target` element.\n         *\n         * @param {string} name\n         * @param {any} target\n         * @param {any} data [optional]\n         */\n        Events.trigger = function (name, target, data, bubble) {\n            if (bubble === void 0) { bubble = false; }\n            if (document.createEvent) {\n                var event = document.createEvent('Event');\n                event.initEvent(name, true, true);\n                target.dispatchEvent(event);\n            }\n            else {\n                Ev.trigger(target, name);\n            }\n        };\n        /**\n         * Heartland.Events.frameHandleWith\n         *\n         * Wraps `hps` state in a closure to provide a `Heartland.Messages.receive`\n         * callback handler for iFrame children.\n         *\n         * @param {Heartland.HPS} hps\n         */\n        Events.frameHandleWith = function (hps) {\n            return function (data) {\n                switch (data.action) {\n                    case 'tokenize':\n                        if (data.accumulateData) {\n                            hps.Messages.post({\n                                action: 'accumulateData'\n                            }, 'parent');\n                            var elOpts = document.getElementById('tokenizeOptions');\n                            if (!elOpts) {\n                                elOpts = document.createElement('input');\n                                elOpts.id = 'tokenizeOptions';\n                                elOpts.type = 'hidden';\n                            }\n                            var elPK = document.getElementById('publicKey');\n                            if (!elPK) {\n                                elPK = document.createElement('input');\n                                elPK.id = 'publicKey';\n                                elPK.type = 'hidden';\n                            }\n                            if (data.data) {\n                                elOpts.value = JSON2.stringify(data.data);\n                                elPK.value = data.data.publicKey;\n                            }\n                            else {\n                                elOpts.value = JSON2.stringify({ publicKey: data.message });\n                                elPK.value = data.message;\n                            }\n                            document\n                                .getElementById('heartland-field-wrapper')\n                                .appendChild(elOpts);\n                            document\n                                .getElementById('heartland-field-wrapper')\n                                .appendChild(elPK);\n                        }\n                        else {\n                            Events.tokenizeIframe(hps, data.data);\n                        }\n                        break;\n                    case 'setStyle':\n                        DOM.setStyle(data.id, data.style);\n                        DOM.resizeFrame(hps);\n                        break;\n                    case 'appendStyle':\n                        DOM.appendStyle(data.id, data.style);\n                        DOM.resizeFrame(hps);\n                        break;\n                    case 'setText':\n                        DOM.setText(data.id, data.text);\n                        DOM.resizeFrame(hps);\n                        break;\n                    case 'setValue':\n                        DOM.setValue(data.id, data.text);\n                        break;\n                    case 'setPlaceholder':\n                        DOM.setPlaceholder(data.id, data.text);\n                        break;\n                    case 'setFieldData':\n                        DOM.setFieldData(data.id, data.value);\n                        if (document.getElementById('heartland-field') &&\n                            document.getElementById('cardCvv') &&\n                            document.getElementById('cardExpiration')) {\n                            var opts = document.getElementById('tokenizeOptions');\n                            var pk = document.getElementById('publicKey');\n                            Events.tokenizeIframe(hps, (opts && opts.getAttribute('value') !== 'undefined'\n                                ? JSON2.parse(opts.getAttribute('value'))\n                                : { publicKey: pk.getAttribute('value') }));\n                        }\n                        break;\n                    case 'getFieldData':\n                        DOM.getFieldData(hps, data.id);\n                        break;\n                    case 'addStylesheet':\n                        DOM.addStylesheet(data.data);\n                        DOM.resizeFrame(hps);\n                        break;\n                    case 'setFocus':\n                        DOM.setFocus();\n                        break;\n                }\n            };\n        };\n        /**\n         * tokenizeIframe\n         *\n         * Tokenizes card data. Used in iframe integrations to tokenize on Heartland's\n         * servers.\n         *\n         * @param {Heartland.HPS} hps\n         * @param {string} publicKey\n         */\n        Events.tokenizeIframe = function (hps, data) {\n            var card = {};\n            var numberElement = (document.getElementById('heartland-field')\n                || document.getElementById('heartland-card-number'));\n            var cvvElement = (document.getElementById('cardCvv')\n                || document.getElementById('heartland-cvv'));\n            var expElement = document.getElementById('cardExpiration');\n            var tokenResponse = function (action) {\n                return function (response) {\n                    hps.Messages.post({ action: action, response: response }, 'parent');\n                    if (cvvElement) {\n                        if (cvvElement.parentNode) {\n                            cvvElement.parentNode.removeChild(cvvElement);\n                        }\n                        else {\n                            cvvElement.remove();\n                        }\n                    }\n                    if (expElement) {\n                        if (expElement.parentNode) {\n                            expElement.parentNode.removeChild(expElement);\n                        }\n                        else {\n                            expElement.remove();\n                        }\n                    }\n                };\n            };\n            card.number = numberElement ? numberElement.value : '';\n            card.cvv = cvvElement ? cvvElement.value : '';\n            card.exp = expElement;\n            if (card.exp) {\n                var formatter = new Expiration$2();\n                var cardExpSplit = formatter.format(card.exp.value, true).split('/');\n                card.expMonth = cardExpSplit[0];\n                card.expYear = cardExpSplit[1];\n                card.exp = undefined;\n            }\n            else {\n                card.expMonth = document.getElementById('heartland-expiration-month').value;\n                card.expYear = document.getElementById('heartland-expiration-year').value;\n            }\n            hps.tokenize({\n                cardCvv: card.cvv ? card.cvv : '',\n                cardExpMonth: card.expMonth ? card.expMonth : '',\n                cardExpYear: card.expYear ? card.expYear : '',\n                cardNumber: card.number ? card.number : '',\n                cca: data.cca,\n                error: tokenResponse('onTokenError'),\n                publicKey: data.publicKey ? data.publicKey : '',\n                success: tokenResponse('onTokenSuccess'),\n                type: 'pan'\n            });\n        };\n        return Events;\n    }());\n    \n    /**\n     * @namespace Heartland.Card\n     */\n    var Card = (function () {\n        function Card() {\n        }\n        /**\n         * Heartland.Card.typeByNumber\n         *\n         * Helper function to grab the CardType for a given card number.\n         *\n         * @param {string} number - The card number\n         * @returns {Heartland.CardType}\n         */\n        Card.typeByNumber = function (number) {\n            var cardType;\n            var i;\n            if (!number) {\n                return null;\n            }\n            if (number.replace(/^\\s+|\\s+$/gm, '').length < 4) {\n                return null;\n            }\n            for (i in cardTypes) {\n                cardType = cardTypes[i];\n                if (cardType && cardType.regex && cardType.regex.test(number)) {\n                    break;\n                }\n            }\n            return cardType;\n        };\n        /**\n         * Heartland.Card.typeByTrack\n         *\n         * @param {string} data - track data\n         * @param {boolean} isEncrypted - (default: false)\n         * @param {string} trackNumber\n         *\n         * @returns CardType\n         */\n        Card.typeByTrack = function (data, isEncrypted, trackNumber) {\n            if (isEncrypted === void 0) { isEncrypted = false; }\n            var number;\n            if (isEncrypted && trackNumber && trackNumber === '02') {\n                number = data.split('=')[0];\n            }\n            else {\n                var temp = data.split('%');\n                if (temp[1]) {\n                    temp = temp[1].split('^');\n                    if (temp[0]) {\n                        number = temp[0].toString().substr(1);\n                    }\n                }\n            }\n            return Card.typeByNumber(number);\n        };\n        /**\n         * Heartland.Card.luhnCheck\n         *\n         * Runs a mod 10 check on a given card number.\n         *\n         * @param {string} number - The card number\n         * @returns {boolean}\n         */\n        Card.luhnCheck = function (number) {\n            var odd = true;\n            var i = 0;\n            var sum = 0;\n            var digit;\n            if (!number) {\n                return false;\n            }\n            var digits = number.split('').reverse();\n            var length = digits.length;\n            for (i; i < length; i++) {\n                digit = parseInt(digits[i], 10);\n                if (odd = !odd) {\n                    digit *= 2;\n                }\n                if (digit > 9) {\n                    digit -= 9;\n                }\n                sum += digit;\n            }\n            return sum % 10 === 0;\n        };\n        /**\n         * Heartland.Card.addType\n         *\n         * Adds a class to the target element with the card type\n         * inferred from the target's current value.\n         *\n         * @param {Event} e\n         */\n        Card.addType = function (e) {\n            var target = (e.currentTarget ? e.currentTarget : e.srcElement);\n            var type = Card.typeByNumber(target.value);\n            var classList = target.className.split(' ');\n            var length = classList.length;\n            var i = 0;\n            var c = '';\n            for (i; i < length; i++) {\n                c = classList[i];\n                if (c && c.indexOf('card-type-') !== -1) {\n                    delete classList[i];\n                }\n            }\n            if (type) {\n                classList.push('card-type-' + type.code);\n            }\n            target.className = classList.join(' ').replace(/^\\s+|\\s+$/gm, '');\n        };\n        /**\n         * Heartland.Card.formatNumber\n         *\n         * Formats a target element's value based on the\n         * inferred card type's formatting regex.\n         *\n         * @param {Event} e\n         */\n        Card.formatNumber = function (e) {\n            var target = (e.currentTarget ? e.currentTarget : e.srcElement);\n            var value = target.value;\n            if (value.length === 0) {\n                return;\n            }\n            var formatted = (new CardNumber).format(value);\n            target.value = formatted;\n            if (!target.setSelectionRange) {\n                return;\n            }\n            var cursor = target.selectionStart;\n            // copy and paste, space inserted on formatter\n            if (value.length < formatted.length) {\n                cursor += formatted.length - value.length;\n            }\n            // check if before new inserted digit is a space\n            if (value.charAt(cursor) === ' ' &&\n                formatted.charAt(cursor - 1) === ' ') {\n                cursor += 1;\n            }\n            target.setSelectionRange(cursor, cursor);\n        };\n        /**\n         * Heartland.Card.formatExpiration\n         *\n         * Formats a target element's value.\n         *\n         * @param {KeyboardEvent} e\n         */\n        Card.formatExpiration = function (e) {\n            var target = (e.currentTarget ? e.currentTarget : e.srcElement);\n            var value = target.value;\n            // allow: delete, backspace\n            if ([46, 8].indexOf(e.keyCode) !== -1 ||\n                // allow: home, end, left, right\n                (e.keyCode >= 35 && e.keyCode <= 39)) {\n                return;\n            }\n            target.value = (new Expiration)\n                .format(value, e.type === 'blur');\n        };\n        /**\n         * Heartland.Card.restrictLength\n         *\n         * Restricts input in a target element to a\n         * certain length data.\n         *\n         * @param {number} length\n         *\n         * @returns {(e: KeyboardEvent) => ()}\n         */\n        Card.restrictLength = function (length) {\n            return function (e) {\n                var target = (e.currentTarget ? e.currentTarget : e.srcElement);\n                var value = target.value;\n                // allow: backspace, delete, tab, escape and enter\n                if ([46, 8, 9, 27, 13, 110].indexOf(e.keyCode) !== -1 ||\n                    // allow: Ctrl+A\n                    (e.keyCode === 65 && e.ctrlKey === true) ||\n                    // allow: home, end, left, right\n                    (e.keyCode >= 35 && e.keyCode <= 39)) {\n                    // let it happen, don't do anything\n                    return;\n                }\n                if (value.length >= length) {\n                    e.preventDefault ? e.preventDefault() : (e.returnValue = false);\n                }\n            };\n        };\n        /**\n         * Heartland.Card.restrictNumeric\n         *\n         * Restricts input in a target element to only\n         * numeric data.\n         *\n         * @param {KeyboardEvent} e\n         */\n        Card.restrictNumeric = function (e) {\n            // allow: backspace, delete, tab, escape and enter\n            if ([46, 8, 9, 27, 13, 110].indexOf(e.keyCode) !== -1 ||\n                // allow: Ctrl+A\n                (e.keyCode === 65 && e.ctrlKey === true) ||\n                // allow: home, end, left, right\n                (e.keyCode >= 35 && e.keyCode <= 39) ||\n                // allow: weird Android/Chrome issue\n                (e.keyCode === 229)) {\n                // let it happen, don't do anything\n                return;\n            }\n            // ensure that it is a number and stop the keypress\n            if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {\n                e.preventDefault ? e.preventDefault() : (e.returnValue = false);\n            }\n        };\n        /**\n         * Heartland.Card.deleteProperly\n         *\n         * Places cursor on the correct position to\n         * let the browser delete the digit instead\n         * of the space.\n         *\n         * @param {KeyboardEvent} e\n         */\n        Card.deleteProperly = function (e) {\n            var target = (e.currentTarget ? e.currentTarget : e.srcElement);\n            var value = target.value;\n            if (!target.setSelectionRange) {\n                return;\n            }\n            var cursor = target.selectionStart;\n            // allow: delete, backspace\n            if ([46, 8].indexOf(e.keyCode) !== -1 &&\n                // if space to be deleted\n                (value.charAt(cursor - 1) === ' ')) {\n                // placing cursor before space to delete digit instead\n                target.setSelectionRange(cursor - 1, cursor - 1);\n            }\n        };\n        /**\n         * Heartland.Card.validateNumber\n         *\n         * Validates a target element's value based on the\n         * inferred card type's validation regex. Adds a\n         * class to the target element to note `valid` or\n         * `invalid`.\n         *\n         * @param {Event} e\n         */\n        Card.validateNumber = function (e) {\n            var target = (e.currentTarget ? e.currentTarget : e.srcElement);\n            var value = target.value;\n            var classList = target.className.split(' ');\n            var length = classList.length;\n            var c = '';\n            for (var i = 0; i < length; i++) {\n                c = classList[i];\n                if (c.indexOf('valid') !== -1) {\n                    delete classList[i];\n                }\n            }\n            if ((new CardNumber$1).validate(value)) {\n                classList.push('valid');\n            }\n            else {\n                classList.push('invalid');\n            }\n            target.className = classList.join(' ').replace(/^\\s+|\\s+$/gm, '');\n        };\n        /**\n         * Heartland.Card.validateCvv\n         *\n         * Validates a target element's value based on the\n         * possible CVV lengths. Adds a class to the target\n         * element to note `valid` or `invalid`.\n         *\n         * @param {Event} e\n         */\n        Card.validateCvv = function (e) {\n            var target = (e.currentTarget ? e.currentTarget : e.srcElement);\n            var value = target.value;\n            var classList = target.className.split(' ');\n            var length = classList.length;\n            var c = '';\n            for (var i = 0; i < length; i++) {\n                c = classList[i];\n                if (c.indexOf('valid') !== -1) {\n                    delete classList[i];\n                }\n            }\n            if ((new Cvv).validate(value)) {\n                classList.push('valid');\n            }\n            else {\n                classList.push('invalid');\n            }\n            target.className = classList.join(' ').replace(/^\\s+|\\s+$/gm, '');\n        };\n        /**\n         * Heartland.Card.validateExpiration\n         *\n         * Validates a target element's value based on the\n         * current date. Adds a class to the target element\n         * to note `valid` or `invalid`.\n         *\n         * @param {Event} e\n         */\n        Card.validateExpiration = function (e) {\n            var target = (e.currentTarget ? e.currentTarget : e.srcElement);\n            var value = target.value;\n            var classList = target.className.split(' ');\n            var length = classList.length;\n            var c = '';\n            for (var i = 0; i < length; i++) {\n                c = classList[i];\n                if (c.indexOf('valid') !== -1) {\n                    delete classList[i];\n                }\n            }\n            if ((new Expiration$1).validate(value)) {\n                classList.push('valid');\n            }\n            else {\n                classList.push('invalid');\n            }\n            target.className = classList.join(' ').replace(/^\\s+|\\s+$/gm, '');\n        };\n        /**\n         * Heartland.Card.attachNumberEvents\n         *\n         * @param {string} selector\n         */\n        Card.attachNumberEvents = function (selector) {\n            Events.addHandler(document.querySelector(selector), 'keydown', Card.restrictNumeric);\n            Events.addHandler(document.querySelector(selector), 'keydown', Card.restrictLength(19));\n            Events.addHandler(document.querySelector(selector), 'keydown', Card.deleteProperly);\n            Events.addHandler(document.querySelector(selector), 'keyup', Card.formatNumber);\n            Events.addHandler(document.querySelector(selector), 'input', Card.formatNumber);\n            Events.addHandler(document.querySelector(selector), 'input', Card.validateNumber);\n            Events.addHandler(document.querySelector(selector), 'input', Card.addType);\n        };\n        /**\n         * Heartland.Card.attachExpirationEvents\n         *\n         * @param {string} selector\n         */\n        Card.attachExpirationEvents = function (selector) {\n            Events.addHandler(document.querySelector(selector), 'keydown', Card.restrictNumeric);\n            Events.addHandler(document.querySelector(selector), 'keydown', Card.restrictLength(9));\n            Events.addHandler(document.querySelector(selector), 'keyup', Card.formatExpiration);\n            Events.addHandler(document.querySelector(selector), 'blur', Card.formatExpiration);\n            Events.addHandler(document.querySelector(selector), 'input', Card.validateExpiration);\n            Events.addHandler(document.querySelector(selector), 'blur', Card.validateExpiration);\n        };\n        /**\n         * Heartland.Card.attachCvvEvents\n         *\n         * @param {string} selector\n         */\n        Card.attachCvvEvents = function (selector) {\n            Events.addHandler(document.querySelector(selector), 'keydown', Card.restrictNumeric);\n            Events.addHandler(document.querySelector(selector), 'keydown', Card.restrictLength(4));\n            Events.addHandler(document.querySelector(selector), 'input', Card.validateCvv);\n        };\n        return Card;\n    }());\n    if (!Array.prototype.indexOf) {\n        Array.prototype.indexOf = function (obj, start) {\n            for (var i = (start || 0), j = this.length; i < j; i++) {\n                if (this[i] === obj) {\n                    return i;\n                }\n            }\n            return -1;\n        };\n    }\n    \n    var Formatter = {\n        CardNumber: CardNumber,\n        Expiration: Expiration\n    };\n    \n    var defaults = {\n        _method: 'post',\n        buttonTarget: '',\n        cardCvv: '',\n        cardExpMonth: '',\n        cardExpYear: '',\n        cardNumber: '',\n        cardType: '',\n        env: 'prod',\n        error: null,\n        fields: {},\n        formId: '',\n        gatewayUrl: '',\n        iframeTarget: '',\n        ktb: '',\n        object: 'token',\n        onEvent: null,\n        onTokenError: null,\n        onTokenSuccess: null,\n        pinBlock: '',\n        publicKey: '',\n        success: null,\n        targetType: '',\n        tokenType: 'supt',\n        track: '',\n        trackNumber: '',\n        type: 'pan',\n        useDefaultStyles: true\n    };\n    \n    var fields = [\n        'cardNumber',\n        'cardCvv',\n        'cardExpiration',\n        'submit'\n    ];\n    \n    var urls = {\n        CERT: 'https://cert.api2.heartlandportico.com/Hps.Exchange.PosGateway.Hpf.v1/api/token',\n        PROD: 'https://api.heartlandportico.com/SecureSubmit.v1/api/token',\n        iframeCERT: 'https://hps.github.io/token/2.1/',\n        iframePROD: 'https://api.heartlandportico.com/SecureSubmit.v1/token/2.1/'\n    };\n    \n    /**\n     * Heartland.Messages\n     *\n     * Initializes a new object for wrapping `window.postMessage` and a fallback\n     * method for legacy browsers.\n     */\n    var Messages = (function () {\n        /**\n         * Heartland.Messages (constructor)\n         *\n         * @constructor\n         * @param {Heartland.HPS} hps\n         * @returns {Heartland.Messages}\n         */\n        function Messages(hps) {\n            this.hps = hps;\n            this.intervalId = null;\n            this.lastHash = '';\n            this.pushIntervalStarted = false;\n        }\n        /**\n         * Heartland.Messages.pushMessages\n         *\n         * For legacy browsers, a mailbox (buffer) must be used to ensure all messages\n         * are sent between parent and child windows. When ready, this function builds\n         * the final message, encodes it, sends it, and resets the mailbox to `[]`.\n         *\n         * @param {Heartland.HPS} hps\n         * @returns {function}\n         */\n        Messages.prototype.pushMessages = function (hps) {\n            return function () {\n                var data = [];\n                var messageArr = [];\n                var i = 0;\n                var targetUrl = '';\n                var current;\n                var targetNode;\n                var re = /^#?\\d+&/;\n                var length = hps.mailbox.length;\n                if (!length) {\n                    return;\n                }\n                for (i = 0; i < length; i++) {\n                    current = hps.mailbox.shift();\n                    if (!targetUrl) {\n                        targetUrl = current.targetUrl;\n                        targetNode = current.targetNode;\n                    }\n                    messageArr.push(current.message);\n                }\n                current = null;\n                if (re.test(window.location.hash)) {\n                    current = JSON2.parse(decodeURIComponent(window.location.hash.replace(re, '')));\n                    data.concat(current);\n                }\n                if (messageArr !== []) {\n                    hps.cacheBust = hps.cacheBust || 1;\n                    data.push({ data: messageArr, source: { name: hps.field || 'parent' } });\n                    var message = JSON2.stringify(data);\n                    var url = targetUrl.replace(/#.*$/, '') + '#' +\n                        (+new Date()) + (hps.cacheBust++) + '&' +\n                        encodeURIComponent(message);\n                    if (targetNode.location) {\n                        targetNode.location.href = url;\n                    }\n                    else {\n                        targetNode.src = url;\n                    }\n                }\n                messageArr.length = 0;\n                hps.mailbox.length = 0;\n            };\n        };\n        /**\n         * Heartland.Messages.post\n         *\n         * When present, wraps the built-in `window.postMessage`. When not present,\n         * pushes the message onto the mailbox for eventual sending, and on first use,\n         * starts the interval for `Messages.pushMessages`.\n         *\n         * @param {Object | string} message\n         * @param {string} target\n         */\n        Messages.prototype.post = function (message, target) {\n            var targetNode;\n            message.source = message.source || {};\n            message.source.name = window.name;\n            if (!this.hps.frames) {\n                return;\n            }\n            var frame = this.hps.frames[target] || this.hps[target];\n            if (!frame) {\n                return;\n            }\n            var targetUrl = this.hps.frames[target].url;\n            try {\n                if (typeof frame.targetNode !== 'undefined') {\n                    targetNode = frame.targetNode;\n                }\n                else if (typeof frame.frame !== 'undefined') {\n                    targetNode = frame.frame;\n                }\n            }\n            catch (e) {\n                targetNode = frame;\n            }\n            if (window.postMessage) {\n                targetNode.postMessage(JSON2.stringify(message), targetUrl);\n            }\n            else {\n                this.hps.mailbox = this.hps.mailbox || [];\n                this.hps.mailbox.push({\n                    message: message,\n                    targetNode: targetNode,\n                    targetUrl: targetUrl\n                });\n                if (!this.pushIntervalStarted) {\n                    setInterval(this.pushMessages(this.hps), 10);\n                }\n            }\n        };\n        /**\n         * Heartland.Messages.receive\n         *\n         * When present, wraps the built-in `window.postMesage`'s `message` or\n         * `onmessage` window events. When not present, uses a single interval to\n         * check for changes to `window.location.hash` when the other window sends a\n         * message and will decode the JSON and URI encoded hash.\n         *\n         * @param {Function} callback\n         * @param {string} sourceOrigin\n         */\n        Messages.prototype.receive = function (callback, sourceOrigin) {\n            if (window.postMessage) {\n                this.callback = function (m) {\n                    try {\n                        callback(JSON2.parse(m.data));\n                    }\n                    catch (e) { }\n                };\n                if (window.addEventListener) {\n                    window.addEventListener('message', this.callback, !1);\n                }\n                else {\n                    window.attachEvent('onmessage', this.callback);\n                }\n            }\n            else {\n                if (this.intervalId) {\n                    clearInterval(this.intervalId);\n                }\n                this.intervalId = null;\n                if (callback) {\n                    this.intervalId = setInterval(function () {\n                        var hash = document.location.hash, re = /^#?\\d+&/;\n                        if (hash !== this.lastHash && re.test(hash)) {\n                            var data = JSON2.parse(decodeURIComponent(hash.replace(re, '')));\n                            this.lastHash = hash;\n                            for (var i in data) {\n                                var m = data[i];\n                                if (Object.prototype.toString.call(m.data) !== '[object Array]') {\n                                    callback(m);\n                                    continue;\n                                }\n                                for (var j in m.data) {\n                                    callback({ data: m.data[j], source: m.source });\n                                }\n                            }\n                        }\n                    }, 100);\n                }\n            }\n            Events.trigger('receiveMessageHandlerAdded', document);\n        };\n        /**\n         * Heartland.Messages.removeReceiver\n         *\n         * Removes active `message` event handler function.\n         */\n        Messages.prototype.removeReceiver = function () {\n            if (window.addEventListener) {\n                window.removeEventListener('message', this.callback, !1);\n            }\n            else {\n                window.detachEvent('onmessage', this.callback);\n            }\n        };\n        /**\n         * Heartland.Messages.dispose\n         *\n         * Removes active `message` event handler function and any\n         * active intervals.\n         */\n        Messages.prototype.dispose = function () {\n            this.removeReceiver();\n            if (this.intervalId) {\n                clearInterval(this.intervalId);\n            }\n        };\n        return Messages;\n    }());\n    \n    /**\n     * @namespace Heartland.Styles\n     */\n    var Styles;\n    (function (Styles) {\n        /**\n         * Heartland.Styles.Defaults\n         *\n         * Collection of helper functions for applying default styles to a child\n         * window's fields. Serves as an example of these methods' use in merchant\n         * modifications. Each function expects a `Heartland.HPS` object to be passed\n         * as an argument.\n         */\n        Styles.Defaults = {\n            body: function (hps) {\n                hps.setStyle('heartland-body', 'margin: 0;' +\n                    'font-family: Arial, \\'Helvetica Neue\\', Helvetica, sans-serif;' +\n                    'color: #666;');\n            },\n            cvv: function (hps) {\n                hps.appendStyle('heartland-cvv', 'width: 110px;');\n            },\n            cvvContainer: function (hps) {\n                hps.setStyle('heartland-cvv-container', 'width: 110px;' +\n                    'display: inline-block;' +\n                    'float: left;');\n            },\n            fieldset: function (hps) {\n                hps.setStyle('heartland-expiration-date-container', 'border: 0;' +\n                    'margin: 0 25px 0px 1px;' +\n                    'padding: 0;' +\n                    'width: 173px;' +\n                    'display: inline-block;' +\n                    'float:  left;');\n            },\n            inputsAndSelects: function (hps) {\n                var ids = [\n                    'heartland-card-number',\n                    'heartland-expiration-month',\n                    'heartland-expiration-year',\n                    'heartland-cvv'\n                ];\n                var length = ids.length;\n                var i = 0;\n                for (i; i < length; i++) {\n                    hps.setStyle(ids[i], 'width: 309px;' +\n                        'padding: 5px;' +\n                        'font-size: 14px;' +\n                        'margin: 3px 0px 15px 0px;' +\n                        'border: 1px #ccc solid;' +\n                        /* IE10 Consumer Preview */\n                        'background-image: -ms-linear-gradient(bottom, #F7F7F7 0%, #EFEFEF 100%);' +\n                        /* Mozilla Firefox */\n                        'background-image: -moz-linear-gradient(bottom, #F7F7F7 0%, #EFEFEF 100%);' +\n                        /* Opera */\n                        'background-image: -o-linear-gradient(bottom, #F7F7F7 0%, #EFEFEF 100%);' +\n                        /* Webkit (Safari/Chrome 10) */\n                        'background-image: -webkit-gradient(linear, left bottom, left top, color-stop(0, #F7F7F7), color-stop(1, #EFEFEF));' +\n                        /* Webkit (Chrome 11+) */\n                        'background-image: -webkit-linear-gradient(bottom, #F7F7F7 0%, #EFEFEF 100%);' +\n                        /* W3C Markup, IE10 Release Preview */\n                        'background-image: linear-gradient(to top, #F7F7F7 0%, #EFEFEF 100%);');\n                }\n            },\n            labelsAndLegend: function (hps) {\n                var ids = [\n                    'heartland-card-number-label',\n                    'heartland-expiration-date-legend',\n                    'heartland-expiration-month-label',\n                    'heartland-expiration-year-label',\n                    'heartland-cvv-label'\n                ];\n                var length = ids.length;\n                var i = 0;\n                for (i; i < length; i++) {\n                    hps.setStyle(ids[i], 'font-size: 13px;' +\n                        'text-transform: uppercase;' +\n                        'font-weight: bold;' +\n                        'display: block;' +\n                        'width: 100%;' +\n                        'clear: both;');\n                }\n            },\n            selectLabels: function (hps) {\n                var ids = ['heartland-expiration-month-label', 'heartland-expiration-year-label'];\n                var length = ids.length;\n                var i = 0;\n                for (i; i < length; i++) {\n                    hps.setStyle(ids[i], 'position:absolute;' +\n                        'width:1px;' +\n                        'height:1px;' +\n                        'padding:0;' +\n                        'margin:-1px;' +\n                        'overflow:hidden;' +\n                        'clip:rect(0,0,0,0);' +\n                        'border:0;');\n                }\n            },\n            selects: function (hps) {\n                var ids = ['heartland-expiration-month', 'heartland-expiration-year'];\n                var length = ids.length;\n                var i = 0;\n                for (i; i < length; i++) {\n                    hps.appendStyle(ids[i], 'border: 0;' +\n                        'outline: 1px solid #ccc;' +\n                        'height: 28px;' +\n                        'width: 80px;' +\n                        '-webkit-appearance: none;' +\n                        '-moz-appearance: none;' +\n                        '-webkit-border-radius: 0px;' +\n                        /* tslint:disable:max-line-length */\n                        'background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAGCAYAAAD68A/GAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyhpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDE0IDc5LjE1Njc5NywgMjAxNC8wOC8yMC0wOTo1MzowMiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTQgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QzA5MTZFN0RFMDY2MTFFNEIyODZFMURFRTA3REUxMjciIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6QzA5MTZFN0VFMDY2MTFFNEIyODZFMURFRTA3REUxMjciPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpDMDkxNkU3QkUwNjYxMUU0QjI4NkUxREVFMDdERTEyNyIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpDMDkxNkU3Q0UwNjYxMUU0QjI4NkUxREVFMDdERTEyNyIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PvMrdUAAAABiSURBVHjaYkxLS3vNwMAgwoAfvGUCEjkMhEE285kzZ65u2bLlJ5DjgkNRxUwgYPz//z+Yl56ePhNIpaEpAqnJADGYkASzgHgnEn8HyEoYB24i1FReILUPynUEmvYFJgcQYACYah+uDhpKGAAAAABJRU5ErkJggg==);' +\n                        /* tslint:enable:max-line-length */\n                        'background-position: 65px 12px;' +\n                        'background-repeat: no-repeat;' +\n                        'background-color:  #F7F7F7;' +\n                        'float: left;' +\n                        'margin-right: 6px');\n                }\n            }\n        };\n    })(Styles || (Styles = {}));\n    \n    /**\n     * @namespace Heartland.Frames\n     */\n    var Frames = (function () {\n        function Frames() {\n        }\n        /**\n         * Heartland.Frames.configureIframe\n         *\n         * Prepares the pages iFrames for communication with the parent window.\n         *\n         * @param {Heartland.HPS} hps\n         * @listens click\n         * @listens message\n         */\n        Frames.configureIframe = function (hps) {\n            var frame;\n            var options = hps.options;\n            var target;\n            var useDefaultStyles = true;\n            hps.Messages = hps.Messages || new Messages(hps);\n            if (options.env === 'cert') {\n                hps.iframe_url = urls.iframeCERT;\n            }\n            else {\n                hps.iframe_url = urls.iframePROD;\n            }\n            if (options.fields !== defaults.fields) {\n                Frames.makeFieldsAndLink(hps);\n            }\n            if (options.fields === defaults.fields && options.iframeTarget) {\n                target = document.getElementById(options.iframeTarget);\n                if (options.targetType === 'myframe') {\n                    frame = target;\n                    hps.iframe_url = frame.src;\n                }\n                else {\n                    frame = DOM.makeFrame('heartland-frame-securesubmit');\n                    target.appendChild(frame);\n                }\n                hps.iframe_url = hps.iframe_url + '#' + encodeURIComponent(document.location.href.split('#')[0]);\n                frame.src = hps.iframe_url;\n                hps.frames.child = {\n                    frame: window.postMessage ? frame.contentWindow : frame,\n                    name: 'child',\n                    url: hps.iframe_url\n                };\n            }\n            if (options.useDefaultStyles === false) {\n                useDefaultStyles = false;\n            }\n            if (options.buttonTarget) {\n                hps.clickHandler = function (e) {\n                    e.preventDefault();\n                    hps.Messages.post({\n                        accumulateData: !!hps.frames.cardNumber,\n                        action: 'tokenize',\n                        data: { publicKey: options.publicKey }\n                    }, hps.frames.cardNumber ? 'cardNumber' : 'child');\n                    return false;\n                };\n                Events.addHandler(options.buttonTarget, 'click', hps.clickHandler);\n            }\n            hps.Messages.receive(function (data) {\n                var fieldFrame;\n                try {\n                    fieldFrame = hps.frames[data.source.name === 'heartland-frame-securesubmit' ? 'parent' : data.source.name];\n                }\n                catch (e) {\n                    return;\n                }\n                switch (data.action) {\n                    case 'requestTokenize':\n                        hps.Messages.post({\n                            accumulateData: !!hps.frames.cardNumber,\n                            action: 'tokenize',\n                            data: options\n                        }, hps.frames.cardNumber ? 'cardNumber' : 'child');\n                        break;\n                    case 'onTokenSuccess':\n                        options.onTokenSuccess(data.response);\n                        break;\n                    case 'onTokenError':\n                        options.onTokenError(data.response);\n                        break;\n                    case 'resize':\n                        if (fieldFrame) {\n                            hps.resizeIFrame(fieldFrame.frame, data.height);\n                        }\n                        else {\n                            hps.resizeIFrame(frame, data.height);\n                        }\n                        break;\n                    case 'receiveMessageHandlerAdded':\n                        if (!options.fields && useDefaultStyles) {\n                            Styles.Defaults.body(hps);\n                            Styles.Defaults.labelsAndLegend(hps);\n                            Styles.Defaults.inputsAndSelects(hps);\n                            Styles.Defaults.fieldset(hps);\n                            Styles.Defaults.selects(hps);\n                            Styles.Defaults.selectLabels(hps);\n                            Styles.Defaults.cvvContainer(hps);\n                            Styles.Defaults.cvv(hps);\n                        }\n                        if (fieldFrame && fieldFrame.options.placeholder) {\n                            hps.Messages.post({\n                                action: 'setPlaceholder',\n                                id: 'heartland-field',\n                                text: fieldFrame.options.placeholder\n                            }, fieldFrame.name);\n                        }\n                        if (fieldFrame && fieldFrame.options.value) {\n                            hps.Messages.post({\n                                action: 'setValue',\n                                id: 'heartland-field',\n                                text: fieldFrame.options.value\n                            }, fieldFrame.name);\n                        }\n                        if (options.style) {\n                            var css = options.styleString\n                                || (options.styleString = DOM.json2css(options.style));\n                            hps.Messages.post({\n                                action: 'addStylesheet',\n                                data: css\n                            }, fieldFrame.name);\n                        }\n                        Events.trigger('securesubmitIframeReady', document);\n                        break;\n                    case 'accumulateData':\n                        for (var i in hps.frames) {\n                            if ('submit' === i || 'cardNumber' === i) {\n                                continue;\n                            }\n                            var field = hps.frames[i];\n                            hps.Messages.post({\n                                action: 'getFieldData',\n                                id: 'heartland-field'\n                            }, field.name);\n                        }\n                        break;\n                    case 'passData':\n                        var cardNumberFieldFrame = hps.frames.cardNumber;\n                        if (!cardNumberFieldFrame) {\n                            break;\n                        }\n                        hps.Messages.post({\n                            action: 'setFieldData',\n                            id: fieldFrame.name,\n                            value: data.value\n                        }, cardNumberFieldFrame.name);\n                        break;\n                    case 'fieldEvent':\n                        if (!options.onEvent) {\n                            break;\n                        }\n                        options.onEvent(data.event);\n                        break;\n                    case 'error':\n                        if (!options.onError) {\n                            break;\n                        }\n                        options.onError(data);\n                        break;\n                }\n            }, '*');\n        };\n        /**\n         * Heartland.Frames.makeFieldsAndLink\n         *\n         * Creates a set of single field iFrames and stores a reference to\n         * them in the parent window's state.\n         *\n         * @param {Heartland.HPS} hps\n         */\n        Frames.makeFieldsAndLink = function (hps) {\n            var options = hps.options;\n            var fieldsLength = fields.length;\n            var baseUrl = hps.iframe_url.replace('index.html', '');\n            for (var i = 0; i < fieldsLength; i++) {\n                var field = fields[i];\n                var fieldOptions = options.fields[field];\n                if (!fieldOptions) {\n                    return;\n                }\n                var frame = DOM.makeFrame(field);\n                var url = baseUrl;\n                if (field === 'submit') {\n                    url = url + 'button.html';\n                }\n                else if (options.cca && options.env === 'cert') {\n                    url = url + 'fieldCca.cert.html';\n                }\n                else if (options.cca && options.env === 'prod') {\n                    url = url + 'fieldCca.prod.html';\n                }\n                else {\n                    url = url + 'field.html';\n                }\n                url = url + '#' + field + ':' + encodeURIComponent(document.location.href.split('#')[0]);\n                frame.src = url;\n                document\n                    .getElementById(fieldOptions.target)\n                    .appendChild(frame);\n                hps.frames[field] = {\n                    frame: frame,\n                    name: field,\n                    options: fieldOptions,\n                    target: fieldOptions.target,\n                    targetNode: window.postMessage ? frame.contentWindow : frame,\n                    url: url\n                };\n            }\n        };\n        /**\n         * Heartland.Frames.monitorFieldEvents\n         *\n         * @param {Heartland.HPS} hps\n         * @param {string | EventTarget} target\n         */\n        Frames.monitorFieldEvents = function (hps, target) {\n            var events = ['click', 'blur', 'focus', 'change', 'keypress', 'keydown', 'keyup'];\n            var i = 0, length = events.length;\n            for (i; i < length; i++) {\n                var event = events[i];\n                Events.addHandler(target, event, function (e) {\n                    var field = document.getElementById('heartland-field');\n                    var classes = [];\n                    var data = {};\n                    if (field.className !== '') {\n                        classes = field.className.split(' ');\n                    }\n                    if (e.keyCode) {\n                        data.keyCode = e.keyCode;\n                    }\n                    hps.Messages.post({\n                        action: 'fieldEvent',\n                        event: {\n                            classes: classes,\n                            data: data,\n                            source: window.name,\n                            type: e.type\n                        }\n                    }, 'parent');\n                });\n            }\n        };\n        return Frames;\n    }());\n    \n    /**\n     * @namespace Heartland.Util\n     */\n    var Util = (function () {\n        function Util() {\n        }\n        /**\n         * Heartland.Util.getCardType\n         *\n         * Parses a credit card number to obtain the card type/brand.\n         *\n         * @param {string} tokenizationType\n         * @param {Heartland.Options} options\n         */\n        Util.getCardType = function (tokenizationType, options) {\n            var cardType;\n            var data = '';\n            var type = 'unknown';\n            switch (tokenizationType) {\n                case 'swipe':\n                    data = options.track;\n                    cardType = Card.typeByTrack(data);\n                    break;\n                case 'encrypted':\n                    data = options.track;\n                    cardType = Card.typeByTrack(data, true, options.trackNumber);\n                    break;\n                default:\n                    data = options.cardNumber;\n                    cardType = Card.typeByNumber(data);\n                    break;\n            }\n            if (cardType) {\n                type = cardType.code;\n            }\n            return type;\n        };\n        /**\n         * Heartland.Util.applyOptions\n         *\n         * Creates a single object by merging a `source` (default) and `properties`\n         * obtained elsewhere, e.g. a function argument in `HPS`. Any properties in\n         * `properties` will overwrite matching properties in `source`.\n         *\n         * @param {Heartland.Options} source\n         * @param {Heartland.Options} properties\n         * @returns {Heartland.Options}\n         */\n        Util.applyOptions = function (source, properties) {\n            var destination = {};\n            if (!source) {\n                source = {};\n            }\n            for (var property in source) {\n                if (source.hasOwnProperty(property)) {\n                    destination[property] = source[property];\n                }\n            }\n            for (var property in properties) {\n                if (properties.hasOwnProperty(property)) {\n                    destination[property] = properties[property];\n                }\n            }\n            return destination;\n        };\n        /**\n         * Heartland.Util.throwError\n         *\n         * Allows a merchant-defined error handler to be used in cases where the\n         * tokenization process fails. If not provided, we throw the message as a\n         * JS runtime error.\n         *\n         * @param {Heartland.Options} options\n         * @param {string | Heartland.TokenizationResponse} errorMessage\n         */\n        Util.throwError = function (options, errorMessage) {\n            if (typeof (options.error) === 'function') {\n                options.error(errorMessage);\n                return;\n            }\n            if (errorMessage.error) {\n                throw new Error(errorMessage.error.message);\n            }\n            throw new Error(errorMessage);\n        };\n        /**\n         * Heartland.Util.getItemByPropertyValue\n         *\n         * Enumerates over a `collection` to retreive an item whose `property` is\n         * a given `value`.\n         *\n         * @param {any} collection\n         * @param {string} property\n         * @param {any} value\n         * @returns {any}\n         */\n        Util.getItemByPropertyValue = function (collection, property, value) {\n            var length = collection.length;\n            var i = 0;\n            for (i; i < length; i++) {\n                if (collection[i][property] === value) {\n                    return collection[i];\n                }\n            }\n        };\n        /**\n         * Heartland.Util.getParams\n         *\n         * Builds param list for a particular `type` from expected properties in\n         * `data`.\n         *\n         * @param {string} type - The tokenization type\n         * @param {Heartland.Options} data\n         * @returns {string}\n         */\n        Util.getParams = function (type, data) {\n            var params = [];\n            switch (type) {\n                case 'iframe':\n                case 'pan':\n                    params.push('token_type=supt', 'object=token', '_method=post', 'api_key=' + data.publicKey.replace(/^\\s+|\\s+$/g, ''), 'card%5Bnumber%5D=' + data.cardNumber.replace(/\\s/g, ''), 'card%5Bexp_month%5D=' + data.cardExpMonth.replace(/^\\s+|\\s+$/g, ''), 'card%5Bexp_year%5D=' + data.cardExpYear.replace(/^\\s+|\\s+$/g, ''), 'card%5Bcvc%5D=' + data.cardCvv.replace(/^\\s+|\\s+$/g, ''));\n                    break;\n                case 'swipe':\n                    params.push('token_type=supt', 'object=token', '_method=post', 'api_key=' + data.publicKey.replace(/^\\s+|\\s+$/g, ''), 'card%5Btrack_method%5D=swipe', 'card%5Btrack%5D=' + encodeURIComponent(data.track.replace(/^\\s+|\\s+$/g, '')));\n                    break;\n                case 'encrypted':\n                    params.push('token_type=supt', 'object=token', '_method=post', 'api_key=' + data.publicKey.replace(/^\\s+|\\s+$/g, ''), 'encryptedcard%5Btrack_method%5D=swipe', 'encryptedcard%5Btrack%5D=' + encodeURIComponent(data.track.replace(/^\\s+|\\s+$/g, '')), 'encryptedcard%5Btrack_number%5D=' + encodeURIComponent(data.trackNumber.replace(/^\\s+|\\s+$/g, '')), 'encryptedcard%5Bktb%5D=' + encodeURIComponent(data.ktb.replace(/^\\s+|\\s+$/g, '')), 'encryptedcard%5Bpin_block%5D=' + encodeURIComponent(data.pinBlock.replace(/^\\s+|\\s+$/g, '')));\n                    break;\n                default:\n                    Util.throwError(data, 'unknown params type');\n                    break;\n            }\n            return params.join('&');\n        };\n        /**\n         * Heartland.Util.getUrlByEnv\n         *\n         * Selects the appropriate tokenization service URL for the\n         * active `publicKey`.\n         *\n         * @param {Heartland.Options} options\n         * @returns {string}\n         */\n        Util.getUrlByEnv = function (options) {\n            options.env = options.publicKey.split('_')[1];\n            if (options.env === 'cert') {\n                options.gatewayUrl = urls.CERT;\n            }\n            else {\n                options.gatewayUrl = urls.PROD;\n            }\n            return options;\n        };\n        /**\n         * Heartland.Util.addFormHandler\n         *\n         * Creates and adds an event handler function for the submission for a given\n         * form (`options.form_id`).\n         *\n         * @param {Heartland.Options} options\n         * @listens submit\n         */\n        Util.addFormHandler = function (options) {\n            var payment_form = document.getElementById(options.formId);\n            var code = function (e) {\n                if (e.preventDefault) {\n                    e.preventDefault();\n                }\n                else if (window.event) {\n                    window.event.returnValue = false;\n                }\n                var fields = Util.getFields(options.formId);\n                var cardType = Util.getCardType(fields.number, 'pan');\n                options.cardNumber = fields.number;\n                options.cardExpMonth = fields.expMonth;\n                options.cardExpYear = fields.expYear;\n                options.cardCvv = fields.cvv;\n                options.cardType = cardType;\n                Ajax.call('pan', options);\n            };\n            Events.addHandler(payment_form, 'submit', code);\n            DOM.addField(options.formId, 'hidden', 'publicKey', options.publicKey);\n        };\n        /**\n         * Heartland.Util.getFields\n         *\n         * Extracts card information from the fields with names `card_number`,\n         * `card_expiration_month`, `card_expiration_year`, and `card_cvc` and\n         * expects them to be present as children of `formParent`.\n         *\n         * @param {string} formParent\n         * @returns {Heartland.CardData}\n         */\n        Util.getFields = function (formParent) {\n            var form = document.getElementById(formParent);\n            var fields = {};\n            var i;\n            var length = form.childElementCount;\n            for (i = 0; i < length; i++) {\n                var element = form.children[i];\n                if (element.id === 'card_number') {\n                    fields.number = element.value;\n                }\n                else if (element.id === 'card_expiration_month') {\n                    fields.expMonth = element.value;\n                }\n                else if (element.id === 'card_expiration_year') {\n                    fields.expYear = element.value;\n                }\n                else if (element.id === 'card_cvc') {\n                    fields.cvv = element.value;\n                }\n            }\n            return fields;\n        };\n        return Util;\n    }());\n    \n    var HeartlandTokenService = (function () {\n        function HeartlandTokenService(url, type) {\n            if (type === void 0) { type = \"pan\"; }\n            this.url = url;\n            this.type = type;\n        }\n        HeartlandTokenService.prototype.tokenize = function (data, callback) {\n            var _this = this;\n            this.requestData = data;\n            Ajax.jsonp(this.buildRequest(data), function (response) {\n                callback(_this.deserializeResponseData(response));\n            });\n        };\n        HeartlandTokenService.prototype.buildRequest = function (data) {\n            return new JsonpRequest(this.url, this.serializeRequestData(data));\n        };\n        HeartlandTokenService.prototype.serializeRequestData = function (data) {\n            return Util.getParams(this.type, data);\n        };\n        HeartlandTokenService.prototype.deserializeResponseData = function (data) {\n            if (data.error) {\n                return data;\n            }\n            var cardType = Util.getCardType(this.type, this.requestData);\n            var card = data.card || data.encryptedcard;\n            var lastfour = card.number.slice(-4);\n            data.last_four = lastfour;\n            data.card_type = cardType;\n            data.exp_month = this.requestData.cardExpMonth;\n            data.exp_year = this.requestData.cardExpYear;\n            return data;\n        };\n        return HeartlandTokenService;\n    }());\n    \n    var CardinalTokenService = (function () {\n        function CardinalTokenService(jwt) {\n            this.jwt = jwt;\n        }\n        CardinalTokenService.prototype.tokenize = function (data, callback) {\n            var _this = this;\n            var request = this.buildRequest(data);\n            var cardinal = window.Cardinal;\n            var cb = function (responseData, jwt) {\n                responseData.jwt = jwt;\n                callback(_this.deserializeResponseData(responseData));\n            };\n            // init only once per frame\n            if (!cardinal.__secureSubmitFrameInit) {\n                cardinal.setup('init', { jwt: this.jwt });\n                cardinal.on('payments.validated', cb);\n                cardinal.__secureSubmitFrameInit = true;\n            }\n            cardinal.trigger('jwt.update', this.jwt);\n            cardinal.start('cca', request.payload);\n        };\n        CardinalTokenService.prototype.buildRequest = function (data) {\n            return new NullRequest({\n                Consumer: {\n                    Account: {\n                        AccountNumber: data.cardNumber.replace(/\\D/g, ''),\n                        CardCode: data.cardCvv.replace(/^\\s+|\\s+$/g, ''),\n                        ExpirationMonth: data.cardExpMonth.replace(/^\\s+|\\s+$/g, ''),\n                        ExpirationYear: data.cardExpYear.replace(/^\\s+|\\s+$/g, '')\n                    }\n                },\n                Options: {\n                    EnableCCA: false\n                },\n                OrderDetails: {\n                    OrderNumber: data.cca.orderNumber\n                }\n            });\n        };\n        CardinalTokenService.prototype.serializeRequestData = function (data) {\n            return data;\n        };\n        CardinalTokenService.prototype.deserializeResponseData = function (data) {\n            if (typeof data.Token !== \"undefined\" &&\n                data.Token.Token !== \"undefined\" &&\n                data.Token.ReasonCode === \"0\") {\n                return this.deserializeSuccessResponse(data);\n            }\n            return this.deserializeFailureResponse(data);\n        };\n        CardinalTokenService.prototype.deserializeSuccessResponse = function (data) {\n            return {\n                jwt: data.jwt,\n                token_value: data.Token.Token\n            };\n        };\n        CardinalTokenService.prototype.deserializeFailureResponse = function (data) {\n            var message = data.ErrorDescription;\n            if (data.Token && data.Token.ReasonDescription !== \"\") {\n                message = data.Token.ReasonDescription;\n            }\n            return {\n                error: {\n                    message: message\n                }\n            };\n        };\n        return CardinalTokenService;\n    }());\n    \n    /**\n     * Heartland.HPS\n     *\n     * Initializes options and adds the default form handler if a `formId` is\n     * passed as an option. This expects the default fields (see `getFields`) to\n     * be present as children of `formId`.\n     */\n    var HPS = (function () {\n        /**\n         * Heartland.HPS (constructor)\n         *\n         * @constructor\n         * @param {Heartland.Options} options [optional]\n         * @returns {Heartland.HPS}\n         */\n        function HPS(options) {\n            if (!options && window.parent) {\n                return;\n            }\n            this.options = Util.applyOptions(defaults, options);\n            this.options = Util.getUrlByEnv(this.options);\n            if (this.options.formId.length > 0) {\n                Util.addFormHandler(this.options);\n            }\n            this.frames = {};\n            if (this.options.type === 'iframe') {\n                this.iframe_url = '';\n                this.Messages = new Messages(this);\n                this.mailbox = [];\n                this.cacheBust = 1;\n                Frames.configureIframe(this);\n                if (this.options.env === \"cert\") {\n                    if (this.options.iframeTarget !== \"\") {\n                        DOM.addCertAlert(this.options.iframeTarget);\n                    }\n                    else {\n                        DOM.addCertAlert(this.options.fields.cardNumber.target);\n                    }\n                }\n            }\n            return this;\n        }\n        /**\n         * Heartland.HPS.tokenize\n         *\n         * Tokenizes card data. Used in manual integrations where the merchant's\n         * credit card fields cannot/do not match the names expected in the default\n         * form handler (see `getFields`).\n         *\n         * @param {Heartland.Options} options [optional]\n         */\n        HPS.prototype.tokenize = function (options) {\n            var _this = this;\n            options = options || {};\n            if (options) {\n                this.options = Util.applyOptions(this.options, options);\n                this.options = Util.getUrlByEnv(this.options);\n            }\n            if (this.options.type === 'iframe' && !!this.frames.cardNumber) {\n                this.Messages.post({\n                    accumulateData: !!this.frames.cardNumber,\n                    action: 'tokenize',\n                    data: { publicKey: this.options.publicKey }\n                }, 'cardNumber');\n                return;\n            }\n            else if (this.options.type === 'iframe') {\n                this.Messages.post({\n                    action: 'tokenize',\n                    data: { publicKey: this.options.publicKey }\n                }, 'child');\n                return;\n            }\n            var tokens = {\n                cardinal: null,\n                heartland: null\n            };\n            var callback = function (response) {\n                if (response.error) {\n                    Util.throwError(_this.options, response);\n                }\n                else {\n                    if (_this.options.formId && _this.options.formId.length > 0) {\n                        var heartland = response.heartland || response;\n                        DOM.addField(_this.options.formId, 'hidden', 'token_value', heartland.token_value);\n                        DOM.addField(_this.options.formId, 'hidden', 'last_four', heartland.last_four);\n                        DOM.addField(_this.options.formId, 'hidden', 'card_exp_year', heartland.exp_year);\n                        DOM.addField(_this.options.formId, 'hidden', 'card_exp_month', heartland.exp_month);\n                        DOM.addField(_this.options.formId, 'hidden', 'card_type', heartland.card_type);\n                    }\n                    _this.options.success(response);\n                }\n            };\n            var callbackWrapper = function (type) {\n                return function (response) {\n                    tokens[type] = response;\n                    if (_this.options.cca && tokens.cardinal && tokens.heartland) {\n                        callback(tokens);\n                    }\n                    if (!_this.options.cca && tokens.heartland) {\n                        callback(tokens.heartland);\n                    }\n                };\n            };\n            (new HeartlandTokenService(this.options.gatewayUrl, this.options.type))\n                .tokenize(this.options, callbackWrapper('heartland'));\n            if (this.options.cca) {\n                (new CardinalTokenService(this.options.cca.jwt))\n                    .tokenize(this.options, callbackWrapper('cardinal'));\n            }\n        };\n        /**\n         * Heartland.HPS.configureInternalIframe\n         *\n         * Sets up a child iframe window to prepare it for communication with the\n         * parent and for tokenization.\n         *\n         * @param {Heartland.Options} options\n         */\n        HPS.prototype.configureInternalIframe = function (options) {\n            this.Messages = new Messages(this);\n            this.parent = window.parent;\n            this.frames = this.frames || {};\n            this.frames.parent = {\n                frame: window.parent,\n                name: 'parent',\n                url: decodeURIComponent(document.location.hash.replace(/^#/, ''))\n            };\n            this.loadHandler = (function (hps) {\n                return function () {\n                    DOM.resizeFrame(hps);\n                };\n            }(this));\n            this.receiveMessageHandlerAddedHandler = (function (hps) {\n                return function () {\n                    hps.Messages.post({ action: 'receiveMessageHandlerAdded' }, 'parent');\n                };\n            }(this));\n            Events.addHandler(window, 'load', this.loadHandler);\n            Events.addHandler(document, 'receiveMessageHandlerAdded', this.receiveMessageHandlerAddedHandler);\n            this.Messages.receive(Events.frameHandleWith(this), '*');\n        };\n        ;\n        /**\n         * Heartland.HPS.configureButtonFieldIframe\n         *\n         * Same as `Heartland.HPS.configureFieldIframe` excet the added click event\n         * handler for the button.\n         *\n         * @param {Heartland.Options} options\n         */\n        HPS.prototype.configureButtonFieldIframe = function (options) {\n            this.configureFieldIframe(options);\n            Events.addHandler('heartland-field', 'click', (function (hps) {\n                return function (e) {\n                    e.preventDefault ? e.preventDefault() : (e.returnValue = false);\n                    hps.Messages.post({ action: 'requestTokenize' }, 'parent');\n                };\n            }(this)));\n        };\n        /**\n         * Heartland.HPS.configureFieldIframe\n         *\n         * Sets up a child iframe window to prepare it for communication with the\n         * parent and for tokenization.\n         *\n         * @param {Heartland.Options} options\n         */\n        HPS.prototype.configureFieldIframe = function (options) {\n            var hash = document.location.hash.replace(/^#/, '');\n            var split = hash.split(':');\n            this.Messages = new Messages(this);\n            this.field = split.shift();\n            this.parent = window.parent;\n            this.frames = this.frames || {};\n            this.frames.parent = {\n                frame: window.parent,\n                name: 'parent',\n                url: decodeURIComponent(split.join(':').replace(/^:/, ''))\n            };\n            window.onerror = (function (hps) {\n                return function (errorMsg, url, lineNumber, column, errorObj) {\n                    hps.Messages.post({\n                        action: 'error',\n                        data: {\n                            column: column,\n                            errorMsg: errorMsg,\n                            lineNumber: lineNumber,\n                            url: url\n                        }\n                    }, 'parent');\n                    return true;\n                };\n            }(this));\n            this.loadHandler = (function (hps) {\n                return function () {\n                    DOM.resizeFrame(hps);\n                    DOM.configureField(hps);\n                    var method = 'attach' + window.name.replace('card', '') + 'Events';\n                    if (Card[method]) {\n                        Card[method]('#heartland-field');\n                    }\n                };\n            }(this));\n            this.receiveMessageHandlerAddedHandler = (function (hps) {\n                return function () {\n                    hps.Messages.post({ action: 'receiveMessageHandlerAdded' }, 'parent');\n                };\n            }(this));\n            Events.addHandler(window, 'load', this.loadHandler);\n            Events.addHandler(document, 'receiveMessageHandlerAdded', this.receiveMessageHandlerAddedHandler);\n            Frames.monitorFieldEvents(this, 'heartland-field');\n            this.Messages.receive(Events.frameHandleWith(this), '*');\n        };\n        ;\n        /**\n         * Heartland.HPS.resizeIFrame\n         *\n         * Called automatically when the child iframe window alerts the parent to\n         * resize.\n         *\n         * @param {HTMLIFrameElement} frame\n         * @param {string} height\n         */\n        HPS.prototype.resizeIFrame = function (frame, height) {\n            if (!frame) {\n                return;\n            }\n            frame.style.height = (parseInt(height, 10)) + 'px';\n        };\n        ;\n        /**\n         * Heartland.HPS.setText\n         *\n         * Public API for setting an element's inner text.\n         *\n         * @param {string} elementid\n         * @param {string} elementtext\n         */\n        HPS.prototype.setText = function (elementid, elementtext) {\n            this.Messages.post({ action: 'setText', id: elementid, text: elementtext }, 'child');\n        };\n        ;\n        /**\n         * Heartland.HPS.setStyle\n         *\n         * Public API for setting an element's style.\n         *\n         * @param {string} elementid\n         * @param {string} elementstyle\n         */\n        HPS.prototype.setStyle = function (elementid, elementstyle) {\n            this.Messages.post({ action: 'setStyle', id: elementid, style: elementstyle }, 'child');\n        };\n        ;\n        /**\n         * Heartland.HPS.appendStyle\n         *\n         * Public API for appending to an element's style.\n         *\n         * @param {string} elementid\n         * @param {string} elementstyle\n         */\n        HPS.prototype.appendStyle = function (elementid, elementstyle) {\n            this.Messages.post({ action: 'appendStyle', id: elementid, style: elementstyle }, 'child');\n        };\n        ;\n        /**\n         * Heartland.HPS.setFocus\n         *\n         * Public API for appending to an element's style.\n         *\n         * @param {string} elementid\n         */\n        HPS.prototype.setFocus = function (elementid) {\n            this.Messages.post({ action: 'setFocus' }, elementid);\n        };\n        ;\n        /**\n         * Heartland.HPS.dispose\n         *\n         * Removes all iframes and event listeners from the DOM.\n         */\n        HPS.prototype.dispose = function () {\n            this.Messages.dispose();\n            this.Messages = null;\n            if (this.frames.cardNumber && this.frames.cardNumber.targetNode) {\n                this.removeNode(this.frames.cardNumber.frame);\n            }\n            if (this.frames.cardExpiration && this.frames.cardExpiration.frame) {\n                this.removeNode(this.frames.cardExpiration.frame);\n            }\n            if (this.frames.cardCvv && this.frames.cardCvv.frame) {\n                this.removeNode(this.frames.cardCvv.frame);\n            }\n            if (this.frames.child && this.frames.child.frame) {\n                this.removeNode(this.frames.child.frame);\n            }\n            if (this.clickHandler) {\n                Events.removeHandler(this.options.buttonTarget, 'click', this.clickHandler);\n            }\n            if (this.loadHandler) {\n                Events.removeHandler(window, 'load', this.loadHandler);\n            }\n            if (this.receiveMessageHandlerAddedHandler) {\n                Events.removeHandler(document, 'receiveMessageHandlerAdded', this.receiveMessageHandlerAddedHandler);\n            }\n        };\n        ;\n        HPS.prototype.removeNode = function (node) {\n            if (node.remove) {\n                node.remove();\n            }\n            else if (node.parentNode && node.parentNode.removeChild) {\n                node.parentNode.removeChild(node);\n            }\n        };\n        return HPS;\n    }());\n    \n    var Validator = {\n        CardNumber: CardNumber$1,\n        Cvv: Cvv,\n        Expiration: Expiration$1\n    };\n    \n    window.HPS = HPS;\n    var index = {\n        Ajax: Ajax,\n        Card: Card,\n        DOM: DOM,\n        Events: Events,\n        Formatter: Formatter,\n        Frames: Frames,\n        HPS: HPS,\n        JSON: JSON2,\n        Messages: Messages,\n        Styles: Styles,\n        Util: Util,\n        Validator: Validator\n    };\n    \n    return index;\n    \n    }());\n    //# sourceMappingURL=securesubmit.js.map\n    export default Heartland;"]}]}