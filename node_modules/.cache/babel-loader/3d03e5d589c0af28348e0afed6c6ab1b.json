{"remainingRequest":"/home/vignesh/DIVRT/revamp-guest-webapp/node_modules/thread-loader/dist/cjs.js!/home/vignesh/DIVRT/revamp-guest-webapp/node_modules/babel-loader/lib/index.js!/home/vignesh/DIVRT/revamp-guest-webapp/node_modules/eslint-loader/index.js??ref--13-0!/home/vignesh/DIVRT/revamp-guest-webapp/src/plugins/securesubmit.js","dependencies":[{"path":"/home/vignesh/DIVRT/revamp-guest-webapp/src/plugins/securesubmit.js","mtime":1673262692530},{"path":"/home/vignesh/DIVRT/revamp-guest-webapp/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vignesh/DIVRT/revamp-guest-webapp/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vignesh/DIVRT/revamp-guest-webapp/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/vignesh/DIVRT/revamp-guest-webapp/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF90eXBlb2YgZnJvbSAiL2hvbWUvdmlnbmVzaC9ESVZSVC9yZXZhbXAtZ3Vlc3Qtd2ViYXBwL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS90eXBlb2YiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5udW1iZXIuY29uc3RydWN0b3IuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuZXhlYy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5yZXBsYWNlLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc2xpY2UuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLnRvLXN0cmluZy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi51cmwudG8tanNvbi5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmpvaW4uanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuc3BsaXQuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcubWF0Y2guanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5mdW5jdGlvbi5uYW1lLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0LmpzIjsKCi8qIGVzbGludC1kaXNhYmxlICovCnZhciBIZWFydGxhbmQgPSBmdW5jdGlvbiAoKSB7CiAgJ3VzZSBzdHJpY3QnOwogIC8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgVGhpcyBmaWxlIGlzIGJhc2VkIG9uIG9yIGluY29ycG9yYXRlcyBtYXRlcmlhbCBmcm9tIHRoZSBwcm9qZWN0cyBsaXN0ZWQgYmVsb3cKICAoY29sbGVjdGl2ZWx5LCAiVGhpcmQgUGFydHkgQ29kZSIpLiBNaWNyb3NvZnQgaXMgbm90IHRoZSBvcmlnaW5hbCBhdXRob3Igb2YgdGhlCiAgVGhpcmQgUGFydHkgQ29kZS4gVGhlIG9yaWdpbmFsIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoZSBsaWNlbnNlLCB1bmRlciB3aGljaAogIE1pY3Jvc29mdCByZWNlaXZlZCBzdWNoIFRoaXJkIFBhcnR5IENvZGUsIGFyZSBzZXQgZm9ydGggYmVsb3cuIFN1Y2ggbGljZW5zZXMKICBhbmQgbm90aWNlcyBhcmUgcHJvdmlkZWQgZm9yIGluZm9ybWF0aW9uYWwgcHVycG9zZXMgb25seS4gTWljcm9zb2Z0LCBub3QgdGhlCiAgdGhpcmQgcGFydHksIGxpY2Vuc2VzIHRoZSBUaGlyZCBQYXJ0eSBDb2RlIHRvIHlvdSB1bmRlciB0aGUgdGVybXMgb2YgdGhlCiAgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wLiBTZWUgTGljZW5zZS50eHQgaW4gdGhlIHByb2plY3Qgcm9vdCBmb3IgY29tcGxldGUKICBsaWNlbnNlIGluZm9ybWF0aW9uLiBNaWNyb3NvZnQgcmVzZXJ2ZXMgYWxsIHJpZ2h0cyBub3QgZXhwcmVzc2x5IGdyYW50ZWQgdW5kZXIKICB0aGUgQXBhY2hlIDIuMCBMaWNlbnNlLCB3aGV0aGVyIGJ5IGltcGxpY2F0aW9uLCBlc3RvcHBlbCBvciBvdGhlcndpc2UuCiAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi8KCiAgLyoKICAgICAganNvbjIuanMKICAgICAgMjAxMS0xMC0xOQogIAogICAgICBQdWJsaWMgRG9tYWluLgogIAogICAgICBOTyBXQVJSQU5UWSBFWFBSRVNTRUQgT1IgSU1QTElFRC4gVVNFIEFUIFlPVVIgT1dOIFJJU0suCiAgCiAgICAgIFNlZSBodHRwOi8vd3d3LkpTT04ub3JnL2pzLmh0bWwKICAKICAKICAgICAgVGhpcyBjb2RlIHNob3VsZCBiZSBtaW5pZmllZCBiZWZvcmUgZGVwbG95bWVudC4KICAgICAgU2VlIGh0dHA6Ly9qYXZhc2NyaXB0LmNyb2NrZm9yZC5jb20vanNtaW4uaHRtbAogIAogICAgICBVU0UgWU9VUiBPV04gQ09QWS4gSVQgSVMgRVhUUkVNRUxZIFVOV0lTRSBUTyBMT0FEIENPREUgRlJPTSBTRVJWRVJTIFlPVSBETwogICAgICBOT1QgQ09OVFJPTC4KICAKICAKICAgICAgVGhpcyBmaWxlIGNyZWF0ZXMgYSBnbG9iYWwgSlNPTiBvYmplY3QgY29udGFpbmluZyB0d28gbWV0aG9kczogc3RyaW5naWZ5CiAgICAgIGFuZCBwYXJzZS4KICAKICAgICAgICAgIEpTT04uc3RyaW5naWZ5KHZhbHVlLCByZXBsYWNlciwgc3BhY2UpCiAgICAgICAgICAgICAgdmFsdWUgICAgICAgYW55IEphdmFTY3JpcHQgdmFsdWUsIHVzdWFsbHkgYW4gb2JqZWN0IG9yIGFycmF5LgogIAogICAgICAgICAgICAgIHJlcGxhY2VyICAgIGFuIG9wdGlvbmFsIHBhcmFtZXRlciB0aGF0IGRldGVybWluZXMgaG93IG9iamVjdAogICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlcyBhcmUgc3RyaW5naWZpZWQgZm9yIG9iamVjdHMuIEl0IGNhbiBiZSBhCiAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gb3IgYW4gYXJyYXkgb2Ygc3RyaW5ncy4KICAKICAgICAgICAgICAgICBzcGFjZSAgICAgICBhbiBvcHRpb25hbCBwYXJhbWV0ZXIgdGhhdCBzcGVjaWZpZXMgdGhlIGluZGVudGF0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgICAgb2YgbmVzdGVkIHN0cnVjdHVyZXMuIElmIGl0IGlzIG9taXR0ZWQsIHRoZSB0ZXh0IHdpbGwKICAgICAgICAgICAgICAgICAgICAgICAgICBiZSBwYWNrZWQgd2l0aG91dCBleHRyYSB3aGl0ZXNwYWNlLiBJZiBpdCBpcyBhIG51bWJlciwKICAgICAgICAgICAgICAgICAgICAgICAgICBpdCB3aWxsIHNwZWNpZnkgdGhlIG51bWJlciBvZiBzcGFjZXMgdG8gaW5kZW50IGF0IGVhY2gKICAgICAgICAgICAgICAgICAgICAgICAgICBsZXZlbC4gSWYgaXQgaXMgYSBzdHJpbmcgKHN1Y2ggYXMgJ1x0JyBvciAnJm5ic3A7JyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgaXQgY29udGFpbnMgdGhlIGNoYXJhY3RlcnMgdXNlZCB0byBpbmRlbnQgYXQgZWFjaCBsZXZlbC4KICAKICAgICAgICAgICAgICBUaGlzIG1ldGhvZCBwcm9kdWNlcyBhIEpTT04gdGV4dCBmcm9tIGEgSmF2YVNjcmlwdCB2YWx1ZS4KICAKICAgICAgICAgICAgICBXaGVuIGFuIG9iamVjdCB2YWx1ZSBpcyBmb3VuZCwgaWYgdGhlIG9iamVjdCBjb250YWlucyBhIHRvSlNPTgogICAgICAgICAgICAgIG1ldGhvZCwgaXRzIHRvSlNPTiBtZXRob2Qgd2lsbCBiZSBjYWxsZWQgYW5kIHRoZSByZXN1bHQgd2lsbCBiZQogICAgICAgICAgICAgIHN0cmluZ2lmaWVkLiBBIHRvSlNPTiBtZXRob2QgZG9lcyBub3Qgc2VyaWFsaXplOiBpdCByZXR1cm5zIHRoZQogICAgICAgICAgICAgIHZhbHVlIHJlcHJlc2VudGVkIGJ5IHRoZSBuYW1lL3ZhbHVlIHBhaXIgdGhhdCBzaG91bGQgYmUgc2VyaWFsaXplZCwKICAgICAgICAgICAgICBvciB1bmRlZmluZWQgaWYgbm90aGluZyBzaG91bGQgYmUgc2VyaWFsaXplZC4gVGhlIHRvSlNPTiBtZXRob2QKICAgICAgICAgICAgICB3aWxsIGJlIHBhc3NlZCB0aGUga2V5IGFzc29jaWF0ZWQgd2l0aCB0aGUgdmFsdWUsIGFuZCB0aGlzIHdpbGwgYmUKICAgICAgICAgICAgICBib3VuZCB0byB0aGUgdmFsdWUKICAKICAgICAgICAgICAgICBGb3IgZXhhbXBsZSwgdGhpcyB3b3VsZCBzZXJpYWxpemUgRGF0ZXMgYXMgSVNPIHN0cmluZ3MuCiAgCiAgICAgICAgICAgICAgICAgIERhdGUucHJvdG90eXBlLnRvSlNPTiA9IGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGYobikgewogICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZvcm1hdCBpbnRlZ2VycyB0byBoYXZlIGF0IGxlYXN0IHR3byBkaWdpdHMuCiAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG4gPCAxMCA/ICcwJyArIG4gOiBuOwogICAgICAgICAgICAgICAgICAgICAgfQogIAogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0VVRDRnVsbFllYXIoKSAgICsgJy0nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgZih0aGlzLmdldFVUQ01vbnRoKCkgKyAxKSArICctJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgIGYodGhpcy5nZXRVVENEYXRlKCkpICAgICAgKyAnVCcgKwogICAgICAgICAgICAgICAgICAgICAgICAgICBmKHRoaXMuZ2V0VVRDSG91cnMoKSkgICAgICsgJzonICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgZih0aGlzLmdldFVUQ01pbnV0ZXMoKSkgICArICc6JyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgIGYodGhpcy5nZXRVVENTZWNvbmRzKCkpICAgKyAnWic7CiAgICAgICAgICAgICAgICAgIH07CiAgCiAgICAgICAgICAgICAgWW91IGNhbiBwcm92aWRlIGFuIG9wdGlvbmFsIHJlcGxhY2VyIG1ldGhvZC4gSXQgd2lsbCBiZSBwYXNzZWQgdGhlCiAgICAgICAgICAgICAga2V5IGFuZCB2YWx1ZSBvZiBlYWNoIG1lbWJlciwgd2l0aCB0aGlzIGJvdW5kIHRvIHRoZSBjb250YWluaW5nCiAgICAgICAgICAgICAgb2JqZWN0LiBUaGUgdmFsdWUgdGhhdCBpcyByZXR1cm5lZCBmcm9tIHlvdXIgbWV0aG9kIHdpbGwgYmUKICAgICAgICAgICAgICBzZXJpYWxpemVkLiBJZiB5b3VyIG1ldGhvZCByZXR1cm5zIHVuZGVmaW5lZCwgdGhlbiB0aGUgbWVtYmVyIHdpbGwKICAgICAgICAgICAgICBiZSBleGNsdWRlZCBmcm9tIHRoZSBzZXJpYWxpemF0aW9uLgogIAogICAgICAgICAgICAgIElmIHRoZSByZXBsYWNlciBwYXJhbWV0ZXIgaXMgYW4gYXJyYXkgb2Ygc3RyaW5ncywgdGhlbiBpdCB3aWxsIGJlCiAgICAgICAgICAgICAgdXNlZCB0byBzZWxlY3QgdGhlIG1lbWJlcnMgdG8gYmUgc2VyaWFsaXplZC4gSXQgZmlsdGVycyB0aGUgcmVzdWx0cwogICAgICAgICAgICAgIHN1Y2ggdGhhdCBvbmx5IG1lbWJlcnMgd2l0aCBrZXlzIGxpc3RlZCBpbiB0aGUgcmVwbGFjZXIgYXJyYXkgYXJlCiAgICAgICAgICAgICAgc3RyaW5naWZpZWQuCiAgCiAgICAgICAgICAgICAgVmFsdWVzIHRoYXQgZG8gbm90IGhhdmUgSlNPTiByZXByZXNlbnRhdGlvbnMsIHN1Y2ggYXMgdW5kZWZpbmVkIG9yCiAgICAgICAgICAgICAgZnVuY3Rpb25zLCB3aWxsIG5vdCBiZSBzZXJpYWxpemVkLiBTdWNoIHZhbHVlcyBpbiBvYmplY3RzIHdpbGwgYmUKICAgICAgICAgICAgICBkcm9wcGVkOyBpbiBhcnJheXMgdGhleSB3aWxsIGJlIHJlcGxhY2VkIHdpdGggbnVsbC4gWW91IGNhbiB1c2UKICAgICAgICAgICAgICBhIHJlcGxhY2VyIGZ1bmN0aW9uIHRvIHJlcGxhY2UgdGhvc2Ugd2l0aCBKU09OIHZhbHVlcy4KICAgICAgICAgICAgICBKU09OLnN0cmluZ2lmeSh1bmRlZmluZWQpIHJldHVybnMgdW5kZWZpbmVkLgogIAogICAgICAgICAgICAgIFRoZSBvcHRpb25hbCBzcGFjZSBwYXJhbWV0ZXIgcHJvZHVjZXMgYSBzdHJpbmdpZmljYXRpb24gb2YgdGhlCiAgICAgICAgICAgICAgdmFsdWUgdGhhdCBpcyBmaWxsZWQgd2l0aCBsaW5lIGJyZWFrcyBhbmQgaW5kZW50YXRpb24gdG8gbWFrZSBpdAogICAgICAgICAgICAgIGVhc2llciB0byByZWFkLgogIAogICAgICAgICAgICAgIElmIHRoZSBzcGFjZSBwYXJhbWV0ZXIgaXMgYSBub24tZW1wdHkgc3RyaW5nLCB0aGVuIHRoYXQgc3RyaW5nIHdpbGwKICAgICAgICAgICAgICBiZSB1c2VkIGZvciBpbmRlbnRhdGlvbi4gSWYgdGhlIHNwYWNlIHBhcmFtZXRlciBpcyBhIG51bWJlciwgdGhlbgogICAgICAgICAgICAgIHRoZSBpbmRlbnRhdGlvbiB3aWxsIGJlIHRoYXQgbWFueSBzcGFjZXMuCiAgCiAgICAgICAgICAgICAgRXhhbXBsZToKICAKICAgICAgICAgICAgICB0ZXh0ID0gSlNPTi5zdHJpbmdpZnkoWydlJywge3BsdXJpYnVzOiAndW51bSd9XSk7CiAgICAgICAgICAgICAgLy8gdGV4dCBpcyAnWyJlIix7InBsdXJpYnVzIjoidW51bSJ9XScKICAKICAKICAgICAgICAgICAgICB0ZXh0ID0gSlNPTi5zdHJpbmdpZnkoWydlJywge3BsdXJpYnVzOiAndW51bSd9XSwgbnVsbCwgJ1x0Jyk7CiAgICAgICAgICAgICAgLy8gdGV4dCBpcyAnW1xuXHQiZSIsXG5cdHtcblx0XHQicGx1cmlidXMiOiAidW51bSJcblx0fVxuXScKICAKICAgICAgICAgICAgICB0ZXh0ID0gSlNPTi5zdHJpbmdpZnkoW25ldyBEYXRlKCldLCBmdW5jdGlvbiAoa2V5LCB2YWx1ZSkgewogICAgICAgICAgICAgICAgICByZXR1cm4gdGhpc1trZXldIGluc3RhbmNlb2YgRGF0ZSA/CiAgICAgICAgICAgICAgICAgICAgICAnRGF0ZSgnICsgdGhpc1trZXldICsgJyknIDogdmFsdWU7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgLy8gdGV4dCBpcyAnWyJEYXRlKC0tLWN1cnJlbnQgdGltZS0tLSkiXScKICAKICAKICAgICAgICAgIEpTT04ucGFyc2UodGV4dCwgcmV2aXZlcikKICAgICAgICAgICAgICBUaGlzIG1ldGhvZCBwYXJzZXMgYSBKU09OIHRleHQgdG8gcHJvZHVjZSBhbiBvYmplY3Qgb3IgYXJyYXkuCiAgICAgICAgICAgICAgSXQgY2FuIHRocm93IGEgU3ludGF4RXJyb3IgZXhjZXB0aW9uLgogIAogICAgICAgICAgICAgIFRoZSBvcHRpb25hbCByZXZpdmVyIHBhcmFtZXRlciBpcyBhIGZ1bmN0aW9uIHRoYXQgY2FuIGZpbHRlciBhbmQKICAgICAgICAgICAgICB0cmFuc2Zvcm0gdGhlIHJlc3VsdHMuIEl0IHJlY2VpdmVzIGVhY2ggb2YgdGhlIGtleXMgYW5kIHZhbHVlcywKICAgICAgICAgICAgICBhbmQgaXRzIHJldHVybiB2YWx1ZSBpcyB1c2VkIGluc3RlYWQgb2YgdGhlIG9yaWdpbmFsIHZhbHVlLgogICAgICAgICAgICAgIElmIGl0IHJldHVybnMgd2hhdCBpdCByZWNlaXZlZCwgdGhlbiB0aGUgc3RydWN0dXJlIGlzIG5vdCBtb2RpZmllZC4KICAgICAgICAgICAgICBJZiBpdCByZXR1cm5zIHVuZGVmaW5lZCB0aGVuIHRoZSBtZW1iZXIgaXMgZGVsZXRlZC4KICAKICAgICAgICAgICAgICBFeGFtcGxlOgogIAogICAgICAgICAgICAgIC8vIFBhcnNlIHRoZSB0ZXh0LiBWYWx1ZXMgdGhhdCBsb29rIGxpa2UgSVNPIGRhdGUgc3RyaW5ncyB3aWxsCiAgICAgICAgICAgICAgLy8gYmUgY29udmVydGVkIHRvIERhdGUgb2JqZWN0cy4KICAKICAgICAgICAgICAgICBteURhdGEgPSBKU09OLnBhcnNlKHRleHQsIGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7CiAgICAgICAgICAgICAgICAgIGxldCBhOwogICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykgewogICAgICAgICAgICAgICAgICAgICAgYSA9CiAgL14oXGR7NH0pLShcZHsyfSktKFxkezJ9KVQoXGR7Mn0pOihcZHsyfSk6KFxkezJ9KD86XC5cZCopPylaJC8uZXhlYyh2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRGF0ZShEYXRlLlVUQygrYVsxXSwgK2FbMl0gLSAxLCArYVszXSwgK2FbNF0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICthWzVdLCArYVs2XSkpOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgICAgICAgICB9KTsKICAKICAgICAgICAgICAgICBteURhdGEgPSBKU09OLnBhcnNlKCdbIkRhdGUoMDkvMDkvMjAwMSkiXScsIGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7CiAgICAgICAgICAgICAgICAgIGxldCBkOwogICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJyAmJgogICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlLnNsaWNlKDAsIDUpID09PSAnRGF0ZSgnICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUuc2xpY2UoLTEpID09PSAnKScpIHsKICAgICAgICAgICAgICAgICAgICAgIGQgPSBuZXcgRGF0ZSh2YWx1ZS5zbGljZSg1LCAtMSkpOwogICAgICAgICAgICAgICAgICAgICAgaWYgKGQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZDsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgICAgICAgfSk7CiAgCiAgCiAgICAgIFRoaXMgaXMgYSByZWZlcmVuY2UgaW1wbGVtZW50YXRpb24uIFlvdSBhcmUgZnJlZSB0byBjb3B5LCBtb2RpZnksIG9yCiAgICAgIHJlZGlzdHJpYnV0ZS4KICAqLwoKICAvKmpzbGludCBldmlsOiB0cnVlLCByZWdleHA6IHRydWUgKi8KCiAgLyptZW1iZXJzICIiLCAiXGIiLCAiXHQiLCAiXG4iLCAiXGYiLCAiXHIiLCAiXCIiLCBKU09OLCAiXFwiLCBhcHBseSwKICAgICAgY2FsbCwgY2hhckNvZGVBdCwgZ2V0VVRDRGF0ZSwgZ2V0VVRDRnVsbFllYXIsIGdldFVUQ0hvdXJzLAogICAgICBnZXRVVENNaW51dGVzLCBnZXRVVENNb250aCwgZ2V0VVRDU2Vjb25kcywgaGFzT3duUHJvcGVydHksIGpvaW4sCiAgICAgIGxhc3RJbmRleCwgbGVuZ3RoLCBwYXJzZSwgcHJvdG90eXBlLCBwdXNoLCByZXBsYWNlLCBzbGljZSwgc3RyaW5naWZ5LAogICAgICB0ZXN0LCB0b0pTT04sIHRvU3RyaW5nLCB2YWx1ZU9mCiAgKi8KICAvLyBjcmVhdGUgYSBKU09OIG9iamVjdCBvbmx5IGlmIG9uZSBkb2VzIG5vdCBhbHJlYWR5IGV4aXN0LiBXZSBjcmVhdGUgdGhlCiAgLy8gbWV0aG9kcyBpbiBhIGNsb3N1cmUgdG8gYXZvaWQgY3JlYXRpbmcgZ2xvYmFsIHZhcmlhYmxlcy4KCiAgdmFyIEpTT04yID0ge307CgogIChmdW5jdGlvbiAoKSB7CiAgICAndXNlIHN0cmljdCc7CgogICAgZnVuY3Rpb24gZihuKSB7CiAgICAgIC8vIGZvcm1hdCBpbnRlZ2VycyB0byBoYXZlIGF0IGxlYXN0IHR3byBkaWdpdHMuCiAgICAgIHJldHVybiBuIDwgMTAgPyAnMCcgKyBuIDogbjsKICAgIH0KCiAgICBpZiAodHlwZW9mIERhdGUucHJvdG90eXBlLnRvSlNPTiAhPT0gJ2Z1bmN0aW9uJykgewogICAgICBEYXRlLnByb3RvdHlwZS50b0pTT04gPSBmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgcmV0dXJuIGlzRmluaXRlKHRoaXMudmFsdWVPZigpKSA/IHRoaXMuZ2V0VVRDRnVsbFllYXIoKSArICctJyArIGYodGhpcy5nZXRVVENNb250aCgpICsgMSkgKyAnLScgKyBmKHRoaXMuZ2V0VVRDRGF0ZSgpKSArICdUJyArIGYodGhpcy5nZXRVVENIb3VycygpKSArICc6JyArIGYodGhpcy5nZXRVVENNaW51dGVzKCkpICsgJzonICsgZih0aGlzLmdldFVUQ1NlY29uZHMoKSkgKyAnWicgOiBudWxsOwogICAgICB9OwoKICAgICAgdmFyIHN0clByb3RvID0gU3RyaW5nLnByb3RvdHlwZTsKICAgICAgdmFyIG51bVByb3RvID0gTnVtYmVyLnByb3RvdHlwZTsKCiAgICAgIG51bVByb3RvLkpTT04gPSBzdHJQcm90by5KU09OID0gQm9vbGVhbi5wcm90b3R5cGUudG9KU09OID0gZnVuY3Rpb24gKGtleSkgewogICAgICAgIHJldHVybiB0aGlzLnZhbHVlT2YoKTsKICAgICAgfTsKICAgIH0KCiAgICB2YXIgY3ggPSAvW1x1MDAwMFx1MDBhZFx1MDYwMC1cdTA2MDRcdTA3MGZcdTE3YjRcdTE3YjVcdTIwMGMtXHUyMDBmXHUyMDI4LVx1MjAyZlx1MjA2MC1cdTIwNmZcdWZlZmZcdWZmZjAtXHVmZmZmXS9nLAogICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZQogICAgZXNjID0gL1tcXFwiXHgwMC1ceDFmXHg3Zi1ceDlmXHUwMGFkXHUwNjAwLVx1MDYwNFx1MDcwZlx1MTdiNFx1MTdiNVx1MjAwYy1cdTIwMGZcdTIwMjgtXHUyMDJmXHUyMDYwLVx1MjA2Zlx1ZmVmZlx1ZmZmMC1cdWZmZmZdL2csCiAgICAgICAgZ2FwLAogICAgICAgIGluZGVudCwKICAgICAgICBtZXRhID0gewogICAgICAnXGInOiAnXFxiJywKICAgICAgJ1x0JzogJ1xcdCcsCiAgICAgICdcbic6ICdcXG4nLAogICAgICAnXGYnOiAnXFxmJywKICAgICAgJ1xyJzogJ1xccicsCiAgICAgICciJzogJ1xcIicsCiAgICAgICdcXCc6ICdcXFxcJwogICAgfSwKICAgICAgICByZXA7CgogICAgZnVuY3Rpb24gcXVvdGUoc3RyaW5nKSB7CiAgICAgIC8vIGlmIHRoZSBzdHJpbmcgY29udGFpbnMgbm8gY29udHJvbCBjaGFyYWN0ZXJzLCBubyBxdW90ZSBjaGFyYWN0ZXJzLCBhbmQgbm8KICAgICAgLy8gYmFja3NsYXNoIGNoYXJhY3RlcnMsIHRoZW4gd2UgY2FuIHNhZmVseSBzbGFwIHNvbWUgcXVvdGVzIGFyb3VuZCBpdC4KICAgICAgLy8gb3RoZXJ3aXNlIHdlIG11c3QgYWxzbyByZXBsYWNlIHRoZSBvZmZlbmRpbmcgY2hhcmFjdGVycyB3aXRoIHNhZmUgZXNjYXBlCiAgICAgIC8vIHNlcXVlbmNlcy4KICAgICAgZXNjLmxhc3RJbmRleCA9IDA7CiAgICAgIHJldHVybiBlc2MudGVzdChzdHJpbmcpID8gJyInICsgc3RyaW5nLnJlcGxhY2UoZXNjLCBmdW5jdGlvbiAoYSkgewogICAgICAgIHZhciBjID0gbWV0YVthXTsKICAgICAgICByZXR1cm4gdHlwZW9mIGMgPT09ICdzdHJpbmcnID8gYyA6ICJcXHUiICsgKCcwMDAwJyArIGEuY2hhckNvZGVBdCgwKS50b1N0cmluZygxNikpLnNsaWNlKC00KTsKICAgICAgfSkgKyAnIicgOiAnIicgKyBzdHJpbmcgKyAnIic7CiAgICB9CgogICAgZnVuY3Rpb24gc3RyKGtleSwgaG9sZGVyKSB7CiAgICAgIC8vIHByb2R1Y2UgYSBzdHJpbmcgZnJvbSBob2xkZXJba2V5XS4KICAgICAgdmFyIGksCiAgICAgICAgICAvLyB0aGUgbG9vcCBjb3VudGVyLgogICAgICBrID0gbnVsbCwKICAgICAgICAgIC8vIHRoZSBtZW1iZXIga2V5LgogICAgICB2LAogICAgICAgICAgLy8gdGhlIG1lbWJlciB2YWx1ZS4KICAgICAgbGVuZ3RoLAogICAgICAgICAgbWluZCA9IGdhcCwKICAgICAgICAgIHBhcnRpYWwsCiAgICAgICAgICB2YWx1ZSA9IGhvbGRlcltrZXldOyAvLyBpZiB0aGUgdmFsdWUgaGFzIGEgdG9KU09OIG1ldGhvZCwgY2FsbCBpdCB0byBvYnRhaW4gYSByZXBsYWNlbWVudCB2YWx1ZS4KCiAgICAgIGlmICh2YWx1ZSAmJiBfdHlwZW9mKHZhbHVlKSA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIHZhbHVlLnRvSlNPTiA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgIHZhbHVlID0gdmFsdWUudG9KU09OKGtleSk7CiAgICAgIH0gLy8gaWYgd2Ugd2VyZSBjYWxsZWQgd2l0aCBhIHJlcGxhY2VyIGZ1bmN0aW9uLCB0aGVuIGNhbGwgdGhlIHJlcGxhY2VyIHRvCiAgICAgIC8vIG9idGFpbiBhIHJlcGxhY2VtZW50IHZhbHVlLgoKCiAgICAgIGlmICh0eXBlb2YgcmVwID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgdmFsdWUgPSByZXAuY2FsbChob2xkZXIsIGtleSwgdmFsdWUpOwogICAgICB9IC8vIHdoYXQgaGFwcGVucyBuZXh0IGRlcGVuZHMgb24gdGhlIHZhbHVlJ3MgdHlwZS4KCgogICAgICBzd2l0Y2ggKF90eXBlb2YodmFsdWUpKSB7CiAgICAgICAgY2FzZSAnc3RyaW5nJzoKICAgICAgICAgIHJldHVybiBxdW90ZSh2YWx1ZSk7CgogICAgICAgIGNhc2UgJ251bWJlcic6CiAgICAgICAgICAvLyBqc29uIG51bWJlcnMgbXVzdCBiZSBmaW5pdGUuIEVuY29kZSBub24tZmluaXRlIG51bWJlcnMgYXMgbnVsbC4KICAgICAgICAgIHJldHVybiBpc0Zpbml0ZSh2YWx1ZSkgPyBTdHJpbmcodmFsdWUpIDogJ251bGwnOwoKICAgICAgICBjYXNlICdib29sZWFuJzoKICAgICAgICBjYXNlICdudWxsJzoKICAgICAgICAgIC8vIGlmIHRoZSB2YWx1ZSBpcyBhIGJvb2xlYW4gb3IgbnVsbCwgY29udmVydCBpdCB0byBhIHN0cmluZy4gTm90ZToKICAgICAgICAgIC8vIHR5cGVvZiBudWxsIGRvZXMgbm90IHByb2R1Y2UgJ251bGwnLiBUaGUgY2FzZSBpcyBpbmNsdWRlZCBoZXJlIGluCiAgICAgICAgICAvLyB0aGUgcmVtb3RlIGNoYW5jZSB0aGF0IHRoaXMgZ2V0cyBmaXhlZCBzb21lZGF5LgogICAgICAgICAgcmV0dXJuIFN0cmluZyh2YWx1ZSk7CiAgICAgICAgLy8gaWYgdGhlIHR5cGUgaXMgJ29iamVjdCcsIHdlIG1pZ2h0IGJlIGRlYWxpbmcgd2l0aCBhbiBvYmplY3Qgb3IgYW4gYXJyYXkgb3IKICAgICAgICAvLyBudWxsLgoKICAgICAgICBjYXNlICdvYmplY3QnOgogICAgICAgICAgLy8gZHVlIHRvIGEgc3BlY2lmaWNhdGlvbiBibHVuZGVyIGluIEVDTUFTY3JpcHQsIHR5cGVvZiBudWxsIGlzICdvYmplY3QnLAogICAgICAgICAgLy8gc28gd2F0Y2ggb3V0IGZvciB0aGF0IGNhc2UuCiAgICAgICAgICBpZiAoIXZhbHVlKSB7CiAgICAgICAgICAgIHJldHVybiAnbnVsbCc7CiAgICAgICAgICB9IC8vIG1ha2UgYW4gYXJyYXkgdG8gaG9sZCB0aGUgcGFydGlhbDogc3RyaW5nW10gcmVzdWx0cyBvZiBzdHJpbmdpZnlpbmcgdGhpcyBvYmplY3QgdmFsdWUuCgoKICAgICAgICAgIGdhcCArPSBpbmRlbnQ7CiAgICAgICAgICBwYXJ0aWFsID0gW107IC8vIGlzIHRoZSB2YWx1ZSBhbiBhcnJheT8KCiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5hcHBseSh2YWx1ZSwgW10pID09PSAnW29iamVjdCBBcnJheV0nKSB7CiAgICAgICAgICAgIC8vIHRoZSB2YWx1ZSBpcyBhbiBhcnJheS4gU3RyaW5naWZ5IGV2ZXJ5IGVsZW1lbnQuIFVzZSBudWxsIGFzIGEgcGxhY2Vob2xkZXIKICAgICAgICAgICAgLy8gZm9yIG5vbi1KU09OIHZhbHVlcy4KICAgICAgICAgICAgbGVuZ3RoID0gdmFsdWUubGVuZ3RoOwoKICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGxlbmd0aDsgaSArPSAxKSB7CiAgICAgICAgICAgICAgcGFydGlhbFtpXSA9IHN0cihpLnRvU3RyaW5nKCksIHZhbHVlKSB8fCAnbnVsbCc7CiAgICAgICAgICAgIH0gLy8gam9pbiBhbGwgb2YgdGhlIGVsZW1lbnRzIHRvZ2V0aGVyLCBzZXBhcmF0ZWQgd2l0aCBjb21tYXMsIGFuZCB3cmFwIHRoZW0gaW4KICAgICAgICAgICAgLy8gYnJhY2tldHMuCgoKICAgICAgICAgICAgdiA9IHBhcnRpYWwubGVuZ3RoID09PSAwID8gJ1tdJyA6IGdhcCA/ICdbXG4nICsgZ2FwICsgcGFydGlhbC5qb2luKCcsXG4nICsgZ2FwKSArICdcbicgKyBtaW5kICsgJ10nIDogJ1snICsgcGFydGlhbC5qb2luKCcsJykgKyAnXSc7CiAgICAgICAgICAgIGdhcCA9IG1pbmQ7CiAgICAgICAgICAgIHJldHVybiB2OwogICAgICAgICAgfSAvLyBpZiB0aGUgcmVwbGFjZXIgaXMgYW4gYXJyYXksIHVzZSBpdCB0byBzZWxlY3QgdGhlIG1lbWJlcnMgdG8gYmUgc3RyaW5naWZpZWQuCgoKICAgICAgICAgIGlmIChyZXAgJiYgX3R5cGVvZihyZXApID09PSAnb2JqZWN0JykgewogICAgICAgICAgICBsZW5ndGggPSByZXAubGVuZ3RoOwoKICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGxlbmd0aDsgaSArPSAxKSB7CiAgICAgICAgICAgICAgaWYgKHR5cGVvZiByZXBbaV0gPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgICAgICBrID0gcmVwW2ldOwogICAgICAgICAgICAgICAgdiA9IHN0cihrLCB2YWx1ZSk7CgogICAgICAgICAgICAgICAgaWYgKHYpIHsKICAgICAgICAgICAgICAgICAgcGFydGlhbC5wdXNoKHF1b3RlKGspICsgKGdhcCA/ICc6ICcgOiAnOicpICsgdik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBvdGhlcndpc2UsIGl0ZXJhdGUgdGhyb3VnaCBhbGwgb2YgdGhlIGtleXMgaW4gdGhlIG9iamVjdC4KICAgICAgICAgICAgZm9yIChrIGluIHZhbHVlKSB7CiAgICAgICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbCh2YWx1ZSwgaykpIHsKICAgICAgICAgICAgICAgIHYgPSBzdHIoaywgdmFsdWUpOwoKICAgICAgICAgICAgICAgIGlmICh2KSB7CiAgICAgICAgICAgICAgICAgIHBhcnRpYWwucHVzaChxdW90ZShrKSArIChnYXAgPyAnOiAnIDogJzonKSArIHYpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSAvLyBqb2luIGFsbCBvZiB0aGUgbWVtYmVyIHRleHRzIHRvZ2V0aGVyLCBzZXBhcmF0ZWQgd2l0aCBjb21tYXMsCiAgICAgICAgICAvLyBhbmQgd3JhcCB0aGVtIGluIGJyYWNlcy4KCgogICAgICAgICAgdiA9IHBhcnRpYWwubGVuZ3RoID09PSAwID8gJ3t9JyA6IGdhcCA/ICd7XG4nICsgZ2FwICsgcGFydGlhbC5qb2luKCcsXG4nICsgZ2FwKSArICdcbicgKyBtaW5kICsgJ30nIDogJ3snICsgcGFydGlhbC5qb2luKCcsJykgKyAnfSc7CiAgICAgICAgICBnYXAgPSBtaW5kOwogICAgICAgICAgcmV0dXJuIHY7CiAgICAgIH0KICAgIH0gLy8gaWYgdGhlIEpTT04gb2JqZWN0IGRvZXMgbm90IHlldCBoYXZlIGEgc3RyaW5naWZ5IG1ldGhvZCwgZ2l2ZSBpdCBvbmUuCgoKICAgIGlmICh0eXBlb2YgSlNPTjIuc3RyaW5naWZ5ICE9PSAnZnVuY3Rpb24nKSB7CiAgICAgIEpTT04yLnN0cmluZ2lmeSA9IGZ1bmN0aW9uICh2YWx1ZSwgcmVwbGFjZXIsIHNwYWNlKSB7CiAgICAgICAgLy8gdGhlIHN0cmluZ2lmeSBtZXRob2QgdGFrZXMgYSB2YWx1ZSBhbmQgYW4gb3B0aW9uYWwgcmVwbGFjZXIsIGFuZCBhbiBvcHRpb25hbAogICAgICAgIC8vIHNwYWNlIHBhcmFtZXRlciwgYW5kIHJldHVybnMgYSBKU09OIHRleHQuIFRoZSByZXBsYWNlciBjYW4gYmUgYSBmdW5jdGlvbgogICAgICAgIC8vIHRoYXQgY2FuIHJlcGxhY2UgdmFsdWVzLCBvciBhbiBhcnJheSBvZiBzdHJpbmdzIHRoYXQgd2lsbCBzZWxlY3QgdGhlIGtleXMuCiAgICAgICAgLy8gYSBkZWZhdWx0IHJlcGxhY2VyIG1ldGhvZCBjYW4gYmUgcHJvdmlkZWQuIFVzZSBvZiB0aGUgc3BhY2UgcGFyYW1ldGVyIGNhbgogICAgICAgIC8vIHByb2R1Y2UgdGV4dCB0aGF0IGlzIG1vcmUgZWFzaWx5IHJlYWRhYmxlLgogICAgICAgIHZhciBpOwogICAgICAgIGdhcCA9ICcnOwogICAgICAgIGluZGVudCA9ICcnOyAvLyBpZiB0aGUgc3BhY2UgcGFyYW1ldGVyIGlzIGEgbnVtYmVyLCBtYWtlIGFuIGluZGVudCBzdHJpbmcgY29udGFpbmluZyB0aGF0CiAgICAgICAgLy8gbWFueSBzcGFjZXMuCgogICAgICAgIGlmICh0eXBlb2Ygc3BhY2UgPT09ICdudW1iZXInKSB7CiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgc3BhY2U7IGkgKz0gMSkgewogICAgICAgICAgICBpbmRlbnQgKz0gJyAnOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHNwYWNlID09PSAnc3RyaW5nJykgewogICAgICAgICAgaW5kZW50ID0gc3BhY2U7CiAgICAgICAgfSAvLyBpZiB0aGVyZSBpcyBhIHJlcGxhY2VyLCBpdCBtdXN0IGJlIGEgZnVuY3Rpb24gb3IgYW4gYXJyYXkuCiAgICAgICAgLy8gb3RoZXJ3aXNlLCB0aHJvdyBhbiBlcnJvci4KCgogICAgICAgIHJlcCA9IHJlcGxhY2VyOwoKICAgICAgICBpZiAocmVwbGFjZXIgJiYgdHlwZW9mIHJlcGxhY2VyICE9PSAnZnVuY3Rpb24nICYmIChfdHlwZW9mKHJlcGxhY2VyKSAhPT0gJ29iamVjdCcgfHwgdHlwZW9mIHJlcGxhY2VyLmxlbmd0aCAhPT0gJ251bWJlcicpKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0pTT04uc3RyaW5naWZ5Jyk7CiAgICAgICAgfSAvLyBtYWtlIGEgZmFrZSByb290IG9iamVjdCBjb250YWluaW5nIG91ciB2YWx1ZSB1bmRlciB0aGUga2V5IG9mICcnLgogICAgICAgIC8vIHJldHVybiB0aGUgcmVzdWx0IG9mIHN0cmluZ2lmeWluZyB0aGUgdmFsdWUuCgoKICAgICAgICByZXR1cm4gc3RyKCcnLCB7CiAgICAgICAgICAnJzogdmFsdWUKICAgICAgICB9KTsKICAgICAgfTsKICAgIH0gLy8gaWYgdGhlIEpTT04gb2JqZWN0IGRvZXMgbm90IHlldCBoYXZlIGEgcGFyc2UgbWV0aG9kLCBnaXZlIGl0IG9uZS4KCgogICAgaWYgKHR5cGVvZiBKU09OMi5wYXJzZSAhPT0gJ2Z1bmN0aW9uJykgewogICAgICBKU09OMi5wYXJzZSA9IGZ1bmN0aW9uICh0ZXh0LCByZXZpdmVyKSB7CiAgICAgICAgLy8gdGhlIHBhcnNlIG1ldGhvZCB0YWtlcyBhIHRleHQgYW5kIGFuIG9wdGlvbmFsIHJldml2ZXIgZnVuY3Rpb24sIGFuZCByZXR1cm5zCiAgICAgICAgLy8gYSBKYXZhU2NyaXB0IHZhbHVlIGlmIHRoZSB0ZXh0IGlzIGEgdmFsaWQgSlNPTiB0ZXh0LgogICAgICAgIHZhciBqOwoKICAgICAgICBmdW5jdGlvbiB3YWxrKGhvbGRlciwga2V5KSB7CiAgICAgICAgICAvLyB0aGUgd2FsayBtZXRob2QgaXMgdXNlZCB0byByZWN1cnNpdmVseSB3YWxrIHRoZSByZXN1bHRpbmcgc3RydWN0dXJlIHNvCiAgICAgICAgICAvLyB0aGF0IG1vZGlmaWNhdGlvbnMgY2FuIGJlIG1hZGUuCiAgICAgICAgICB2YXIgayA9IG51bGwsCiAgICAgICAgICAgICAgdiwKICAgICAgICAgICAgICB2YWx1ZSA9IGhvbGRlcltrZXldOwoKICAgICAgICAgIGlmICh2YWx1ZSAmJiBfdHlwZW9mKHZhbHVlKSA9PT0gJ29iamVjdCcpIHsKICAgICAgICAgICAgZm9yIChrIGluIHZhbHVlKSB7CiAgICAgICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbCh2YWx1ZSwgaykpIHsKICAgICAgICAgICAgICAgIHYgPSB3YWxrKHZhbHVlLCBrKTsKCiAgICAgICAgICAgICAgICBpZiAodiAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgIHZhbHVlW2tdID0gdjsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIHZhbHVlW2tdID0gdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiByZXZpdmVyLmNhbGwoaG9sZGVyLCBrZXksIHZhbHVlKTsKICAgICAgICB9IC8vIHBhcnNpbmcgaGFwcGVucyBpbiBmb3VyIHN0YWdlcy4gSW4gdGhlIGZpcnN0IHN0YWdlLCB3ZSByZXBsYWNlIGNlcnRhaW4KICAgICAgICAvLyB1bmljb2RlIGNoYXJhY3RlcnMgd2l0aCBlc2NhcGUgc2VxdWVuY2VzLiBKYXZhU2NyaXB0IGhhbmRsZXMgbWFueSBjaGFyYWN0ZXJzCiAgICAgICAgLy8gaW5jb3JyZWN0bHksIGVpdGhlciBzaWxlbnRseSBkZWxldGluZyB0aGVtLCBvciB0cmVhdGluZyB0aGVtIGFzIGxpbmUgZW5kaW5ncy4KCgogICAgICAgIHRleHQgPSBTdHJpbmcodGV4dCk7CiAgICAgICAgY3gubGFzdEluZGV4ID0gMDsKCiAgICAgICAgaWYgKGN4LnRlc3QodGV4dCkpIHsKICAgICAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoY3gsIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICAgIHJldHVybiAiXFx1IiArICgnMDAwMCcgKyBhLmNoYXJDb2RlQXQoMCkudG9TdHJpbmcoMTYpKS5zbGljZSgtNCk7CiAgICAgICAgICB9KTsKICAgICAgICB9IC8vIGluIHRoZSBzZWNvbmQgc3RhZ2UsIHdlIHJ1biB0aGUgdGV4dCBhZ2FpbnN0IHJlZ3VsYXIgZXhwcmVzc2lvbnMgdGhhdCBsb29rCiAgICAgICAgLy8gZm9yIG5vbi1KU09OIHBhdHRlcm5zLiBXZSBhcmUgZXNwZWNpYWxseSBjb25jZXJuZWQgd2l0aCAnKCknIGFuZCAnbmV3JwogICAgICAgIC8vIGJlY2F1c2UgdGhleSBjYW4gY2F1c2UgaW52b2NhdGlvbiwgYW5kICc9JyBiZWNhdXNlIGl0IGNhbiBjYXVzZSBtdXRhdGlvbi4KICAgICAgICAvLyBidXQganVzdCB0byBiZSBzYWZlLCB3ZSB3YW50IHRvIHJlamVjdCBhbGwgdW5leHBlY3RlZCBmb3Jtcy4KICAgICAgICAvLyB3ZSBzcGxpdCB0aGUgc2Vjb25kIHN0YWdlIGludG8gNCByZWdleHAgb3BlcmF0aW9ucyBpbiBvcmRlciB0byB3b3JrIGFyb3VuZAogICAgICAgIC8vIGNyaXBwbGluZyBpbmVmZmljaWVuY2llcyBpbiBJRSdzIGFuZCBTYWZhcmkncyByZWdleHAgZW5naW5lcy4gRmlyc3Qgd2UKICAgICAgICAvLyByZXBsYWNlIHRoZSBKU09OIGJhY2tzbGFzaCBwYWlycyB3aXRoICdAJyAoYSBub24tSlNPTiBjaGFyYWN0ZXIpLiBTZWNvbmQsIHdlCiAgICAgICAgLy8gcmVwbGFjZSBhbGwgc2ltcGxlIHZhbHVlIHRva2VucyB3aXRoICddJyBjaGFyYWN0ZXJzLiBUaGlyZCwgd2UgZGVsZXRlIGFsbAogICAgICAgIC8vIG9wZW4gYnJhY2tldHMgdGhhdCBmb2xsb3cgYSBjb2xvbiBvciBjb21tYSBvciB0aGF0IGJlZ2luIHRoZSB0ZXh0LiBGaW5hbGx5LAogICAgICAgIC8vIHdlIGxvb2sgdG8gc2VlIHRoYXQgdGhlIHJlbWFpbmluZyBjaGFyYWN0ZXJzIGFyZSBvbmx5IHdoaXRlc3BhY2Ugb3IgJ10nIG9yCiAgICAgICAgLy8gJywnIG9yICc6JyBvciAneycgb3IgJ30nLiBJZiB0aGF0IGlzIHNvLCB0aGVuIHRoZSB0ZXh0IGlzIHNhZmUgZm9yIGV2YWwuCgoKICAgICAgICBpZiAoL15bXF0sOnt9XHNdKiQvLnRlc3QodGV4dC5yZXBsYWNlKC9cXCg/OlsiXFxcL2JmbnJ0XXx1WzAtOWEtZkEtRl17NH0pL2csICdAJykucmVwbGFjZSgvIlteIlxcXG5ccl0qInx0cnVlfGZhbHNlfG51bGx8LT9cZCsoPzpcLlxkKik/KD86W2VFXVsrXC1dP1xkKyk/L2csICddJykucmVwbGFjZSgvKD86Xnw6fCwpKD86XHMqXFspKy9nLCAnJykpKSB7CiAgICAgICAgICAvLyBpbiB0aGUgdGhpcmQgc3RhZ2Ugd2UgdXNlIHRoZSBldmFsIGZ1bmN0aW9uIHRvIGNvbXBpbGUgdGhlIHRleHQgaW50byBhCiAgICAgICAgICAvLyBqYXZhc2NyaXB0IHN0cnVjdHVyZS4gVGhlICd7JyBvcGVyYXRvciBpcyBzdWJqZWN0IHRvIGEgc3ludGFjdGljIGFtYmlndWl0eQogICAgICAgICAgLy8gaW4gSmF2YVNjcmlwdDogaXQgY2FuIGJlZ2luIGEgYmxvY2sgb3IgYW4gb2JqZWN0IGxpdGVyYWwuIFdlIHdyYXAgdGhlIHRleHQKICAgICAgICAgIC8vIGluIHBhcmVucyB0byBlbGltaW5hdGUgdGhlIGFtYmlndWl0eS4KICAgICAgICAgIGogPSBuZXcgRnVuY3Rpb24oJ3JldHVybiAoJyArIHRleHQgKyAnKScpKCk7IC8vIGluIHRoZSBvcHRpb25hbCBmb3VydGggc3RhZ2UsIHdlIHJlY3Vyc2l2ZWx5IHdhbGsgdGhlIG5ldyBzdHJ1Y3R1cmUsIHBhc3NpbmcKICAgICAgICAgIC8vIGVhY2ggbmFtZS92YWx1ZSBwYWlyIHRvIGEgcmV2aXZlciBmdW5jdGlvbiBmb3IgcG9zc2libGUgdHJhbnNmb3JtYXRpb24uCgogICAgICAgICAgcmV0dXJuIHR5cGVvZiByZXZpdmVyID09PSAnZnVuY3Rpb24nID8gd2Fsayh7CiAgICAgICAgICAgICcnOiBqCiAgICAgICAgICB9LCAnJykgOiBqOwogICAgICAgIH0gLy8gaWYgdGhlIHRleHQgaXMgbm90IEpTT04gcGFyc2VhYmxlLCB0aGVuIGEgU3ludGF4RXJyb3IgaXMgdGhyb3duLgoKCiAgICAgICAgdGhyb3cgbmV3IFN5bnRheEVycm9yKCdKU09OLnBhcnNlJyk7CiAgICAgIH07CiAgICB9CiAgfSkoKTsKCiAgdmFyIEpzb25wUmVxdWVzdCA9IGZ1bmN0aW9uICgpIHsKICAgIGZ1bmN0aW9uIEpzb25wUmVxdWVzdCh1cmwsIHBheWxvYWQpIHsKICAgICAgaWYgKHVybCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdXJsID0gIiI7CiAgICAgIH0KCiAgICAgIGlmIChwYXlsb2FkID09PSB2b2lkIDApIHsKICAgICAgICBwYXlsb2FkID0gIiI7CiAgICAgIH0KCiAgICAgIHRoaXMudXJsID0gdXJsOwogICAgICB0aGlzLnBheWxvYWQgPSBwYXlsb2FkOwogICAgICB0aGlzLnR5cGUgPSAianNvbnAiOwogICAgfQoKICAgIHJldHVybiBKc29ucFJlcXVlc3Q7CiAgfSgpOwoKICB2YXIgTnVsbFJlcXVlc3QgPSBmdW5jdGlvbiAoKSB7CiAgICBmdW5jdGlvbiBOdWxsUmVxdWVzdChwYXlsb2FkKSB7CiAgICAgIGlmIChwYXlsb2FkID09PSB2b2lkIDApIHsKICAgICAgICBwYXlsb2FkID0ge307CiAgICAgIH0KCiAgICAgIHRoaXMucGF5bG9hZCA9IHBheWxvYWQ7CiAgICAgIHRoaXMudHlwZSA9ICJudWxsIjsKICAgIH0KCiAgICByZXR1cm4gTnVsbFJlcXVlc3Q7CiAgfSgpOwogIC8qKgogICAqIEBuYW1lc3BhY2UgSGVhcnRsYW5kLkFqYXgKICAgKi8KCgogIHZhciBBamF4ID0gZnVuY3Rpb24gKCkgewogICAgZnVuY3Rpb24gQWpheCgpIHt9CiAgICAvKioKICAgICAqIEhlYXJ0bGFuZC5BamF4Lmpzb25wCiAgICAgKgogICAgICogQ3JlYXRlcyBhIG5ldyBET00gbm9kZSBjb250YWluaW5nIGEgY3JlYXRlZCBKU09OUCBjYWxsYmFjayBoYW5kbGVyIGZvciBhbgogICAgICogaW1wZW5kaW5nIEFqYXggSlNPTlAgcmVxdWVzdC4gUmVtb3ZlcyBuZWVkIGZvciBgWE1MSHR0cFJlcXVlc3RgLgogICAgICoKICAgICAqIEBwYXJhbSB7c3RyaW5nfSB1cmwKICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IGNhbGxiYWNrCiAgICAgKi8KCgogICAgQWpheC5qc29ucCA9IGZ1bmN0aW9uIChyZXF1ZXN0LCBjYWxsYmFjaykgewogICAgICB2YXIgc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7CiAgICAgIHZhciBjYWxsYmFja05hbWUgPSAnanNvbnBfY2FsbGJhY2tfJyArIE1hdGgucm91bmQoMTAwMDAwICogTWF0aC5yYW5kb20oKSk7CgogICAgICB3aW5kb3dbY2FsbGJhY2tOYW1lXSA9IGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgd2luZG93W2NhbGxiYWNrTmFtZV0gPSB1bmRlZmluZWQ7CiAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChzY3JpcHQpOwogICAgICAgIGNhbGxiYWNrKGRhdGEpOwogICAgICB9OwoKICAgICAgc2NyaXB0LnNyYyA9IHJlcXVlc3QudXJsICsgKHJlcXVlc3QudXJsLmluZGV4T2YoJz8nKSA+PSAwID8gJyYnIDogJz8nKSArICdjYWxsYmFjaz0nICsgY2FsbGJhY2tOYW1lICsgJyYnICsgcmVxdWVzdC5wYXlsb2FkOwogICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHNjcmlwdCk7CiAgICB9OwogICAgLyoqCiAgICAgKiBIZWFydGxhbmQuQWpheC5jb3JzCiAgICAgKgogICAgICogQ3JlYXRlcyBhIG5ldyBgWE1MSHR0cFJlcXVlc3RgIG9iamVjdCBmb3IgYSBQT1NUIHJlcXVlc3QgdG8gdGhlIGdpdmVuIGB1cmxgLgogICAgICoKICAgICAqIEBwYXJhbSB7c3RyaW5nfSB1cmwKICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IGNhbGxiYWNrCiAgICAgKi8KCgogICAgQWpheC5jb3JzID0gZnVuY3Rpb24gKHJlcXVlc3QsIGNhbGxiYWNrKSB7CiAgICAgIHZhciB4aHI7CiAgICAgIHZhciBtZXRob2QgPSAnUE9TVCc7CiAgICAgIHZhciB0aW1lb3V0OwoKICAgICAgaWYgKG5ldyBYTUxIdHRwUmVxdWVzdCgpLndpdGhDcmVkZW50aWFscyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgeGhyID0gbmV3IHdpbmRvdy5YRG9tYWluUmVxdWVzdCgpOwogICAgICAgIG1ldGhvZCA9ICdHRVQnOwogICAgICAgIHJlcXVlc3QudXJsID0gcmVxdWVzdC51cmwuc3BsaXQoJz8nKVswXTsKICAgICAgICByZXF1ZXN0LnVybCA9IHJlcXVlc3QudXJsICsgJz8nICsgcmVxdWVzdC5wYXlsb2FkOwogICAgICAgIHhoci5vcGVuKG1ldGhvZCwgcmVxdWVzdC51cmwpOwogICAgICB9IGVsc2UgewogICAgICAgIHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOwogICAgICAgIHhoci5vcGVuKG1ldGhvZCwgcmVxdWVzdC51cmwpOwogICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkJyk7CiAgICAgIH0KCiAgICAgIHZhciBjYiA9IGZ1bmN0aW9uIGNiKGUpIHsKICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dCk7CgogICAgICAgIGlmIChlLnR5cGUgPT09ICdlcnJvcicpIHsKICAgICAgICAgIGNhbGxiYWNrKHsKICAgICAgICAgICAgZXJyb3I6IHsKICAgICAgICAgICAgICBtZXNzYWdlOiAnY29tbXVuaWNhdGlvbiBlcnJvcicKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBpZiAoeGhyLnJlYWR5U3RhdGUgPT09IDQgfHwgeGhyLnJlYWR5U3RhdGUgIT09IDQgJiYgeGhyLnJlc3BvbnNlVGV4dCAhPT0gJycpIHsKICAgICAgICAgIHZhciBkYXRhID0gSlNPTjIucGFyc2UoeGhyLnJlc3BvbnNlVGV4dCk7CiAgICAgICAgICBjYWxsYmFjayhkYXRhKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY2FsbGJhY2soewogICAgICAgICAgICBlcnJvcjogewogICAgICAgICAgICAgIG1lc3NhZ2U6ICdubyBkYXRhJwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH07CgogICAgICB4aHIub25sb2FkID0gY2I7CiAgICAgIHhoci5vbmVycm9yID0gY2I7CiAgICAgIHhoci5zZW5kKHJlcXVlc3QucGF5bG9hZCk7CiAgICAgIHRpbWVvdXQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICB4aHIuYWJvcnQoKTsKICAgICAgICBjYWxsYmFjayh7CiAgICAgICAgICBlcnJvcjogewogICAgICAgICAgICBtZXNzYWdlOiAndGltZW91dCcKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSwgNTAwMCk7CiAgICB9OwoKICAgIHJldHVybiBBamF4OwogIH0oKTsKCiAgdmFyIGNhcmRUeXBlcyA9IFt7CiAgICBjb2RlOiAndmlzYScsCiAgICBmb3JtYXQ6IC8oXGR7MSw0fSkvZywKICAgIGxlbmd0aDogMTYsCiAgICByZWdleDogL140LwogIH0sIHsKICAgIGNvZGU6ICdtYXN0ZXJjYXJkJywKICAgIGZvcm1hdDogLyhcZHsxLDR9KS9nLAogICAgbGVuZ3RoOiAxNiwKICAgIHJlZ2V4OiAvXig1WzEtNV18MlsyLTddKS8KICB9LCB7CiAgICBjb2RlOiAnYW1leCcsCiAgICBmb3JtYXQ6IC8oXGR7MSw0fSkoXGR7MSw2fSk/KFxkezEsNX0pPy8sCiAgICBsZW5ndGg6IDE1LAogICAgcmVnZXg6IC9eM1s0N10vCiAgfSwgewogICAgY29kZTogJ2RpbmVycycsCiAgICBmb3JtYXQ6IC8oXGR7MSw0fSkoXGR7MSw2fSk/KFxkezEsNH0pPy8sCiAgICBsZW5ndGg6IDE0LAogICAgcmVnZXg6IC9eM1swNjg5XS8KICB9LCB7CiAgICBjb2RlOiAnZGlzY292ZXInLAogICAgZm9ybWF0OiAvKFxkezEsNH0pL2csCiAgICBsZW5ndGg6IDE2LAogICAgcmVnZXg6IC9eNihbMDQ1XXwyMikvCiAgfSwgewogICAgY29kZTogJ2pjYicsCiAgICBmb3JtYXQ6IC8oXGR7MSw0fSkvZywKICAgIGxlbmd0aDogMTYsCiAgICByZWdleDogL14zNS8KICB9XTsKCiAgdmFyIENhcmROdW1iZXIgPSBmdW5jdGlvbiAoKSB7CiAgICBmdW5jdGlvbiBDYXJkTnVtYmVyKCkge30KCiAgICBDYXJkTnVtYmVyLnByb3RvdHlwZS5mb3JtYXQgPSBmdW5jdGlvbiAobnVtYmVyKSB7CiAgICAgIG51bWJlciA9IG51bWJlci5yZXBsYWNlKC9cRC9nLCAnJyk7CiAgICAgIHZhciB0eXBlID0gQ2FyZC50eXBlQnlOdW1iZXIobnVtYmVyKTsKCiAgICAgIGlmICghdHlwZSkgewogICAgICAgIHJldHVybiBudW1iZXI7CiAgICAgIH0KCiAgICAgIHZhciBtYXRjaGVzID0gbnVtYmVyLm1hdGNoKHR5cGUuZm9ybWF0KTsKCiAgICAgIGlmICghbWF0Y2hlcykgewogICAgICAgIHJldHVybiBudW1iZXI7CiAgICAgIH0KCiAgICAgIGlmICghdHlwZS5mb3JtYXQuZ2xvYmFsKSB7CiAgICAgICAgbWF0Y2hlcy5zaGlmdCgpOwogICAgICB9CgogICAgICByZXR1cm4gbWF0Y2hlcy5qb2luKCcgJykucmVwbGFjZSgvXlxzK3xccyskL2dtLCAnJyk7CiAgICB9OwoKICAgIHJldHVybiBDYXJkTnVtYmVyOwogIH0oKTsKCiAgdmFyIEV4cGlyYXRpb24gPSBmdW5jdGlvbiAoKSB7CiAgICBmdW5jdGlvbiBFeHBpcmF0aW9uKCkge30KCiAgICBFeHBpcmF0aW9uLnByb3RvdHlwZS5mb3JtYXQgPSBmdW5jdGlvbiAoZXhwLCBmaW5hbCkgewogICAgICBpZiAoZmluYWwgPT09IHZvaWQgMCkgewogICAgICAgIGZpbmFsID0gZmFsc2U7CiAgICAgIH0KCiAgICAgIHZhciBwYXQgPSAvXlxEKihcZHsxLDJ9KShcRCspPyhcZHsxLDR9KT8vOwogICAgICB2YXIgZ3JvdXBzID0gZXhwLm1hdGNoKHBhdCk7CiAgICAgIHZhciBtb250aDsKICAgICAgdmFyIGRlbDsKICAgICAgdmFyIHllYXI7CgogICAgICBpZiAoIWdyb3VwcykgewogICAgICAgIHJldHVybiAnJzsKICAgICAgfQoKICAgICAgbW9udGggPSBncm91cHNbMV0gfHwgJyc7CiAgICAgIGRlbCA9IGdyb3Vwc1syXSB8fCAnJzsKICAgICAgeWVhciA9IGdyb3Vwc1szXSB8fCAnJzsKCiAgICAgIGlmICh5ZWFyLmxlbmd0aCA+IDApIHsKICAgICAgICBkZWwgPSAnIC8gJzsKICAgICAgfSBlbHNlIGlmIChtb250aC5sZW5ndGggPT09IDIgfHwgZGVsLmxlbmd0aCA+IDApIHsKICAgICAgICBkZWwgPSAnIC8gJzsKICAgICAgfSBlbHNlIGlmIChtb250aC5sZW5ndGggPT09IDEgJiYgbW9udGggIT09ICcwJyAmJiBtb250aCAhPT0gJzEnKSB7CiAgICAgICAgZGVsID0gJyAvICc7CiAgICAgIH0KCiAgICAgIGlmIChtb250aC5sZW5ndGggPT09IDEgJiYgZGVsICE9PSAnJykgewogICAgICAgIG1vbnRoID0gJzAnICsgbW9udGg7CiAgICAgIH0KCiAgICAgIGlmIChmaW5hbCAmJiB5ZWFyLmxlbmd0aCA9PT0gMikgewogICAgICAgIHllYXIgPSBuZXcgRGF0ZSgpLmdldEZ1bGxZZWFyKCkudG9TdHJpbmcoKS5zbGljZSgwLCAyKSArIHllYXI7CiAgICAgIH0KCiAgICAgIHJldHVybiBtb250aCArIGRlbCArIHllYXI7CiAgICB9OwoKICAgIHJldHVybiBFeHBpcmF0aW9uOwogIH0oKTsKCiAgdmFyIENhcmROdW1iZXIkMSA9IGZ1bmN0aW9uICgpIHsKICAgIGZ1bmN0aW9uIENhcmROdW1iZXIoKSB7fQoKICAgIENhcmROdW1iZXIucHJvdG90eXBlLnZhbGlkYXRlID0gZnVuY3Rpb24gKG51bWJlcikgewogICAgICBpZiAoIW51bWJlcikgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgbnVtYmVyID0gbnVtYmVyLnJlcGxhY2UoL1stXHNdL2csICcnKTsKICAgICAgdmFyIHR5cGUgPSBDYXJkLnR5cGVCeU51bWJlcihudW1iZXIpOwoKICAgICAgaWYgKCF0eXBlKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICByZXR1cm4gQ2FyZC5sdWhuQ2hlY2sobnVtYmVyKSAmJiBudW1iZXIubGVuZ3RoID09PSB0eXBlLmxlbmd0aDsKICAgIH07CgogICAgcmV0dXJuIENhcmROdW1iZXI7CiAgfSgpOwoKICB2YXIgQ3Z2ID0gZnVuY3Rpb24gKCkgewogICAgZnVuY3Rpb24gQ3Z2KCkge30KCiAgICBDdnYucHJvdG90eXBlLnZhbGlkYXRlID0gZnVuY3Rpb24gKGN2dikgewogICAgICBpZiAoIWN2dikgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgY3Z2ID0gY3Z2LnJlcGxhY2UoL15ccyt8XHMrJC9nLCAnJyk7CgogICAgICBpZiAoIS9eXGQrJC8udGVzdChjdnYpKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICByZXR1cm4gMyA8PSBjdnYubGVuZ3RoICYmIGN2di5sZW5ndGggPD0gNDsKICAgIH07CgogICAgcmV0dXJuIEN2djsKICB9KCk7CgogIHZhciBFeHBpcmF0aW9uJDEgPSBmdW5jdGlvbiAoKSB7CiAgICBmdW5jdGlvbiBFeHBpcmF0aW9uKCkge30KCiAgICBFeHBpcmF0aW9uLnByb3RvdHlwZS52YWxpZGF0ZSA9IGZ1bmN0aW9uIChleHApIHsKICAgICAgdmFyIG0sIHk7CgogICAgICBpZiAoIWV4cCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgdmFyIHNwbGl0ID0gZXhwLnNwbGl0KCcvJyk7CiAgICAgIG0gPSBzcGxpdFswXSwgeSA9IHNwbGl0WzFdOwoKICAgICAgaWYgKCFtIHx8ICF5KSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICBtID0gbS5yZXBsYWNlKC9eXHMrfFxzKyQvZywgJycpOwogICAgICB5ID0geS5yZXBsYWNlKC9eXHMrfFxzKyQvZywgJycpOwoKICAgICAgaWYgKCEvXlxkKyQvLnRlc3QobSkpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIGlmICghL15cZCskLy50ZXN0KHkpKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICBpZiAoeS5sZW5ndGggPT09IDIpIHsKICAgICAgICB5ID0gbmV3IERhdGUoKS5nZXRGdWxsWWVhcigpLnRvU3RyaW5nKCkuc2xpY2UoMCwgMikgKyB5OwogICAgICB9CgogICAgICB2YXIgbW9udGggPSBwYXJzZUludChtLCAxMCk7CiAgICAgIHZhciB5ZWFyID0gcGFyc2VJbnQoeSwgMTApOwoKICAgICAgaWYgKCEoMSA8PSBtb250aCAmJiBtb250aCA8PSAxMikpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0gLy8gY3JlYXRlcyBkYXRlIGFzIDEgZGF5IHBhc3QgZW5kIG9mCiAgICAgIC8vIGV4cGlyYXRpb24gbW9udGggc2luY2UgSlMgbW9udGhzCiAgICAgIC8vIGFyZSAwIGluZGV4ZWQKCgogICAgICByZXR1cm4gbmV3IERhdGUoeWVhciwgbW9udGgsIDEpID4gbmV3IERhdGUoKTsKICAgIH07CgogICAgcmV0dXJuIEV4cGlyYXRpb247CiAgfSgpOwogIC8qKgogICAqIEBuYW1lc3BhY2UgSGVhcnRsYW5kLkRPTQogICAqLwoKCiAgdmFyIERPTSA9IGZ1bmN0aW9uICgpIHsKICAgIGZ1bmN0aW9uIERPTSgpIHt9CiAgICAvKioKICAgICAqIEhlYXJ0bGFuZC5ET00uY29uZmlndXJlRmllbGQKICAgICAqCiAgICAgKiBDb25maWd1cmVzIGFuIGlucHV0IGZpZWxkIGluIGEgc2luZ2xlIGZpZWxkIGlGcmFtZS4KICAgICAqCiAgICAgKiBAcGFyYW0ge0hlYXJ0bGFuZC5IUFN9IGhwcwogICAgICovCgoKICAgIERPTS5jb25maWd1cmVGaWVsZCA9IGZ1bmN0aW9uIChocHMpIHsKICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hlYXJ0bGFuZC1maWVsZCcpLnNldEF0dHJpYnV0ZSgnbmFtZScsIGhwcy5maWVsZCk7CiAgICB9OwogICAgLyoqCiAgICAgKiBIZWFydGxhbmQuRE9NLm1ha2VGcmFtZQogICAgICoKICAgICAqIENyZWF0ZXMgYSBzaW5nbGUgaUZyYW1lIGVsZW1lbnQgd2l0aCB0aGUgYXBwcm9wcmlhdGUgZGVmYXVsdHMuCiAgICAgKgogICAgICogQHBhcmFtIHtzdHJpbmd9IG5hbWUKICAgICAqIEByZXR1cm5zIHtIVE1MSWZyYW1lRWxlbWVudH0KICAgICAqLwoKCiAgICBET00ubWFrZUZyYW1lID0gZnVuY3Rpb24gKG5hbWUpIHsKICAgICAgdmFyIGZyYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaWZyYW1lJyk7CiAgICAgIGZyYW1lLmlkID0gJ2hlYXJ0bGFuZC1mcmFtZS0nICsgbmFtZTsKICAgICAgZnJhbWUubmFtZSA9IG5hbWU7CiAgICAgIGZyYW1lLnN0eWxlLmJvcmRlciA9ICcwJzsKICAgICAgZnJhbWUuZnJhbWVCb3JkZXIgPSAnMCc7CiAgICAgIGZyYW1lLnNjcm9sbGluZyA9ICdubyc7CiAgICAgIHJldHVybiBmcmFtZTsKICAgIH07CiAgICAvKioKICAgICAqIEhlYXJ0bGFuZC5ET00uYWRkRmllbGQKICAgICAqCiAgICAgKiBBZGRzIGEgRE9NIGBpbnB1dGAgbm9kZSB0byBgZm9ybVBhcmVudGAgd2l0aCB0eXBlIGBmaWVsZFR5cGVgLCBuYW1lCiAgICAgKiBgZmllbGROYW1lYCwgYW5kIHZhbHVlIGBmaWVsZFZhbHVlYC4KICAgICAqCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gZm9ybVBhcmVudAogICAgICogQHBhcmFtIHtzdHJpbmd9IGZpZWxkVHlwZQogICAgICogQHBhcmFtIHtzdHJpbmd9IGZpZWxkTmFtZQogICAgICogQHBhcmFtIHtzdHJpbmd9IGZpZWxkVmFsdWUKICAgICAqLwoKCiAgICBET00uYWRkRmllbGQgPSBmdW5jdGlvbiAoZm9ybVBhcmVudCwgZmllbGRUeXBlLCBmaWVsZE5hbWUsIGZpZWxkVmFsdWUpIHsKICAgICAgdmFyIGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTsKICAgICAgaW5wdXQuc2V0QXR0cmlidXRlKCd0eXBlJywgZmllbGRUeXBlKTsKICAgICAgaW5wdXQuc2V0QXR0cmlidXRlKCduYW1lJywgZmllbGROYW1lKTsKICAgICAgaW5wdXQuc2V0QXR0cmlidXRlKCd2YWx1ZScsIGZpZWxkVmFsdWUpOwogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChmb3JtUGFyZW50KS5hcHBlbmRDaGlsZChpbnB1dCk7CiAgICB9OwogICAgLyoqCiAgICAgKiBIZWFydGxhbmQuRE9NLnNldFN0eWxlCiAgICAgKgogICAgICogU2V0cyBhbiBlbGVtZW50J3Mgc3R5bGUgYXR0cmlidXRlIHdpdGhpbiBhIGNoaWxkIGlmcmFtZSB3aW5kb3cuCiAgICAgKgogICAgICogQHBhcmFtIHtzdHJpbmd9IGVsZW1lbnRpZAogICAgICogQHBhcmFtIHtzdHJpbmd9IGh0bWxzdHlsZQogICAgICovCgoKICAgIERPTS5zZXRTdHlsZSA9IGZ1bmN0aW9uIChlbGVtZW50aWQsIGh0bWxzdHlsZSkgewogICAgICB2YXIgZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChlbGVtZW50aWQpOwoKICAgICAgaWYgKGVsKSB7CiAgICAgICAgZWwuc2V0QXR0cmlidXRlKCdzdHlsZScsIERPTS5lbmNvZGVFbnRpdGllcyhodG1sc3R5bGUpKTsKICAgICAgfQogICAgfTsKICAgIC8qKgogICAgICogSGVhcnRsYW5kLkRPTS5hcHBlbmRTdHlsZQogICAgICoKICAgICAqIEFwcGVuZHMgYW4gZWxlbWVudCdzIHN0eWxlIGF0dHJpYnV0ZSB3aXRoaW4gYSBjaGlsZCBpZnJhbWUgd2luZG93LgogICAgICoKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBlbGVtZW50aWQKICAgICAqIEBwYXJhbSB7U3RyaW5nfSBodG1sc3R5bGUKICAgICAqLwoKCiAgICBET00uYXBwZW5kU3R5bGUgPSBmdW5jdGlvbiAoZWxlbWVudGlkLCBodG1sc3R5bGUpIHsKICAgICAgdmFyIGVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZWxlbWVudGlkKTsKCiAgICAgIGlmIChlbCkgewogICAgICAgIHZhciBjdXJyc3R5bGUgPSBlbC5nZXRBdHRyaWJ1dGUoJ3N0eWxlJyk7CiAgICAgICAgdmFyIG5ld3N0eWxlID0gKGN1cnJzdHlsZSA/IGN1cnJzdHlsZSA6ICcnKSArIGh0bWxzdHlsZTsKICAgICAgICBlbC5zZXRBdHRyaWJ1dGUoJ3N0eWxlJywgRE9NLmVuY29kZUVudGl0aWVzKG5ld3N0eWxlKSk7CiAgICAgIH0KICAgIH07CiAgICAvKioKICAgICAqIEhlYXJ0bGFuZC5ET00uc2V0VGV4dAogICAgICoKICAgICAqIFNldHMgYW4gZWxlbWVudCdzIGlubmVyIHRleHQgd2l0aGluIGEgY2hpbGQgaWZyYW1lIHdpbmRvdy4KICAgICAqCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gZWxlbWVudGlkCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdGV4dAogICAgICovCgoKICAgIERPTS5zZXRUZXh0ID0gZnVuY3Rpb24gKGVsZW1lbnRpZCwgdGV4dCkgewogICAgICB2YXIgZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChlbGVtZW50aWQpOwoKICAgICAgaWYgKGVsKSB7CiAgICAgICAgZWwudGV4dENvbnRlbnQgPSBET00uZW5jb2RlRW50aXRpZXModGV4dCk7CiAgICAgIH0KICAgIH07CiAgICAvKioKICAgICAqIEhlYXJ0bGFuZC5ET00uc2V0VmFsdWUKICAgICAqCiAgICAgKiBTZXRzIGFuIGVsZW1lbnQncyB2YWx1ZSB3aXRoaW4gYSBjaGlsZCBpZnJhbWUgd2luZG93CiAgICAgKgogICAgICogQHBhcmFtIHtzdHJpbmd9IGVsZW1lbnRpZAogICAgICogQHBhcmFtIHtzdHJpbmd9IHZhbHVlCiAgICAgKi8KCgogICAgRE9NLnNldFZhbHVlID0gZnVuY3Rpb24gKGVsZW1lbnRpZCwgdGV4dCkgewogICAgICB2YXIgZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChlbGVtZW50aWQpOwoKICAgICAgaWYgKGVsICYmIHR5cGVvZiBlbC52YWx1ZSAhPT0gInVuZGVmaW5lZCIpIHsKICAgICAgICBlbC52YWx1ZSA9IERPTS5lbmNvZGVFbnRpdGllcyh0ZXh0KTsKICAgICAgfQogICAgfTsKICAgIC8qKgogICAgICogSGVhcnRsYW5kLkRPTS5zZXRQbGFjZWhvbGRlcgogICAgICoKICAgICAqIFNldHMgYW4gZWxlbWVudCdzIHBsYWNlaG9sZGVyIGF0dHJpYnV0ZSB3aXRoaW4gYSBjaGlsZCBpZnJhbWUgd2luZG93LgogICAgICoKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBlbGVtZW50aWQKICAgICAqIEBwYXJhbSB7c3RyaW5nfSB0ZXh0CiAgICAgKi8KCgogICAgRE9NLnNldFBsYWNlaG9sZGVyID0gZnVuY3Rpb24gKGVsZW1lbnRpZCwgdGV4dCkgewogICAgICB2YXIgZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChlbGVtZW50aWQpOwoKICAgICAgaWYgKGVsKSB7CiAgICAgICAgaWYgKHRleHQgPT09ICfigKLigKLigKLigKIg4oCi4oCi4oCi4oCiIOKAouKAouKAouKAoiDigKLigKLigKLigKInIHx8IHRleHQgPT09ICfigKLigKLigKLigKInIHx8IHRleHQgPT09ICfigKLigKLigKInIHx8IHRleHQgPT09ICfCt8K3wrfCtyDCt8K3wrfCtyDCt8K3wrfCtyDCt8K3wrfCtycpIHsKICAgICAgICAgIGVsLnNldEF0dHJpYnV0ZSgncGxhY2Vob2xkZXInLCB0ZXh0KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZWwuc2V0QXR0cmlidXRlKCdwbGFjZWhvbGRlcicsIERPTS5lbmNvZGVFbnRpdGllcyh0ZXh0KSk7CiAgICAgICAgfQogICAgICB9CiAgICB9OwogICAgLyoqCiAgICAgKiBIZWFydGxhbmQuRE9NLnJlc2l6ZUZyYW1lCiAgICAgKgogICAgICogQWxlcnRzIGEgcGFyZW50IHdpbmRvdyB0byByZXNpemUgdGhlIGlmcmFtZS4KICAgICAqCiAgICAgKiBAcGFyYW0ge0hlYXJ0bGFuZC5IUFN9IGhwcwogICAgICovCgoKICAgIERPTS5yZXNpemVGcmFtZSA9IGZ1bmN0aW9uIChocHMpIHsKICAgICAgdmFyIGRvY0hlaWdodCA9IGRvY3VtZW50LmJvZHkub2Zmc2V0SGVpZ2h0ICsgMTsgLy8gb2ZmIGJ5IG9uZSBlcnJvcgoKICAgICAgaHBzLk1lc3NhZ2VzLnBvc3QoewogICAgICAgIGFjdGlvbjogJ3Jlc2l6ZScsCiAgICAgICAgaGVpZ2h0OiBkb2NIZWlnaHQKICAgICAgfSwgJ3BhcmVudCcpOwogICAgfTsKICAgIC8qKgogICAgICogSGVhcnRsYW5kLkRPTS5zZXRGaWVsZERhdGEKICAgICAqCiAgICAgKiBSZWNlaXZlcyBhIGZpZWxkIHZhbHVlIGZyb20gYW5vdGhlciBmcmFtZSBwcmlvciB0byB0aGUgdG9rZW5pemF0aW9uIHByb2Nlc3MuCiAgICAgKgogICAgICogQHBhcmFtIHtzdHJpbmd9IGVsZW1lbnRpZAogICAgICogQHBhcmFtIHtzdHJpbmd9IHZhbHVlCiAgICAgKi8KCgogICAgRE9NLnNldEZpZWxkRGF0YSA9IGZ1bmN0aW9uIChlbGVtZW50aWQsIHZhbHVlKSB7CiAgICAgIHZhciBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGVsZW1lbnRpZCk7CgogICAgICBpZiAoIWVsICYmIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZWFydGxhbmQtZmllbGQnKSkgewogICAgICAgIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTsKICAgICAgICBlbC5zZXRBdHRyaWJ1dGUoJ2lkJywgRE9NLmVuY29kZUVudGl0aWVzKGVsZW1lbnRpZCkpOwogICAgICAgIGVsLnNldEF0dHJpYnV0ZSgndHlwZScsICdoaWRkZW4nKTsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGVhcnRsYW5kLWZpZWxkLXdyYXBwZXInKS5hcHBlbmRDaGlsZChlbCk7CiAgICAgIH0KCiAgICAgIGlmIChlbCkgewogICAgICAgIGVsLnNldEF0dHJpYnV0ZSgndmFsdWUnLCBET00uZW5jb2RlRW50aXRpZXModmFsdWUpKTsKICAgICAgfQogICAgfTsKICAgIC8qKgogICAgICogSGVhcnRsYW5kLkRPTS5nZXRGaWVsZERhdGEKICAgICAqCiAgICAgKiBSZXRyaWV2ZXMgYSBmaWVsZCB2YWx1ZSBmb3IgYW5vdGhlciBmcmFtZSBwcmlvciB0byB0aGUgdG9rZW5pemF0aW9uIHByb2Nlc3MuCiAgICAgKgogICAgICogQHBhcmFtIHtIZWFydGxhbmQuSFBTfSBocHMKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBlbGVtZW50aWQKICAgICAqLwoKCiAgICBET00uZ2V0RmllbGREYXRhID0gZnVuY3Rpb24gKGhwcywgZWxlbWVudGlkKSB7CiAgICAgIHZhciBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGVsZW1lbnRpZCk7CgogICAgICBpZiAoZWwpIHsKICAgICAgICBocHMuTWVzc2FnZXMucG9zdCh7CiAgICAgICAgICBhY3Rpb246ICdwYXNzRGF0YScsCiAgICAgICAgICB2YWx1ZTogZWwudmFsdWUKICAgICAgICB9LCAncGFyZW50Jyk7CiAgICAgIH0KICAgIH07CiAgICAvKioKICAgICAqIEhlYXJ0bGFuZC5ET00uYWRkU3R5bGVzaGVldAogICAgICoKICAgICAqIENyZWF0ZXMgYSBgc3R5bGVgIG5vZGUgaW4gdGhlIERPTSB3aXRoIHRoZSBnaXZlbiBgY3NzYC4KICAgICAqCiAgICAgKiBAcGFyYW0ge0hlYXJ0bGFuZC5IUFN9IGhwcwogICAgICogQHBhcmFtIHtzdHJpbmd9IGVsZW1lbnRpZAogICAgICovCgoKICAgIERPTS5hZGRTdHlsZXNoZWV0ID0gZnVuY3Rpb24gKGNzcykgewogICAgICB2YXIgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzdHlsZScpOwogICAgICB2YXIgZWxlbWVudHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnaGVhZCcpOwogICAgICBlbC50eXBlID0gJ3RleHQvY3NzJzsKICAgICAgZWwuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoY3NzKSk7CgogICAgICBpZiAoZWxlbWVudHMgJiYgZWxlbWVudHNbMF0pIHsKICAgICAgICBlbGVtZW50c1swXS5hcHBlbmRDaGlsZChlbCk7CiAgICAgIH0KICAgIH07CiAgICAvKioKICAgICAqIEhlYXJ0bGFuZC5ET00uanNvbjJjc3MKICAgICAqCiAgICAgKiBDb252ZXJ0cyBhIEpTT04gbm9kZSB0byB0ZXh0IHJlcHJlc2VudGluZyBDU1MuCiAgICAgKgogICAgICogQHBhcmFtIHtzdHJpbmd9IGpzb24KICAgICAqIEByZXR1cm5zIHtzdHJpbmd9CiAgICAgKi8KCgogICAgRE9NLmpzb24yY3NzID0gZnVuY3Rpb24gKGpzb24pIHsKICAgICAgdmFyIGNzcyA9ICcnOwogICAgICB2YXIgYXR0cmlidXRlczsKICAgICAgdmFyIGNoaWxkcmVuOwogICAgICB2YXIgaSwgajsKICAgICAgdmFyIGtleSwgdmFsdWU7CgogICAgICBpZiAoYXR0cmlidXRlcyA9IERPTS5qc29uQXR0cmlidXRlcyhqc29uKSkgewogICAgICAgIHZhciBhdHRyaWJ1dGVzTGVuZ3RoID0gYXR0cmlidXRlcy5sZW5ndGg7CgogICAgICAgIGZvciAoaSA9IDA7IGkgPCBhdHRyaWJ1dGVzTGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGtleSA9IGF0dHJpYnV0ZXNbaV07CiAgICAgICAgICB2YWx1ZSA9IGpzb25ba2V5XTsKCiAgICAgICAgICBpZiAoRE9NLmlzQXJyYXkodmFsdWUpKSB7CiAgICAgICAgICAgIHZhciBhcnJMZW5ndGggPSB2YWx1ZS5sZW5ndGg7CgogICAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgYXJyTGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgICBjc3MgKz0ga2V5ICsgJzonICsgdmFsdWVbal0gKyAnOyc7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNzcyArPSBrZXkgKyAnOicgKyB2YWx1ZSArICc7JzsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmIChjaGlsZHJlbiA9IERPTS5qc29uQ2hpbGRyZW4oanNvbikpIHsKICAgICAgICB2YXIgY2hpbGRyZW5MZW5ndGggPSBjaGlsZHJlbi5sZW5ndGg7CgogICAgICAgIGZvciAoaSA9IDA7IGkgPCBjaGlsZHJlbkxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBrZXkgPSBjaGlsZHJlbltpXTsKICAgICAgICAgIHZhbHVlID0ganNvbltrZXldOwogICAgICAgICAgY3NzICs9IGtleSArICd7JyArIERPTS5qc29uMmNzcyh2YWx1ZSkgKyAnfSc7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gY3NzOwogICAgfTsKICAgIC8qKgogICAgICogSGVhcnRsYW5kLkRPTS5zZXRGb2N1cwogICAgICoKICAgICAqIFNldHMgdGhlIGZvY3VzIG9uIGFuIGlmcmFtZSdzIGZpZWxkLgogICAgICoKICAgICAqIEBwYXJhbSB7SGVhcnRsYW5kLkhQU30gaHBzCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gZWxlbWVudGlkCiAgICAgKi8KCgogICAgRE9NLnNldEZvY3VzID0gZnVuY3Rpb24gKCkgewogICAgICB2YXIgZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGVhcnRsYW5kLWZpZWxkJyk7CgogICAgICBpZiAoZWwpIHsKICAgICAgICBlbC5mb2N1cygpOwogICAgICB9CiAgICB9OwogICAgLyoqCiAgICAgKiBIZWFydGxhbmQuRE9NLmFkZENlcnRBbGVydAogICAgICoKICAgICAqIEFkZHMgYW4gYWxlcnQgbGV0dGluZyB0aGUgZGV2ZWxvcGVyIGtub3cgdGhleSdyZSBpbiBzYW5kYm94IG1vZGUKICAgICAqCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gZWxlbWVudGlkCiAgICAgKgogICAgICovCgoKICAgIERPTS5hZGRDZXJ0QWxlcnQgPSBmdW5jdGlvbiAoZWxlbWVudGlkKSB7CiAgICAgIHZhciBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICB2YXIgdGV4dCA9IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCJUaGlzIHBhZ2UgaXMgY3VycmVudGx5IGluIHRlc3QgbW9kZS4gRG8gbm90IHVzZSByZWFsL2FjdGl2ZSBjYXJkIG51bWJlcnMuIik7CiAgICAgIGVsLmFwcGVuZENoaWxkKHRleHQpOwogICAgICBlbC5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKICAgICAgZWwuc3R5bGUud2lkdGggPSAiMTAwJSI7CiAgICAgIGVsLnN0eWxlLm1hcmdpbkJvdHRvbSA9ICI1cHgiOwogICAgICBlbC5zdHlsZS5jb2xvciA9ICIjZmZmIjsKICAgICAgZWwuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gIiM3NzAwMDAiOwogICAgICBlbC5zdHlsZS5wYWRkaW5nID0gIjhweCA1cHgiOwogICAgICBlbC5zdHlsZS5mb250RmFtaWx5ID0gIlZlcmRhbmEiOwogICAgICBlbC5zdHlsZS5mb250V2VpZ2h0ID0gIjEwMCI7CiAgICAgIGVsLnN0eWxlLmZvbnRTaXplID0gIjEycHgiOwogICAgICBlbC5zdHlsZS50ZXh0QWxpZ24gPSAiY2VudGVyIjsKICAgICAgZWwuc3R5bGUuYm94U2l6aW5nID0gImJvcmRlci1ib3giOwogICAgICB2YXIgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZWxlbWVudGlkKTsKICAgICAgdmFyIGZyYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hlYXJ0bGFuZC1mcmFtZS1jYXJkTnVtYmVyJyk7CgogICAgICBpZiAoZnJhbWUpIHsKICAgICAgICBjb250YWluZXIuaW5zZXJ0QmVmb3JlKGVsLCBmcmFtZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIGZyYW1lMiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZWFydGxhbmQtZnJhbWUtaGVhcnRsYW5kLWZyYW1lLXNlY3VyZXN1Ym1pdCcpOwogICAgICAgIGNvbnRhaW5lci5pbnNlcnRCZWZvcmUoZWwsIGZyYW1lMik7CiAgICAgIH0KICAgIH07CiAgICAvKioqKioqKioqKioKICAgICAqIEhlbHBlcnMgKgogICAgICoqKioqKioqKioqLwoKICAgIC8qKgogICAgICogRXNjYXBlcyBhbGwgcG90ZW50aWFsbHkgZGFuZ2Vyb3VzIGNoYXJhY3RlcnMsIHNvIHRoYXQgdGhlCiAgICAgKiByZXN1bHRpbmcgc3RyaW5nIGNhbiBiZSBzYWZlbHkgaW5zZXJ0ZWQgaW50byBhdHRyaWJ1dGUgb3IKICAgICAqIGVsZW1lbnQgdGV4dC4KICAgICAqCiAgICAgKiBAcGFyYW0gdmFsdWUKICAgICAqIEByZXR1cm5zIHtzdHJpbmd9IGVzY2FwZWQgdGV4dAogICAgICovCgoKICAgIERPTS5lbmNvZGVFbnRpdGllcyA9IGZ1bmN0aW9uICh2YWx1ZSkgewogICAgICByZXR1cm4gdmFsdWUucmVwbGFjZSgvJi9nLCAnJmFtcDsnKS5yZXBsYWNlKC9bXHVEODAwLVx1REJGRl1bXHVEQzAwLVx1REZGRl0vZywgZnVuY3Rpb24gKHYpIHsKICAgICAgICB2YXIgaGkgPSB2LmNoYXJDb2RlQXQoMCk7CiAgICAgICAgdmFyIGxvdyA9IHYuY2hhckNvZGVBdCgxKTsKICAgICAgICByZXR1cm4gJyYjJyArICgoaGkgLSAweEQ4MDApICogMHg0MDAgKyAobG93IC0gMHhEQzAwKSArIDB4MTAwMDApICsgJzsnOwogICAgICB9KS5yZXBsYWNlKC8oW15cIy1+fCB8IV0pL2csIGZ1bmN0aW9uICh2KSB7CiAgICAgICAgcmV0dXJuICcmIycgKyB2LmNoYXJDb2RlQXQoMCkgKyAnOyc7CiAgICAgIH0pLnJlcGxhY2UoLzwvZywgJyZsdDsnKS5yZXBsYWNlKC8+L2csICcmZ3Q7Jyk7CiAgICB9OwoKICAgIERPTS5pc0FycmF5ID0gZnVuY3Rpb24gKG9iaikgewogICAgICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG9iaikgPT09ICdbb2JqZWN0IEFycmF5XSc7CiAgICB9OwoKICAgIERPTS5qc29uQXR0cmlidXRlcyA9IGZ1bmN0aW9uIChqc29uKSB7CiAgICAgIHZhciBzZXQgPSBbXTsKCiAgICAgIGZvciAodmFyIGkgaW4ganNvbikgewogICAgICAgIGlmIChqc29uLmhhc093blByb3BlcnR5KGkpICYmICh0eXBlb2YganNvbltpXSA9PT0gJ3N0cmluZycgfHwgRE9NLmlzQXJyYXkoanNvbltpXSkpKSB7CiAgICAgICAgICBzZXQucHVzaChpKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBzZXQ7CiAgICB9OwoKICAgIERPTS5qc29uQ2hpbGRyZW4gPSBmdW5jdGlvbiAoanNvbikgewogICAgICB2YXIgc2V0ID0gW107CgogICAgICBmb3IgKHZhciBpIGluIGpzb24pIHsKICAgICAgICBpZiAoanNvbi5oYXNPd25Qcm9wZXJ0eShpKSAmJiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoanNvbltpXSkgPT09ICdbb2JqZWN0IE9iamVjdF0nKSB7CiAgICAgICAgICBzZXQucHVzaChpKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBzZXQ7CiAgICB9OwoKICAgIHJldHVybiBET007CiAgfSgpOwoKICB2YXIgRXhwaXJhdGlvbiQyID0gZnVuY3Rpb24gKCkgewogICAgZnVuY3Rpb24gRXhwaXJhdGlvbigpIHt9CgogICAgRXhwaXJhdGlvbi5wcm90b3R5cGUuZm9ybWF0ID0gZnVuY3Rpb24gKGV4cCwgZmluYWwpIHsKICAgICAgaWYgKGZpbmFsID09PSB2b2lkIDApIHsKICAgICAgICBmaW5hbCA9IGZhbHNlOwogICAgICB9CgogICAgICB2YXIgcGF0ID0gL15cRCooXGR7MSwyfSkoXEQrKT8oXGR7MSw0fSk/LzsKICAgICAgdmFyIGdyb3VwcyA9IGV4cC5tYXRjaChwYXQpOwogICAgICB2YXIgbW9udGg7CiAgICAgIHZhciBkZWw7CiAgICAgIHZhciB5ZWFyOwoKICAgICAgaWYgKCFncm91cHMpIHsKICAgICAgICByZXR1cm4gJyc7CiAgICAgIH0KCiAgICAgIG1vbnRoID0gZ3JvdXBzWzFdIHx8ICcnOwogICAgICBkZWwgPSBncm91cHNbMl0gfHwgJyc7CiAgICAgIHllYXIgPSBncm91cHNbM10gfHwgJyc7CgogICAgICBpZiAoeWVhci5sZW5ndGggPiAwKSB7CiAgICAgICAgZGVsID0gJyAvICc7CiAgICAgIH0gZWxzZSBpZiAobW9udGgubGVuZ3RoID09PSAyIHx8IGRlbC5sZW5ndGggPiAwKSB7CiAgICAgICAgZGVsID0gJyAvICc7CiAgICAgIH0gZWxzZSBpZiAobW9udGgubGVuZ3RoID09PSAxICYmIG1vbnRoICE9PSAnMCcgJiYgbW9udGggIT09ICcxJykgewogICAgICAgIGRlbCA9ICcgLyAnOwogICAgICB9CgogICAgICBpZiAobW9udGgubGVuZ3RoID09PSAxICYmIGRlbCAhPT0gJycpIHsKICAgICAgICBtb250aCA9ICcwJyArIG1vbnRoOwogICAgICB9CgogICAgICBpZiAoZmluYWwgJiYgeWVhci5sZW5ndGggPT09IDIpIHsKICAgICAgICB5ZWFyID0gbmV3IERhdGUoKS5nZXRGdWxsWWVhcigpLnRvU3RyaW5nKCkuc2xpY2UoMCwgMikgKyB5ZWFyOwogICAgICB9CgogICAgICByZXR1cm4gbW9udGggKyBkZWwgKyB5ZWFyOwogICAgfTsKCiAgICByZXR1cm4gRXhwaXJhdGlvbjsKICB9KCk7CgogIHZhciBFdiA9IGZ1bmN0aW9uICgpIHsKICAgIGZ1bmN0aW9uIEV2KCkge30KCiAgICBFdi5saXN0ZW4gPSBmdW5jdGlvbiAobm9kZSwgZXZlbnROYW1lLCBjYWxsYmFjaykgewogICAgICBpZiAoZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcikgewogICAgICAgIG5vZGUuYWRkRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIGNhbGxiYWNrLCBmYWxzZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKG5vZGUgPT09IGRvY3VtZW50KSB7CiAgICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuYXR0YWNoRXZlbnQoJ29ucHJvcGVydHljaGFuZ2UnLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBpZiAoZS5wcm9wZXJ0eU5hbWUgPT09IGV2ZW50TmFtZSkgewogICAgICAgICAgICAgIGNhbGxiYWNrKGUpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbm9kZS5hdHRhY2hFdmVudCgnb24nICsgZXZlbnROYW1lLCBjYWxsYmFjayk7CiAgICAgICAgfQogICAgICB9CiAgICB9OwoKICAgIEV2LnRyaWdnZXIgPSBmdW5jdGlvbiAobm9kZSwgZXZlbnROYW1lKSB7CiAgICAgIGlmIChkb2N1bWVudC5jcmVhdGVFdmVudCkgewogICAgICAgIHZhciBldmVudCA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50KCdFdmVudCcpOwogICAgICAgIGV2ZW50LmluaXRFdmVudChldmVudE5hbWUsIHRydWUsIHRydWUpOwogICAgICAgIG5vZGUuZGlzcGF0Y2hFdmVudChldmVudCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50W2V2ZW50TmFtZV0rKzsKICAgICAgfQogICAgfTsKCiAgICBFdi5pZ25vcmUgPSBmdW5jdGlvbiAoZXZlbnROYW1lLCBjYWxsYmFjaykgewogICAgICBpZiAoZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcikgewogICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCBjYWxsYmFjaywgZmFsc2UpOwogICAgICB9IGVsc2UgewogICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5kZXRhY2hFdmVudCgnb25wcm9wZXJ0eWNoYW5nZScsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICBpZiAoZS5wcm9wZXJ0eU5hbWUgPT09IGV2ZW50TmFtZSkgewogICAgICAgICAgICBjYWxsYmFjayhlKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgfTsKCiAgICByZXR1cm4gRXY7CiAgfSgpOwogIC8qKgogICAqIEBuYW1lc3BhY2UgSGVhcnRsYW5kLkV2ZW50cwogICAqLwoKCiAgdmFyIEV2ZW50cyA9IGZ1bmN0aW9uICgpIHsKICAgIGZ1bmN0aW9uIEV2ZW50cygpIHt9CiAgICAvKioKICAgICAqIEhlYXJ0bGFuZC5FdmVudHMuYWRkSGFuZGxlcgogICAgICoKICAgICAqIEFkZHMgYW4gYGV2ZW50YCBoYW5kbGVyIGZvciBhIGdpdmVuIGB0YXJnZXRgIGVsZW1lbnQuCiAgICAgKgogICAgICogQHBhcmFtIHtzdHJpbmcgfCBFdmVudFRhcmdldH0gdGFyZ2V0CiAgICAgKiBAcGFyYW0ge3N0cmluZ30gZXZlbnQKICAgICAqIEBwYXJhbSB7RXZlbnRMaXN0ZW5lcn0gY2FsbGJhY2sKICAgICAqLwoKCiAgICBFdmVudHMuYWRkSGFuZGxlciA9IGZ1bmN0aW9uICh0YXJnZXQsIGV2ZW50LCBjYWxsYmFjaykgewogICAgICB2YXIgbm9kZTsKCiAgICAgIGlmICh0eXBlb2YgdGFyZ2V0ID09PSAnc3RyaW5nJykgewogICAgICAgIG5vZGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0YXJnZXQpOwogICAgICB9IGVsc2UgewogICAgICAgIG5vZGUgPSB0YXJnZXQ7CiAgICAgIH0KCiAgICAgIGlmIChkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKSB7CiAgICAgICAgbm9kZS5hZGRFdmVudExpc3RlbmVyKGV2ZW50LCBjYWxsYmFjaywgZmFsc2UpOwogICAgICB9IGVsc2UgewogICAgICAgIEV2Lmxpc3Rlbihub2RlLCBldmVudCwgY2FsbGJhY2spOwogICAgICB9CiAgICB9OwogICAgLyoqCiAgICAgKiBIZWFydGxhbmQuRXZlbnRzLnJlbW92ZUhhbmRsZXIKICAgICAqCiAgICAgKiBSZW1vdmVzIGFuIGBldmVudGAgaGFuZGxlciBmb3IgYSBnaXZlbiBgdGFyZ2V0YCBlbGVtZW50LgogICAgICoKICAgICAqIEBwYXJhbSB7c3RyaW5nIHwgRXZlbnRUYXJnZXR9IHRhcmdldAogICAgICogQHBhcmFtIHtzdHJpbmd9IGV2ZW50CiAgICAgKiBAcGFyYW0ge0V2ZW50TGlzdGVuZXJ9IGNhbGxiYWNrCiAgICAgKi8KCgogICAgRXZlbnRzLnJlbW92ZUhhbmRsZXIgPSBmdW5jdGlvbiAodGFyZ2V0LCBldmVudCwgY2FsbGJhY2spIHsKICAgICAgdmFyIG5vZGU7CgogICAgICBpZiAodHlwZW9mIHRhcmdldCA9PT0gJ3N0cmluZycpIHsKICAgICAgICBub2RlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGFyZ2V0KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBub2RlID0gdGFyZ2V0OwogICAgICB9CgogICAgICBpZiAoZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcikgewogICAgICAgIG5vZGUucmVtb3ZlRXZlbnRMaXN0ZW5lcihldmVudCwgY2FsbGJhY2ssIGZhbHNlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBFdi5pZ25vcmUoZXZlbnQsIGNhbGxiYWNrKTsKICAgICAgfQogICAgfTsKICAgIC8qKgogICAgICogSGVhcnRsYW5kLkV2ZW50cy50cmlnZ2VyCiAgICAgKgogICAgICogRmlyZXMgb2ZmIGFuIGBldmVudGAgZm9yIGEgZ2l2ZW4gYHRhcmdldGAgZWxlbWVudC4KICAgICAqCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gbmFtZQogICAgICogQHBhcmFtIHthbnl9IHRhcmdldAogICAgICogQHBhcmFtIHthbnl9IGRhdGEgW29wdGlvbmFsXQogICAgICovCgoKICAgIEV2ZW50cy50cmlnZ2VyID0gZnVuY3Rpb24gKG5hbWUsIHRhcmdldCwgZGF0YSwgYnViYmxlKSB7CiAgICAgIGlmIChidWJibGUgPT09IHZvaWQgMCkgewogICAgICAgIGJ1YmJsZSA9IGZhbHNlOwogICAgICB9CgogICAgICBpZiAoZG9jdW1lbnQuY3JlYXRlRXZlbnQpIHsKICAgICAgICB2YXIgZXZlbnQgPSBkb2N1bWVudC5jcmVhdGVFdmVudCgnRXZlbnQnKTsKICAgICAgICBldmVudC5pbml0RXZlbnQobmFtZSwgdHJ1ZSwgdHJ1ZSk7CiAgICAgICAgdGFyZ2V0LmRpc3BhdGNoRXZlbnQoZXZlbnQpOwogICAgICB9IGVsc2UgewogICAgICAgIEV2LnRyaWdnZXIodGFyZ2V0LCBuYW1lKTsKICAgICAgfQogICAgfTsKICAgIC8qKgogICAgICogSGVhcnRsYW5kLkV2ZW50cy5mcmFtZUhhbmRsZVdpdGgKICAgICAqCiAgICAgKiBXcmFwcyBgaHBzYCBzdGF0ZSBpbiBhIGNsb3N1cmUgdG8gcHJvdmlkZSBhIGBIZWFydGxhbmQuTWVzc2FnZXMucmVjZWl2ZWAKICAgICAqIGNhbGxiYWNrIGhhbmRsZXIgZm9yIGlGcmFtZSBjaGlsZHJlbi4KICAgICAqCiAgICAgKiBAcGFyYW0ge0hlYXJ0bGFuZC5IUFN9IGhwcwogICAgICovCgoKICAgIEV2ZW50cy5mcmFtZUhhbmRsZVdpdGggPSBmdW5jdGlvbiAoaHBzKSB7CiAgICAgIHJldHVybiBmdW5jdGlvbiAoZGF0YSkgewogICAgICAgIHN3aXRjaCAoZGF0YS5hY3Rpb24pIHsKICAgICAgICAgIGNhc2UgJ3Rva2VuaXplJzoKICAgICAgICAgICAgaWYgKGRhdGEuYWNjdW11bGF0ZURhdGEpIHsKICAgICAgICAgICAgICBocHMuTWVzc2FnZXMucG9zdCh7CiAgICAgICAgICAgICAgICBhY3Rpb246ICdhY2N1bXVsYXRlRGF0YScKICAgICAgICAgICAgICB9LCAncGFyZW50Jyk7CiAgICAgICAgICAgICAgdmFyIGVsT3B0cyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b2tlbml6ZU9wdGlvbnMnKTsKCiAgICAgICAgICAgICAgaWYgKCFlbE9wdHMpIHsKICAgICAgICAgICAgICAgIGVsT3B0cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7CiAgICAgICAgICAgICAgICBlbE9wdHMuaWQgPSAndG9rZW5pemVPcHRpb25zJzsKICAgICAgICAgICAgICAgIGVsT3B0cy50eXBlID0gJ2hpZGRlbic7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB2YXIgZWxQSyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwdWJsaWNLZXknKTsKCiAgICAgICAgICAgICAgaWYgKCFlbFBLKSB7CiAgICAgICAgICAgICAgICBlbFBLID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTsKICAgICAgICAgICAgICAgIGVsUEsuaWQgPSAncHVibGljS2V5JzsKICAgICAgICAgICAgICAgIGVsUEsudHlwZSA9ICdoaWRkZW4nOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKGRhdGEuZGF0YSkgewogICAgICAgICAgICAgICAgZWxPcHRzLnZhbHVlID0gSlNPTjIuc3RyaW5naWZ5KGRhdGEuZGF0YSk7CiAgICAgICAgICAgICAgICBlbFBLLnZhbHVlID0gZGF0YS5kYXRhLnB1YmxpY0tleTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZWxPcHRzLnZhbHVlID0gSlNPTjIuc3RyaW5naWZ5KHsKICAgICAgICAgICAgICAgICAgcHVibGljS2V5OiBkYXRhLm1lc3NhZ2UKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgZWxQSy52YWx1ZSA9IGRhdGEubWVzc2FnZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZWFydGxhbmQtZmllbGQtd3JhcHBlcicpLmFwcGVuZENoaWxkKGVsT3B0cyk7CiAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hlYXJ0bGFuZC1maWVsZC13cmFwcGVyJykuYXBwZW5kQ2hpbGQoZWxQSyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgRXZlbnRzLnRva2VuaXplSWZyYW1lKGhwcywgZGF0YS5kYXRhKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAnc2V0U3R5bGUnOgogICAgICAgICAgICBET00uc2V0U3R5bGUoZGF0YS5pZCwgZGF0YS5zdHlsZSk7CiAgICAgICAgICAgIERPTS5yZXNpemVGcmFtZShocHMpOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlICdhcHBlbmRTdHlsZSc6CiAgICAgICAgICAgIERPTS5hcHBlbmRTdHlsZShkYXRhLmlkLCBkYXRhLnN0eWxlKTsKICAgICAgICAgICAgRE9NLnJlc2l6ZUZyYW1lKGhwcyk7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgJ3NldFRleHQnOgogICAgICAgICAgICBET00uc2V0VGV4dChkYXRhLmlkLCBkYXRhLnRleHQpOwogICAgICAgICAgICBET00ucmVzaXplRnJhbWUoaHBzKTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAnc2V0VmFsdWUnOgogICAgICAgICAgICBET00uc2V0VmFsdWUoZGF0YS5pZCwgZGF0YS50ZXh0KTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAnc2V0UGxhY2Vob2xkZXInOgogICAgICAgICAgICBET00uc2V0UGxhY2Vob2xkZXIoZGF0YS5pZCwgZGF0YS50ZXh0KTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAnc2V0RmllbGREYXRhJzoKICAgICAgICAgICAgRE9NLnNldEZpZWxkRGF0YShkYXRhLmlkLCBkYXRhLnZhbHVlKTsKCiAgICAgICAgICAgIGlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGVhcnRsYW5kLWZpZWxkJykgJiYgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhcmRDdnYnKSAmJiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FyZEV4cGlyYXRpb24nKSkgewogICAgICAgICAgICAgIHZhciBvcHRzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Rva2VuaXplT3B0aW9ucycpOwogICAgICAgICAgICAgIHZhciBwayA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwdWJsaWNLZXknKTsKICAgICAgICAgICAgICBFdmVudHMudG9rZW5pemVJZnJhbWUoaHBzLCBvcHRzICYmIG9wdHMuZ2V0QXR0cmlidXRlKCd2YWx1ZScpICE9PSAndW5kZWZpbmVkJyA/IEpTT04yLnBhcnNlKG9wdHMuZ2V0QXR0cmlidXRlKCd2YWx1ZScpKSA6IHsKICAgICAgICAgICAgICAgIHB1YmxpY0tleTogcGsuZ2V0QXR0cmlidXRlKCd2YWx1ZScpCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgJ2dldEZpZWxkRGF0YSc6CiAgICAgICAgICAgIERPTS5nZXRGaWVsZERhdGEoaHBzLCBkYXRhLmlkKTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAnYWRkU3R5bGVzaGVldCc6CiAgICAgICAgICAgIERPTS5hZGRTdHlsZXNoZWV0KGRhdGEuZGF0YSk7CiAgICAgICAgICAgIERPTS5yZXNpemVGcmFtZShocHMpOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlICdzZXRGb2N1cyc6CiAgICAgICAgICAgIERPTS5zZXRGb2N1cygpOwogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH07CiAgICB9OwogICAgLyoqCiAgICAgKiB0b2tlbml6ZUlmcmFtZQogICAgICoKICAgICAqIFRva2VuaXplcyBjYXJkIGRhdGEuIFVzZWQgaW4gaWZyYW1lIGludGVncmF0aW9ucyB0byB0b2tlbml6ZSBvbiBIZWFydGxhbmQncwogICAgICogc2VydmVycy4KICAgICAqCiAgICAgKiBAcGFyYW0ge0hlYXJ0bGFuZC5IUFN9IGhwcwogICAgICogQHBhcmFtIHtzdHJpbmd9IHB1YmxpY0tleQogICAgICovCgoKICAgIEV2ZW50cy50b2tlbml6ZUlmcmFtZSA9IGZ1bmN0aW9uIChocHMsIGRhdGEpIHsKICAgICAgdmFyIGNhcmQgPSB7fTsKICAgICAgdmFyIG51bWJlckVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGVhcnRsYW5kLWZpZWxkJykgfHwgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hlYXJ0bGFuZC1jYXJkLW51bWJlcicpOwogICAgICB2YXIgY3Z2RWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYXJkQ3Z2JykgfHwgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hlYXJ0bGFuZC1jdnYnKTsKICAgICAgdmFyIGV4cEVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FyZEV4cGlyYXRpb24nKTsKCiAgICAgIHZhciB0b2tlblJlc3BvbnNlID0gZnVuY3Rpb24gdG9rZW5SZXNwb25zZShhY3Rpb24pIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICBocHMuTWVzc2FnZXMucG9zdCh7CiAgICAgICAgICAgIGFjdGlvbjogYWN0aW9uLAogICAgICAgICAgICByZXNwb25zZTogcmVzcG9uc2UKICAgICAgICAgIH0sICdwYXJlbnQnKTsKCiAgICAgICAgICBpZiAoY3Z2RWxlbWVudCkgewogICAgICAgICAgICBpZiAoY3Z2RWxlbWVudC5wYXJlbnROb2RlKSB7CiAgICAgICAgICAgICAgY3Z2RWxlbWVudC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGN2dkVsZW1lbnQpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGN2dkVsZW1lbnQucmVtb3ZlKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZXhwRWxlbWVudCkgewogICAgICAgICAgICBpZiAoZXhwRWxlbWVudC5wYXJlbnROb2RlKSB7CiAgICAgICAgICAgICAgZXhwRWxlbWVudC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGV4cEVsZW1lbnQpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGV4cEVsZW1lbnQucmVtb3ZlKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9OwogICAgICB9OwoKICAgICAgY2FyZC5udW1iZXIgPSBudW1iZXJFbGVtZW50ID8gbnVtYmVyRWxlbWVudC52YWx1ZSA6ICcnOwogICAgICBjYXJkLmN2diA9IGN2dkVsZW1lbnQgPyBjdnZFbGVtZW50LnZhbHVlIDogJyc7CiAgICAgIGNhcmQuZXhwID0gZXhwRWxlbWVudDsKCiAgICAgIGlmIChjYXJkLmV4cCkgewogICAgICAgIHZhciBmb3JtYXR0ZXIgPSBuZXcgRXhwaXJhdGlvbiQyKCk7CiAgICAgICAgdmFyIGNhcmRFeHBTcGxpdCA9IGZvcm1hdHRlci5mb3JtYXQoY2FyZC5leHAudmFsdWUsIHRydWUpLnNwbGl0KCcvJyk7CiAgICAgICAgY2FyZC5leHBNb250aCA9IGNhcmRFeHBTcGxpdFswXTsKICAgICAgICBjYXJkLmV4cFllYXIgPSBjYXJkRXhwU3BsaXRbMV07CiAgICAgICAgY2FyZC5leHAgPSB1bmRlZmluZWQ7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY2FyZC5leHBNb250aCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZWFydGxhbmQtZXhwaXJhdGlvbi1tb250aCcpLnZhbHVlOwogICAgICAgIGNhcmQuZXhwWWVhciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZWFydGxhbmQtZXhwaXJhdGlvbi15ZWFyJykudmFsdWU7CiAgICAgIH0KCiAgICAgIGhwcy50b2tlbml6ZSh7CiAgICAgICAgY2FyZEN2djogY2FyZC5jdnYgPyBjYXJkLmN2diA6ICcnLAogICAgICAgIGNhcmRFeHBNb250aDogY2FyZC5leHBNb250aCA/IGNhcmQuZXhwTW9udGggOiAnJywKICAgICAgICBjYXJkRXhwWWVhcjogY2FyZC5leHBZZWFyID8gY2FyZC5leHBZZWFyIDogJycsCiAgICAgICAgY2FyZE51bWJlcjogY2FyZC5udW1iZXIgPyBjYXJkLm51bWJlciA6ICcnLAogICAgICAgIGNjYTogZGF0YS5jY2EsCiAgICAgICAgZXJyb3I6IHRva2VuUmVzcG9uc2UoJ29uVG9rZW5FcnJvcicpLAogICAgICAgIHB1YmxpY0tleTogZGF0YS5wdWJsaWNLZXkgPyBkYXRhLnB1YmxpY0tleSA6ICcnLAogICAgICAgIHN1Y2Nlc3M6IHRva2VuUmVzcG9uc2UoJ29uVG9rZW5TdWNjZXNzJyksCiAgICAgICAgdHlwZTogJ3BhbicKICAgICAgfSk7CiAgICB9OwoKICAgIHJldHVybiBFdmVudHM7CiAgfSgpOwogIC8qKgogICAqIEBuYW1lc3BhY2UgSGVhcnRsYW5kLkNhcmQKICAgKi8KCgogIHZhciBDYXJkID0gZnVuY3Rpb24gKCkgewogICAgZnVuY3Rpb24gQ2FyZCgpIHt9CiAgICAvKioKICAgICAqIEhlYXJ0bGFuZC5DYXJkLnR5cGVCeU51bWJlcgogICAgICoKICAgICAqIEhlbHBlciBmdW5jdGlvbiB0byBncmFiIHRoZSBDYXJkVHlwZSBmb3IgYSBnaXZlbiBjYXJkIG51bWJlci4KICAgICAqCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gbnVtYmVyIC0gVGhlIGNhcmQgbnVtYmVyCiAgICAgKiBAcmV0dXJucyB7SGVhcnRsYW5kLkNhcmRUeXBlfQogICAgICovCgoKICAgIENhcmQudHlwZUJ5TnVtYmVyID0gZnVuY3Rpb24gKG51bWJlcikgewogICAgICB2YXIgY2FyZFR5cGU7CiAgICAgIHZhciBpOwoKICAgICAgaWYgKCFudW1iZXIpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQoKICAgICAgaWYgKG51bWJlci5yZXBsYWNlKC9eXHMrfFxzKyQvZ20sICcnKS5sZW5ndGggPCA0KSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KCiAgICAgIGZvciAoaSBpbiBjYXJkVHlwZXMpIHsKICAgICAgICBjYXJkVHlwZSA9IGNhcmRUeXBlc1tpXTsKCiAgICAgICAgaWYgKGNhcmRUeXBlICYmIGNhcmRUeXBlLnJlZ2V4ICYmIGNhcmRUeXBlLnJlZ2V4LnRlc3QobnVtYmVyKSkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gY2FyZFR5cGU7CiAgICB9OwogICAgLyoqCiAgICAgKiBIZWFydGxhbmQuQ2FyZC50eXBlQnlUcmFjawogICAgICoKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBkYXRhIC0gdHJhY2sgZGF0YQogICAgICogQHBhcmFtIHtib29sZWFufSBpc0VuY3J5cHRlZCAtIChkZWZhdWx0OiBmYWxzZSkKICAgICAqIEBwYXJhbSB7c3RyaW5nfSB0cmFja051bWJlcgogICAgICoKICAgICAqIEByZXR1cm5zIENhcmRUeXBlCiAgICAgKi8KCgogICAgQ2FyZC50eXBlQnlUcmFjayA9IGZ1bmN0aW9uIChkYXRhLCBpc0VuY3J5cHRlZCwgdHJhY2tOdW1iZXIpIHsKICAgICAgaWYgKGlzRW5jcnlwdGVkID09PSB2b2lkIDApIHsKICAgICAgICBpc0VuY3J5cHRlZCA9IGZhbHNlOwogICAgICB9CgogICAgICB2YXIgbnVtYmVyOwoKICAgICAgaWYgKGlzRW5jcnlwdGVkICYmIHRyYWNrTnVtYmVyICYmIHRyYWNrTnVtYmVyID09PSAnMDInKSB7CiAgICAgICAgbnVtYmVyID0gZGF0YS5zcGxpdCgnPScpWzBdOwogICAgICB9IGVsc2UgewogICAgICAgIHZhciB0ZW1wID0gZGF0YS5zcGxpdCgnJScpOwoKICAgICAgICBpZiAodGVtcFsxXSkgewogICAgICAgICAgdGVtcCA9IHRlbXBbMV0uc3BsaXQoJ14nKTsKCiAgICAgICAgICBpZiAodGVtcFswXSkgewogICAgICAgICAgICBudW1iZXIgPSB0ZW1wWzBdLnRvU3RyaW5nKCkuc3Vic3RyKDEpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIENhcmQudHlwZUJ5TnVtYmVyKG51bWJlcik7CiAgICB9OwogICAgLyoqCiAgICAgKiBIZWFydGxhbmQuQ2FyZC5sdWhuQ2hlY2sKICAgICAqCiAgICAgKiBSdW5zIGEgbW9kIDEwIGNoZWNrIG9uIGEgZ2l2ZW4gY2FyZCBudW1iZXIuCiAgICAgKgogICAgICogQHBhcmFtIHtzdHJpbmd9IG51bWJlciAtIFRoZSBjYXJkIG51bWJlcgogICAgICogQHJldHVybnMge2Jvb2xlYW59CiAgICAgKi8KCgogICAgQ2FyZC5sdWhuQ2hlY2sgPSBmdW5jdGlvbiAobnVtYmVyKSB7CiAgICAgIHZhciBvZGQgPSB0cnVlOwogICAgICB2YXIgaSA9IDA7CiAgICAgIHZhciBzdW0gPSAwOwogICAgICB2YXIgZGlnaXQ7CgogICAgICBpZiAoIW51bWJlcikgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgdmFyIGRpZ2l0cyA9IG51bWJlci5zcGxpdCgnJykucmV2ZXJzZSgpOwogICAgICB2YXIgbGVuZ3RoID0gZGlnaXRzLmxlbmd0aDsKCiAgICAgIGZvciAoaTsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgICAgZGlnaXQgPSBwYXJzZUludChkaWdpdHNbaV0sIDEwKTsKCiAgICAgICAgaWYgKG9kZCA9ICFvZGQpIHsKICAgICAgICAgIGRpZ2l0ICo9IDI7CiAgICAgICAgfQoKICAgICAgICBpZiAoZGlnaXQgPiA5KSB7CiAgICAgICAgICBkaWdpdCAtPSA5OwogICAgICAgIH0KCiAgICAgICAgc3VtICs9IGRpZ2l0OwogICAgICB9CgogICAgICByZXR1cm4gc3VtICUgMTAgPT09IDA7CiAgICB9OwogICAgLyoqCiAgICAgKiBIZWFydGxhbmQuQ2FyZC5hZGRUeXBlCiAgICAgKgogICAgICogQWRkcyBhIGNsYXNzIHRvIHRoZSB0YXJnZXQgZWxlbWVudCB3aXRoIHRoZSBjYXJkIHR5cGUKICAgICAqIGluZmVycmVkIGZyb20gdGhlIHRhcmdldCdzIGN1cnJlbnQgdmFsdWUuCiAgICAgKgogICAgICogQHBhcmFtIHtFdmVudH0gZQogICAgICovCgoKICAgIENhcmQuYWRkVHlwZSA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0YXJnZXQgPSBlLmN1cnJlbnRUYXJnZXQgPyBlLmN1cnJlbnRUYXJnZXQgOiBlLnNyY0VsZW1lbnQ7CiAgICAgIHZhciB0eXBlID0gQ2FyZC50eXBlQnlOdW1iZXIodGFyZ2V0LnZhbHVlKTsKICAgICAgdmFyIGNsYXNzTGlzdCA9IHRhcmdldC5jbGFzc05hbWUuc3BsaXQoJyAnKTsKICAgICAgdmFyIGxlbmd0aCA9IGNsYXNzTGlzdC5sZW5ndGg7CiAgICAgIHZhciBpID0gMDsKICAgICAgdmFyIGMgPSAnJzsKCiAgICAgIGZvciAoaTsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgICAgYyA9IGNsYXNzTGlzdFtpXTsKCiAgICAgICAgaWYgKGMgJiYgYy5pbmRleE9mKCdjYXJkLXR5cGUtJykgIT09IC0xKSB7CiAgICAgICAgICBkZWxldGUgY2xhc3NMaXN0W2ldOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHR5cGUpIHsKICAgICAgICBjbGFzc0xpc3QucHVzaCgnY2FyZC10eXBlLScgKyB0eXBlLmNvZGUpOwogICAgICB9CgogICAgICB0YXJnZXQuY2xhc3NOYW1lID0gY2xhc3NMaXN0LmpvaW4oJyAnKS5yZXBsYWNlKC9eXHMrfFxzKyQvZ20sICcnKTsKICAgIH07CiAgICAvKioKICAgICAqIEhlYXJ0bGFuZC5DYXJkLmZvcm1hdE51bWJlcgogICAgICoKICAgICAqIEZvcm1hdHMgYSB0YXJnZXQgZWxlbWVudCdzIHZhbHVlIGJhc2VkIG9uIHRoZQogICAgICogaW5mZXJyZWQgY2FyZCB0eXBlJ3MgZm9ybWF0dGluZyByZWdleC4KICAgICAqCiAgICAgKiBAcGFyYW0ge0V2ZW50fSBlCiAgICAgKi8KCgogICAgQ2FyZC5mb3JtYXROdW1iZXIgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdGFyZ2V0ID0gZS5jdXJyZW50VGFyZ2V0ID8gZS5jdXJyZW50VGFyZ2V0IDogZS5zcmNFbGVtZW50OwogICAgICB2YXIgdmFsdWUgPSB0YXJnZXQudmFsdWU7CgogICAgICBpZiAodmFsdWUubGVuZ3RoID09PSAwKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgZm9ybWF0dGVkID0gbmV3IENhcmROdW1iZXIoKS5mb3JtYXQodmFsdWUpOwogICAgICB0YXJnZXQudmFsdWUgPSBmb3JtYXR0ZWQ7CgogICAgICBpZiAoIXRhcmdldC5zZXRTZWxlY3Rpb25SYW5nZSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIGN1cnNvciA9IHRhcmdldC5zZWxlY3Rpb25TdGFydDsgLy8gY29weSBhbmQgcGFzdGUsIHNwYWNlIGluc2VydGVkIG9uIGZvcm1hdHRlcgoKICAgICAgaWYgKHZhbHVlLmxlbmd0aCA8IGZvcm1hdHRlZC5sZW5ndGgpIHsKICAgICAgICBjdXJzb3IgKz0gZm9ybWF0dGVkLmxlbmd0aCAtIHZhbHVlLmxlbmd0aDsKICAgICAgfSAvLyBjaGVjayBpZiBiZWZvcmUgbmV3IGluc2VydGVkIGRpZ2l0IGlzIGEgc3BhY2UKCgogICAgICBpZiAodmFsdWUuY2hhckF0KGN1cnNvcikgPT09ICcgJyAmJiBmb3JtYXR0ZWQuY2hhckF0KGN1cnNvciAtIDEpID09PSAnICcpIHsKICAgICAgICBjdXJzb3IgKz0gMTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnNldFNlbGVjdGlvblJhbmdlKGN1cnNvciwgY3Vyc29yKTsKICAgIH07CiAgICAvKioKICAgICAqIEhlYXJ0bGFuZC5DYXJkLmZvcm1hdEV4cGlyYXRpb24KICAgICAqCiAgICAgKiBGb3JtYXRzIGEgdGFyZ2V0IGVsZW1lbnQncyB2YWx1ZS4KICAgICAqCiAgICAgKiBAcGFyYW0ge0tleWJvYXJkRXZlbnR9IGUKICAgICAqLwoKCiAgICBDYXJkLmZvcm1hdEV4cGlyYXRpb24gPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdGFyZ2V0ID0gZS5jdXJyZW50VGFyZ2V0ID8gZS5jdXJyZW50VGFyZ2V0IDogZS5zcmNFbGVtZW50OwogICAgICB2YXIgdmFsdWUgPSB0YXJnZXQudmFsdWU7IC8vIGFsbG93OiBkZWxldGUsIGJhY2tzcGFjZQoKICAgICAgaWYgKFs0NiwgOF0uaW5kZXhPZihlLmtleUNvZGUpICE9PSAtMSB8fCAvLyBhbGxvdzogaG9tZSwgZW5kLCBsZWZ0LCByaWdodAogICAgICBlLmtleUNvZGUgPj0gMzUgJiYgZS5rZXlDb2RlIDw9IDM5KSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB0YXJnZXQudmFsdWUgPSBuZXcgRXhwaXJhdGlvbigpLmZvcm1hdCh2YWx1ZSwgZS50eXBlID09PSAnYmx1cicpOwogICAgfTsKICAgIC8qKgogICAgICogSGVhcnRsYW5kLkNhcmQucmVzdHJpY3RMZW5ndGgKICAgICAqCiAgICAgKiBSZXN0cmljdHMgaW5wdXQgaW4gYSB0YXJnZXQgZWxlbWVudCB0byBhCiAgICAgKiBjZXJ0YWluIGxlbmd0aCBkYXRhLgogICAgICoKICAgICAqIEBwYXJhbSB7bnVtYmVyfSBsZW5ndGgKICAgICAqCiAgICAgKiBAcmV0dXJucyB7KGU6IEtleWJvYXJkRXZlbnQpID0+ICgpfQogICAgICovCgoKICAgIENhcmQucmVzdHJpY3RMZW5ndGggPSBmdW5jdGlvbiAobGVuZ3RoKSB7CiAgICAgIHJldHVybiBmdW5jdGlvbiAoZSkgewogICAgICAgIHZhciB0YXJnZXQgPSBlLmN1cnJlbnRUYXJnZXQgPyBlLmN1cnJlbnRUYXJnZXQgOiBlLnNyY0VsZW1lbnQ7CiAgICAgICAgdmFyIHZhbHVlID0gdGFyZ2V0LnZhbHVlOyAvLyBhbGxvdzogYmFja3NwYWNlLCBkZWxldGUsIHRhYiwgZXNjYXBlIGFuZCBlbnRlcgoKICAgICAgICBpZiAoWzQ2LCA4LCA5LCAyNywgMTMsIDExMF0uaW5kZXhPZihlLmtleUNvZGUpICE9PSAtMSB8fCAvLyBhbGxvdzogQ3RybCtBCiAgICAgICAgZS5rZXlDb2RlID09PSA2NSAmJiBlLmN0cmxLZXkgPT09IHRydWUgfHwgLy8gYWxsb3c6IGhvbWUsIGVuZCwgbGVmdCwgcmlnaHQKICAgICAgICBlLmtleUNvZGUgPj0gMzUgJiYgZS5rZXlDb2RlIDw9IDM5KSB7CiAgICAgICAgICAvLyBsZXQgaXQgaGFwcGVuLCBkb24ndCBkbyBhbnl0aGluZwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKHZhbHVlLmxlbmd0aCA+PSBsZW5ndGgpIHsKICAgICAgICAgIGUucHJldmVudERlZmF1bHQgPyBlLnByZXZlbnREZWZhdWx0KCkgOiBlLnJldHVyblZhbHVlID0gZmFsc2U7CiAgICAgICAgfQogICAgICB9OwogICAgfTsKICAgIC8qKgogICAgICogSGVhcnRsYW5kLkNhcmQucmVzdHJpY3ROdW1lcmljCiAgICAgKgogICAgICogUmVzdHJpY3RzIGlucHV0IGluIGEgdGFyZ2V0IGVsZW1lbnQgdG8gb25seQogICAgICogbnVtZXJpYyBkYXRhLgogICAgICoKICAgICAqIEBwYXJhbSB7S2V5Ym9hcmRFdmVudH0gZQogICAgICovCgoKICAgIENhcmQucmVzdHJpY3ROdW1lcmljID0gZnVuY3Rpb24gKGUpIHsKICAgICAgLy8gYWxsb3c6IGJhY2tzcGFjZSwgZGVsZXRlLCB0YWIsIGVzY2FwZSBhbmQgZW50ZXIKICAgICAgaWYgKFs0NiwgOCwgOSwgMjcsIDEzLCAxMTBdLmluZGV4T2YoZS5rZXlDb2RlKSAhPT0gLTEgfHwgLy8gYWxsb3c6IEN0cmwrQQogICAgICBlLmtleUNvZGUgPT09IDY1ICYmIGUuY3RybEtleSA9PT0gdHJ1ZSB8fCAvLyBhbGxvdzogaG9tZSwgZW5kLCBsZWZ0LCByaWdodAogICAgICBlLmtleUNvZGUgPj0gMzUgJiYgZS5rZXlDb2RlIDw9IDM5IHx8IC8vIGFsbG93OiB3ZWlyZCBBbmRyb2lkL0Nocm9tZSBpc3N1ZQogICAgICBlLmtleUNvZGUgPT09IDIyOSkgewogICAgICAgIC8vIGxldCBpdCBoYXBwZW4sIGRvbid0IGRvIGFueXRoaW5nCiAgICAgICAgcmV0dXJuOwogICAgICB9IC8vIGVuc3VyZSB0aGF0IGl0IGlzIGEgbnVtYmVyIGFuZCBzdG9wIHRoZSBrZXlwcmVzcwoKCiAgICAgIGlmICgoZS5zaGlmdEtleSB8fCBlLmtleUNvZGUgPCA0OCB8fCBlLmtleUNvZGUgPiA1NykgJiYgKGUua2V5Q29kZSA8IDk2IHx8IGUua2V5Q29kZSA+IDEwNSkpIHsKICAgICAgICBlLnByZXZlbnREZWZhdWx0ID8gZS5wcmV2ZW50RGVmYXVsdCgpIDogZS5yZXR1cm5WYWx1ZSA9IGZhbHNlOwogICAgICB9CiAgICB9OwogICAgLyoqCiAgICAgKiBIZWFydGxhbmQuQ2FyZC5kZWxldGVQcm9wZXJseQogICAgICoKICAgICAqIFBsYWNlcyBjdXJzb3Igb24gdGhlIGNvcnJlY3QgcG9zaXRpb24gdG8KICAgICAqIGxldCB0aGUgYnJvd3NlciBkZWxldGUgdGhlIGRpZ2l0IGluc3RlYWQKICAgICAqIG9mIHRoZSBzcGFjZS4KICAgICAqCiAgICAgKiBAcGFyYW0ge0tleWJvYXJkRXZlbnR9IGUKICAgICAqLwoKCiAgICBDYXJkLmRlbGV0ZVByb3Blcmx5ID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHRhcmdldCA9IGUuY3VycmVudFRhcmdldCA/IGUuY3VycmVudFRhcmdldCA6IGUuc3JjRWxlbWVudDsKICAgICAgdmFyIHZhbHVlID0gdGFyZ2V0LnZhbHVlOwoKICAgICAgaWYgKCF0YXJnZXQuc2V0U2VsZWN0aW9uUmFuZ2UpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciBjdXJzb3IgPSB0YXJnZXQuc2VsZWN0aW9uU3RhcnQ7IC8vIGFsbG93OiBkZWxldGUsIGJhY2tzcGFjZQoKICAgICAgaWYgKFs0NiwgOF0uaW5kZXhPZihlLmtleUNvZGUpICE9PSAtMSAmJiAvLyBpZiBzcGFjZSB0byBiZSBkZWxldGVkCiAgICAgIHZhbHVlLmNoYXJBdChjdXJzb3IgLSAxKSA9PT0gJyAnKSB7CiAgICAgICAgLy8gcGxhY2luZyBjdXJzb3IgYmVmb3JlIHNwYWNlIHRvIGRlbGV0ZSBkaWdpdCBpbnN0ZWFkCiAgICAgICAgdGFyZ2V0LnNldFNlbGVjdGlvblJhbmdlKGN1cnNvciAtIDEsIGN1cnNvciAtIDEpOwogICAgICB9CiAgICB9OwogICAgLyoqCiAgICAgKiBIZWFydGxhbmQuQ2FyZC52YWxpZGF0ZU51bWJlcgogICAgICoKICAgICAqIFZhbGlkYXRlcyBhIHRhcmdldCBlbGVtZW50J3MgdmFsdWUgYmFzZWQgb24gdGhlCiAgICAgKiBpbmZlcnJlZCBjYXJkIHR5cGUncyB2YWxpZGF0aW9uIHJlZ2V4LiBBZGRzIGEKICAgICAqIGNsYXNzIHRvIHRoZSB0YXJnZXQgZWxlbWVudCB0byBub3RlIGB2YWxpZGAgb3IKICAgICAqIGBpbnZhbGlkYC4KICAgICAqCiAgICAgKiBAcGFyYW0ge0V2ZW50fSBlCiAgICAgKi8KCgogICAgQ2FyZC52YWxpZGF0ZU51bWJlciA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0YXJnZXQgPSBlLmN1cnJlbnRUYXJnZXQgPyBlLmN1cnJlbnRUYXJnZXQgOiBlLnNyY0VsZW1lbnQ7CiAgICAgIHZhciB2YWx1ZSA9IHRhcmdldC52YWx1ZTsKICAgICAgdmFyIGNsYXNzTGlzdCA9IHRhcmdldC5jbGFzc05hbWUuc3BsaXQoJyAnKTsKICAgICAgdmFyIGxlbmd0aCA9IGNsYXNzTGlzdC5sZW5ndGg7CiAgICAgIHZhciBjID0gJyc7CgogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgICAgYyA9IGNsYXNzTGlzdFtpXTsKCiAgICAgICAgaWYgKGMuaW5kZXhPZigndmFsaWQnKSAhPT0gLTEpIHsKICAgICAgICAgIGRlbGV0ZSBjbGFzc0xpc3RbaV07CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAobmV3IENhcmROdW1iZXIkMSgpLnZhbGlkYXRlKHZhbHVlKSkgewogICAgICAgIGNsYXNzTGlzdC5wdXNoKCd2YWxpZCcpOwogICAgICB9IGVsc2UgewogICAgICAgIGNsYXNzTGlzdC5wdXNoKCdpbnZhbGlkJyk7CiAgICAgIH0KCiAgICAgIHRhcmdldC5jbGFzc05hbWUgPSBjbGFzc0xpc3Quam9pbignICcpLnJlcGxhY2UoL15ccyt8XHMrJC9nbSwgJycpOwogICAgfTsKICAgIC8qKgogICAgICogSGVhcnRsYW5kLkNhcmQudmFsaWRhdGVDdnYKICAgICAqCiAgICAgKiBWYWxpZGF0ZXMgYSB0YXJnZXQgZWxlbWVudCdzIHZhbHVlIGJhc2VkIG9uIHRoZQogICAgICogcG9zc2libGUgQ1ZWIGxlbmd0aHMuIEFkZHMgYSBjbGFzcyB0byB0aGUgdGFyZ2V0CiAgICAgKiBlbGVtZW50IHRvIG5vdGUgYHZhbGlkYCBvciBgaW52YWxpZGAuCiAgICAgKgogICAgICogQHBhcmFtIHtFdmVudH0gZQogICAgICovCgoKICAgIENhcmQudmFsaWRhdGVDdnYgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdGFyZ2V0ID0gZS5jdXJyZW50VGFyZ2V0ID8gZS5jdXJyZW50VGFyZ2V0IDogZS5zcmNFbGVtZW50OwogICAgICB2YXIgdmFsdWUgPSB0YXJnZXQudmFsdWU7CiAgICAgIHZhciBjbGFzc0xpc3QgPSB0YXJnZXQuY2xhc3NOYW1lLnNwbGl0KCcgJyk7CiAgICAgIHZhciBsZW5ndGggPSBjbGFzc0xpc3QubGVuZ3RoOwogICAgICB2YXIgYyA9ICcnOwoKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICAgIGMgPSBjbGFzc0xpc3RbaV07CgogICAgICAgIGlmIChjLmluZGV4T2YoJ3ZhbGlkJykgIT09IC0xKSB7CiAgICAgICAgICBkZWxldGUgY2xhc3NMaXN0W2ldOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKG5ldyBDdnYoKS52YWxpZGF0ZSh2YWx1ZSkpIHsKICAgICAgICBjbGFzc0xpc3QucHVzaCgndmFsaWQnKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjbGFzc0xpc3QucHVzaCgnaW52YWxpZCcpOwogICAgICB9CgogICAgICB0YXJnZXQuY2xhc3NOYW1lID0gY2xhc3NMaXN0LmpvaW4oJyAnKS5yZXBsYWNlKC9eXHMrfFxzKyQvZ20sICcnKTsKICAgIH07CiAgICAvKioKICAgICAqIEhlYXJ0bGFuZC5DYXJkLnZhbGlkYXRlRXhwaXJhdGlvbgogICAgICoKICAgICAqIFZhbGlkYXRlcyBhIHRhcmdldCBlbGVtZW50J3MgdmFsdWUgYmFzZWQgb24gdGhlCiAgICAgKiBjdXJyZW50IGRhdGUuIEFkZHMgYSBjbGFzcyB0byB0aGUgdGFyZ2V0IGVsZW1lbnQKICAgICAqIHRvIG5vdGUgYHZhbGlkYCBvciBgaW52YWxpZGAuCiAgICAgKgogICAgICogQHBhcmFtIHtFdmVudH0gZQogICAgICovCgoKICAgIENhcmQudmFsaWRhdGVFeHBpcmF0aW9uID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHRhcmdldCA9IGUuY3VycmVudFRhcmdldCA/IGUuY3VycmVudFRhcmdldCA6IGUuc3JjRWxlbWVudDsKICAgICAgdmFyIHZhbHVlID0gdGFyZ2V0LnZhbHVlOwogICAgICB2YXIgY2xhc3NMaXN0ID0gdGFyZ2V0LmNsYXNzTmFtZS5zcGxpdCgnICcpOwogICAgICB2YXIgbGVuZ3RoID0gY2xhc3NMaXN0Lmxlbmd0aDsKICAgICAgdmFyIGMgPSAnJzsKCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICBjID0gY2xhc3NMaXN0W2ldOwoKICAgICAgICBpZiAoYy5pbmRleE9mKCd2YWxpZCcpICE9PSAtMSkgewogICAgICAgICAgZGVsZXRlIGNsYXNzTGlzdFtpXTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmIChuZXcgRXhwaXJhdGlvbiQxKCkudmFsaWRhdGUodmFsdWUpKSB7CiAgICAgICAgY2xhc3NMaXN0LnB1c2goJ3ZhbGlkJyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY2xhc3NMaXN0LnB1c2goJ2ludmFsaWQnKTsKICAgICAgfQoKICAgICAgdGFyZ2V0LmNsYXNzTmFtZSA9IGNsYXNzTGlzdC5qb2luKCcgJykucmVwbGFjZSgvXlxzK3xccyskL2dtLCAnJyk7CiAgICB9OwogICAgLyoqCiAgICAgKiBIZWFydGxhbmQuQ2FyZC5hdHRhY2hOdW1iZXJFdmVudHMKICAgICAqCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gc2VsZWN0b3IKICAgICAqLwoKCiAgICBDYXJkLmF0dGFjaE51bWJlckV2ZW50cyA9IGZ1bmN0aW9uIChzZWxlY3RvcikgewogICAgICBFdmVudHMuYWRkSGFuZGxlcihkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKSwgJ2tleWRvd24nLCBDYXJkLnJlc3RyaWN0TnVtZXJpYyk7CiAgICAgIEV2ZW50cy5hZGRIYW5kbGVyKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3IpLCAna2V5ZG93bicsIENhcmQucmVzdHJpY3RMZW5ndGgoMTkpKTsKICAgICAgRXZlbnRzLmFkZEhhbmRsZXIoZG9jdW1lbnQucXVlcnlTZWxlY3RvcihzZWxlY3RvciksICdrZXlkb3duJywgQ2FyZC5kZWxldGVQcm9wZXJseSk7CiAgICAgIEV2ZW50cy5hZGRIYW5kbGVyKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3IpLCAna2V5dXAnLCBDYXJkLmZvcm1hdE51bWJlcik7CiAgICAgIEV2ZW50cy5hZGRIYW5kbGVyKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3IpLCAnaW5wdXQnLCBDYXJkLmZvcm1hdE51bWJlcik7CiAgICAgIEV2ZW50cy5hZGRIYW5kbGVyKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3IpLCAnaW5wdXQnLCBDYXJkLnZhbGlkYXRlTnVtYmVyKTsKICAgICAgRXZlbnRzLmFkZEhhbmRsZXIoZG9jdW1lbnQucXVlcnlTZWxlY3RvcihzZWxlY3RvciksICdpbnB1dCcsIENhcmQuYWRkVHlwZSk7CiAgICB9OwogICAgLyoqCiAgICAgKiBIZWFydGxhbmQuQ2FyZC5hdHRhY2hFeHBpcmF0aW9uRXZlbnRzCiAgICAgKgogICAgICogQHBhcmFtIHtzdHJpbmd9IHNlbGVjdG9yCiAgICAgKi8KCgogICAgQ2FyZC5hdHRhY2hFeHBpcmF0aW9uRXZlbnRzID0gZnVuY3Rpb24gKHNlbGVjdG9yKSB7CiAgICAgIEV2ZW50cy5hZGRIYW5kbGVyKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3IpLCAna2V5ZG93bicsIENhcmQucmVzdHJpY3ROdW1lcmljKTsKICAgICAgRXZlbnRzLmFkZEhhbmRsZXIoZG9jdW1lbnQucXVlcnlTZWxlY3RvcihzZWxlY3RvciksICdrZXlkb3duJywgQ2FyZC5yZXN0cmljdExlbmd0aCg5KSk7CiAgICAgIEV2ZW50cy5hZGRIYW5kbGVyKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3IpLCAna2V5dXAnLCBDYXJkLmZvcm1hdEV4cGlyYXRpb24pOwogICAgICBFdmVudHMuYWRkSGFuZGxlcihkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKSwgJ2JsdXInLCBDYXJkLmZvcm1hdEV4cGlyYXRpb24pOwogICAgICBFdmVudHMuYWRkSGFuZGxlcihkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKSwgJ2lucHV0JywgQ2FyZC52YWxpZGF0ZUV4cGlyYXRpb24pOwogICAgICBFdmVudHMuYWRkSGFuZGxlcihkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKSwgJ2JsdXInLCBDYXJkLnZhbGlkYXRlRXhwaXJhdGlvbik7CiAgICB9OwogICAgLyoqCiAgICAgKiBIZWFydGxhbmQuQ2FyZC5hdHRhY2hDdnZFdmVudHMKICAgICAqCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gc2VsZWN0b3IKICAgICAqLwoKCiAgICBDYXJkLmF0dGFjaEN2dkV2ZW50cyA9IGZ1bmN0aW9uIChzZWxlY3RvcikgewogICAgICBFdmVudHMuYWRkSGFuZGxlcihkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKSwgJ2tleWRvd24nLCBDYXJkLnJlc3RyaWN0TnVtZXJpYyk7CiAgICAgIEV2ZW50cy5hZGRIYW5kbGVyKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3IpLCAna2V5ZG93bicsIENhcmQucmVzdHJpY3RMZW5ndGgoNCkpOwogICAgICBFdmVudHMuYWRkSGFuZGxlcihkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKSwgJ2lucHV0JywgQ2FyZC52YWxpZGF0ZUN2dik7CiAgICB9OwoKICAgIHJldHVybiBDYXJkOwogIH0oKTsKCiAgaWYgKCFBcnJheS5wcm90b3R5cGUuaW5kZXhPZikgewogICAgQXJyYXkucHJvdG90eXBlLmluZGV4T2YgPSBmdW5jdGlvbiAob2JqLCBzdGFydCkgewogICAgICBmb3IgKHZhciBpID0gc3RhcnQgfHwgMCwgaiA9IHRoaXMubGVuZ3RoOyBpIDwgajsgaSsrKSB7CiAgICAgICAgaWYgKHRoaXNbaV0gPT09IG9iaikgewogICAgICAgICAgcmV0dXJuIGk7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gLTE7CiAgICB9OwogIH0KCiAgdmFyIEZvcm1hdHRlciA9IHsKICAgIENhcmROdW1iZXI6IENhcmROdW1iZXIsCiAgICBFeHBpcmF0aW9uOiBFeHBpcmF0aW9uCiAgfTsKICB2YXIgZGVmYXVsdHMgPSB7CiAgICBfbWV0aG9kOiAncG9zdCcsCiAgICBidXR0b25UYXJnZXQ6ICcnLAogICAgY2FyZEN2djogJycsCiAgICBjYXJkRXhwTW9udGg6ICcnLAogICAgY2FyZEV4cFllYXI6ICcnLAogICAgY2FyZE51bWJlcjogJycsCiAgICBjYXJkVHlwZTogJycsCiAgICBlbnY6ICdwcm9kJywKICAgIGVycm9yOiBudWxsLAogICAgZmllbGRzOiB7fSwKICAgIGZvcm1JZDogJycsCiAgICBnYXRld2F5VXJsOiAnJywKICAgIGlmcmFtZVRhcmdldDogJycsCiAgICBrdGI6ICcnLAogICAgb2JqZWN0OiAndG9rZW4nLAogICAgb25FdmVudDogbnVsbCwKICAgIG9uVG9rZW5FcnJvcjogbnVsbCwKICAgIG9uVG9rZW5TdWNjZXNzOiBudWxsLAogICAgcGluQmxvY2s6ICcnLAogICAgcHVibGljS2V5OiAnJywKICAgIHN1Y2Nlc3M6IG51bGwsCiAgICB0YXJnZXRUeXBlOiAnJywKICAgIHRva2VuVHlwZTogJ3N1cHQnLAogICAgdHJhY2s6ICcnLAogICAgdHJhY2tOdW1iZXI6ICcnLAogICAgdHlwZTogJ3BhbicsCiAgICB1c2VEZWZhdWx0U3R5bGVzOiB0cnVlCiAgfTsKICB2YXIgZmllbGRzID0gWydjYXJkTnVtYmVyJywgJ2NhcmRDdnYnLCAnY2FyZEV4cGlyYXRpb24nLCAnc3VibWl0J107CiAgdmFyIHVybHMgPSB7CiAgICBDRVJUOiAnaHR0cHM6Ly9jZXJ0LmFwaTIuaGVhcnRsYW5kcG9ydGljby5jb20vSHBzLkV4Y2hhbmdlLlBvc0dhdGV3YXkuSHBmLnYxL2FwaS90b2tlbicsCiAgICBQUk9EOiAnaHR0cHM6Ly9hcGkuaGVhcnRsYW5kcG9ydGljby5jb20vU2VjdXJlU3VibWl0LnYxL2FwaS90b2tlbicsCiAgICBpZnJhbWVDRVJUOiAnaHR0cHM6Ly9ocHMuZ2l0aHViLmlvL3Rva2VuLzIuMS8nLAogICAgaWZyYW1lUFJPRDogJ2h0dHBzOi8vYXBpLmhlYXJ0bGFuZHBvcnRpY28uY29tL1NlY3VyZVN1Ym1pdC52MS90b2tlbi8yLjEvJwogIH07CiAgLyoqCiAgICogSGVhcnRsYW5kLk1lc3NhZ2VzCiAgICoKICAgKiBJbml0aWFsaXplcyBhIG5ldyBvYmplY3QgZm9yIHdyYXBwaW5nIGB3aW5kb3cucG9zdE1lc3NhZ2VgIGFuZCBhIGZhbGxiYWNrCiAgICogbWV0aG9kIGZvciBsZWdhY3kgYnJvd3NlcnMuCiAgICovCgogIHZhciBNZXNzYWdlcyA9IGZ1bmN0aW9uICgpIHsKICAgIC8qKgogICAgICogSGVhcnRsYW5kLk1lc3NhZ2VzIChjb25zdHJ1Y3RvcikKICAgICAqCiAgICAgKiBAY29uc3RydWN0b3IKICAgICAqIEBwYXJhbSB7SGVhcnRsYW5kLkhQU30gaHBzCiAgICAgKiBAcmV0dXJucyB7SGVhcnRsYW5kLk1lc3NhZ2VzfQogICAgICovCiAgICBmdW5jdGlvbiBNZXNzYWdlcyhocHMpIHsKICAgICAgdGhpcy5ocHMgPSBocHM7CiAgICAgIHRoaXMuaW50ZXJ2YWxJZCA9IG51bGw7CiAgICAgIHRoaXMubGFzdEhhc2ggPSAnJzsKICAgICAgdGhpcy5wdXNoSW50ZXJ2YWxTdGFydGVkID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIEhlYXJ0bGFuZC5NZXNzYWdlcy5wdXNoTWVzc2FnZXMKICAgICAqCiAgICAgKiBGb3IgbGVnYWN5IGJyb3dzZXJzLCBhIG1haWxib3ggKGJ1ZmZlcikgbXVzdCBiZSB1c2VkIHRvIGVuc3VyZSBhbGwgbWVzc2FnZXMKICAgICAqIGFyZSBzZW50IGJldHdlZW4gcGFyZW50IGFuZCBjaGlsZCB3aW5kb3dzLiBXaGVuIHJlYWR5LCB0aGlzIGZ1bmN0aW9uIGJ1aWxkcwogICAgICogdGhlIGZpbmFsIG1lc3NhZ2UsIGVuY29kZXMgaXQsIHNlbmRzIGl0LCBhbmQgcmVzZXRzIHRoZSBtYWlsYm94IHRvIGBbXWAuCiAgICAgKgogICAgICogQHBhcmFtIHtIZWFydGxhbmQuSFBTfSBocHMKICAgICAqIEByZXR1cm5zIHtmdW5jdGlvbn0KICAgICAqLwoKCiAgICBNZXNzYWdlcy5wcm90b3R5cGUucHVzaE1lc3NhZ2VzID0gZnVuY3Rpb24gKGhwcykgewogICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBkYXRhID0gW107CiAgICAgICAgdmFyIG1lc3NhZ2VBcnIgPSBbXTsKICAgICAgICB2YXIgaSA9IDA7CiAgICAgICAgdmFyIHRhcmdldFVybCA9ICcnOwogICAgICAgIHZhciBjdXJyZW50OwogICAgICAgIHZhciB0YXJnZXROb2RlOwogICAgICAgIHZhciByZSA9IC9eIz9cZCsmLzsKICAgICAgICB2YXIgbGVuZ3RoID0gaHBzLm1haWxib3gubGVuZ3RoOwoKICAgICAgICBpZiAoIWxlbmd0aCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgZm9yIChpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBjdXJyZW50ID0gaHBzLm1haWxib3guc2hpZnQoKTsKCiAgICAgICAgICBpZiAoIXRhcmdldFVybCkgewogICAgICAgICAgICB0YXJnZXRVcmwgPSBjdXJyZW50LnRhcmdldFVybDsKICAgICAgICAgICAgdGFyZ2V0Tm9kZSA9IGN1cnJlbnQudGFyZ2V0Tm9kZTsKICAgICAgICAgIH0KCiAgICAgICAgICBtZXNzYWdlQXJyLnB1c2goY3VycmVudC5tZXNzYWdlKTsKICAgICAgICB9CgogICAgICAgIGN1cnJlbnQgPSBudWxsOwoKICAgICAgICBpZiAocmUudGVzdCh3aW5kb3cubG9jYXRpb24uaGFzaCkpIHsKICAgICAgICAgIGN1cnJlbnQgPSBKU09OMi5wYXJzZShkZWNvZGVVUklDb21wb25lbnQod2luZG93LmxvY2F0aW9uLmhhc2gucmVwbGFjZShyZSwgJycpKSk7CiAgICAgICAgICBkYXRhLmNvbmNhdChjdXJyZW50KTsKICAgICAgICB9CgogICAgICAgIGlmIChtZXNzYWdlQXJyICE9PSBbXSkgewogICAgICAgICAgaHBzLmNhY2hlQnVzdCA9IGhwcy5jYWNoZUJ1c3QgfHwgMTsKICAgICAgICAgIGRhdGEucHVzaCh7CiAgICAgICAgICAgIGRhdGE6IG1lc3NhZ2VBcnIsCiAgICAgICAgICAgIHNvdXJjZTogewogICAgICAgICAgICAgIG5hbWU6IGhwcy5maWVsZCB8fCAncGFyZW50JwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICAgIHZhciBtZXNzYWdlID0gSlNPTjIuc3RyaW5naWZ5KGRhdGEpOwogICAgICAgICAgdmFyIHVybCA9IHRhcmdldFVybC5yZXBsYWNlKC8jLiokLywgJycpICsgJyMnICsgK25ldyBEYXRlKCkgKyBocHMuY2FjaGVCdXN0KysgKyAnJicgKyBlbmNvZGVVUklDb21wb25lbnQobWVzc2FnZSk7CgogICAgICAgICAgaWYgKHRhcmdldE5vZGUubG9jYXRpb24pIHsKICAgICAgICAgICAgdGFyZ2V0Tm9kZS5sb2NhdGlvbi5ocmVmID0gdXJsOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGFyZ2V0Tm9kZS5zcmMgPSB1cmw7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBtZXNzYWdlQXJyLmxlbmd0aCA9IDA7CiAgICAgICAgaHBzLm1haWxib3gubGVuZ3RoID0gMDsKICAgICAgfTsKICAgIH07CiAgICAvKioKICAgICAqIEhlYXJ0bGFuZC5NZXNzYWdlcy5wb3N0CiAgICAgKgogICAgICogV2hlbiBwcmVzZW50LCB3cmFwcyB0aGUgYnVpbHQtaW4gYHdpbmRvdy5wb3N0TWVzc2FnZWAuIFdoZW4gbm90IHByZXNlbnQsCiAgICAgKiBwdXNoZXMgdGhlIG1lc3NhZ2Ugb250byB0aGUgbWFpbGJveCBmb3IgZXZlbnR1YWwgc2VuZGluZywgYW5kIG9uIGZpcnN0IHVzZSwKICAgICAqIHN0YXJ0cyB0aGUgaW50ZXJ2YWwgZm9yIGBNZXNzYWdlcy5wdXNoTWVzc2FnZXNgLgogICAgICoKICAgICAqIEBwYXJhbSB7T2JqZWN0IHwgc3RyaW5nfSBtZXNzYWdlCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdGFyZ2V0CiAgICAgKi8KCgogICAgTWVzc2FnZXMucHJvdG90eXBlLnBvc3QgPSBmdW5jdGlvbiAobWVzc2FnZSwgdGFyZ2V0KSB7CiAgICAgIHZhciB0YXJnZXROb2RlOwogICAgICBtZXNzYWdlLnNvdXJjZSA9IG1lc3NhZ2Uuc291cmNlIHx8IHt9OwogICAgICBtZXNzYWdlLnNvdXJjZS5uYW1lID0gd2luZG93Lm5hbWU7CgogICAgICBpZiAoIXRoaXMuaHBzLmZyYW1lcykgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIGZyYW1lID0gdGhpcy5ocHMuZnJhbWVzW3RhcmdldF0gfHwgdGhpcy5ocHNbdGFyZ2V0XTsKCiAgICAgIGlmICghZnJhbWUpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciB0YXJnZXRVcmwgPSB0aGlzLmhwcy5mcmFtZXNbdGFyZ2V0XS51cmw7CgogICAgICB0cnkgewogICAgICAgIGlmICh0eXBlb2YgZnJhbWUudGFyZ2V0Tm9kZSAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgIHRhcmdldE5vZGUgPSBmcmFtZS50YXJnZXROb2RlOwogICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGZyYW1lLmZyYW1lICE9PSAndW5kZWZpbmVkJykgewogICAgICAgICAgdGFyZ2V0Tm9kZSA9IGZyYW1lLmZyYW1lOwogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIHRhcmdldE5vZGUgPSBmcmFtZTsKICAgICAgfQoKICAgICAgaWYgKHdpbmRvdy5wb3N0TWVzc2FnZSkgewogICAgICAgIHRhcmdldE5vZGUucG9zdE1lc3NhZ2UoSlNPTjIuc3RyaW5naWZ5KG1lc3NhZ2UpLCB0YXJnZXRVcmwpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuaHBzLm1haWxib3ggPSB0aGlzLmhwcy5tYWlsYm94IHx8IFtdOwogICAgICAgIHRoaXMuaHBzLm1haWxib3gucHVzaCh7CiAgICAgICAgICBtZXNzYWdlOiBtZXNzYWdlLAogICAgICAgICAgdGFyZ2V0Tm9kZTogdGFyZ2V0Tm9kZSwKICAgICAgICAgIHRhcmdldFVybDogdGFyZ2V0VXJsCiAgICAgICAgfSk7CgogICAgICAgIGlmICghdGhpcy5wdXNoSW50ZXJ2YWxTdGFydGVkKSB7CiAgICAgICAgICBzZXRJbnRlcnZhbCh0aGlzLnB1c2hNZXNzYWdlcyh0aGlzLmhwcyksIDEwKTsKICAgICAgICB9CiAgICAgIH0KICAgIH07CiAgICAvKioKICAgICAqIEhlYXJ0bGFuZC5NZXNzYWdlcy5yZWNlaXZlCiAgICAgKgogICAgICogV2hlbiBwcmVzZW50LCB3cmFwcyB0aGUgYnVpbHQtaW4gYHdpbmRvdy5wb3N0TWVzYWdlYCdzIGBtZXNzYWdlYCBvcgogICAgICogYG9ubWVzc2FnZWAgd2luZG93IGV2ZW50cy4gV2hlbiBub3QgcHJlc2VudCwgdXNlcyBhIHNpbmdsZSBpbnRlcnZhbCB0bwogICAgICogY2hlY2sgZm9yIGNoYW5nZXMgdG8gYHdpbmRvdy5sb2NhdGlvbi5oYXNoYCB3aGVuIHRoZSBvdGhlciB3aW5kb3cgc2VuZHMgYQogICAgICogbWVzc2FnZSBhbmQgd2lsbCBkZWNvZGUgdGhlIEpTT04gYW5kIFVSSSBlbmNvZGVkIGhhc2guCiAgICAgKgogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBzb3VyY2VPcmlnaW4KICAgICAqLwoKCiAgICBNZXNzYWdlcy5wcm90b3R5cGUucmVjZWl2ZSA9IGZ1bmN0aW9uIChjYWxsYmFjaywgc291cmNlT3JpZ2luKSB7CiAgICAgIGlmICh3aW5kb3cucG9zdE1lc3NhZ2UpIHsKICAgICAgICB0aGlzLmNhbGxiYWNrID0gZnVuY3Rpb24gKG0pIHsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGNhbGxiYWNrKEpTT04yLnBhcnNlKG0uZGF0YSkpOwogICAgICAgICAgfSBjYXRjaCAoZSkge30KICAgICAgICB9OwoKICAgICAgICBpZiAod2luZG93LmFkZEV2ZW50TGlzdGVuZXIpIHsKICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgdGhpcy5jYWxsYmFjaywgITEpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB3aW5kb3cuYXR0YWNoRXZlbnQoJ29ubWVzc2FnZScsIHRoaXMuY2FsbGJhY2spOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAodGhpcy5pbnRlcnZhbElkKSB7CiAgICAgICAgICBjbGVhckludGVydmFsKHRoaXMuaW50ZXJ2YWxJZCk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLmludGVydmFsSWQgPSBudWxsOwoKICAgICAgICBpZiAoY2FsbGJhY2spIHsKICAgICAgICAgIHRoaXMuaW50ZXJ2YWxJZCA9IHNldEludGVydmFsKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIGhhc2ggPSBkb2N1bWVudC5sb2NhdGlvbi5oYXNoLAogICAgICAgICAgICAgICAgcmUgPSAvXiM/XGQrJi87CgogICAgICAgICAgICBpZiAoaGFzaCAhPT0gdGhpcy5sYXN0SGFzaCAmJiByZS50ZXN0KGhhc2gpKSB7CiAgICAgICAgICAgICAgdmFyIGRhdGEgPSBKU09OMi5wYXJzZShkZWNvZGVVUklDb21wb25lbnQoaGFzaC5yZXBsYWNlKHJlLCAnJykpKTsKICAgICAgICAgICAgICB0aGlzLmxhc3RIYXNoID0gaGFzaDsKCiAgICAgICAgICAgICAgZm9yICh2YXIgaSBpbiBkYXRhKSB7CiAgICAgICAgICAgICAgICB2YXIgbSA9IGRhdGFbaV07CgogICAgICAgICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChtLmRhdGEpICE9PSAnW29iamVjdCBBcnJheV0nKSB7CiAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKG0pOwogICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBmb3IgKHZhciBqIGluIG0uZGF0YSkgewogICAgICAgICAgICAgICAgICBjYWxsYmFjayh7CiAgICAgICAgICAgICAgICAgICAgZGF0YTogbS5kYXRhW2pdLAogICAgICAgICAgICAgICAgICAgIHNvdXJjZTogbS5zb3VyY2UKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9LCAxMDApOwogICAgICAgIH0KICAgICAgfQoKICAgICAgRXZlbnRzLnRyaWdnZXIoJ3JlY2VpdmVNZXNzYWdlSGFuZGxlckFkZGVkJywgZG9jdW1lbnQpOwogICAgfTsKICAgIC8qKgogICAgICogSGVhcnRsYW5kLk1lc3NhZ2VzLnJlbW92ZVJlY2VpdmVyCiAgICAgKgogICAgICogUmVtb3ZlcyBhY3RpdmUgYG1lc3NhZ2VgIGV2ZW50IGhhbmRsZXIgZnVuY3Rpb24uCiAgICAgKi8KCgogICAgTWVzc2FnZXMucHJvdG90eXBlLnJlbW92ZVJlY2VpdmVyID0gZnVuY3Rpb24gKCkgewogICAgICBpZiAod2luZG93LmFkZEV2ZW50TGlzdGVuZXIpIHsKICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIHRoaXMuY2FsbGJhY2ssICExKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB3aW5kb3cuZGV0YWNoRXZlbnQoJ29ubWVzc2FnZScsIHRoaXMuY2FsbGJhY2spOwogICAgICB9CiAgICB9OwogICAgLyoqCiAgICAgKiBIZWFydGxhbmQuTWVzc2FnZXMuZGlzcG9zZQogICAgICoKICAgICAqIFJlbW92ZXMgYWN0aXZlIGBtZXNzYWdlYCBldmVudCBoYW5kbGVyIGZ1bmN0aW9uIGFuZCBhbnkKICAgICAqIGFjdGl2ZSBpbnRlcnZhbHMuCiAgICAgKi8KCgogICAgTWVzc2FnZXMucHJvdG90eXBlLmRpc3Bvc2UgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHRoaXMucmVtb3ZlUmVjZWl2ZXIoKTsKCiAgICAgIGlmICh0aGlzLmludGVydmFsSWQpIHsKICAgICAgICBjbGVhckludGVydmFsKHRoaXMuaW50ZXJ2YWxJZCk7CiAgICAgIH0KICAgIH07CgogICAgcmV0dXJuIE1lc3NhZ2VzOwogIH0oKTsKICAvKioKICAgKiBAbmFtZXNwYWNlIEhlYXJ0bGFuZC5TdHlsZXMKICAgKi8KCgogIHZhciBTdHlsZXM7CgogIChmdW5jdGlvbiAoU3R5bGVzKSB7CiAgICAvKioKICAgICAqIEhlYXJ0bGFuZC5TdHlsZXMuRGVmYXVsdHMKICAgICAqCiAgICAgKiBDb2xsZWN0aW9uIG9mIGhlbHBlciBmdW5jdGlvbnMgZm9yIGFwcGx5aW5nIGRlZmF1bHQgc3R5bGVzIHRvIGEgY2hpbGQKICAgICAqIHdpbmRvdydzIGZpZWxkcy4gU2VydmVzIGFzIGFuIGV4YW1wbGUgb2YgdGhlc2UgbWV0aG9kcycgdXNlIGluIG1lcmNoYW50CiAgICAgKiBtb2RpZmljYXRpb25zLiBFYWNoIGZ1bmN0aW9uIGV4cGVjdHMgYSBgSGVhcnRsYW5kLkhQU2Agb2JqZWN0IHRvIGJlIHBhc3NlZAogICAgICogYXMgYW4gYXJndW1lbnQuCiAgICAgKi8KICAgIFN0eWxlcy5EZWZhdWx0cyA9IHsKICAgICAgYm9keTogZnVuY3Rpb24gYm9keShocHMpIHsKICAgICAgICBocHMuc2V0U3R5bGUoJ2hlYXJ0bGFuZC1ib2R5JywgJ21hcmdpbjogMDsnICsgJ2ZvbnQtZmFtaWx5OiBBcmlhbCwgXCdIZWx2ZXRpY2EgTmV1ZVwnLCBIZWx2ZXRpY2EsIHNhbnMtc2VyaWY7JyArICdjb2xvcjogIzY2NjsnKTsKICAgICAgfSwKICAgICAgY3Z2OiBmdW5jdGlvbiBjdnYoaHBzKSB7CiAgICAgICAgaHBzLmFwcGVuZFN0eWxlKCdoZWFydGxhbmQtY3Z2JywgJ3dpZHRoOiAxMTBweDsnKTsKICAgICAgfSwKICAgICAgY3Z2Q29udGFpbmVyOiBmdW5jdGlvbiBjdnZDb250YWluZXIoaHBzKSB7CiAgICAgICAgaHBzLnNldFN0eWxlKCdoZWFydGxhbmQtY3Z2LWNvbnRhaW5lcicsICd3aWR0aDogMTEwcHg7JyArICdkaXNwbGF5OiBpbmxpbmUtYmxvY2s7JyArICdmbG9hdDogbGVmdDsnKTsKICAgICAgfSwKICAgICAgZmllbGRzZXQ6IGZ1bmN0aW9uIGZpZWxkc2V0KGhwcykgewogICAgICAgIGhwcy5zZXRTdHlsZSgnaGVhcnRsYW5kLWV4cGlyYXRpb24tZGF0ZS1jb250YWluZXInLCAnYm9yZGVyOiAwOycgKyAnbWFyZ2luOiAwIDI1cHggMHB4IDFweDsnICsgJ3BhZGRpbmc6IDA7JyArICd3aWR0aDogMTczcHg7JyArICdkaXNwbGF5OiBpbmxpbmUtYmxvY2s7JyArICdmbG9hdDogIGxlZnQ7Jyk7CiAgICAgIH0sCiAgICAgIGlucHV0c0FuZFNlbGVjdHM6IGZ1bmN0aW9uIGlucHV0c0FuZFNlbGVjdHMoaHBzKSB7CiAgICAgICAgdmFyIGlkcyA9IFsnaGVhcnRsYW5kLWNhcmQtbnVtYmVyJywgJ2hlYXJ0bGFuZC1leHBpcmF0aW9uLW1vbnRoJywgJ2hlYXJ0bGFuZC1leHBpcmF0aW9uLXllYXInLCAnaGVhcnRsYW5kLWN2diddOwogICAgICAgIHZhciBsZW5ndGggPSBpZHMubGVuZ3RoOwogICAgICAgIHZhciBpID0gMDsKCiAgICAgICAgZm9yIChpOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGhwcy5zZXRTdHlsZShpZHNbaV0sICd3aWR0aDogMzA5cHg7JyArICdwYWRkaW5nOiA1cHg7JyArICdmb250LXNpemU6IDE0cHg7JyArICdtYXJnaW46IDNweCAwcHggMTVweCAwcHg7JyArICdib3JkZXI6IDFweCAjY2NjIHNvbGlkOycgKwogICAgICAgICAgLyogSUUxMCBDb25zdW1lciBQcmV2aWV3ICovCiAgICAgICAgICAnYmFja2dyb3VuZC1pbWFnZTogLW1zLWxpbmVhci1ncmFkaWVudChib3R0b20sICNGN0Y3RjcgMCUsICNFRkVGRUYgMTAwJSk7JyArCiAgICAgICAgICAvKiBNb3ppbGxhIEZpcmVmb3ggKi8KICAgICAgICAgICdiYWNrZ3JvdW5kLWltYWdlOiAtbW96LWxpbmVhci1ncmFkaWVudChib3R0b20sICNGN0Y3RjcgMCUsICNFRkVGRUYgMTAwJSk7JyArCiAgICAgICAgICAvKiBPcGVyYSAqLwogICAgICAgICAgJ2JhY2tncm91bmQtaW1hZ2U6IC1vLWxpbmVhci1ncmFkaWVudChib3R0b20sICNGN0Y3RjcgMCUsICNFRkVGRUYgMTAwJSk7JyArCiAgICAgICAgICAvKiBXZWJraXQgKFNhZmFyaS9DaHJvbWUgMTApICovCiAgICAgICAgICAnYmFja2dyb3VuZC1pbWFnZTogLXdlYmtpdC1ncmFkaWVudChsaW5lYXIsIGxlZnQgYm90dG9tLCBsZWZ0IHRvcCwgY29sb3Itc3RvcCgwLCAjRjdGN0Y3KSwgY29sb3Itc3RvcCgxLCAjRUZFRkVGKSk7JyArCiAgICAgICAgICAvKiBXZWJraXQgKENocm9tZSAxMSspICovCiAgICAgICAgICAnYmFja2dyb3VuZC1pbWFnZTogLXdlYmtpdC1saW5lYXItZ3JhZGllbnQoYm90dG9tLCAjRjdGN0Y3IDAlLCAjRUZFRkVGIDEwMCUpOycgKwogICAgICAgICAgLyogVzNDIE1hcmt1cCwgSUUxMCBSZWxlYXNlIFByZXZpZXcgKi8KICAgICAgICAgICdiYWNrZ3JvdW5kLWltYWdlOiBsaW5lYXItZ3JhZGllbnQodG8gdG9wLCAjRjdGN0Y3IDAlLCAjRUZFRkVGIDEwMCUpOycpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgbGFiZWxzQW5kTGVnZW5kOiBmdW5jdGlvbiBsYWJlbHNBbmRMZWdlbmQoaHBzKSB7CiAgICAgICAgdmFyIGlkcyA9IFsnaGVhcnRsYW5kLWNhcmQtbnVtYmVyLWxhYmVsJywgJ2hlYXJ0bGFuZC1leHBpcmF0aW9uLWRhdGUtbGVnZW5kJywgJ2hlYXJ0bGFuZC1leHBpcmF0aW9uLW1vbnRoLWxhYmVsJywgJ2hlYXJ0bGFuZC1leHBpcmF0aW9uLXllYXItbGFiZWwnLCAnaGVhcnRsYW5kLWN2di1sYWJlbCddOwogICAgICAgIHZhciBsZW5ndGggPSBpZHMubGVuZ3RoOwogICAgICAgIHZhciBpID0gMDsKCiAgICAgICAgZm9yIChpOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGhwcy5zZXRTdHlsZShpZHNbaV0sICdmb250LXNpemU6IDEzcHg7JyArICd0ZXh0LXRyYW5zZm9ybTogdXBwZXJjYXNlOycgKyAnZm9udC13ZWlnaHQ6IGJvbGQ7JyArICdkaXNwbGF5OiBibG9jazsnICsgJ3dpZHRoOiAxMDAlOycgKyAnY2xlYXI6IGJvdGg7Jyk7CiAgICAgICAgfQogICAgICB9LAogICAgICBzZWxlY3RMYWJlbHM6IGZ1bmN0aW9uIHNlbGVjdExhYmVscyhocHMpIHsKICAgICAgICB2YXIgaWRzID0gWydoZWFydGxhbmQtZXhwaXJhdGlvbi1tb250aC1sYWJlbCcsICdoZWFydGxhbmQtZXhwaXJhdGlvbi15ZWFyLWxhYmVsJ107CiAgICAgICAgdmFyIGxlbmd0aCA9IGlkcy5sZW5ndGg7CiAgICAgICAgdmFyIGkgPSAwOwoKICAgICAgICBmb3IgKGk7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICAgICAgaHBzLnNldFN0eWxlKGlkc1tpXSwgJ3Bvc2l0aW9uOmFic29sdXRlOycgKyAnd2lkdGg6MXB4OycgKyAnaGVpZ2h0OjFweDsnICsgJ3BhZGRpbmc6MDsnICsgJ21hcmdpbjotMXB4OycgKyAnb3ZlcmZsb3c6aGlkZGVuOycgKyAnY2xpcDpyZWN0KDAsMCwwLDApOycgKyAnYm9yZGVyOjA7Jyk7CiAgICAgICAgfQogICAgICB9LAogICAgICBzZWxlY3RzOiBmdW5jdGlvbiBzZWxlY3RzKGhwcykgewogICAgICAgIHZhciBpZHMgPSBbJ2hlYXJ0bGFuZC1leHBpcmF0aW9uLW1vbnRoJywgJ2hlYXJ0bGFuZC1leHBpcmF0aW9uLXllYXInXTsKICAgICAgICB2YXIgbGVuZ3RoID0gaWRzLmxlbmd0aDsKICAgICAgICB2YXIgaSA9IDA7CgogICAgICAgIGZvciAoaTsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBocHMuYXBwZW5kU3R5bGUoaWRzW2ldLCAnYm9yZGVyOiAwOycgKyAnb3V0bGluZTogMXB4IHNvbGlkICNjY2M7JyArICdoZWlnaHQ6IDI4cHg7JyArICd3aWR0aDogODBweDsnICsgJy13ZWJraXQtYXBwZWFyYW5jZTogbm9uZTsnICsgJy1tb3otYXBwZWFyYW5jZTogbm9uZTsnICsgJy13ZWJraXQtYm9yZGVyLXJhZGl1czogMHB4OycgKwogICAgICAgICAgLyogdHNsaW50OmRpc2FibGU6bWF4LWxpbmUtbGVuZ3RoICovCiAgICAgICAgICAnYmFja2dyb3VuZC1pbWFnZTogdXJsKGRhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBQW9BQUFBR0NBWUFBQUQ2OEEvR0FBQUFHWFJGV0hSVGIyWjBkMkZ5WlFCQlpHOWlaU0JKYldGblpWSmxZV1I1Y2NsbFBBQUFBeWhwVkZoMFdFMU1PbU52YlM1aFpHOWlaUzU0YlhBQUFBQUFBRHcvZUhCaFkydGxkQ0JpWldkcGJqMGk3N3UvSWlCcFpEMGlWelZOTUUxd1EyVm9hVWg2Y21WVGVrNVVZM3ByWXpsa0lqOCtJRHg0T25odGNHMWxkR0VnZUcxc2JuTTZlRDBpWVdSdlltVTZibk02YldWMFlTOGlJSGc2ZUcxd2RHczlJa0ZrYjJKbElGaE5VQ0JEYjNKbElEVXVOaTFqTURFMElEYzVMakUxTmpjNU55d2dNakF4TkM4d09DOHlNQzB3T1RvMU16b3dNaUFnSUNBZ0lDQWdJajRnUEhKa1pqcFNSRVlnZUcxc2JuTTZjbVJtUFNKb2RIUndPaTh2ZDNkM0xuY3pMbTl5Wnk4eE9UazVMekF5THpJeUxYSmtaaTF6ZVc1MFlYZ3Ribk1qSWo0Z1BISmtaanBFWlhOamNtbHdkR2x2YmlCeVpHWTZZV0p2ZFhROUlpSWdlRzFzYm5NNmVHMXdQU0pvZEhSd09pOHZibk11WVdSdlltVXVZMjl0TDNoaGNDOHhMakF2SWlCNGJXeHVjenA0YlhCTlRUMGlhSFIwY0RvdkwyNXpMbUZrYjJKbExtTnZiUzk0WVhBdk1TNHdMMjF0THlJZ2VHMXNibk02YzNSU1pXWTlJbWgwZEhBNkx5OXVjeTVoWkc5aVpTNWpiMjB2ZUdGd0x6RXVNQzl6Vkhsd1pTOVNaWE52ZFhKalpWSmxaaU1pSUhodGNEcERjbVZoZEc5eVZHOXZiRDBpUVdSdlltVWdVR2h2ZEc5emFHOXdJRU5ESURJd01UUWdLRTFoWTJsdWRHOXphQ2tpSUhodGNFMU5Pa2x1YzNSaGJtTmxTVVE5SW5odGNDNXBhV1E2UXpBNU1UWkZOMFJGTURZMk1URkZORUl5T0RaRk1VUkZSVEEzUkVVeE1qY2lJSGh0Y0UxTk9rUnZZM1Z0Wlc1MFNVUTlJbmh0Y0M1a2FXUTZRekE1TVRaRk4wVkZNRFkyTVRGRk5FSXlPRFpGTVVSRlJUQTNSRVV4TWpjaVBpQThlRzF3VFUwNlJHVnlhWFpsWkVaeWIyMGdjM1JTWldZNmFXNXpkR0Z1WTJWSlJEMGllRzF3TG1scFpEcERNRGt4TmtVM1FrVXdOall4TVVVMFFqSTROa1V4UkVWRk1EZEVSVEV5TnlJZ2MzUlNaV1k2Wkc5amRXMWxiblJKUkQwaWVHMXdMbVJwWkRwRE1Ea3hOa1UzUTBVd05qWXhNVVUwUWpJNE5rVXhSRVZGTURkRVJURXlOeUl2UGlBOEwzSmtaanBFWlhOamNtbHdkR2x2Ymo0Z1BDOXlaR1k2VWtSR1BpQThMM2c2ZUcxd2JXVjBZVDRnUEQ5NGNHRmphMlYwSUdWdVpEMGljaUkvUHZNcmRVQUFBQUJpU1VSQlZIamFZa3hMUzN2TndNQWd3b0FmdkdVQ0Vqa01oRUUyODVrelo2NXUyYkxsSjVEamdrTlJ4VXdnWVB6Ly96K1lsNTZlUGhOSXBhRXBBcW5KQURHWWtBU3pnSGduRW44SHlFb1lCMjRpMUZSZUlMVVB5blVFbXZZRkpnY1FZQUNZYWgrdURocEtHQUFBQUFCSlJVNUVya0pnZ2c9PSk7JyArCiAgICAgICAgICAvKiB0c2xpbnQ6ZW5hYmxlOm1heC1saW5lLWxlbmd0aCAqLwogICAgICAgICAgJ2JhY2tncm91bmQtcG9zaXRpb246IDY1cHggMTJweDsnICsgJ2JhY2tncm91bmQtcmVwZWF0OiBuby1yZXBlYXQ7JyArICdiYWNrZ3JvdW5kLWNvbG9yOiAgI0Y3RjdGNzsnICsgJ2Zsb2F0OiBsZWZ0OycgKyAnbWFyZ2luLXJpZ2h0OiA2cHgnKTsKICAgICAgICB9CiAgICAgIH0KICAgIH07CiAgfSkoU3R5bGVzIHx8IChTdHlsZXMgPSB7fSkpOwogIC8qKgogICAqIEBuYW1lc3BhY2UgSGVhcnRsYW5kLkZyYW1lcwogICAqLwoKCiAgdmFyIEZyYW1lcyA9IGZ1bmN0aW9uICgpIHsKICAgIGZ1bmN0aW9uIEZyYW1lcygpIHt9CiAgICAvKioKICAgICAqIEhlYXJ0bGFuZC5GcmFtZXMuY29uZmlndXJlSWZyYW1lCiAgICAgKgogICAgICogUHJlcGFyZXMgdGhlIHBhZ2VzIGlGcmFtZXMgZm9yIGNvbW11bmljYXRpb24gd2l0aCB0aGUgcGFyZW50IHdpbmRvdy4KICAgICAqCiAgICAgKiBAcGFyYW0ge0hlYXJ0bGFuZC5IUFN9IGhwcwogICAgICogQGxpc3RlbnMgY2xpY2sKICAgICAqIEBsaXN0ZW5zIG1lc3NhZ2UKICAgICAqLwoKCiAgICBGcmFtZXMuY29uZmlndXJlSWZyYW1lID0gZnVuY3Rpb24gKGhwcykgewogICAgICB2YXIgZnJhbWU7CiAgICAgIHZhciBvcHRpb25zID0gaHBzLm9wdGlvbnM7CiAgICAgIHZhciB0YXJnZXQ7CiAgICAgIHZhciB1c2VEZWZhdWx0U3R5bGVzID0gdHJ1ZTsKICAgICAgaHBzLk1lc3NhZ2VzID0gaHBzLk1lc3NhZ2VzIHx8IG5ldyBNZXNzYWdlcyhocHMpOwoKICAgICAgaWYgKG9wdGlvbnMuZW52ID09PSAnY2VydCcpIHsKICAgICAgICBocHMuaWZyYW1lX3VybCA9IHVybHMuaWZyYW1lQ0VSVDsKICAgICAgfSBlbHNlIHsKICAgICAgICBocHMuaWZyYW1lX3VybCA9IHVybHMuaWZyYW1lUFJPRDsKICAgICAgfQoKICAgICAgaWYgKG9wdGlvbnMuZmllbGRzICE9PSBkZWZhdWx0cy5maWVsZHMpIHsKICAgICAgICBGcmFtZXMubWFrZUZpZWxkc0FuZExpbmsoaHBzKTsKICAgICAgfQoKICAgICAgaWYgKG9wdGlvbnMuZmllbGRzID09PSBkZWZhdWx0cy5maWVsZHMgJiYgb3B0aW9ucy5pZnJhbWVUYXJnZXQpIHsKICAgICAgICB0YXJnZXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChvcHRpb25zLmlmcmFtZVRhcmdldCk7CgogICAgICAgIGlmIChvcHRpb25zLnRhcmdldFR5cGUgPT09ICdteWZyYW1lJykgewogICAgICAgICAgZnJhbWUgPSB0YXJnZXQ7CiAgICAgICAgICBocHMuaWZyYW1lX3VybCA9IGZyYW1lLnNyYzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZnJhbWUgPSBET00ubWFrZUZyYW1lKCdoZWFydGxhbmQtZnJhbWUtc2VjdXJlc3VibWl0Jyk7CiAgICAgICAgICB0YXJnZXQuYXBwZW5kQ2hpbGQoZnJhbWUpOwogICAgICAgIH0KCiAgICAgICAgaHBzLmlmcmFtZV91cmwgPSBocHMuaWZyYW1lX3VybCArICcjJyArIGVuY29kZVVSSUNvbXBvbmVudChkb2N1bWVudC5sb2NhdGlvbi5ocmVmLnNwbGl0KCcjJylbMF0pOwogICAgICAgIGZyYW1lLnNyYyA9IGhwcy5pZnJhbWVfdXJsOwogICAgICAgIGhwcy5mcmFtZXMuY2hpbGQgPSB7CiAgICAgICAgICBmcmFtZTogd2luZG93LnBvc3RNZXNzYWdlID8gZnJhbWUuY29udGVudFdpbmRvdyA6IGZyYW1lLAogICAgICAgICAgbmFtZTogJ2NoaWxkJywKICAgICAgICAgIHVybDogaHBzLmlmcmFtZV91cmwKICAgICAgICB9OwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy51c2VEZWZhdWx0U3R5bGVzID09PSBmYWxzZSkgewogICAgICAgIHVzZURlZmF1bHRTdHlsZXMgPSBmYWxzZTsKICAgICAgfQoKICAgICAgaWYgKG9wdGlvbnMuYnV0dG9uVGFyZ2V0KSB7CiAgICAgICAgaHBzLmNsaWNrSGFuZGxlciA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICBocHMuTWVzc2FnZXMucG9zdCh7CiAgICAgICAgICAgIGFjY3VtdWxhdGVEYXRhOiAhIWhwcy5mcmFtZXMuY2FyZE51bWJlciwKICAgICAgICAgICAgYWN0aW9uOiAndG9rZW5pemUnLAogICAgICAgICAgICBkYXRhOiB7CiAgICAgICAgICAgICAgcHVibGljS2V5OiBvcHRpb25zLnB1YmxpY0tleQogICAgICAgICAgICB9CiAgICAgICAgICB9LCBocHMuZnJhbWVzLmNhcmROdW1iZXIgPyAnY2FyZE51bWJlcicgOiAnY2hpbGQnKTsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9OwoKICAgICAgICBFdmVudHMuYWRkSGFuZGxlcihvcHRpb25zLmJ1dHRvblRhcmdldCwgJ2NsaWNrJywgaHBzLmNsaWNrSGFuZGxlcik7CiAgICAgIH0KCiAgICAgIGhwcy5NZXNzYWdlcy5yZWNlaXZlKGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgdmFyIGZpZWxkRnJhbWU7CgogICAgICAgIHRyeSB7CiAgICAgICAgICBmaWVsZEZyYW1lID0gaHBzLmZyYW1lc1tkYXRhLnNvdXJjZS5uYW1lID09PSAnaGVhcnRsYW5kLWZyYW1lLXNlY3VyZXN1Ym1pdCcgPyAncGFyZW50JyA6IGRhdGEuc291cmNlLm5hbWVdOwogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHN3aXRjaCAoZGF0YS5hY3Rpb24pIHsKICAgICAgICAgIGNhc2UgJ3JlcXVlc3RUb2tlbml6ZSc6CiAgICAgICAgICAgIGhwcy5NZXNzYWdlcy5wb3N0KHsKICAgICAgICAgICAgICBhY2N1bXVsYXRlRGF0YTogISFocHMuZnJhbWVzLmNhcmROdW1iZXIsCiAgICAgICAgICAgICAgYWN0aW9uOiAndG9rZW5pemUnLAogICAgICAgICAgICAgIGRhdGE6IG9wdGlvbnMKICAgICAgICAgICAgfSwgaHBzLmZyYW1lcy5jYXJkTnVtYmVyID8gJ2NhcmROdW1iZXInIDogJ2NoaWxkJyk7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgJ29uVG9rZW5TdWNjZXNzJzoKICAgICAgICAgICAgb3B0aW9ucy5vblRva2VuU3VjY2VzcyhkYXRhLnJlc3BvbnNlKTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAnb25Ub2tlbkVycm9yJzoKICAgICAgICAgICAgb3B0aW9ucy5vblRva2VuRXJyb3IoZGF0YS5yZXNwb25zZSk7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgJ3Jlc2l6ZSc6CiAgICAgICAgICAgIGlmIChmaWVsZEZyYW1lKSB7CiAgICAgICAgICAgICAgaHBzLnJlc2l6ZUlGcmFtZShmaWVsZEZyYW1lLmZyYW1lLCBkYXRhLmhlaWdodCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgaHBzLnJlc2l6ZUlGcmFtZShmcmFtZSwgZGF0YS5oZWlnaHQpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlICdyZWNlaXZlTWVzc2FnZUhhbmRsZXJBZGRlZCc6CiAgICAgICAgICAgIGlmICghb3B0aW9ucy5maWVsZHMgJiYgdXNlRGVmYXVsdFN0eWxlcykgewogICAgICAgICAgICAgIFN0eWxlcy5EZWZhdWx0cy5ib2R5KGhwcyk7CiAgICAgICAgICAgICAgU3R5bGVzLkRlZmF1bHRzLmxhYmVsc0FuZExlZ2VuZChocHMpOwogICAgICAgICAgICAgIFN0eWxlcy5EZWZhdWx0cy5pbnB1dHNBbmRTZWxlY3RzKGhwcyk7CiAgICAgICAgICAgICAgU3R5bGVzLkRlZmF1bHRzLmZpZWxkc2V0KGhwcyk7CiAgICAgICAgICAgICAgU3R5bGVzLkRlZmF1bHRzLnNlbGVjdHMoaHBzKTsKICAgICAgICAgICAgICBTdHlsZXMuRGVmYXVsdHMuc2VsZWN0TGFiZWxzKGhwcyk7CiAgICAgICAgICAgICAgU3R5bGVzLkRlZmF1bHRzLmN2dkNvbnRhaW5lcihocHMpOwogICAgICAgICAgICAgIFN0eWxlcy5EZWZhdWx0cy5jdnYoaHBzKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGZpZWxkRnJhbWUgJiYgZmllbGRGcmFtZS5vcHRpb25zLnBsYWNlaG9sZGVyKSB7CiAgICAgICAgICAgICAgaHBzLk1lc3NhZ2VzLnBvc3QoewogICAgICAgICAgICAgICAgYWN0aW9uOiAnc2V0UGxhY2Vob2xkZXInLAogICAgICAgICAgICAgICAgaWQ6ICdoZWFydGxhbmQtZmllbGQnLAogICAgICAgICAgICAgICAgdGV4dDogZmllbGRGcmFtZS5vcHRpb25zLnBsYWNlaG9sZGVyCiAgICAgICAgICAgICAgfSwgZmllbGRGcmFtZS5uYW1lKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGZpZWxkRnJhbWUgJiYgZmllbGRGcmFtZS5vcHRpb25zLnZhbHVlKSB7CiAgICAgICAgICAgICAgaHBzLk1lc3NhZ2VzLnBvc3QoewogICAgICAgICAgICAgICAgYWN0aW9uOiAnc2V0VmFsdWUnLAogICAgICAgICAgICAgICAgaWQ6ICdoZWFydGxhbmQtZmllbGQnLAogICAgICAgICAgICAgICAgdGV4dDogZmllbGRGcmFtZS5vcHRpb25zLnZhbHVlCiAgICAgICAgICAgICAgfSwgZmllbGRGcmFtZS5uYW1lKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKG9wdGlvbnMuc3R5bGUpIHsKICAgICAgICAgICAgICB2YXIgY3NzID0gb3B0aW9ucy5zdHlsZVN0cmluZyB8fCAob3B0aW9ucy5zdHlsZVN0cmluZyA9IERPTS5qc29uMmNzcyhvcHRpb25zLnN0eWxlKSk7CiAgICAgICAgICAgICAgaHBzLk1lc3NhZ2VzLnBvc3QoewogICAgICAgICAgICAgICAgYWN0aW9uOiAnYWRkU3R5bGVzaGVldCcsCiAgICAgICAgICAgICAgICBkYXRhOiBjc3MKICAgICAgICAgICAgICB9LCBmaWVsZEZyYW1lLm5hbWUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBFdmVudHMudHJpZ2dlcignc2VjdXJlc3VibWl0SWZyYW1lUmVhZHknLCBkb2N1bWVudCk7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgJ2FjY3VtdWxhdGVEYXRhJzoKICAgICAgICAgICAgZm9yICh2YXIgaSBpbiBocHMuZnJhbWVzKSB7CiAgICAgICAgICAgICAgaWYgKCdzdWJtaXQnID09PSBpIHx8ICdjYXJkTnVtYmVyJyA9PT0gaSkgewogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB2YXIgZmllbGQgPSBocHMuZnJhbWVzW2ldOwogICAgICAgICAgICAgIGhwcy5NZXNzYWdlcy5wb3N0KHsKICAgICAgICAgICAgICAgIGFjdGlvbjogJ2dldEZpZWxkRGF0YScsCiAgICAgICAgICAgICAgICBpZDogJ2hlYXJ0bGFuZC1maWVsZCcKICAgICAgICAgICAgICB9LCBmaWVsZC5uYW1lKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAncGFzc0RhdGEnOgogICAgICAgICAgICB2YXIgY2FyZE51bWJlckZpZWxkRnJhbWUgPSBocHMuZnJhbWVzLmNhcmROdW1iZXI7CgogICAgICAgICAgICBpZiAoIWNhcmROdW1iZXJGaWVsZEZyYW1lKSB7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGhwcy5NZXNzYWdlcy5wb3N0KHsKICAgICAgICAgICAgICBhY3Rpb246ICdzZXRGaWVsZERhdGEnLAogICAgICAgICAgICAgIGlkOiBmaWVsZEZyYW1lLm5hbWUsCiAgICAgICAgICAgICAgdmFsdWU6IGRhdGEudmFsdWUKICAgICAgICAgICAgfSwgY2FyZE51bWJlckZpZWxkRnJhbWUubmFtZSk7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgJ2ZpZWxkRXZlbnQnOgogICAgICAgICAgICBpZiAoIW9wdGlvbnMub25FdmVudCkgewogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBvcHRpb25zLm9uRXZlbnQoZGF0YS5ldmVudCk7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgJ2Vycm9yJzoKICAgICAgICAgICAgaWYgKCFvcHRpb25zLm9uRXJyb3IpIHsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgb3B0aW9ucy5vbkVycm9yKGRhdGEpOwogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0sICcqJyk7CiAgICB9OwogICAgLyoqCiAgICAgKiBIZWFydGxhbmQuRnJhbWVzLm1ha2VGaWVsZHNBbmRMaW5rCiAgICAgKgogICAgICogQ3JlYXRlcyBhIHNldCBvZiBzaW5nbGUgZmllbGQgaUZyYW1lcyBhbmQgc3RvcmVzIGEgcmVmZXJlbmNlIHRvCiAgICAgKiB0aGVtIGluIHRoZSBwYXJlbnQgd2luZG93J3Mgc3RhdGUuCiAgICAgKgogICAgICogQHBhcmFtIHtIZWFydGxhbmQuSFBTfSBocHMKICAgICAqLwoKCiAgICBGcmFtZXMubWFrZUZpZWxkc0FuZExpbmsgPSBmdW5jdGlvbiAoaHBzKSB7CiAgICAgIHZhciBvcHRpb25zID0gaHBzLm9wdGlvbnM7CiAgICAgIHZhciBmaWVsZHNMZW5ndGggPSBmaWVsZHMubGVuZ3RoOwogICAgICB2YXIgYmFzZVVybCA9IGhwcy5pZnJhbWVfdXJsLnJlcGxhY2UoJ2luZGV4Lmh0bWwnLCAnJyk7CgogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGZpZWxkc0xlbmd0aDsgaSsrKSB7CiAgICAgICAgdmFyIGZpZWxkID0gZmllbGRzW2ldOwogICAgICAgIHZhciBmaWVsZE9wdGlvbnMgPSBvcHRpb25zLmZpZWxkc1tmaWVsZF07CgogICAgICAgIGlmICghZmllbGRPcHRpb25zKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB2YXIgZnJhbWUgPSBET00ubWFrZUZyYW1lKGZpZWxkKTsKICAgICAgICB2YXIgdXJsID0gYmFzZVVybDsKCiAgICAgICAgaWYgKGZpZWxkID09PSAnc3VibWl0JykgewogICAgICAgICAgdXJsID0gdXJsICsgJ2J1dHRvbi5odG1sJzsKICAgICAgICB9IGVsc2UgaWYgKG9wdGlvbnMuY2NhICYmIG9wdGlvbnMuZW52ID09PSAnY2VydCcpIHsKICAgICAgICAgIHVybCA9IHVybCArICdmaWVsZENjYS5jZXJ0Lmh0bWwnOwogICAgICAgIH0gZWxzZSBpZiAob3B0aW9ucy5jY2EgJiYgb3B0aW9ucy5lbnYgPT09ICdwcm9kJykgewogICAgICAgICAgdXJsID0gdXJsICsgJ2ZpZWxkQ2NhLnByb2QuaHRtbCc7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHVybCA9IHVybCArICdmaWVsZC5odG1sJzsKICAgICAgICB9CgogICAgICAgIHVybCA9IHVybCArICcjJyArIGZpZWxkICsgJzonICsgZW5jb2RlVVJJQ29tcG9uZW50KGRvY3VtZW50LmxvY2F0aW9uLmhyZWYuc3BsaXQoJyMnKVswXSk7CiAgICAgICAgZnJhbWUuc3JjID0gdXJsOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGZpZWxkT3B0aW9ucy50YXJnZXQpLmFwcGVuZENoaWxkKGZyYW1lKTsKICAgICAgICBocHMuZnJhbWVzW2ZpZWxkXSA9IHsKICAgICAgICAgIGZyYW1lOiBmcmFtZSwKICAgICAgICAgIG5hbWU6IGZpZWxkLAogICAgICAgICAgb3B0aW9uczogZmllbGRPcHRpb25zLAogICAgICAgICAgdGFyZ2V0OiBmaWVsZE9wdGlvbnMudGFyZ2V0LAogICAgICAgICAgdGFyZ2V0Tm9kZTogd2luZG93LnBvc3RNZXNzYWdlID8gZnJhbWUuY29udGVudFdpbmRvdyA6IGZyYW1lLAogICAgICAgICAgdXJsOiB1cmwKICAgICAgICB9OwogICAgICB9CiAgICB9OwogICAgLyoqCiAgICAgKiBIZWFydGxhbmQuRnJhbWVzLm1vbml0b3JGaWVsZEV2ZW50cwogICAgICoKICAgICAqIEBwYXJhbSB7SGVhcnRsYW5kLkhQU30gaHBzCiAgICAgKiBAcGFyYW0ge3N0cmluZyB8IEV2ZW50VGFyZ2V0fSB0YXJnZXQKICAgICAqLwoKCiAgICBGcmFtZXMubW9uaXRvckZpZWxkRXZlbnRzID0gZnVuY3Rpb24gKGhwcywgdGFyZ2V0KSB7CiAgICAgIHZhciBldmVudHMgPSBbJ2NsaWNrJywgJ2JsdXInLCAnZm9jdXMnLCAnY2hhbmdlJywgJ2tleXByZXNzJywgJ2tleWRvd24nLCAna2V5dXAnXTsKICAgICAgdmFyIGkgPSAwLAogICAgICAgICAgbGVuZ3RoID0gZXZlbnRzLmxlbmd0aDsKCiAgICAgIGZvciAoaTsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmFyIGV2ZW50ID0gZXZlbnRzW2ldOwogICAgICAgIEV2ZW50cy5hZGRIYW5kbGVyKHRhcmdldCwgZXZlbnQsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICB2YXIgZmllbGQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGVhcnRsYW5kLWZpZWxkJyk7CiAgICAgICAgICB2YXIgY2xhc3NlcyA9IFtdOwogICAgICAgICAgdmFyIGRhdGEgPSB7fTsKCiAgICAgICAgICBpZiAoZmllbGQuY2xhc3NOYW1lICE9PSAnJykgewogICAgICAgICAgICBjbGFzc2VzID0gZmllbGQuY2xhc3NOYW1lLnNwbGl0KCcgJyk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGUua2V5Q29kZSkgewogICAgICAgICAgICBkYXRhLmtleUNvZGUgPSBlLmtleUNvZGU7CiAgICAgICAgICB9CgogICAgICAgICAgaHBzLk1lc3NhZ2VzLnBvc3QoewogICAgICAgICAgICBhY3Rpb246ICdmaWVsZEV2ZW50JywKICAgICAgICAgICAgZXZlbnQ6IHsKICAgICAgICAgICAgICBjbGFzc2VzOiBjbGFzc2VzLAogICAgICAgICAgICAgIGRhdGE6IGRhdGEsCiAgICAgICAgICAgICAgc291cmNlOiB3aW5kb3cubmFtZSwKICAgICAgICAgICAgICB0eXBlOiBlLnR5cGUKICAgICAgICAgICAgfQogICAgICAgICAgfSwgJ3BhcmVudCcpOwogICAgICAgIH0pOwogICAgICB9CiAgICB9OwoKICAgIHJldHVybiBGcmFtZXM7CiAgfSgpOwogIC8qKgogICAqIEBuYW1lc3BhY2UgSGVhcnRsYW5kLlV0aWwKICAgKi8KCgogIHZhciBVdGlsID0gZnVuY3Rpb24gKCkgewogICAgZnVuY3Rpb24gVXRpbCgpIHt9CiAgICAvKioKICAgICAqIEhlYXJ0bGFuZC5VdGlsLmdldENhcmRUeXBlCiAgICAgKgogICAgICogUGFyc2VzIGEgY3JlZGl0IGNhcmQgbnVtYmVyIHRvIG9idGFpbiB0aGUgY2FyZCB0eXBlL2JyYW5kLgogICAgICoKICAgICAqIEBwYXJhbSB7c3RyaW5nfSB0b2tlbml6YXRpb25UeXBlCiAgICAgKiBAcGFyYW0ge0hlYXJ0bGFuZC5PcHRpb25zfSBvcHRpb25zCiAgICAgKi8KCgogICAgVXRpbC5nZXRDYXJkVHlwZSA9IGZ1bmN0aW9uICh0b2tlbml6YXRpb25UeXBlLCBvcHRpb25zKSB7CiAgICAgIHZhciBjYXJkVHlwZTsKICAgICAgdmFyIGRhdGEgPSAnJzsKICAgICAgdmFyIHR5cGUgPSAndW5rbm93bic7CgogICAgICBzd2l0Y2ggKHRva2VuaXphdGlvblR5cGUpIHsKICAgICAgICBjYXNlICdzd2lwZSc6CiAgICAgICAgICBkYXRhID0gb3B0aW9ucy50cmFjazsKICAgICAgICAgIGNhcmRUeXBlID0gQ2FyZC50eXBlQnlUcmFjayhkYXRhKTsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlICdlbmNyeXB0ZWQnOgogICAgICAgICAgZGF0YSA9IG9wdGlvbnMudHJhY2s7CiAgICAgICAgICBjYXJkVHlwZSA9IENhcmQudHlwZUJ5VHJhY2soZGF0YSwgdHJ1ZSwgb3B0aW9ucy50cmFja051bWJlcik7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIGRhdGEgPSBvcHRpb25zLmNhcmROdW1iZXI7CiAgICAgICAgICBjYXJkVHlwZSA9IENhcmQudHlwZUJ5TnVtYmVyKGRhdGEpOwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KCiAgICAgIGlmIChjYXJkVHlwZSkgewogICAgICAgIHR5cGUgPSBjYXJkVHlwZS5jb2RlOwogICAgICB9CgogICAgICByZXR1cm4gdHlwZTsKICAgIH07CiAgICAvKioKICAgICAqIEhlYXJ0bGFuZC5VdGlsLmFwcGx5T3B0aW9ucwogICAgICoKICAgICAqIENyZWF0ZXMgYSBzaW5nbGUgb2JqZWN0IGJ5IG1lcmdpbmcgYSBgc291cmNlYCAoZGVmYXVsdCkgYW5kIGBwcm9wZXJ0aWVzYAogICAgICogb2J0YWluZWQgZWxzZXdoZXJlLCBlLmcuIGEgZnVuY3Rpb24gYXJndW1lbnQgaW4gYEhQU2AuIEFueSBwcm9wZXJ0aWVzIGluCiAgICAgKiBgcHJvcGVydGllc2Agd2lsbCBvdmVyd3JpdGUgbWF0Y2hpbmcgcHJvcGVydGllcyBpbiBgc291cmNlYC4KICAgICAqCiAgICAgKiBAcGFyYW0ge0hlYXJ0bGFuZC5PcHRpb25zfSBzb3VyY2UKICAgICAqIEBwYXJhbSB7SGVhcnRsYW5kLk9wdGlvbnN9IHByb3BlcnRpZXMKICAgICAqIEByZXR1cm5zIHtIZWFydGxhbmQuT3B0aW9uc30KICAgICAqLwoKCiAgICBVdGlsLmFwcGx5T3B0aW9ucyA9IGZ1bmN0aW9uIChzb3VyY2UsIHByb3BlcnRpZXMpIHsKICAgICAgdmFyIGRlc3RpbmF0aW9uID0ge307CgogICAgICBpZiAoIXNvdXJjZSkgewogICAgICAgIHNvdXJjZSA9IHt9OwogICAgICB9CgogICAgICBmb3IgKHZhciBwcm9wZXJ0eSBpbiBzb3VyY2UpIHsKICAgICAgICBpZiAoc291cmNlLmhhc093blByb3BlcnR5KHByb3BlcnR5KSkgewogICAgICAgICAgZGVzdGluYXRpb25bcHJvcGVydHldID0gc291cmNlW3Byb3BlcnR5XTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZvciAodmFyIHByb3BlcnR5IGluIHByb3BlcnRpZXMpIHsKICAgICAgICBpZiAocHJvcGVydGllcy5oYXNPd25Qcm9wZXJ0eShwcm9wZXJ0eSkpIHsKICAgICAgICAgIGRlc3RpbmF0aW9uW3Byb3BlcnR5XSA9IHByb3BlcnRpZXNbcHJvcGVydHldOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIGRlc3RpbmF0aW9uOwogICAgfTsKICAgIC8qKgogICAgICogSGVhcnRsYW5kLlV0aWwudGhyb3dFcnJvcgogICAgICoKICAgICAqIEFsbG93cyBhIG1lcmNoYW50LWRlZmluZWQgZXJyb3IgaGFuZGxlciB0byBiZSB1c2VkIGluIGNhc2VzIHdoZXJlIHRoZQogICAgICogdG9rZW5pemF0aW9uIHByb2Nlc3MgZmFpbHMuIElmIG5vdCBwcm92aWRlZCwgd2UgdGhyb3cgdGhlIG1lc3NhZ2UgYXMgYQogICAgICogSlMgcnVudGltZSBlcnJvci4KICAgICAqCiAgICAgKiBAcGFyYW0ge0hlYXJ0bGFuZC5PcHRpb25zfSBvcHRpb25zCiAgICAgKiBAcGFyYW0ge3N0cmluZyB8IEhlYXJ0bGFuZC5Ub2tlbml6YXRpb25SZXNwb25zZX0gZXJyb3JNZXNzYWdlCiAgICAgKi8KCgogICAgVXRpbC50aHJvd0Vycm9yID0gZnVuY3Rpb24gKG9wdGlvbnMsIGVycm9yTWVzc2FnZSkgewogICAgICBpZiAodHlwZW9mIG9wdGlvbnMuZXJyb3IgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICBvcHRpb25zLmVycm9yKGVycm9yTWVzc2FnZSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoZXJyb3JNZXNzYWdlLmVycm9yKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yTWVzc2FnZS5lcnJvci5tZXNzYWdlKTsKICAgICAgfQoKICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yTWVzc2FnZSk7CiAgICB9OwogICAgLyoqCiAgICAgKiBIZWFydGxhbmQuVXRpbC5nZXRJdGVtQnlQcm9wZXJ0eVZhbHVlCiAgICAgKgogICAgICogRW51bWVyYXRlcyBvdmVyIGEgYGNvbGxlY3Rpb25gIHRvIHJldHJlaXZlIGFuIGl0ZW0gd2hvc2UgYHByb3BlcnR5YCBpcwogICAgICogYSBnaXZlbiBgdmFsdWVgLgogICAgICoKICAgICAqIEBwYXJhbSB7YW55fSBjb2xsZWN0aW9uCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gcHJvcGVydHkKICAgICAqIEBwYXJhbSB7YW55fSB2YWx1ZQogICAgICogQHJldHVybnMge2FueX0KICAgICAqLwoKCiAgICBVdGlsLmdldEl0ZW1CeVByb3BlcnR5VmFsdWUgPSBmdW5jdGlvbiAoY29sbGVjdGlvbiwgcHJvcGVydHksIHZhbHVlKSB7CiAgICAgIHZhciBsZW5ndGggPSBjb2xsZWN0aW9uLmxlbmd0aDsKICAgICAgdmFyIGkgPSAwOwoKICAgICAgZm9yIChpOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAoY29sbGVjdGlvbltpXVtwcm9wZXJ0eV0gPT09IHZhbHVlKSB7CiAgICAgICAgICByZXR1cm4gY29sbGVjdGlvbltpXTsKICAgICAgICB9CiAgICAgIH0KICAgIH07CiAgICAvKioKICAgICAqIEhlYXJ0bGFuZC5VdGlsLmdldFBhcmFtcwogICAgICoKICAgICAqIEJ1aWxkcyBwYXJhbSBsaXN0IGZvciBhIHBhcnRpY3VsYXIgYHR5cGVgIGZyb20gZXhwZWN0ZWQgcHJvcGVydGllcyBpbgogICAgICogYGRhdGFgLgogICAgICoKICAgICAqIEBwYXJhbSB7c3RyaW5nfSB0eXBlIC0gVGhlIHRva2VuaXphdGlvbiB0eXBlCiAgICAgKiBAcGFyYW0ge0hlYXJ0bGFuZC5PcHRpb25zfSBkYXRhCiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfQogICAgICovCgoKICAgIFV0aWwuZ2V0UGFyYW1zID0gZnVuY3Rpb24gKHR5cGUsIGRhdGEpIHsKICAgICAgdmFyIHBhcmFtcyA9IFtdOwoKICAgICAgc3dpdGNoICh0eXBlKSB7CiAgICAgICAgY2FzZSAnaWZyYW1lJzoKICAgICAgICBjYXNlICdwYW4nOgogICAgICAgICAgcGFyYW1zLnB1c2goJ3Rva2VuX3R5cGU9c3VwdCcsICdvYmplY3Q9dG9rZW4nLCAnX21ldGhvZD1wb3N0JywgJ2FwaV9rZXk9JyArIGRhdGEucHVibGljS2V5LnJlcGxhY2UoL15ccyt8XHMrJC9nLCAnJyksICdjYXJkJTVCbnVtYmVyJTVEPScgKyBkYXRhLmNhcmROdW1iZXIucmVwbGFjZSgvXHMvZywgJycpLCAnY2FyZCU1QmV4cF9tb250aCU1RD0nICsgZGF0YS5jYXJkRXhwTW9udGgucmVwbGFjZSgvXlxzK3xccyskL2csICcnKSwgJ2NhcmQlNUJleHBfeWVhciU1RD0nICsgZGF0YS5jYXJkRXhwWWVhci5yZXBsYWNlKC9eXHMrfFxzKyQvZywgJycpLCAnY2FyZCU1QmN2YyU1RD0nICsgZGF0YS5jYXJkQ3Z2LnJlcGxhY2UoL15ccyt8XHMrJC9nLCAnJykpOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgJ3N3aXBlJzoKICAgICAgICAgIHBhcmFtcy5wdXNoKCd0b2tlbl90eXBlPXN1cHQnLCAnb2JqZWN0PXRva2VuJywgJ19tZXRob2Q9cG9zdCcsICdhcGlfa2V5PScgKyBkYXRhLnB1YmxpY0tleS5yZXBsYWNlKC9eXHMrfFxzKyQvZywgJycpLCAnY2FyZCU1QnRyYWNrX21ldGhvZCU1RD1zd2lwZScsICdjYXJkJTVCdHJhY2slNUQ9JyArIGVuY29kZVVSSUNvbXBvbmVudChkYXRhLnRyYWNrLnJlcGxhY2UoL15ccyt8XHMrJC9nLCAnJykpKTsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlICdlbmNyeXB0ZWQnOgogICAgICAgICAgcGFyYW1zLnB1c2goJ3Rva2VuX3R5cGU9c3VwdCcsICdvYmplY3Q9dG9rZW4nLCAnX21ldGhvZD1wb3N0JywgJ2FwaV9rZXk9JyArIGRhdGEucHVibGljS2V5LnJlcGxhY2UoL15ccyt8XHMrJC9nLCAnJyksICdlbmNyeXB0ZWRjYXJkJTVCdHJhY2tfbWV0aG9kJTVEPXN3aXBlJywgJ2VuY3J5cHRlZGNhcmQlNUJ0cmFjayU1RD0nICsgZW5jb2RlVVJJQ29tcG9uZW50KGRhdGEudHJhY2sucmVwbGFjZSgvXlxzK3xccyskL2csICcnKSksICdlbmNyeXB0ZWRjYXJkJTVCdHJhY2tfbnVtYmVyJTVEPScgKyBlbmNvZGVVUklDb21wb25lbnQoZGF0YS50cmFja051bWJlci5yZXBsYWNlKC9eXHMrfFxzKyQvZywgJycpKSwgJ2VuY3J5cHRlZGNhcmQlNUJrdGIlNUQ9JyArIGVuY29kZVVSSUNvbXBvbmVudChkYXRhLmt0Yi5yZXBsYWNlKC9eXHMrfFxzKyQvZywgJycpKSwgJ2VuY3J5cHRlZGNhcmQlNUJwaW5fYmxvY2slNUQ9JyArIGVuY29kZVVSSUNvbXBvbmVudChkYXRhLnBpbkJsb2NrLnJlcGxhY2UoL15ccyt8XHMrJC9nLCAnJykpKTsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgVXRpbC50aHJvd0Vycm9yKGRhdGEsICd1bmtub3duIHBhcmFtcyB0eXBlJyk7CiAgICAgICAgICBicmVhazsKICAgICAgfQoKICAgICAgcmV0dXJuIHBhcmFtcy5qb2luKCcmJyk7CiAgICB9OwogICAgLyoqCiAgICAgKiBIZWFydGxhbmQuVXRpbC5nZXRVcmxCeUVudgogICAgICoKICAgICAqIFNlbGVjdHMgdGhlIGFwcHJvcHJpYXRlIHRva2VuaXphdGlvbiBzZXJ2aWNlIFVSTCBmb3IgdGhlCiAgICAgKiBhY3RpdmUgYHB1YmxpY0tleWAuCiAgICAgKgogICAgICogQHBhcmFtIHtIZWFydGxhbmQuT3B0aW9uc30gb3B0aW9ucwogICAgICogQHJldHVybnMge3N0cmluZ30KICAgICAqLwoKCiAgICBVdGlsLmdldFVybEJ5RW52ID0gZnVuY3Rpb24gKG9wdGlvbnMpIHsKICAgICAgb3B0aW9ucy5lbnYgPSBvcHRpb25zLnB1YmxpY0tleS5zcGxpdCgnXycpWzFdOwoKICAgICAgaWYgKG9wdGlvbnMuZW52ID09PSAnY2VydCcpIHsKICAgICAgICBvcHRpb25zLmdhdGV3YXlVcmwgPSB1cmxzLkNFUlQ7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgb3B0aW9ucy5nYXRld2F5VXJsID0gdXJscy5QUk9EOwogICAgICB9CgogICAgICByZXR1cm4gb3B0aW9uczsKICAgIH07CiAgICAvKioKICAgICAqIEhlYXJ0bGFuZC5VdGlsLmFkZEZvcm1IYW5kbGVyCiAgICAgKgogICAgICogQ3JlYXRlcyBhbmQgYWRkcyBhbiBldmVudCBoYW5kbGVyIGZ1bmN0aW9uIGZvciB0aGUgc3VibWlzc2lvbiBmb3IgYSBnaXZlbgogICAgICogZm9ybSAoYG9wdGlvbnMuZm9ybV9pZGApLgogICAgICoKICAgICAqIEBwYXJhbSB7SGVhcnRsYW5kLk9wdGlvbnN9IG9wdGlvbnMKICAgICAqIEBsaXN0ZW5zIHN1Ym1pdAogICAgICovCgoKICAgIFV0aWwuYWRkRm9ybUhhbmRsZXIgPSBmdW5jdGlvbiAob3B0aW9ucykgewogICAgICB2YXIgcGF5bWVudF9mb3JtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQob3B0aW9ucy5mb3JtSWQpOwoKICAgICAgdmFyIGNvZGUgPSBmdW5jdGlvbiBjb2RlKGUpIHsKICAgICAgICBpZiAoZS5wcmV2ZW50RGVmYXVsdCkgewogICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIH0gZWxzZSBpZiAod2luZG93LmV2ZW50KSB7CiAgICAgICAgICB3aW5kb3cuZXZlbnQucmV0dXJuVmFsdWUgPSBmYWxzZTsKICAgICAgICB9CgogICAgICAgIHZhciBmaWVsZHMgPSBVdGlsLmdldEZpZWxkcyhvcHRpb25zLmZvcm1JZCk7CiAgICAgICAgdmFyIGNhcmRUeXBlID0gVXRpbC5nZXRDYXJkVHlwZShmaWVsZHMubnVtYmVyLCAncGFuJyk7CiAgICAgICAgb3B0aW9ucy5jYXJkTnVtYmVyID0gZmllbGRzLm51bWJlcjsKICAgICAgICBvcHRpb25zLmNhcmRFeHBNb250aCA9IGZpZWxkcy5leHBNb250aDsKICAgICAgICBvcHRpb25zLmNhcmRFeHBZZWFyID0gZmllbGRzLmV4cFllYXI7CiAgICAgICAgb3B0aW9ucy5jYXJkQ3Z2ID0gZmllbGRzLmN2djsKICAgICAgICBvcHRpb25zLmNhcmRUeXBlID0gY2FyZFR5cGU7CiAgICAgICAgQWpheC5jYWxsKCdwYW4nLCBvcHRpb25zKTsKICAgICAgfTsKCiAgICAgIEV2ZW50cy5hZGRIYW5kbGVyKHBheW1lbnRfZm9ybSwgJ3N1Ym1pdCcsIGNvZGUpOwogICAgICBET00uYWRkRmllbGQob3B0aW9ucy5mb3JtSWQsICdoaWRkZW4nLCAncHVibGljS2V5Jywgb3B0aW9ucy5wdWJsaWNLZXkpOwogICAgfTsKICAgIC8qKgogICAgICogSGVhcnRsYW5kLlV0aWwuZ2V0RmllbGRzCiAgICAgKgogICAgICogRXh0cmFjdHMgY2FyZCBpbmZvcm1hdGlvbiBmcm9tIHRoZSBmaWVsZHMgd2l0aCBuYW1lcyBgY2FyZF9udW1iZXJgLAogICAgICogYGNhcmRfZXhwaXJhdGlvbl9tb250aGAsIGBjYXJkX2V4cGlyYXRpb25feWVhcmAsIGFuZCBgY2FyZF9jdmNgIGFuZAogICAgICogZXhwZWN0cyB0aGVtIHRvIGJlIHByZXNlbnQgYXMgY2hpbGRyZW4gb2YgYGZvcm1QYXJlbnRgLgogICAgICoKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBmb3JtUGFyZW50CiAgICAgKiBAcmV0dXJucyB7SGVhcnRsYW5kLkNhcmREYXRhfQogICAgICovCgoKICAgIFV0aWwuZ2V0RmllbGRzID0gZnVuY3Rpb24gKGZvcm1QYXJlbnQpIHsKICAgICAgdmFyIGZvcm0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChmb3JtUGFyZW50KTsKICAgICAgdmFyIGZpZWxkcyA9IHt9OwogICAgICB2YXIgaTsKICAgICAgdmFyIGxlbmd0aCA9IGZvcm0uY2hpbGRFbGVtZW50Q291bnQ7CgogICAgICBmb3IgKGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICB2YXIgZWxlbWVudCA9IGZvcm0uY2hpbGRyZW5baV07CgogICAgICAgIGlmIChlbGVtZW50LmlkID09PSAnY2FyZF9udW1iZXInKSB7CiAgICAgICAgICBmaWVsZHMubnVtYmVyID0gZWxlbWVudC52YWx1ZTsKICAgICAgICB9IGVsc2UgaWYgKGVsZW1lbnQuaWQgPT09ICdjYXJkX2V4cGlyYXRpb25fbW9udGgnKSB7CiAgICAgICAgICBmaWVsZHMuZXhwTW9udGggPSBlbGVtZW50LnZhbHVlOwogICAgICAgIH0gZWxzZSBpZiAoZWxlbWVudC5pZCA9PT0gJ2NhcmRfZXhwaXJhdGlvbl95ZWFyJykgewogICAgICAgICAgZmllbGRzLmV4cFllYXIgPSBlbGVtZW50LnZhbHVlOwogICAgICAgIH0gZWxzZSBpZiAoZWxlbWVudC5pZCA9PT0gJ2NhcmRfY3ZjJykgewogICAgICAgICAgZmllbGRzLmN2diA9IGVsZW1lbnQudmFsdWU7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gZmllbGRzOwogICAgfTsKCiAgICByZXR1cm4gVXRpbDsKICB9KCk7CgogIHZhciBIZWFydGxhbmRUb2tlblNlcnZpY2UgPSBmdW5jdGlvbiAoKSB7CiAgICBmdW5jdGlvbiBIZWFydGxhbmRUb2tlblNlcnZpY2UodXJsLCB0eXBlKSB7CiAgICAgIGlmICh0eXBlID09PSB2b2lkIDApIHsKICAgICAgICB0eXBlID0gInBhbiI7CiAgICAgIH0KCiAgICAgIHRoaXMudXJsID0gdXJsOwogICAgICB0aGlzLnR5cGUgPSB0eXBlOwogICAgfQoKICAgIEhlYXJ0bGFuZFRva2VuU2VydmljZS5wcm90b3R5cGUudG9rZW5pemUgPSBmdW5jdGlvbiAoZGF0YSwgY2FsbGJhY2spIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIHRoaXMucmVxdWVzdERhdGEgPSBkYXRhOwogICAgICBBamF4Lmpzb25wKHRoaXMuYnVpbGRSZXF1ZXN0KGRhdGEpLCBmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBjYWxsYmFjayhfdGhpcy5kZXNlcmlhbGl6ZVJlc3BvbnNlRGF0YShyZXNwb25zZSkpOwogICAgICB9KTsKICAgIH07CgogICAgSGVhcnRsYW5kVG9rZW5TZXJ2aWNlLnByb3RvdHlwZS5idWlsZFJlcXVlc3QgPSBmdW5jdGlvbiAoZGF0YSkgewogICAgICByZXR1cm4gbmV3IEpzb25wUmVxdWVzdCh0aGlzLnVybCwgdGhpcy5zZXJpYWxpemVSZXF1ZXN0RGF0YShkYXRhKSk7CiAgICB9OwoKICAgIEhlYXJ0bGFuZFRva2VuU2VydmljZS5wcm90b3R5cGUuc2VyaWFsaXplUmVxdWVzdERhdGEgPSBmdW5jdGlvbiAoZGF0YSkgewogICAgICByZXR1cm4gVXRpbC5nZXRQYXJhbXModGhpcy50eXBlLCBkYXRhKTsKICAgIH07CgogICAgSGVhcnRsYW5kVG9rZW5TZXJ2aWNlLnByb3RvdHlwZS5kZXNlcmlhbGl6ZVJlc3BvbnNlRGF0YSA9IGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgIGlmIChkYXRhLmVycm9yKSB7CiAgICAgICAgcmV0dXJuIGRhdGE7CiAgICAgIH0KCiAgICAgIHZhciBjYXJkVHlwZSA9IFV0aWwuZ2V0Q2FyZFR5cGUodGhpcy50eXBlLCB0aGlzLnJlcXVlc3REYXRhKTsKICAgICAgdmFyIGNhcmQgPSBkYXRhLmNhcmQgfHwgZGF0YS5lbmNyeXB0ZWRjYXJkOwogICAgICB2YXIgbGFzdGZvdXIgPSBjYXJkLm51bWJlci5zbGljZSgtNCk7CiAgICAgIGRhdGEubGFzdF9mb3VyID0gbGFzdGZvdXI7CiAgICAgIGRhdGEuY2FyZF90eXBlID0gY2FyZFR5cGU7CiAgICAgIGRhdGEuZXhwX21vbnRoID0gdGhpcy5yZXF1ZXN0RGF0YS5jYXJkRXhwTW9udGg7CiAgICAgIGRhdGEuZXhwX3llYXIgPSB0aGlzLnJlcXVlc3REYXRhLmNhcmRFeHBZZWFyOwogICAgICByZXR1cm4gZGF0YTsKICAgIH07CgogICAgcmV0dXJuIEhlYXJ0bGFuZFRva2VuU2VydmljZTsKICB9KCk7CgogIHZhciBDYXJkaW5hbFRva2VuU2VydmljZSA9IGZ1bmN0aW9uICgpIHsKICAgIGZ1bmN0aW9uIENhcmRpbmFsVG9rZW5TZXJ2aWNlKGp3dCkgewogICAgICB0aGlzLmp3dCA9IGp3dDsKICAgIH0KCiAgICBDYXJkaW5hbFRva2VuU2VydmljZS5wcm90b3R5cGUudG9rZW5pemUgPSBmdW5jdGlvbiAoZGF0YSwgY2FsbGJhY2spIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIHZhciByZXF1ZXN0ID0gdGhpcy5idWlsZFJlcXVlc3QoZGF0YSk7CiAgICAgIHZhciBjYXJkaW5hbCA9IHdpbmRvdy5DYXJkaW5hbDsKCiAgICAgIHZhciBjYiA9IGZ1bmN0aW9uIGNiKHJlc3BvbnNlRGF0YSwgand0KSB7CiAgICAgICAgcmVzcG9uc2VEYXRhLmp3dCA9IGp3dDsKICAgICAgICBjYWxsYmFjayhfdGhpcy5kZXNlcmlhbGl6ZVJlc3BvbnNlRGF0YShyZXNwb25zZURhdGEpKTsKICAgICAgfTsgLy8gaW5pdCBvbmx5IG9uY2UgcGVyIGZyYW1lCgoKICAgICAgaWYgKCFjYXJkaW5hbC5fX3NlY3VyZVN1Ym1pdEZyYW1lSW5pdCkgewogICAgICAgIGNhcmRpbmFsLnNldHVwKCdpbml0JywgewogICAgICAgICAgand0OiB0aGlzLmp3dAogICAgICAgIH0pOwogICAgICAgIGNhcmRpbmFsLm9uKCdwYXltZW50cy52YWxpZGF0ZWQnLCBjYik7CiAgICAgICAgY2FyZGluYWwuX19zZWN1cmVTdWJtaXRGcmFtZUluaXQgPSB0cnVlOwogICAgICB9CgogICAgICBjYXJkaW5hbC50cmlnZ2VyKCdqd3QudXBkYXRlJywgdGhpcy5qd3QpOwogICAgICBjYXJkaW5hbC5zdGFydCgnY2NhJywgcmVxdWVzdC5wYXlsb2FkKTsKICAgIH07CgogICAgQ2FyZGluYWxUb2tlblNlcnZpY2UucHJvdG90eXBlLmJ1aWxkUmVxdWVzdCA9IGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgIHJldHVybiBuZXcgTnVsbFJlcXVlc3QoewogICAgICAgIENvbnN1bWVyOiB7CiAgICAgICAgICBBY2NvdW50OiB7CiAgICAgICAgICAgIEFjY291bnROdW1iZXI6IGRhdGEuY2FyZE51bWJlci5yZXBsYWNlKC9cRC9nLCAnJyksCiAgICAgICAgICAgIENhcmRDb2RlOiBkYXRhLmNhcmRDdnYucmVwbGFjZSgvXlxzK3xccyskL2csICcnKSwKICAgICAgICAgICAgRXhwaXJhdGlvbk1vbnRoOiBkYXRhLmNhcmRFeHBNb250aC5yZXBsYWNlKC9eXHMrfFxzKyQvZywgJycpLAogICAgICAgICAgICBFeHBpcmF0aW9uWWVhcjogZGF0YS5jYXJkRXhwWWVhci5yZXBsYWNlKC9eXHMrfFxzKyQvZywgJycpCiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBPcHRpb25zOiB7CiAgICAgICAgICBFbmFibGVDQ0E6IGZhbHNlCiAgICAgICAgfSwKICAgICAgICBPcmRlckRldGFpbHM6IHsKICAgICAgICAgIE9yZGVyTnVtYmVyOiBkYXRhLmNjYS5vcmRlck51bWJlcgogICAgICAgIH0KICAgICAgfSk7CiAgICB9OwoKICAgIENhcmRpbmFsVG9rZW5TZXJ2aWNlLnByb3RvdHlwZS5zZXJpYWxpemVSZXF1ZXN0RGF0YSA9IGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgIHJldHVybiBkYXRhOwogICAgfTsKCiAgICBDYXJkaW5hbFRva2VuU2VydmljZS5wcm90b3R5cGUuZGVzZXJpYWxpemVSZXNwb25zZURhdGEgPSBmdW5jdGlvbiAoZGF0YSkgewogICAgICBpZiAodHlwZW9mIGRhdGEuVG9rZW4gIT09ICJ1bmRlZmluZWQiICYmIGRhdGEuVG9rZW4uVG9rZW4gIT09ICJ1bmRlZmluZWQiICYmIGRhdGEuVG9rZW4uUmVhc29uQ29kZSA9PT0gIjAiKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZGVzZXJpYWxpemVTdWNjZXNzUmVzcG9uc2UoZGF0YSk7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzLmRlc2VyaWFsaXplRmFpbHVyZVJlc3BvbnNlKGRhdGEpOwogICAgfTsKCiAgICBDYXJkaW5hbFRva2VuU2VydmljZS5wcm90b3R5cGUuZGVzZXJpYWxpemVTdWNjZXNzUmVzcG9uc2UgPSBmdW5jdGlvbiAoZGF0YSkgewogICAgICByZXR1cm4gewogICAgICAgIGp3dDogZGF0YS5qd3QsCiAgICAgICAgdG9rZW5fdmFsdWU6IGRhdGEuVG9rZW4uVG9rZW4KICAgICAgfTsKICAgIH07CgogICAgQ2FyZGluYWxUb2tlblNlcnZpY2UucHJvdG90eXBlLmRlc2VyaWFsaXplRmFpbHVyZVJlc3BvbnNlID0gZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgdmFyIG1lc3NhZ2UgPSBkYXRhLkVycm9yRGVzY3JpcHRpb247CgogICAgICBpZiAoZGF0YS5Ub2tlbiAmJiBkYXRhLlRva2VuLlJlYXNvbkRlc2NyaXB0aW9uICE9PSAiIikgewogICAgICAgIG1lc3NhZ2UgPSBkYXRhLlRva2VuLlJlYXNvbkRlc2NyaXB0aW9uOwogICAgICB9CgogICAgICByZXR1cm4gewogICAgICAgIGVycm9yOiB7CiAgICAgICAgICBtZXNzYWdlOiBtZXNzYWdlCiAgICAgICAgfQogICAgICB9OwogICAgfTsKCiAgICByZXR1cm4gQ2FyZGluYWxUb2tlblNlcnZpY2U7CiAgfSgpOwogIC8qKgogICAqIEhlYXJ0bGFuZC5IUFMKICAgKgogICAqIEluaXRpYWxpemVzIG9wdGlvbnMgYW5kIGFkZHMgdGhlIGRlZmF1bHQgZm9ybSBoYW5kbGVyIGlmIGEgYGZvcm1JZGAgaXMKICAgKiBwYXNzZWQgYXMgYW4gb3B0aW9uLiBUaGlzIGV4cGVjdHMgdGhlIGRlZmF1bHQgZmllbGRzIChzZWUgYGdldEZpZWxkc2ApIHRvCiAgICogYmUgcHJlc2VudCBhcyBjaGlsZHJlbiBvZiBgZm9ybUlkYC4KICAgKi8KCgogIHZhciBIUFMgPSBmdW5jdGlvbiAoKSB7CiAgICAvKioKICAgICAqIEhlYXJ0bGFuZC5IUFMgKGNvbnN0cnVjdG9yKQogICAgICoKICAgICAqIEBjb25zdHJ1Y3RvcgogICAgICogQHBhcmFtIHtIZWFydGxhbmQuT3B0aW9uc30gb3B0aW9ucyBbb3B0aW9uYWxdCiAgICAgKiBAcmV0dXJucyB7SGVhcnRsYW5kLkhQU30KICAgICAqLwogICAgZnVuY3Rpb24gSFBTKG9wdGlvbnMpIHsKICAgICAgaWYgKCFvcHRpb25zICYmIHdpbmRvdy5wYXJlbnQpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHRoaXMub3B0aW9ucyA9IFV0aWwuYXBwbHlPcHRpb25zKGRlZmF1bHRzLCBvcHRpb25zKTsKICAgICAgdGhpcy5vcHRpb25zID0gVXRpbC5nZXRVcmxCeUVudih0aGlzLm9wdGlvbnMpOwoKICAgICAgaWYgKHRoaXMub3B0aW9ucy5mb3JtSWQubGVuZ3RoID4gMCkgewogICAgICAgIFV0aWwuYWRkRm9ybUhhbmRsZXIodGhpcy5vcHRpb25zKTsKICAgICAgfQoKICAgICAgdGhpcy5mcmFtZXMgPSB7fTsKCiAgICAgIGlmICh0aGlzLm9wdGlvbnMudHlwZSA9PT0gJ2lmcmFtZScpIHsKICAgICAgICB0aGlzLmlmcmFtZV91cmwgPSAnJzsKICAgICAgICB0aGlzLk1lc3NhZ2VzID0gbmV3IE1lc3NhZ2VzKHRoaXMpOwogICAgICAgIHRoaXMubWFpbGJveCA9IFtdOwogICAgICAgIHRoaXMuY2FjaGVCdXN0ID0gMTsKICAgICAgICBGcmFtZXMuY29uZmlndXJlSWZyYW1lKHRoaXMpOwoKICAgICAgICBpZiAodGhpcy5vcHRpb25zLmVudiA9PT0gImNlcnQiKSB7CiAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLmlmcmFtZVRhcmdldCAhPT0gIiIpIHsKICAgICAgICAgICAgRE9NLmFkZENlcnRBbGVydCh0aGlzLm9wdGlvbnMuaWZyYW1lVGFyZ2V0KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIERPTS5hZGRDZXJ0QWxlcnQodGhpcy5vcHRpb25zLmZpZWxkcy5jYXJkTnVtYmVyLnRhcmdldCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogSGVhcnRsYW5kLkhQUy50b2tlbml6ZQogICAgICoKICAgICAqIFRva2VuaXplcyBjYXJkIGRhdGEuIFVzZWQgaW4gbWFudWFsIGludGVncmF0aW9ucyB3aGVyZSB0aGUgbWVyY2hhbnQncwogICAgICogY3JlZGl0IGNhcmQgZmllbGRzIGNhbm5vdC9kbyBub3QgbWF0Y2ggdGhlIG5hbWVzIGV4cGVjdGVkIGluIHRoZSBkZWZhdWx0CiAgICAgKiBmb3JtIGhhbmRsZXIgKHNlZSBgZ2V0RmllbGRzYCkuCiAgICAgKgogICAgICogQHBhcmFtIHtIZWFydGxhbmQuT3B0aW9uc30gb3B0aW9ucyBbb3B0aW9uYWxdCiAgICAgKi8KCgogICAgSFBTLnByb3RvdHlwZS50b2tlbml6ZSA9IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTsKCiAgICAgIGlmIChvcHRpb25zKSB7CiAgICAgICAgdGhpcy5vcHRpb25zID0gVXRpbC5hcHBseU9wdGlvbnModGhpcy5vcHRpb25zLCBvcHRpb25zKTsKICAgICAgICB0aGlzLm9wdGlvbnMgPSBVdGlsLmdldFVybEJ5RW52KHRoaXMub3B0aW9ucyk7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLm9wdGlvbnMudHlwZSA9PT0gJ2lmcmFtZScgJiYgISF0aGlzLmZyYW1lcy5jYXJkTnVtYmVyKSB7CiAgICAgICAgdGhpcy5NZXNzYWdlcy5wb3N0KHsKICAgICAgICAgIGFjY3VtdWxhdGVEYXRhOiAhIXRoaXMuZnJhbWVzLmNhcmROdW1iZXIsCiAgICAgICAgICBhY3Rpb246ICd0b2tlbml6ZScsCiAgICAgICAgICBkYXRhOiB7CiAgICAgICAgICAgIHB1YmxpY0tleTogdGhpcy5vcHRpb25zLnB1YmxpY0tleQogICAgICAgICAgfQogICAgICAgIH0sICdjYXJkTnVtYmVyJyk7CiAgICAgICAgcmV0dXJuOwogICAgICB9IGVsc2UgaWYgKHRoaXMub3B0aW9ucy50eXBlID09PSAnaWZyYW1lJykgewogICAgICAgIHRoaXMuTWVzc2FnZXMucG9zdCh7CiAgICAgICAgICBhY3Rpb246ICd0b2tlbml6ZScsCiAgICAgICAgICBkYXRhOiB7CiAgICAgICAgICAgIHB1YmxpY0tleTogdGhpcy5vcHRpb25zLnB1YmxpY0tleQogICAgICAgICAgfQogICAgICAgIH0sICdjaGlsZCcpOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIHRva2VucyA9IHsKICAgICAgICBjYXJkaW5hbDogbnVsbCwKICAgICAgICBoZWFydGxhbmQ6IG51bGwKICAgICAgfTsKCiAgICAgIHZhciBjYWxsYmFjayA9IGZ1bmN0aW9uIGNhbGxiYWNrKHJlc3BvbnNlKSB7CiAgICAgICAgaWYgKHJlc3BvbnNlLmVycm9yKSB7CiAgICAgICAgICBVdGlsLnRocm93RXJyb3IoX3RoaXMub3B0aW9ucywgcmVzcG9uc2UpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAoX3RoaXMub3B0aW9ucy5mb3JtSWQgJiYgX3RoaXMub3B0aW9ucy5mb3JtSWQubGVuZ3RoID4gMCkgewogICAgICAgICAgICB2YXIgaGVhcnRsYW5kID0gcmVzcG9uc2UuaGVhcnRsYW5kIHx8IHJlc3BvbnNlOwogICAgICAgICAgICBET00uYWRkRmllbGQoX3RoaXMub3B0aW9ucy5mb3JtSWQsICdoaWRkZW4nLCAndG9rZW5fdmFsdWUnLCBoZWFydGxhbmQudG9rZW5fdmFsdWUpOwogICAgICAgICAgICBET00uYWRkRmllbGQoX3RoaXMub3B0aW9ucy5mb3JtSWQsICdoaWRkZW4nLCAnbGFzdF9mb3VyJywgaGVhcnRsYW5kLmxhc3RfZm91cik7CiAgICAgICAgICAgIERPTS5hZGRGaWVsZChfdGhpcy5vcHRpb25zLmZvcm1JZCwgJ2hpZGRlbicsICdjYXJkX2V4cF95ZWFyJywgaGVhcnRsYW5kLmV4cF95ZWFyKTsKICAgICAgICAgICAgRE9NLmFkZEZpZWxkKF90aGlzLm9wdGlvbnMuZm9ybUlkLCAnaGlkZGVuJywgJ2NhcmRfZXhwX21vbnRoJywgaGVhcnRsYW5kLmV4cF9tb250aCk7CiAgICAgICAgICAgIERPTS5hZGRGaWVsZChfdGhpcy5vcHRpb25zLmZvcm1JZCwgJ2hpZGRlbicsICdjYXJkX3R5cGUnLCBoZWFydGxhbmQuY2FyZF90eXBlKTsKICAgICAgICAgIH0KCiAgICAgICAgICBfdGhpcy5vcHRpb25zLnN1Y2Nlc3MocmVzcG9uc2UpOwogICAgICAgIH0KICAgICAgfTsKCiAgICAgIHZhciBjYWxsYmFja1dyYXBwZXIgPSBmdW5jdGlvbiBjYWxsYmFja1dyYXBwZXIodHlwZSkgewogICAgICAgIHJldHVybiBmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIHRva2Vuc1t0eXBlXSA9IHJlc3BvbnNlOwoKICAgICAgICAgIGlmIChfdGhpcy5vcHRpb25zLmNjYSAmJiB0b2tlbnMuY2FyZGluYWwgJiYgdG9rZW5zLmhlYXJ0bGFuZCkgewogICAgICAgICAgICBjYWxsYmFjayh0b2tlbnMpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICghX3RoaXMub3B0aW9ucy5jY2EgJiYgdG9rZW5zLmhlYXJ0bGFuZCkgewogICAgICAgICAgICBjYWxsYmFjayh0b2tlbnMuaGVhcnRsYW5kKTsKICAgICAgICAgIH0KICAgICAgICB9OwogICAgICB9OwoKICAgICAgbmV3IEhlYXJ0bGFuZFRva2VuU2VydmljZSh0aGlzLm9wdGlvbnMuZ2F0ZXdheVVybCwgdGhpcy5vcHRpb25zLnR5cGUpLnRva2VuaXplKHRoaXMub3B0aW9ucywgY2FsbGJhY2tXcmFwcGVyKCdoZWFydGxhbmQnKSk7CgogICAgICBpZiAodGhpcy5vcHRpb25zLmNjYSkgewogICAgICAgIG5ldyBDYXJkaW5hbFRva2VuU2VydmljZSh0aGlzLm9wdGlvbnMuY2NhLmp3dCkudG9rZW5pemUodGhpcy5vcHRpb25zLCBjYWxsYmFja1dyYXBwZXIoJ2NhcmRpbmFsJykpOwogICAgICB9CiAgICB9OwogICAgLyoqCiAgICAgKiBIZWFydGxhbmQuSFBTLmNvbmZpZ3VyZUludGVybmFsSWZyYW1lCiAgICAgKgogICAgICogU2V0cyB1cCBhIGNoaWxkIGlmcmFtZSB3aW5kb3cgdG8gcHJlcGFyZSBpdCBmb3IgY29tbXVuaWNhdGlvbiB3aXRoIHRoZQogICAgICogcGFyZW50IGFuZCBmb3IgdG9rZW5pemF0aW9uLgogICAgICoKICAgICAqIEBwYXJhbSB7SGVhcnRsYW5kLk9wdGlvbnN9IG9wdGlvbnMKICAgICAqLwoKCiAgICBIUFMucHJvdG90eXBlLmNvbmZpZ3VyZUludGVybmFsSWZyYW1lID0gZnVuY3Rpb24gKG9wdGlvbnMpIHsKICAgICAgdGhpcy5NZXNzYWdlcyA9IG5ldyBNZXNzYWdlcyh0aGlzKTsKICAgICAgdGhpcy5wYXJlbnQgPSB3aW5kb3cucGFyZW50OwogICAgICB0aGlzLmZyYW1lcyA9IHRoaXMuZnJhbWVzIHx8IHt9OwogICAgICB0aGlzLmZyYW1lcy5wYXJlbnQgPSB7CiAgICAgICAgZnJhbWU6IHdpbmRvdy5wYXJlbnQsCiAgICAgICAgbmFtZTogJ3BhcmVudCcsCiAgICAgICAgdXJsOiBkZWNvZGVVUklDb21wb25lbnQoZG9jdW1lbnQubG9jYXRpb24uaGFzaC5yZXBsYWNlKC9eIy8sICcnKSkKICAgICAgfTsKCiAgICAgIHRoaXMubG9hZEhhbmRsZXIgPSBmdW5jdGlvbiAoaHBzKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIERPTS5yZXNpemVGcmFtZShocHMpOwogICAgICAgIH07CiAgICAgIH0odGhpcyk7CgogICAgICB0aGlzLnJlY2VpdmVNZXNzYWdlSGFuZGxlckFkZGVkSGFuZGxlciA9IGZ1bmN0aW9uIChocHMpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgICAgaHBzLk1lc3NhZ2VzLnBvc3QoewogICAgICAgICAgICBhY3Rpb246ICdyZWNlaXZlTWVzc2FnZUhhbmRsZXJBZGRlZCcKICAgICAgICAgIH0sICdwYXJlbnQnKTsKICAgICAgICB9OwogICAgICB9KHRoaXMpOwoKICAgICAgRXZlbnRzLmFkZEhhbmRsZXIod2luZG93LCAnbG9hZCcsIHRoaXMubG9hZEhhbmRsZXIpOwogICAgICBFdmVudHMuYWRkSGFuZGxlcihkb2N1bWVudCwgJ3JlY2VpdmVNZXNzYWdlSGFuZGxlckFkZGVkJywgdGhpcy5yZWNlaXZlTWVzc2FnZUhhbmRsZXJBZGRlZEhhbmRsZXIpOwogICAgICB0aGlzLk1lc3NhZ2VzLnJlY2VpdmUoRXZlbnRzLmZyYW1lSGFuZGxlV2l0aCh0aGlzKSwgJyonKTsKICAgIH07CgogICAgOwogICAgLyoqCiAgICAgKiBIZWFydGxhbmQuSFBTLmNvbmZpZ3VyZUJ1dHRvbkZpZWxkSWZyYW1lCiAgICAgKgogICAgICogU2FtZSBhcyBgSGVhcnRsYW5kLkhQUy5jb25maWd1cmVGaWVsZElmcmFtZWAgZXhjZXQgdGhlIGFkZGVkIGNsaWNrIGV2ZW50CiAgICAgKiBoYW5kbGVyIGZvciB0aGUgYnV0dG9uLgogICAgICoKICAgICAqIEBwYXJhbSB7SGVhcnRsYW5kLk9wdGlvbnN9IG9wdGlvbnMKICAgICAqLwoKICAgIEhQUy5wcm90b3R5cGUuY29uZmlndXJlQnV0dG9uRmllbGRJZnJhbWUgPSBmdW5jdGlvbiAob3B0aW9ucykgewogICAgICB0aGlzLmNvbmZpZ3VyZUZpZWxkSWZyYW1lKG9wdGlvbnMpOwogICAgICBFdmVudHMuYWRkSGFuZGxlcignaGVhcnRsYW5kLWZpZWxkJywgJ2NsaWNrJywgZnVuY3Rpb24gKGhwcykgewogICAgICAgIHJldHVybiBmdW5jdGlvbiAoZSkgewogICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCA/IGUucHJldmVudERlZmF1bHQoKSA6IGUucmV0dXJuVmFsdWUgPSBmYWxzZTsKICAgICAgICAgIGhwcy5NZXNzYWdlcy5wb3N0KHsKICAgICAgICAgICAgYWN0aW9uOiAncmVxdWVzdFRva2VuaXplJwogICAgICAgICAgfSwgJ3BhcmVudCcpOwogICAgICAgIH07CiAgICAgIH0odGhpcykpOwogICAgfTsKICAgIC8qKgogICAgICogSGVhcnRsYW5kLkhQUy5jb25maWd1cmVGaWVsZElmcmFtZQogICAgICoKICAgICAqIFNldHMgdXAgYSBjaGlsZCBpZnJhbWUgd2luZG93IHRvIHByZXBhcmUgaXQgZm9yIGNvbW11bmljYXRpb24gd2l0aCB0aGUKICAgICAqIHBhcmVudCBhbmQgZm9yIHRva2VuaXphdGlvbi4KICAgICAqCiAgICAgKiBAcGFyYW0ge0hlYXJ0bGFuZC5PcHRpb25zfSBvcHRpb25zCiAgICAgKi8KCgogICAgSFBTLnByb3RvdHlwZS5jb25maWd1cmVGaWVsZElmcmFtZSA9IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICAgIHZhciBoYXNoID0gZG9jdW1lbnQubG9jYXRpb24uaGFzaC5yZXBsYWNlKC9eIy8sICcnKTsKICAgICAgdmFyIHNwbGl0ID0gaGFzaC5zcGxpdCgnOicpOwogICAgICB0aGlzLk1lc3NhZ2VzID0gbmV3IE1lc3NhZ2VzKHRoaXMpOwogICAgICB0aGlzLmZpZWxkID0gc3BsaXQuc2hpZnQoKTsKICAgICAgdGhpcy5wYXJlbnQgPSB3aW5kb3cucGFyZW50OwogICAgICB0aGlzLmZyYW1lcyA9IHRoaXMuZnJhbWVzIHx8IHt9OwogICAgICB0aGlzLmZyYW1lcy5wYXJlbnQgPSB7CiAgICAgICAgZnJhbWU6IHdpbmRvdy5wYXJlbnQsCiAgICAgICAgbmFtZTogJ3BhcmVudCcsCiAgICAgICAgdXJsOiBkZWNvZGVVUklDb21wb25lbnQoc3BsaXQuam9pbignOicpLnJlcGxhY2UoL146LywgJycpKQogICAgICB9OwoKICAgICAgd2luZG93Lm9uZXJyb3IgPSBmdW5jdGlvbiAoaHBzKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChlcnJvck1zZywgdXJsLCBsaW5lTnVtYmVyLCBjb2x1bW4sIGVycm9yT2JqKSB7CiAgICAgICAgICBocHMuTWVzc2FnZXMucG9zdCh7CiAgICAgICAgICAgIGFjdGlvbjogJ2Vycm9yJywKICAgICAgICAgICAgZGF0YTogewogICAgICAgICAgICAgIGNvbHVtbjogY29sdW1uLAogICAgICAgICAgICAgIGVycm9yTXNnOiBlcnJvck1zZywKICAgICAgICAgICAgICBsaW5lTnVtYmVyOiBsaW5lTnVtYmVyLAogICAgICAgICAgICAgIHVybDogdXJsCiAgICAgICAgICAgIH0KICAgICAgICAgIH0sICdwYXJlbnQnKTsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH07CiAgICAgIH0odGhpcyk7CgogICAgICB0aGlzLmxvYWRIYW5kbGVyID0gZnVuY3Rpb24gKGhwcykgewogICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBET00ucmVzaXplRnJhbWUoaHBzKTsKICAgICAgICAgIERPTS5jb25maWd1cmVGaWVsZChocHMpOwogICAgICAgICAgdmFyIG1ldGhvZCA9ICdhdHRhY2gnICsgd2luZG93Lm5hbWUucmVwbGFjZSgnY2FyZCcsICcnKSArICdFdmVudHMnOwoKICAgICAgICAgIGlmIChDYXJkW21ldGhvZF0pIHsKICAgICAgICAgICAgQ2FyZFttZXRob2RdKCcjaGVhcnRsYW5kLWZpZWxkJyk7CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgfSh0aGlzKTsKCiAgICAgIHRoaXMucmVjZWl2ZU1lc3NhZ2VIYW5kbGVyQWRkZWRIYW5kbGVyID0gZnVuY3Rpb24gKGhwcykgewogICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBocHMuTWVzc2FnZXMucG9zdCh7CiAgICAgICAgICAgIGFjdGlvbjogJ3JlY2VpdmVNZXNzYWdlSGFuZGxlckFkZGVkJwogICAgICAgICAgfSwgJ3BhcmVudCcpOwogICAgICAgIH07CiAgICAgIH0odGhpcyk7CgogICAgICBFdmVudHMuYWRkSGFuZGxlcih3aW5kb3csICdsb2FkJywgdGhpcy5sb2FkSGFuZGxlcik7CiAgICAgIEV2ZW50cy5hZGRIYW5kbGVyKGRvY3VtZW50LCAncmVjZWl2ZU1lc3NhZ2VIYW5kbGVyQWRkZWQnLCB0aGlzLnJlY2VpdmVNZXNzYWdlSGFuZGxlckFkZGVkSGFuZGxlcik7CiAgICAgIEZyYW1lcy5tb25pdG9yRmllbGRFdmVudHModGhpcywgJ2hlYXJ0bGFuZC1maWVsZCcpOwogICAgICB0aGlzLk1lc3NhZ2VzLnJlY2VpdmUoRXZlbnRzLmZyYW1lSGFuZGxlV2l0aCh0aGlzKSwgJyonKTsKICAgIH07CgogICAgOwogICAgLyoqCiAgICAgKiBIZWFydGxhbmQuSFBTLnJlc2l6ZUlGcmFtZQogICAgICoKICAgICAqIENhbGxlZCBhdXRvbWF0aWNhbGx5IHdoZW4gdGhlIGNoaWxkIGlmcmFtZSB3aW5kb3cgYWxlcnRzIHRoZSBwYXJlbnQgdG8KICAgICAqIHJlc2l6ZS4KICAgICAqCiAgICAgKiBAcGFyYW0ge0hUTUxJRnJhbWVFbGVtZW50fSBmcmFtZQogICAgICogQHBhcmFtIHtzdHJpbmd9IGhlaWdodAogICAgICovCgogICAgSFBTLnByb3RvdHlwZS5yZXNpemVJRnJhbWUgPSBmdW5jdGlvbiAoZnJhbWUsIGhlaWdodCkgewogICAgICBpZiAoIWZyYW1lKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBmcmFtZS5zdHlsZS5oZWlnaHQgPSBwYXJzZUludChoZWlnaHQsIDEwKSArICdweCc7CiAgICB9OwoKICAgIDsKICAgIC8qKgogICAgICogSGVhcnRsYW5kLkhQUy5zZXRUZXh0CiAgICAgKgogICAgICogUHVibGljIEFQSSBmb3Igc2V0dGluZyBhbiBlbGVtZW50J3MgaW5uZXIgdGV4dC4KICAgICAqCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gZWxlbWVudGlkCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gZWxlbWVudHRleHQKICAgICAqLwoKICAgIEhQUy5wcm90b3R5cGUuc2V0VGV4dCA9IGZ1bmN0aW9uIChlbGVtZW50aWQsIGVsZW1lbnR0ZXh0KSB7CiAgICAgIHRoaXMuTWVzc2FnZXMucG9zdCh7CiAgICAgICAgYWN0aW9uOiAnc2V0VGV4dCcsCiAgICAgICAgaWQ6IGVsZW1lbnRpZCwKICAgICAgICB0ZXh0OiBlbGVtZW50dGV4dAogICAgICB9LCAnY2hpbGQnKTsKICAgIH07CgogICAgOwogICAgLyoqCiAgICAgKiBIZWFydGxhbmQuSFBTLnNldFN0eWxlCiAgICAgKgogICAgICogUHVibGljIEFQSSBmb3Igc2V0dGluZyBhbiBlbGVtZW50J3Mgc3R5bGUuCiAgICAgKgogICAgICogQHBhcmFtIHtzdHJpbmd9IGVsZW1lbnRpZAogICAgICogQHBhcmFtIHtzdHJpbmd9IGVsZW1lbnRzdHlsZQogICAgICovCgogICAgSFBTLnByb3RvdHlwZS5zZXRTdHlsZSA9IGZ1bmN0aW9uIChlbGVtZW50aWQsIGVsZW1lbnRzdHlsZSkgewogICAgICB0aGlzLk1lc3NhZ2VzLnBvc3QoewogICAgICAgIGFjdGlvbjogJ3NldFN0eWxlJywKICAgICAgICBpZDogZWxlbWVudGlkLAogICAgICAgIHN0eWxlOiBlbGVtZW50c3R5bGUKICAgICAgfSwgJ2NoaWxkJyk7CiAgICB9OwoKICAgIDsKICAgIC8qKgogICAgICogSGVhcnRsYW5kLkhQUy5hcHBlbmRTdHlsZQogICAgICoKICAgICAqIFB1YmxpYyBBUEkgZm9yIGFwcGVuZGluZyB0byBhbiBlbGVtZW50J3Mgc3R5bGUuCiAgICAgKgogICAgICogQHBhcmFtIHtzdHJpbmd9IGVsZW1lbnRpZAogICAgICogQHBhcmFtIHtzdHJpbmd9IGVsZW1lbnRzdHlsZQogICAgICovCgogICAgSFBTLnByb3RvdHlwZS5hcHBlbmRTdHlsZSA9IGZ1bmN0aW9uIChlbGVtZW50aWQsIGVsZW1lbnRzdHlsZSkgewogICAgICB0aGlzLk1lc3NhZ2VzLnBvc3QoewogICAgICAgIGFjdGlvbjogJ2FwcGVuZFN0eWxlJywKICAgICAgICBpZDogZWxlbWVudGlkLAogICAgICAgIHN0eWxlOiBlbGVtZW50c3R5bGUKICAgICAgfSwgJ2NoaWxkJyk7CiAgICB9OwoKICAgIDsKICAgIC8qKgogICAgICogSGVhcnRsYW5kLkhQUy5zZXRGb2N1cwogICAgICoKICAgICAqIFB1YmxpYyBBUEkgZm9yIGFwcGVuZGluZyB0byBhbiBlbGVtZW50J3Mgc3R5bGUuCiAgICAgKgogICAgICogQHBhcmFtIHtzdHJpbmd9IGVsZW1lbnRpZAogICAgICovCgogICAgSFBTLnByb3RvdHlwZS5zZXRGb2N1cyA9IGZ1bmN0aW9uIChlbGVtZW50aWQpIHsKICAgICAgdGhpcy5NZXNzYWdlcy5wb3N0KHsKICAgICAgICBhY3Rpb246ICdzZXRGb2N1cycKICAgICAgfSwgZWxlbWVudGlkKTsKICAgIH07CgogICAgOwogICAgLyoqCiAgICAgKiBIZWFydGxhbmQuSFBTLmRpc3Bvc2UKICAgICAqCiAgICAgKiBSZW1vdmVzIGFsbCBpZnJhbWVzIGFuZCBldmVudCBsaXN0ZW5lcnMgZnJvbSB0aGUgRE9NLgogICAgICovCgogICAgSFBTLnByb3RvdHlwZS5kaXNwb3NlID0gZnVuY3Rpb24gKCkgewogICAgICB0aGlzLk1lc3NhZ2VzLmRpc3Bvc2UoKTsKICAgICAgdGhpcy5NZXNzYWdlcyA9IG51bGw7CgogICAgICBpZiAodGhpcy5mcmFtZXMuY2FyZE51bWJlciAmJiB0aGlzLmZyYW1lcy5jYXJkTnVtYmVyLnRhcmdldE5vZGUpIHsKICAgICAgICB0aGlzLnJlbW92ZU5vZGUodGhpcy5mcmFtZXMuY2FyZE51bWJlci5mcmFtZSk7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmZyYW1lcy5jYXJkRXhwaXJhdGlvbiAmJiB0aGlzLmZyYW1lcy5jYXJkRXhwaXJhdGlvbi5mcmFtZSkgewogICAgICAgIHRoaXMucmVtb3ZlTm9kZSh0aGlzLmZyYW1lcy5jYXJkRXhwaXJhdGlvbi5mcmFtZSk7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmZyYW1lcy5jYXJkQ3Z2ICYmIHRoaXMuZnJhbWVzLmNhcmRDdnYuZnJhbWUpIHsKICAgICAgICB0aGlzLnJlbW92ZU5vZGUodGhpcy5mcmFtZXMuY2FyZEN2di5mcmFtZSk7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmZyYW1lcy5jaGlsZCAmJiB0aGlzLmZyYW1lcy5jaGlsZC5mcmFtZSkgewogICAgICAgIHRoaXMucmVtb3ZlTm9kZSh0aGlzLmZyYW1lcy5jaGlsZC5mcmFtZSk7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmNsaWNrSGFuZGxlcikgewogICAgICAgIEV2ZW50cy5yZW1vdmVIYW5kbGVyKHRoaXMub3B0aW9ucy5idXR0b25UYXJnZXQsICdjbGljaycsIHRoaXMuY2xpY2tIYW5kbGVyKTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMubG9hZEhhbmRsZXIpIHsKICAgICAgICBFdmVudHMucmVtb3ZlSGFuZGxlcih3aW5kb3csICdsb2FkJywgdGhpcy5sb2FkSGFuZGxlcik7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnJlY2VpdmVNZXNzYWdlSGFuZGxlckFkZGVkSGFuZGxlcikgewogICAgICAgIEV2ZW50cy5yZW1vdmVIYW5kbGVyKGRvY3VtZW50LCAncmVjZWl2ZU1lc3NhZ2VIYW5kbGVyQWRkZWQnLCB0aGlzLnJlY2VpdmVNZXNzYWdlSGFuZGxlckFkZGVkSGFuZGxlcik7CiAgICAgIH0KICAgIH07CgogICAgOwoKICAgIEhQUy5wcm90b3R5cGUucmVtb3ZlTm9kZSA9IGZ1bmN0aW9uIChub2RlKSB7CiAgICAgIGlmIChub2RlLnJlbW92ZSkgewogICAgICAgIG5vZGUucmVtb3ZlKCk7CiAgICAgIH0gZWxzZSBpZiAobm9kZS5wYXJlbnROb2RlICYmIG5vZGUucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCkgewogICAgICAgIG5vZGUucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChub2RlKTsKICAgICAgfQogICAgfTsKCiAgICByZXR1cm4gSFBTOwogIH0oKTsKCiAgdmFyIFZhbGlkYXRvciA9IHsKICAgIENhcmROdW1iZXI6IENhcmROdW1iZXIkMSwKICAgIEN2djogQ3Z2LAogICAgRXhwaXJhdGlvbjogRXhwaXJhdGlvbiQxCiAgfTsKICB3aW5kb3cuSFBTID0gSFBTOwogIHZhciBpbmRleCA9IHsKICAgIEFqYXg6IEFqYXgsCiAgICBDYXJkOiBDYXJkLAogICAgRE9NOiBET00sCiAgICBFdmVudHM6IEV2ZW50cywKICAgIEZvcm1hdHRlcjogRm9ybWF0dGVyLAogICAgRnJhbWVzOiBGcmFtZXMsCiAgICBIUFM6IEhQUywKICAgIEpTT046IEpTT04yLAogICAgTWVzc2FnZXM6IE1lc3NhZ2VzLAogICAgU3R5bGVzOiBTdHlsZXMsCiAgICBVdGlsOiBVdGlsLAogICAgVmFsaWRhdG9yOiBWYWxpZGF0b3IKICB9OwogIHJldHVybiBpbmRleDsKfSgpOwoKZXhwb3J0IGRlZmF1bHQgSGVhcnRsYW5kOw=="},{"version":3,"sources":["/home/vignesh/DIVRT/revamp-guest-webapp/src/plugins/securesubmit.js"],"names":["Heartland","JSON2","f","n","Date","prototype","toJSON","key","isFinite","valueOf","getUTCFullYear","getUTCMonth","getUTCDate","getUTCHours","getUTCMinutes","getUTCSeconds","strProto","String","numProto","Number","JSON","Boolean","cx","esc","gap","indent","meta","rep","quote","string","lastIndex","test","replace","a","c","charCodeAt","toString","slice","str","holder","i","k","v","length","mind","partial","value","call","Object","apply","join","push","hasOwnProperty","stringify","replacer","space","Error","parse","text","reviver","j","walk","undefined","Function","SyntaxError","JsonpRequest","url","payload","type","NullRequest","Ajax","jsonp","request","callback","script","document","createElement","callbackName","Math","round","random","window","data","body","removeChild","src","indexOf","appendChild","cors","xhr","method","timeout","XMLHttpRequest","withCredentials","XDomainRequest","split","open","setRequestHeader","cb","e","clearTimeout","error","message","readyState","responseText","onload","onerror","send","setTimeout","abort","cardTypes","code","format","regex","CardNumber","number","Card","typeByNumber","matches","match","global","shift","Expiration","exp","final","pat","groups","month","del","year","getFullYear","CardNumber$1","validate","luhnCheck","Cvv","cvv","Expiration$1","m","y","parseInt","DOM","configureField","hps","getElementById","setAttribute","field","makeFrame","name","frame","id","style","border","frameBorder","scrolling","addField","formParent","fieldType","fieldName","fieldValue","input","setStyle","elementid","htmlstyle","el","encodeEntities","appendStyle","currstyle","getAttribute","newstyle","setText","textContent","setValue","setPlaceholder","resizeFrame","docHeight","offsetHeight","Messages","post","action","height","setFieldData","getFieldData","addStylesheet","css","elements","getElementsByTagName","createTextNode","json2css","json","attributes","children","jsonAttributes","attributesLength","isArray","arrLength","jsonChildren","childrenLength","setFocus","focus","addCertAlert","display","width","marginBottom","color","backgroundColor","padding","fontFamily","fontWeight","fontSize","textAlign","boxSizing","container","insertBefore","frame2","hi","low","obj","set","Expiration$2","Ev","listen","node","eventName","addEventListener","documentElement","attachEvent","propertyName","trigger","createEvent","event","initEvent","dispatchEvent","ignore","removeEventListener","detachEvent","Events","addHandler","target","removeHandler","bubble","frameHandleWith","accumulateData","elOpts","elPK","publicKey","tokenizeIframe","opts","pk","card","numberElement","cvvElement","expElement","tokenResponse","response","parentNode","remove","formatter","cardExpSplit","expMonth","expYear","tokenize","cardCvv","cardExpMonth","cardExpYear","cardNumber","cca","success","cardType","typeByTrack","isEncrypted","trackNumber","temp","substr","odd","sum","digit","digits","reverse","addType","currentTarget","srcElement","classList","className","formatNumber","formatted","setSelectionRange","cursor","selectionStart","charAt","formatExpiration","keyCode","restrictLength","ctrlKey","preventDefault","returnValue","restrictNumeric","shiftKey","deleteProperly","validateNumber","validateCvv","validateExpiration","attachNumberEvents","selector","querySelector","attachExpirationEvents","attachCvvEvents","Array","start","Formatter","defaults","_method","buttonTarget","env","fields","formId","gatewayUrl","iframeTarget","ktb","object","onEvent","onTokenError","onTokenSuccess","pinBlock","targetType","tokenType","track","useDefaultStyles","urls","CERT","PROD","iframeCERT","iframePROD","intervalId","lastHash","pushIntervalStarted","pushMessages","messageArr","targetUrl","current","targetNode","re","mailbox","location","hash","decodeURIComponent","concat","cacheBust","source","encodeURIComponent","href","frames","postMessage","setInterval","receive","sourceOrigin","clearInterval","removeReceiver","dispose","Styles","Defaults","cvvContainer","fieldset","inputsAndSelects","ids","labelsAndLegend","selectLabels","selects","Frames","configureIframe","options","iframe_url","makeFieldsAndLink","child","contentWindow","clickHandler","fieldFrame","resizeIFrame","placeholder","styleString","cardNumberFieldFrame","onError","fieldsLength","baseUrl","fieldOptions","monitorFieldEvents","events","classes","Util","getCardType","tokenizationType","applyOptions","properties","destination","property","throwError","errorMessage","getItemByPropertyValue","collection","getParams","params","getUrlByEnv","addFormHandler","payment_form","getFields","form","childElementCount","element","HeartlandTokenService","_this","requestData","buildRequest","deserializeResponseData","serializeRequestData","encryptedcard","lastfour","last_four","card_type","exp_month","exp_year","CardinalTokenService","jwt","cardinal","Cardinal","responseData","__secureSubmitFrameInit","setup","on","Consumer","Account","AccountNumber","CardCode","ExpirationMonth","ExpirationYear","Options","EnableCCA","OrderDetails","OrderNumber","orderNumber","Token","ReasonCode","deserializeSuccessResponse","deserializeFailureResponse","token_value","ErrorDescription","ReasonDescription","HPS","parent","tokens","heartland","callbackWrapper","configureInternalIframe","loadHandler","receiveMessageHandlerAddedHandler","configureButtonFieldIframe","configureFieldIframe","errorMsg","lineNumber","column","errorObj","elementtext","elementstyle","removeNode","cardExpiration","Validator","index"],"mappings":";;;;;;;;;;;;;;AAAA;AACA,IAAIA,SAAS,GAAI,YAAY;AACzB;AAEA;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACI;;AACA;AACJ;AACA;AACA;AACA;AACA;AACI;AACA;;AACA,MAAIC,KAAK,GAAG,EAAZ;;AACC,eAAY;AACT;;AACA,aAASC,CAAT,CAAWC,CAAX,EAAc;AACV;AACA,aAAOA,CAAC,GAAG,EAAJ,GAAS,MAAMA,CAAf,GAAmBA,CAA1B;AACH;;AACD,QAAI,OAAOC,IAAI,CAACC,SAAL,CAAeC,MAAtB,KAAiC,UAArC,EAAiD;AAC7CF,MAAAA,IAAI,CAACC,SAAL,CAAeC,MAAf,GAAwB,UAAUC,GAAV,EAAe;AACnC,eAAOC,QAAQ,CAAC,KAAKC,OAAL,EAAD,CAAR,GA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","sourcesContent":["/* eslint-disable */\nvar Heartland = (function () {\n    'use strict';\n    \n    /* -----------------------------------------------------------------------------\n    This file is based on or incorporates material from the projects listed below\n    (collectively, \"Third Party Code\"). Microsoft is not the original author of the\n    Third Party Code. The original copyright notice and the license, under which\n    Microsoft received such Third Party Code, are set forth below. Such licenses\n    and notices are provided for informational purposes only. Microsoft, not the\n    third party, licenses the Third Party Code to you under the terms of the\n    Apache License, Version 2.0. See License.txt in the project root for complete\n    license information. Microsoft reserves all rights not expressly granted under\n    the Apache 2.0 License, whether by implication, estoppel or otherwise.\n    ----------------------------------------------------------------------------- */\n    /*\n        json2.js\n        2011-10-19\n    \n        Public Domain.\n    \n        NO WARRANTY EXPRESSED OR IMPLIED. USE AT YOUR OWN RISK.\n    \n        See http://www.JSON.org/js.html\n    \n    \n        This code should be minified before deployment.\n        See http://javascript.crockford.com/jsmin.html\n    \n        USE YOUR OWN COPY. IT IS EXTREMELY UNWISE TO LOAD CODE FROM SERVERS YOU DO\n        NOT CONTROL.\n    \n    \n        This file creates a global JSON object containing two methods: stringify\n        and parse.\n    \n            JSON.stringify(value, replacer, space)\n                value       any JavaScript value, usually an object or array.\n    \n                replacer    an optional parameter that determines how object\n                            values are stringified for objects. It can be a\n                            function or an array of strings.\n    \n                space       an optional parameter that specifies the indentation\n                            of nested structures. If it is omitted, the text will\n                            be packed without extra whitespace. If it is a number,\n                            it will specify the number of spaces to indent at each\n                            level. If it is a string (such as '\\t' or '&nbsp;'),\n                            it contains the characters used to indent at each level.\n    \n                This method produces a JSON text from a JavaScript value.\n    \n                When an object value is found, if the object contains a toJSON\n                method, its toJSON method will be called and the result will be\n                stringified. A toJSON method does not serialize: it returns the\n                value represented by the name/value pair that should be serialized,\n                or undefined if nothing should be serialized. The toJSON method\n                will be passed the key associated with the value, and this will be\n                bound to the value\n    \n                For example, this would serialize Dates as ISO strings.\n    \n                    Date.prototype.toJSON = function (key) {\n                        function f(n) {\n                            // Format integers to have at least two digits.\n                            return n < 10 ? '0' + n : n;\n                        }\n    \n                        return this.getUTCFullYear()   + '-' +\n                             f(this.getUTCMonth() + 1) + '-' +\n                             f(this.getUTCDate())      + 'T' +\n                             f(this.getUTCHours())     + ':' +\n                             f(this.getUTCMinutes())   + ':' +\n                             f(this.getUTCSeconds())   + 'Z';\n                    };\n    \n                You can provide an optional replacer method. It will be passed the\n                key and value of each member, with this bound to the containing\n                object. The value that is returned from your method will be\n                serialized. If your method returns undefined, then the member will\n                be excluded from the serialization.\n    \n                If the replacer parameter is an array of strings, then it will be\n                used to select the members to be serialized. It filters the results\n                such that only members with keys listed in the replacer array are\n                stringified.\n    \n                Values that do not have JSON representations, such as undefined or\n                functions, will not be serialized. Such values in objects will be\n                dropped; in arrays they will be replaced with null. You can use\n                a replacer function to replace those with JSON values.\n                JSON.stringify(undefined) returns undefined.\n    \n                The optional space parameter produces a stringification of the\n                value that is filled with line breaks and indentation to make it\n                easier to read.\n    \n                If the space parameter is a non-empty string, then that string will\n                be used for indentation. If the space parameter is a number, then\n                the indentation will be that many spaces.\n    \n                Example:\n    \n                text = JSON.stringify(['e', {pluribus: 'unum'}]);\n                // text is '[\"e\",{\"pluribus\":\"unum\"}]'\n    \n    \n                text = JSON.stringify(['e', {pluribus: 'unum'}], null, '\\t');\n                // text is '[\\n\\t\"e\",\\n\\t{\\n\\t\\t\"pluribus\": \"unum\"\\n\\t}\\n]'\n    \n                text = JSON.stringify([new Date()], function (key, value) {\n                    return this[key] instanceof Date ?\n                        'Date(' + this[key] + ')' : value;\n                });\n                // text is '[\"Date(---current time---)\"]'\n    \n    \n            JSON.parse(text, reviver)\n                This method parses a JSON text to produce an object or array.\n                It can throw a SyntaxError exception.\n    \n                The optional reviver parameter is a function that can filter and\n                transform the results. It receives each of the keys and values,\n                and its return value is used instead of the original value.\n                If it returns what it received, then the structure is not modified.\n                If it returns undefined then the member is deleted.\n    \n                Example:\n    \n                // Parse the text. Values that look like ISO date strings will\n                // be converted to Date objects.\n    \n                myData = JSON.parse(text, function (key, value) {\n                    let a;\n                    if (typeof value === 'string') {\n                        a =\n    /^(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2}(?:\\.\\d*)?)Z$/.exec(value);\n                        if (a) {\n                            return new Date(Date.UTC(+a[1], +a[2] - 1, +a[3], +a[4],\n                                +a[5], +a[6]));\n                        }\n                    }\n                    return value;\n                });\n    \n                myData = JSON.parse('[\"Date(09/09/2001)\"]', function (key, value) {\n                    let d;\n                    if (typeof value === 'string' &&\n                            value.slice(0, 5) === 'Date(' &&\n                            value.slice(-1) === ')') {\n                        d = new Date(value.slice(5, -1));\n                        if (d) {\n                            return d;\n                        }\n                    }\n                    return value;\n                });\n    \n    \n        This is a reference implementation. You are free to copy, modify, or\n        redistribute.\n    */\n    /*jslint evil: true, regexp: true */\n    /*members \"\", \"\\b\", \"\\t\", \"\\n\", \"\\f\", \"\\r\", \"\\\"\", JSON, \"\\\\\", apply,\n        call, charCodeAt, getUTCDate, getUTCFullYear, getUTCHours,\n        getUTCMinutes, getUTCMonth, getUTCSeconds, hasOwnProperty, join,\n        lastIndex, length, parse, prototype, push, replace, slice, stringify,\n        test, toJSON, toString, valueOf\n    */\n    // create a JSON object only if one does not already exist. We create the\n    // methods in a closure to avoid creating global variables.\n    var JSON2 = {};\n    (function () {\n        'use strict';\n        function f(n) {\n            // format integers to have at least two digits.\n            return n < 10 ? '0' + n : n;\n        }\n        if (typeof Date.prototype.toJSON !== 'function') {\n            Date.prototype.toJSON = function (key) {\n                return isFinite(this.valueOf())\n                    ? this.getUTCFullYear() + '-' +\n                        f(this.getUTCMonth() + 1) + '-' +\n                        f(this.getUTCDate()) + 'T' +\n                        f(this.getUTCHours()) + ':' +\n                        f(this.getUTCMinutes()) + ':' +\n                        f(this.getUTCSeconds()) + 'Z'\n                    : null;\n            };\n            var strProto = String.prototype;\n            var numProto = Number.prototype;\n            numProto.JSON = strProto.JSON =\n                Boolean.prototype.toJSON = function (key) {\n                    return this.valueOf();\n                };\n        }\n        var cx = /[\\u0000\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g, \n        // tslint:disable-next-line\n        esc = /[\\\\\\\"\\x00-\\x1f\\x7f-\\x9f\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g, gap, indent, meta = {\n            '\\b': '\\\\b',\n            '\\t': '\\\\t',\n            '\\n': '\\\\n',\n            '\\f': '\\\\f',\n            '\\r': '\\\\r',\n            '\"': '\\\\\"',\n            '\\\\': '\\\\\\\\'\n        }, rep;\n        function quote(string) {\n            // if the string contains no control characters, no quote characters, and no\n            // backslash characters, then we can safely slap some quotes around it.\n            // otherwise we must also replace the offending characters with safe escape\n            // sequences.\n            esc.lastIndex = 0;\n            return esc.test(string) ? '\"' + string.replace(esc, function (a) {\n                var c = meta[a];\n                return typeof c === 'string'\n                    ? c\n                    : '\\\\u' + ('0000' + a.charCodeAt(0).toString(16)).slice(-4);\n            }) + '\"' : '\"' + string + '\"';\n        }\n        function str(key, holder) {\n            // produce a string from holder[key].\n            var i, // the loop counter.\n            k = null, // the member key.\n            v, // the member value.\n            length, mind = gap, partial, value = holder[key];\n            // if the value has a toJSON method, call it to obtain a replacement value.\n            if (value && typeof value === 'object' &&\n                typeof value.toJSON === 'function') {\n                value = value.toJSON(key);\n            }\n            // if we were called with a replacer function, then call the replacer to\n            // obtain a replacement value.\n            if (typeof rep === 'function') {\n                value = rep.call(holder, key, value);\n            }\n            // what happens next depends on the value's type.\n            switch (typeof value) {\n                case 'string':\n                    return quote(value);\n                case 'number':\n                    // json numbers must be finite. Encode non-finite numbers as null.\n                    return isFinite(value) ? String(value) : 'null';\n                case 'boolean':\n                case 'null':\n                    // if the value is a boolean or null, convert it to a string. Note:\n                    // typeof null does not produce 'null'. The case is included here in\n                    // the remote chance that this gets fixed someday.\n                    return String(value);\n                // if the type is 'object', we might be dealing with an object or an array or\n                // null.\n                case 'object':\n                    // due to a specification blunder in ECMAScript, typeof null is 'object',\n                    // so watch out for that case.\n                    if (!value) {\n                        return 'null';\n                    }\n                    // make an array to hold the partial: string[] results of stringifying this object value.\n                    gap += indent;\n                    partial = [];\n                    // is the value an array?\n                    if (Object.prototype.toString.apply(value, []) === '[object Array]') {\n                        // the value is an array. Stringify every element. Use null as a placeholder\n                        // for non-JSON values.\n                        length = value.length;\n                        for (i = 0; i < length; i += 1) {\n                            partial[i] = str(i.toString(), value) || 'null';\n                        }\n                        // join all of the elements together, separated with commas, and wrap them in\n                        // brackets.\n                        v = partial.length === 0\n                            ? '[]'\n                            : gap\n                                ? '[\\n' + gap + partial.join(',\\n' + gap) + '\\n' + mind + ']'\n                                : '[' + partial.join(',') + ']';\n                        gap = mind;\n                        return v;\n                    }\n                    // if the replacer is an array, use it to select the members to be stringified.\n                    if (rep && typeof rep === 'object') {\n                        length = rep.length;\n                        for (i = 0; i < length; i += 1) {\n                            if (typeof rep[i] === 'string') {\n                                k = rep[i];\n                                v = str(k, value);\n                                if (v) {\n                                    partial.push(quote(k) + (gap ? ': ' : ':') + v);\n                                }\n                            }\n                        }\n                    }\n                    else {\n                        // otherwise, iterate through all of the keys in the object.\n                        for (k in value) {\n                            if (Object.prototype.hasOwnProperty.call(value, k)) {\n                                v = str(k, value);\n                                if (v) {\n                                    partial.push(quote(k) + (gap ? ': ' : ':') + v);\n                                }\n                            }\n                        }\n                    }\n                    // join all of the member texts together, separated with commas,\n                    // and wrap them in braces.\n                    v = partial.length === 0\n                        ? '{}'\n                        : gap\n                            ? '{\\n' + gap + partial.join(',\\n' + gap) + '\\n' + mind + '}'\n                            : '{' + partial.join(',') + '}';\n                    gap = mind;\n                    return v;\n            }\n        }\n        // if the JSON object does not yet have a stringify method, give it one.\n        if (typeof JSON2.stringify !== 'function') {\n            JSON2.stringify = function (value, replacer, space) {\n                // the stringify method takes a value and an optional replacer, and an optional\n                // space parameter, and returns a JSON text. The replacer can be a function\n                // that can replace values, or an array of strings that will select the keys.\n                // a default replacer method can be provided. Use of the space parameter can\n                // produce text that is more easily readable.\n                var i;\n                gap = '';\n                indent = '';\n                // if the space parameter is a number, make an indent string containing that\n                // many spaces.\n                if (typeof space === 'number') {\n                    for (i = 0; i < space; i += 1) {\n                        indent += ' ';\n                    }\n                }\n                else if (typeof space === 'string') {\n                    indent = space;\n                }\n                // if there is a replacer, it must be a function or an array.\n                // otherwise, throw an error.\n                rep = replacer;\n                if (replacer && typeof replacer !== 'function' &&\n                    (typeof replacer !== 'object' ||\n                        typeof replacer.length !== 'number')) {\n                    throw new Error('JSON.stringify');\n                }\n                // make a fake root object containing our value under the key of ''.\n                // return the result of stringifying the value.\n                return str('', { '': value });\n            };\n        }\n        // if the JSON object does not yet have a parse method, give it one.\n        if (typeof JSON2.parse !== 'function') {\n            JSON2.parse = function (text, reviver) {\n                // the parse method takes a text and an optional reviver function, and returns\n                // a JavaScript value if the text is a valid JSON text.\n                var j;\n                function walk(holder, key) {\n                    // the walk method is used to recursively walk the resulting structure so\n                    // that modifications can be made.\n                    var k = null, v, value = holder[key];\n                    if (value && typeof value === 'object') {\n                        for (k in value) {\n                            if (Object.prototype.hasOwnProperty.call(value, k)) {\n                                v = walk(value, k);\n                                if (v !== undefined) {\n                                    value[k] = v;\n                                }\n                                else {\n                                    value[k] = undefined;\n                                }\n                            }\n                        }\n                    }\n                    return reviver.call(holder, key, value);\n                }\n                // parsing happens in four stages. In the first stage, we replace certain\n                // unicode characters with escape sequences. JavaScript handles many characters\n                // incorrectly, either silently deleting them, or treating them as line endings.\n                text = String(text);\n                cx.lastIndex = 0;\n                if (cx.test(text)) {\n                    text = text.replace(cx, function (a) {\n                        return '\\\\u' +\n                            ('0000' + a.charCodeAt(0).toString(16)).slice(-4);\n                    });\n                }\n                // in the second stage, we run the text against regular expressions that look\n                // for non-JSON patterns. We are especially concerned with '()' and 'new'\n                // because they can cause invocation, and '=' because it can cause mutation.\n                // but just to be safe, we want to reject all unexpected forms.\n                // we split the second stage into 4 regexp operations in order to work around\n                // crippling inefficiencies in IE's and Safari's regexp engines. First we\n                // replace the JSON backslash pairs with '@' (a non-JSON character). Second, we\n                // replace all simple value tokens with ']' characters. Third, we delete all\n                // open brackets that follow a colon or comma or that begin the text. Finally,\n                // we look to see that the remaining characters are only whitespace or ']' or\n                // ',' or ':' or '{' or '}'. If that is so, then the text is safe for eval.\n                if (/^[\\],:{}\\s]*$/\n                    .test(text.replace(/\\\\(?:[\"\\\\\\/bfnrt]|u[0-9a-fA-F]{4})/g, '@')\n                    .replace(/\"[^\"\\\\\\n\\r]*\"|true|false|null|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?/g, ']')\n                    .replace(/(?:^|:|,)(?:\\s*\\[)+/g, ''))) {\n                    // in the third stage we use the eval function to compile the text into a\n                    // javascript structure. The '{' operator is subject to a syntactic ambiguity\n                    // in JavaScript: it can begin a block or an object literal. We wrap the text\n                    // in parens to eliminate the ambiguity.\n                    j = (new Function('return (' + text + ')')());\n                    // in the optional fourth stage, we recursively walk the new structure, passing\n                    // each name/value pair to a reviver function for possible transformation.\n                    return typeof reviver === 'function'\n                        ? walk({ '': j }, '')\n                        : j;\n                }\n                // if the text is not JSON parseable, then a SyntaxError is thrown.\n                throw new SyntaxError('JSON.parse');\n            };\n        }\n    }());\n    \n    var JsonpRequest = (function () {\n        function JsonpRequest(url, payload) {\n            if (url === void 0) { url = \"\"; }\n            if (payload === void 0) { payload = \"\"; }\n            this.url = url;\n            this.payload = payload;\n            this.type = \"jsonp\";\n        }\n        return JsonpRequest;\n    }());\n    var NullRequest = (function () {\n        function NullRequest(payload) {\n            if (payload === void 0) { payload = {}; }\n            this.payload = payload;\n            this.type = \"null\";\n        }\n        return NullRequest;\n    }());\n    /**\n     * @namespace Heartland.Ajax\n     */\n    var Ajax = (function () {\n        function Ajax() {\n        }\n        /**\n         * Heartland.Ajax.jsonp\n         *\n         * Creates a new DOM node containing a created JSONP callback handler for an\n         * impending Ajax JSONP request. Removes need for `XMLHttpRequest`.\n         *\n         * @param {string} url\n         * @param {function} callback\n         */\n        Ajax.jsonp = function (request, callback) {\n            var script = document.createElement('script');\n            var callbackName = 'jsonp_callback_' + Math.round(100000 * Math.random());\n            window[callbackName] = function (data) {\n                window[callbackName] = undefined;\n                document.body.removeChild(script);\n                callback(data);\n            };\n            script.src = request.url + (request.url.indexOf('?') >= 0 ? '&' : '?') + 'callback=' + callbackName\n                + '&' + request.payload;\n            document.body.appendChild(script);\n        };\n        /**\n         * Heartland.Ajax.cors\n         *\n         * Creates a new `XMLHttpRequest` object for a POST request to the given `url`.\n         *\n         * @param {string} url\n         * @param {function} callback\n         */\n        Ajax.cors = function (request, callback) {\n            var xhr;\n            var method = 'POST';\n            var timeout;\n            if ((new XMLHttpRequest()).withCredentials === undefined) {\n                xhr = new window.XDomainRequest();\n                method = 'GET';\n                request.url = request.url.split('?')[0];\n                request.url = request.url + '?' + request.payload;\n                xhr.open(method, request.url);\n            }\n            else {\n                xhr = new XMLHttpRequest();\n                xhr.open(method, request.url);\n                xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');\n            }\n            var cb = function (e) {\n                clearTimeout(timeout);\n                if (e.type === 'error') {\n                    callback({ error: { message: 'communication error' } });\n                    return;\n                }\n                if (xhr.readyState === 4 || (xhr.readyState !== 4 && xhr.responseText !== '')) {\n                    var data = JSON2.parse(xhr.responseText);\n                    callback(data);\n                }\n                else {\n                    callback({ error: { message: 'no data' } });\n                }\n            };\n            xhr.onload = cb;\n            xhr.onerror = cb;\n            xhr.send(request.payload);\n            timeout = setTimeout(function () {\n                xhr.abort();\n                callback({ error: { message: 'timeout' } });\n            }, 5000);\n        };\n        return Ajax;\n    }());\n    \n    var cardTypes = [\n        {\n            code: 'visa',\n            format: /(\\d{1,4})/g,\n            length: 16,\n            regex: /^4/\n        },\n        {\n            code: 'mastercard',\n            format: /(\\d{1,4})/g,\n            length: 16,\n            regex: /^(5[1-5]|2[2-7])/\n        },\n        {\n            code: 'amex',\n            format: /(\\d{1,4})(\\d{1,6})?(\\d{1,5})?/,\n            length: 15,\n            regex: /^3[47]/\n        },\n        {\n            code: 'diners',\n            format: /(\\d{1,4})(\\d{1,6})?(\\d{1,4})?/,\n            length: 14,\n            regex: /^3[0689]/\n        },\n        {\n            code: 'discover',\n            format: /(\\d{1,4})/g,\n            length: 16,\n            regex: /^6([045]|22)/\n        },\n        {\n            code: 'jcb',\n            format: /(\\d{1,4})/g,\n            length: 16,\n            regex: /^35/\n        }\n    ];\n    \n    var CardNumber = (function () {\n        function CardNumber() {\n        }\n        CardNumber.prototype.format = function (number) {\n            number = number.replace(/\\D/g, '');\n            var type = Card.typeByNumber(number);\n            if (!type) {\n                return number;\n            }\n            var matches = number.match(type.format);\n            if (!matches) {\n                return number;\n            }\n            if (!type.format.global) {\n                matches.shift();\n            }\n            return matches.join(' ').replace(/^\\s+|\\s+$/gm, '');\n        };\n        return CardNumber;\n    }());\n    \n    var Expiration = (function () {\n        function Expiration() {\n        }\n        Expiration.prototype.format = function (exp, final) {\n            if (final === void 0) { final = false; }\n            var pat = /^\\D*(\\d{1,2})(\\D+)?(\\d{1,4})?/;\n            var groups = exp.match(pat);\n            var month;\n            var del;\n            var year;\n            if (!groups) {\n                return '';\n            }\n            month = groups[1] || '';\n            del = groups[2] || '';\n            year = groups[3] || '';\n            if (year.length > 0) {\n                del = ' / ';\n            }\n            else if (month.length === 2 || del.length > 0) {\n                del = ' / ';\n            }\n            else if (month.length === 1 && (month !== '0' && month !== '1')) {\n                del = ' / ';\n            }\n            if (month.length === 1 && del !== '') {\n                month = '0' + month;\n            }\n            if (final && year.length === 2) {\n                year = (new Date).getFullYear().toString().slice(0, 2) + year;\n            }\n            return month + del + year;\n        };\n        return Expiration;\n    }());\n    \n    var CardNumber$1 = (function () {\n        function CardNumber() {\n        }\n        CardNumber.prototype.validate = function (number) {\n            if (!number) {\n                return false;\n            }\n            number = number.replace(/[-\\s]/g, '');\n            var type = Card.typeByNumber(number);\n            if (!type) {\n                return false;\n            }\n            return Card.luhnCheck(number)\n                && number.length === type.length;\n        };\n        return CardNumber;\n    }());\n    \n    var Cvv = (function () {\n        function Cvv() {\n        }\n        Cvv.prototype.validate = function (cvv) {\n            if (!cvv) {\n                return false;\n            }\n            cvv = cvv.replace(/^\\s+|\\s+$/g, '');\n            if (!/^\\d+$/.test(cvv)) {\n                return false;\n            }\n            return 3 <= cvv.length && cvv.length <= 4;\n        };\n        return Cvv;\n    }());\n    \n    var Expiration$1 = (function () {\n        function Expiration() {\n        }\n        Expiration.prototype.validate = function (exp) {\n            var m, y;\n            if (!exp) {\n                return false;\n            }\n            var split = exp.split('/');\n            m = split[0], y = split[1];\n            if (!m || !y) {\n                return false;\n            }\n            m = m.replace(/^\\s+|\\s+$/g, '');\n            y = y.replace(/^\\s+|\\s+$/g, '');\n            if (!/^\\d+$/.test(m)) {\n                return false;\n            }\n            if (!/^\\d+$/.test(y)) {\n                return false;\n            }\n            if (y.length === 2) {\n                y = (new Date).getFullYear().toString().slice(0, 2) + y;\n            }\n            var month = parseInt(m, 10);\n            var year = parseInt(y, 10);\n            if (!(1 <= month && month <= 12)) {\n                return false;\n            }\n            // creates date as 1 day past end of\n            // expiration month since JS months\n            // are 0 indexed\n            return (new Date(year, month, 1)) > (new Date);\n        };\n        return Expiration;\n    }());\n    \n    /**\n     * @namespace Heartland.DOM\n     */\n    var DOM = (function () {\n        function DOM() {\n        }\n        /**\n         * Heartland.DOM.configureField\n         *\n         * Configures an input field in a single field iFrame.\n         *\n         * @param {Heartland.HPS} hps\n         */\n        DOM.configureField = function (hps) {\n            document.getElementById('heartland-field').setAttribute('name', hps.field);\n        };\n        /**\n         * Heartland.DOM.makeFrame\n         *\n         * Creates a single iFrame element with the appropriate defaults.\n         *\n         * @param {string} name\n         * @returns {HTMLIframeElement}\n         */\n        DOM.makeFrame = function (name) {\n            var frame = document.createElement('iframe');\n            frame.id = 'heartland-frame-' + name;\n            frame.name = name;\n            frame.style.border = '0';\n            frame.frameBorder = '0';\n            frame.scrolling = 'no';\n            return frame;\n        };\n        /**\n         * Heartland.DOM.addField\n         *\n         * Adds a DOM `input` node to `formParent` with type `fieldType`, name\n         * `fieldName`, and value `fieldValue`.\n         *\n         * @param {string} formParent\n         * @param {string} fieldType\n         * @param {string} fieldName\n         * @param {string} fieldValue\n         */\n        DOM.addField = function (formParent, fieldType, fieldName, fieldValue) {\n            var input = document.createElement('input');\n            input.setAttribute('type', fieldType);\n            input.setAttribute('name', fieldName);\n            input.setAttribute('value', fieldValue);\n            document.getElementById(formParent).appendChild(input);\n        };\n        /**\n         * Heartland.DOM.setStyle\n         *\n         * Sets an element's style attribute within a child iframe window.\n         *\n         * @param {string} elementid\n         * @param {string} htmlstyle\n         */\n        DOM.setStyle = function (elementid, htmlstyle) {\n            var el = document.getElementById(elementid);\n            if (el) {\n                el.setAttribute('style', DOM.encodeEntities(htmlstyle));\n            }\n        };\n        /**\n         * Heartland.DOM.appendStyle\n         *\n         * Appends an element's style attribute within a child iframe window.\n         *\n         * @param {string} elementid\n         * @param {String} htmlstyle\n         */\n        DOM.appendStyle = function (elementid, htmlstyle) {\n            var el = document.getElementById(elementid);\n            if (el) {\n                var currstyle = el.getAttribute('style');\n                var newstyle = (currstyle ? currstyle : '') + htmlstyle;\n                el.setAttribute('style', DOM.encodeEntities(newstyle));\n            }\n        };\n        /**\n         * Heartland.DOM.setText\n         *\n         * Sets an element's inner text within a child iframe window.\n         *\n         * @param {string} elementid\n         * @param {string} text\n         */\n        DOM.setText = function (elementid, text) {\n            var el = document.getElementById(elementid);\n            if (el) {\n                el.textContent = DOM.encodeEntities(text);\n            }\n        };\n        /**\n         * Heartland.DOM.setValue\n         *\n         * Sets an element's value within a child iframe window\n         *\n         * @param {string} elementid\n         * @param {string} value\n         */\n        DOM.setValue = function (elementid, text) {\n            var el = document.getElementById(elementid);\n            if (el && typeof el.value !== \"undefined\") {\n                el.value = DOM.encodeEntities(text);\n            }\n        };\n        /**\n         * Heartland.DOM.setPlaceholder\n         *\n         * Sets an element's placeholder attribute within a child iframe window.\n         *\n         * @param {string} elementid\n         * @param {string} text\n         */\n        DOM.setPlaceholder = function (elementid, text) {\n            var el = document.getElementById(elementid);\n            if (el) {\n                if (text === '•••• •••• •••• ••••' || text === '••••' || text === '•••'\n                    || text === '···· ···· ···· ····') {\n                    el.setAttribute('placeholder', text);\n                }\n                else {\n                    el.setAttribute('placeholder', DOM.encodeEntities(text));\n                }\n            }\n        };\n        /**\n         * Heartland.DOM.resizeFrame\n         *\n         * Alerts a parent window to resize the iframe.\n         *\n         * @param {Heartland.HPS} hps\n         */\n        DOM.resizeFrame = function (hps) {\n            var docHeight = document.body.offsetHeight + 1; // off by one error\n            hps.Messages.post({ action: 'resize', height: docHeight }, 'parent');\n        };\n        /**\n         * Heartland.DOM.setFieldData\n         *\n         * Receives a field value from another frame prior to the tokenization process.\n         *\n         * @param {string} elementid\n         * @param {string} value\n         */\n        DOM.setFieldData = function (elementid, value) {\n            var el = document.getElementById(elementid);\n            if (!el && document.getElementById('heartland-field')) {\n                el = document.createElement('input');\n                el.setAttribute('id', DOM.encodeEntities(elementid));\n                el.setAttribute('type', 'hidden');\n                document.getElementById('heartland-field-wrapper').appendChild(el);\n            }\n            if (el) {\n                el.setAttribute('value', DOM.encodeEntities(value));\n            }\n        };\n        /**\n         * Heartland.DOM.getFieldData\n         *\n         * Retrieves a field value for another frame prior to the tokenization process.\n         *\n         * @param {Heartland.HPS} hps\n         * @param {string} elementid\n         */\n        DOM.getFieldData = function (hps, elementid) {\n            var el = document.getElementById(elementid);\n            if (el) {\n                hps.Messages.post({ action: 'passData', value: el.value }, 'parent');\n            }\n        };\n        /**\n         * Heartland.DOM.addStylesheet\n         *\n         * Creates a `style` node in the DOM with the given `css`.\n         *\n         * @param {Heartland.HPS} hps\n         * @param {string} elementid\n         */\n        DOM.addStylesheet = function (css) {\n            var el = document.createElement('style');\n            var elements = document.getElementsByTagName('head');\n            el.type = 'text/css';\n            el.appendChild(document.createTextNode(css));\n            if (elements && elements[0]) {\n                elements[0].appendChild(el);\n            }\n        };\n        /**\n         * Heartland.DOM.json2css\n         *\n         * Converts a JSON node to text representing CSS.\n         *\n         * @param {string} json\n         * @returns {string}\n         */\n        DOM.json2css = function (json) {\n            var css = '';\n            var attributes;\n            var children;\n            var i, j;\n            var key, value;\n            if (attributes = DOM.jsonAttributes(json)) {\n                var attributesLength = attributes.length;\n                for (i = 0; i < attributesLength; i++) {\n                    key = attributes[i];\n                    value = json[key];\n                    if (DOM.isArray(value)) {\n                        var arrLength = value.length;\n                        for (j = 0; j < arrLength; j++) {\n                            css += key + ':' + value[j] + ';';\n                        }\n                    }\n                    else {\n                        css += key + ':' + value + ';';\n                    }\n                }\n            }\n            if (children = DOM.jsonChildren(json)) {\n                var childrenLength = children.length;\n                for (i = 0; i < childrenLength; i++) {\n                    key = children[i];\n                    value = json[key];\n                    css += key + '{' + DOM.json2css(value) + '}';\n                }\n            }\n            return css;\n        };\n        /**\n         * Heartland.DOM.setFocus\n         *\n         * Sets the focus on an iframe's field.\n         *\n         * @param {Heartland.HPS} hps\n         * @param {string} elementid\n         */\n        DOM.setFocus = function () {\n            var el = document.getElementById('heartland-field');\n            if (el) {\n                el.focus();\n            }\n        };\n        /**\n         * Heartland.DOM.addCertAlert\n         *\n         * Adds an alert letting the developer know they're in sandbox mode\n         *\n         * @param {string} elementid\n         *\n         */\n        DOM.addCertAlert = function (elementid) {\n            var el = document.createElement('div');\n            var text = document.createTextNode(\"This page is currently in test mode. Do not use real/active card numbers.\");\n            el.appendChild(text);\n            el.style.display = \"block\";\n            el.style.width = \"100%\";\n            el.style.marginBottom = \"5px\";\n            el.style.color = \"#fff\";\n            el.style.backgroundColor = \"#770000\";\n            el.style.padding = \"8px 5px\";\n            el.style.fontFamily = \"Verdana\";\n            el.style.fontWeight = \"100\";\n            el.style.fontSize = \"12px\";\n            el.style.textAlign = \"center\";\n            el.style.boxSizing = \"border-box\";\n            var container = document.getElementById(elementid);\n            var frame = document.getElementById('heartland-frame-cardNumber');\n            if (frame) {\n                container.insertBefore(el, frame);\n            }\n            else {\n                var frame2 = document.getElementById('heartland-frame-heartland-frame-securesubmit');\n                container.insertBefore(el, frame2);\n            }\n        };\n        /***********\n         * Helpers *\n         ***********/\n        /**\n         * Escapes all potentially dangerous characters, so that the\n         * resulting string can be safely inserted into attribute or\n         * element text.\n         *\n         * @param value\n         * @returns {string} escaped text\n         */\n        DOM.encodeEntities = function (value) {\n            return value.\n                replace(/&/g, '&amp;').\n                replace(/[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]/g, function (v) {\n                var hi = v.charCodeAt(0);\n                var low = v.charCodeAt(1);\n                return '&#' + (((hi - 0xD800) * 0x400) + (low - 0xDC00) + 0x10000) + ';';\n            }).\n                replace(/([^\\#-~| |!])/g, function (v) {\n                return '&#' + v.charCodeAt(0) + ';';\n            }).\n                replace(/</g, '&lt;').\n                replace(/>/g, '&gt;');\n        };\n        DOM.isArray = function (obj) {\n            return Object.prototype.toString.call(obj) === '[object Array]';\n        };\n        DOM.jsonAttributes = function (json) {\n            var set = [];\n            for (var i in json) {\n                if (json.hasOwnProperty(i)\n                    && (typeof json[i] === 'string' || DOM.isArray(json[i]))) {\n                    set.push(i);\n                }\n            }\n            return set;\n        };\n        DOM.jsonChildren = function (json) {\n            var set = [];\n            for (var i in json) {\n                if (json.hasOwnProperty(i)\n                    && (Object.prototype.toString.call(json[i]) === '[object Object]')) {\n                    set.push(i);\n                }\n            }\n            return set;\n        };\n        return DOM;\n    }());\n    \n    var Expiration$2 = (function () {\n        function Expiration() {\n        }\n        Expiration.prototype.format = function (exp, final) {\n            if (final === void 0) { final = false; }\n            var pat = /^\\D*(\\d{1,2})(\\D+)?(\\d{1,4})?/;\n            var groups = exp.match(pat);\n            var month;\n            var del;\n            var year;\n            if (!groups) {\n                return '';\n            }\n            month = groups[1] || '';\n            del = groups[2] || '';\n            year = groups[3] || '';\n            if (year.length > 0) {\n                del = ' / ';\n            }\n            else if (month.length === 2 || del.length > 0) {\n                del = ' / ';\n            }\n            else if (month.length === 1 && (month !== '0' && month !== '1')) {\n                del = ' / ';\n            }\n            if (month.length === 1 && del !== '') {\n                month = '0' + month;\n            }\n            if (final && year.length === 2) {\n                year = (new Date).getFullYear().toString().slice(0, 2) + year;\n            }\n            return month + del + year;\n        };\n        return Expiration;\n    }());\n    \n    var Ev = (function () {\n        function Ev() {\n        }\n        Ev.listen = function (node, eventName, callback) {\n            if (document.addEventListener) {\n                node.addEventListener(eventName, callback, false);\n            }\n            else {\n                if (node === document) {\n                    document.documentElement.attachEvent('onpropertychange', function (e) {\n                        if (e.propertyName === eventName) {\n                            callback(e);\n                        }\n                    });\n                }\n                else {\n                    node.attachEvent('on' + eventName, callback);\n                }\n            }\n        };\n        Ev.trigger = function (node, eventName) {\n            if (document.createEvent) {\n                var event = document.createEvent('Event');\n                event.initEvent(eventName, true, true);\n                node.dispatchEvent(event);\n            }\n            else {\n                document.documentElement[eventName]++;\n            }\n        };\n        Ev.ignore = function (eventName, callback) {\n            if (document.removeEventListener) {\n                document.removeEventListener(eventName, callback, false);\n            }\n            else {\n                document.documentElement.detachEvent('onpropertychange', function (e) {\n                    if (e.propertyName === eventName) {\n                        callback(e);\n                    }\n                });\n            }\n        };\n        return Ev;\n    }());\n    /**\n     * @namespace Heartland.Events\n     */\n    var Events = (function () {\n        function Events() {\n        }\n        /**\n         * Heartland.Events.addHandler\n         *\n         * Adds an `event` handler for a given `target` element.\n         *\n         * @param {string | EventTarget} target\n         * @param {string} event\n         * @param {EventListener} callback\n         */\n        Events.addHandler = function (target, event, callback) {\n            var node;\n            if (typeof target === 'string') {\n                node = document.getElementById(target);\n            }\n            else {\n                node = target;\n            }\n            if (document.addEventListener) {\n                node.addEventListener(event, callback, false);\n            }\n            else {\n                Ev.listen(node, event, callback);\n            }\n        };\n        /**\n         * Heartland.Events.removeHandler\n         *\n         * Removes an `event` handler for a given `target` element.\n         *\n         * @param {string | EventTarget} target\n         * @param {string} event\n         * @param {EventListener} callback\n         */\n        Events.removeHandler = function (target, event, callback) {\n            var node;\n            if (typeof target === 'string') {\n                node = document.getElementById(target);\n            }\n            else {\n                node = target;\n            }\n            if (document.removeEventListener) {\n                node.removeEventListener(event, callback, false);\n            }\n            else {\n                Ev.ignore(event, callback);\n            }\n        };\n        /**\n         * Heartland.Events.trigger\n         *\n         * Fires off an `event` for a given `target` element.\n         *\n         * @param {string} name\n         * @param {any} target\n         * @param {any} data [optional]\n         */\n        Events.trigger = function (name, target, data, bubble) {\n            if (bubble === void 0) { bubble = false; }\n            if (document.createEvent) {\n                var event = document.createEvent('Event');\n                event.initEvent(name, true, true);\n                target.dispatchEvent(event);\n            }\n            else {\n                Ev.trigger(target, name);\n            }\n        };\n        /**\n         * Heartland.Events.frameHandleWith\n         *\n         * Wraps `hps` state in a closure to provide a `Heartland.Messages.receive`\n         * callback handler for iFrame children.\n         *\n         * @param {Heartland.HPS} hps\n         */\n        Events.frameHandleWith = function (hps) {\n            return function (data) {\n                switch (data.action) {\n                    case 'tokenize':\n                        if (data.accumulateData) {\n                            hps.Messages.post({\n                                action: 'accumulateData'\n                            }, 'parent');\n                            var elOpts = document.getElementById('tokenizeOptions');\n                            if (!elOpts) {\n                                elOpts = document.createElement('input');\n                                elOpts.id = 'tokenizeOptions';\n                                elOpts.type = 'hidden';\n                            }\n                            var elPK = document.getElementById('publicKey');\n                            if (!elPK) {\n                                elPK = document.createElement('input');\n                                elPK.id = 'publicKey';\n                                elPK.type = 'hidden';\n                            }\n                            if (data.data) {\n                                elOpts.value = JSON2.stringify(data.data);\n                                elPK.value = data.data.publicKey;\n                            }\n                            else {\n                                elOpts.value = JSON2.stringify({ publicKey: data.message });\n                                elPK.value = data.message;\n                            }\n                            document\n                                .getElementById('heartland-field-wrapper')\n                                .appendChild(elOpts);\n                            document\n                                .getElementById('heartland-field-wrapper')\n                                .appendChild(elPK);\n                        }\n                        else {\n                            Events.tokenizeIframe(hps, data.data);\n                        }\n                        break;\n                    case 'setStyle':\n                        DOM.setStyle(data.id, data.style);\n                        DOM.resizeFrame(hps);\n                        break;\n                    case 'appendStyle':\n                        DOM.appendStyle(data.id, data.style);\n                        DOM.resizeFrame(hps);\n                        break;\n                    case 'setText':\n                        DOM.setText(data.id, data.text);\n                        DOM.resizeFrame(hps);\n                        break;\n                    case 'setValue':\n                        DOM.setValue(data.id, data.text);\n                        break;\n                    case 'setPlaceholder':\n                        DOM.setPlaceholder(data.id, data.text);\n                        break;\n                    case 'setFieldData':\n                        DOM.setFieldData(data.id, data.value);\n                        if (document.getElementById('heartland-field') &&\n                            document.getElementById('cardCvv') &&\n                            document.getElementById('cardExpiration')) {\n                            var opts = document.getElementById('tokenizeOptions');\n                            var pk = document.getElementById('publicKey');\n                            Events.tokenizeIframe(hps, (opts && opts.getAttribute('value') !== 'undefined'\n                                ? JSON2.parse(opts.getAttribute('value'))\n                                : { publicKey: pk.getAttribute('value') }));\n                        }\n                        break;\n                    case 'getFieldData':\n                        DOM.getFieldData(hps, data.id);\n                        break;\n                    case 'addStylesheet':\n                        DOM.addStylesheet(data.data);\n                        DOM.resizeFrame(hps);\n                        break;\n                    case 'setFocus':\n                        DOM.setFocus();\n                        break;\n                }\n            };\n        };\n        /**\n         * tokenizeIframe\n         *\n         * Tokenizes card data. Used in iframe integrations to tokenize on Heartland's\n         * servers.\n         *\n         * @param {Heartland.HPS} hps\n         * @param {string} publicKey\n         */\n        Events.tokenizeIframe = function (hps, data) {\n            var card = {};\n            var numberElement = (document.getElementById('heartland-field')\n                || document.getElementById('heartland-card-number'));\n            var cvvElement = (document.getElementById('cardCvv')\n                || document.getElementById('heartland-cvv'));\n            var expElement = document.getElementById('cardExpiration');\n            var tokenResponse = function (action) {\n                return function (response) {\n                    hps.Messages.post({ action: action, response: response }, 'parent');\n                    if (cvvElement) {\n                        if (cvvElement.parentNode) {\n                            cvvElement.parentNode.removeChild(cvvElement);\n                        }\n                        else {\n                            cvvElement.remove();\n                        }\n                    }\n                    if (expElement) {\n                        if (expElement.parentNode) {\n                            expElement.parentNode.removeChild(expElement);\n                        }\n                        else {\n                            expElement.remove();\n                        }\n                    }\n                };\n            };\n            card.number = numberElement ? numberElement.value : '';\n            card.cvv = cvvElement ? cvvElement.value : '';\n            card.exp = expElement;\n            if (card.exp) {\n                var formatter = new Expiration$2();\n                var cardExpSplit = formatter.format(card.exp.value, true).split('/');\n                card.expMonth = cardExpSplit[0];\n                card.expYear = cardExpSplit[1];\n                card.exp = undefined;\n            }\n            else {\n                card.expMonth = document.getElementById('heartland-expiration-month').value;\n                card.expYear = document.getElementById('heartland-expiration-year').value;\n            }\n            hps.tokenize({\n                cardCvv: card.cvv ? card.cvv : '',\n                cardExpMonth: card.expMonth ? card.expMonth : '',\n                cardExpYear: card.expYear ? card.expYear : '',\n                cardNumber: card.number ? card.number : '',\n                cca: data.cca,\n                error: tokenResponse('onTokenError'),\n                publicKey: data.publicKey ? data.publicKey : '',\n                success: tokenResponse('onTokenSuccess'),\n                type: 'pan'\n            });\n        };\n        return Events;\n    }());\n    \n    /**\n     * @namespace Heartland.Card\n     */\n    var Card = (function () {\n        function Card() {\n        }\n        /**\n         * Heartland.Card.typeByNumber\n         *\n         * Helper function to grab the CardType for a given card number.\n         *\n         * @param {string} number - The card number\n         * @returns {Heartland.CardType}\n         */\n        Card.typeByNumber = function (number) {\n            var cardType;\n            var i;\n            if (!number) {\n                return null;\n            }\n            if (number.replace(/^\\s+|\\s+$/gm, '').length < 4) {\n                return null;\n            }\n            for (i in cardTypes) {\n                cardType = cardTypes[i];\n                if (cardType && cardType.regex && cardType.regex.test(number)) {\n                    break;\n                }\n            }\n            return cardType;\n        };\n        /**\n         * Heartland.Card.typeByTrack\n         *\n         * @param {string} data - track data\n         * @param {boolean} isEncrypted - (default: false)\n         * @param {string} trackNumber\n         *\n         * @returns CardType\n         */\n        Card.typeByTrack = function (data, isEncrypted, trackNumber) {\n            if (isEncrypted === void 0) { isEncrypted = false; }\n            var number;\n            if (isEncrypted && trackNumber && trackNumber === '02') {\n                number = data.split('=')[0];\n            }\n            else {\n                var temp = data.split('%');\n                if (temp[1]) {\n                    temp = temp[1].split('^');\n                    if (temp[0]) {\n                        number = temp[0].toString().substr(1);\n                    }\n                }\n            }\n            return Card.typeByNumber(number);\n        };\n        /**\n         * Heartland.Card.luhnCheck\n         *\n         * Runs a mod 10 check on a given card number.\n         *\n         * @param {string} number - The card number\n         * @returns {boolean}\n         */\n        Card.luhnCheck = function (number) {\n            var odd = true;\n            var i = 0;\n            var sum = 0;\n            var digit;\n            if (!number) {\n                return false;\n            }\n            var digits = number.split('').reverse();\n            var length = digits.length;\n            for (i; i < length; i++) {\n                digit = parseInt(digits[i], 10);\n                if (odd = !odd) {\n                    digit *= 2;\n                }\n                if (digit > 9) {\n                    digit -= 9;\n                }\n                sum += digit;\n            }\n            return sum % 10 === 0;\n        };\n        /**\n         * Heartland.Card.addType\n         *\n         * Adds a class to the target element with the card type\n         * inferred from the target's current value.\n         *\n         * @param {Event} e\n         */\n        Card.addType = function (e) {\n            var target = (e.currentTarget ? e.currentTarget : e.srcElement);\n            var type = Card.typeByNumber(target.value);\n            var classList = target.className.split(' ');\n            var length = classList.length;\n            var i = 0;\n            var c = '';\n            for (i; i < length; i++) {\n                c = classList[i];\n                if (c && c.indexOf('card-type-') !== -1) {\n                    delete classList[i];\n                }\n            }\n            if (type) {\n                classList.push('card-type-' + type.code);\n            }\n            target.className = classList.join(' ').replace(/^\\s+|\\s+$/gm, '');\n        };\n        /**\n         * Heartland.Card.formatNumber\n         *\n         * Formats a target element's value based on the\n         * inferred card type's formatting regex.\n         *\n         * @param {Event} e\n         */\n        Card.formatNumber = function (e) {\n            var target = (e.currentTarget ? e.currentTarget : e.srcElement);\n            var value = target.value;\n            if (value.length === 0) {\n                return;\n            }\n            var formatted = (new CardNumber).format(value);\n            target.value = formatted;\n            if (!target.setSelectionRange) {\n                return;\n            }\n            var cursor = target.selectionStart;\n            // copy and paste, space inserted on formatter\n            if (value.length < formatted.length) {\n                cursor += formatted.length - value.length;\n            }\n            // check if before new inserted digit is a space\n            if (value.charAt(cursor) === ' ' &&\n                formatted.charAt(cursor - 1) === ' ') {\n                cursor += 1;\n            }\n            target.setSelectionRange(cursor, cursor);\n        };\n        /**\n         * Heartland.Card.formatExpiration\n         *\n         * Formats a target element's value.\n         *\n         * @param {KeyboardEvent} e\n         */\n        Card.formatExpiration = function (e) {\n            var target = (e.currentTarget ? e.currentTarget : e.srcElement);\n            var value = target.value;\n            // allow: delete, backspace\n            if ([46, 8].indexOf(e.keyCode) !== -1 ||\n                // allow: home, end, left, right\n                (e.keyCode >= 35 && e.keyCode <= 39)) {\n                return;\n            }\n            target.value = (new Expiration)\n                .format(value, e.type === 'blur');\n        };\n        /**\n         * Heartland.Card.restrictLength\n         *\n         * Restricts input in a target element to a\n         * certain length data.\n         *\n         * @param {number} length\n         *\n         * @returns {(e: KeyboardEvent) => ()}\n         */\n        Card.restrictLength = function (length) {\n            return function (e) {\n                var target = (e.currentTarget ? e.currentTarget : e.srcElement);\n                var value = target.value;\n                // allow: backspace, delete, tab, escape and enter\n                if ([46, 8, 9, 27, 13, 110].indexOf(e.keyCode) !== -1 ||\n                    // allow: Ctrl+A\n                    (e.keyCode === 65 && e.ctrlKey === true) ||\n                    // allow: home, end, left, right\n                    (e.keyCode >= 35 && e.keyCode <= 39)) {\n                    // let it happen, don't do anything\n                    return;\n                }\n                if (value.length >= length) {\n                    e.preventDefault ? e.preventDefault() : (e.returnValue = false);\n                }\n            };\n        };\n        /**\n         * Heartland.Card.restrictNumeric\n         *\n         * Restricts input in a target element to only\n         * numeric data.\n         *\n         * @param {KeyboardEvent} e\n         */\n        Card.restrictNumeric = function (e) {\n            // allow: backspace, delete, tab, escape and enter\n            if ([46, 8, 9, 27, 13, 110].indexOf(e.keyCode) !== -1 ||\n                // allow: Ctrl+A\n                (e.keyCode === 65 && e.ctrlKey === true) ||\n                // allow: home, end, left, right\n                (e.keyCode >= 35 && e.keyCode <= 39) ||\n                // allow: weird Android/Chrome issue\n                (e.keyCode === 229)) {\n                // let it happen, don't do anything\n                return;\n            }\n            // ensure that it is a number and stop the keypress\n            if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {\n                e.preventDefault ? e.preventDefault() : (e.returnValue = false);\n            }\n        };\n        /**\n         * Heartland.Card.deleteProperly\n         *\n         * Places cursor on the correct position to\n         * let the browser delete the digit instead\n         * of the space.\n         *\n         * @param {KeyboardEvent} e\n         */\n        Card.deleteProperly = function (e) {\n            var target = (e.currentTarget ? e.currentTarget : e.srcElement);\n            var value = target.value;\n            if (!target.setSelectionRange) {\n                return;\n            }\n            var cursor = target.selectionStart;\n            // allow: delete, backspace\n            if ([46, 8].indexOf(e.keyCode) !== -1 &&\n                // if space to be deleted\n                (value.charAt(cursor - 1) === ' ')) {\n                // placing cursor before space to delete digit instead\n                target.setSelectionRange(cursor - 1, cursor - 1);\n            }\n        };\n        /**\n         * Heartland.Card.validateNumber\n         *\n         * Validates a target element's value based on the\n         * inferred card type's validation regex. Adds a\n         * class to the target element to note `valid` or\n         * `invalid`.\n         *\n         * @param {Event} e\n         */\n        Card.validateNumber = function (e) {\n            var target = (e.currentTarget ? e.currentTarget : e.srcElement);\n            var value = target.value;\n            var classList = target.className.split(' ');\n            var length = classList.length;\n            var c = '';\n            for (var i = 0; i < length; i++) {\n                c = classList[i];\n                if (c.indexOf('valid') !== -1) {\n                    delete classList[i];\n                }\n            }\n            if ((new CardNumber$1).validate(value)) {\n                classList.push('valid');\n            }\n            else {\n                classList.push('invalid');\n            }\n            target.className = classList.join(' ').replace(/^\\s+|\\s+$/gm, '');\n        };\n        /**\n         * Heartland.Card.validateCvv\n         *\n         * Validates a target element's value based on the\n         * possible CVV lengths. Adds a class to the target\n         * element to note `valid` or `invalid`.\n         *\n         * @param {Event} e\n         */\n        Card.validateCvv = function (e) {\n            var target = (e.currentTarget ? e.currentTarget : e.srcElement);\n            var value = target.value;\n            var classList = target.className.split(' ');\n            var length = classList.length;\n            var c = '';\n            for (var i = 0; i < length; i++) {\n                c = classList[i];\n                if (c.indexOf('valid') !== -1) {\n                    delete classList[i];\n                }\n            }\n            if ((new Cvv).validate(value)) {\n                classList.push('valid');\n            }\n            else {\n                classList.push('invalid');\n            }\n            target.className = classList.join(' ').replace(/^\\s+|\\s+$/gm, '');\n        };\n        /**\n         * Heartland.Card.validateExpiration\n         *\n         * Validates a target element's value based on the\n         * current date. Adds a class to the target element\n         * to note `valid` or `invalid`.\n         *\n         * @param {Event} e\n         */\n        Card.validateExpiration = function (e) {\n            var target = (e.currentTarget ? e.currentTarget : e.srcElement);\n            var value = target.value;\n            var classList = target.className.split(' ');\n            var length = classList.length;\n            var c = '';\n            for (var i = 0; i < length; i++) {\n                c = classList[i];\n                if (c.indexOf('valid') !== -1) {\n                    delete classList[i];\n                }\n            }\n            if ((new Expiration$1).validate(value)) {\n                classList.push('valid');\n            }\n            else {\n                classList.push('invalid');\n            }\n            target.className = classList.join(' ').replace(/^\\s+|\\s+$/gm, '');\n        };\n        /**\n         * Heartland.Card.attachNumberEvents\n         *\n         * @param {string} selector\n         */\n        Card.attachNumberEvents = function (selector) {\n            Events.addHandler(document.querySelector(selector), 'keydown', Card.restrictNumeric);\n            Events.addHandler(document.querySelector(selector), 'keydown', Card.restrictLength(19));\n            Events.addHandler(document.querySelector(selector), 'keydown', Card.deleteProperly);\n            Events.addHandler(document.querySelector(selector), 'keyup', Card.formatNumber);\n            Events.addHandler(document.querySelector(selector), 'input', Card.formatNumber);\n            Events.addHandler(document.querySelector(selector), 'input', Card.validateNumber);\n            Events.addHandler(document.querySelector(selector), 'input', Card.addType);\n        };\n        /**\n         * Heartland.Card.attachExpirationEvents\n         *\n         * @param {string} selector\n         */\n        Card.attachExpirationEvents = function (selector) {\n            Events.addHandler(document.querySelector(selector), 'keydown', Card.restrictNumeric);\n            Events.addHandler(document.querySelector(selector), 'keydown', Card.restrictLength(9));\n            Events.addHandler(document.querySelector(selector), 'keyup', Card.formatExpiration);\n            Events.addHandler(document.querySelector(selector), 'blur', Card.formatExpiration);\n            Events.addHandler(document.querySelector(selector), 'input', Card.validateExpiration);\n            Events.addHandler(document.querySelector(selector), 'blur', Card.validateExpiration);\n        };\n        /**\n         * Heartland.Card.attachCvvEvents\n         *\n         * @param {string} selector\n         */\n        Card.attachCvvEvents = function (selector) {\n            Events.addHandler(document.querySelector(selector), 'keydown', Card.restrictNumeric);\n            Events.addHandler(document.querySelector(selector), 'keydown', Card.restrictLength(4));\n            Events.addHandler(document.querySelector(selector), 'input', Card.validateCvv);\n        };\n        return Card;\n    }());\n    if (!Array.prototype.indexOf) {\n        Array.prototype.indexOf = function (obj, start) {\n            for (var i = (start || 0), j = this.length; i < j; i++) {\n                if (this[i] === obj) {\n                    return i;\n                }\n            }\n            return -1;\n        };\n    }\n    \n    var Formatter = {\n        CardNumber: CardNumber,\n        Expiration: Expiration\n    };\n    \n    var defaults = {\n        _method: 'post',\n        buttonTarget: '',\n        cardCvv: '',\n        cardExpMonth: '',\n        cardExpYear: '',\n        cardNumber: '',\n        cardType: '',\n        env: 'prod',\n        error: null,\n        fields: {},\n        formId: '',\n        gatewayUrl: '',\n        iframeTarget: '',\n        ktb: '',\n        object: 'token',\n        onEvent: null,\n        onTokenError: null,\n        onTokenSuccess: null,\n        pinBlock: '',\n        publicKey: '',\n        success: null,\n        targetType: '',\n        tokenType: 'supt',\n        track: '',\n        trackNumber: '',\n        type: 'pan',\n        useDefaultStyles: true\n    };\n    \n    var fields = [\n        'cardNumber',\n        'cardCvv',\n        'cardExpiration',\n        'submit'\n    ];\n    \n    var urls = {\n        CERT: 'https://cert.api2.heartlandportico.com/Hps.Exchange.PosGateway.Hpf.v1/api/token',\n        PROD: 'https://api.heartlandportico.com/SecureSubmit.v1/api/token',\n        iframeCERT: 'https://hps.github.io/token/2.1/',\n        iframePROD: 'https://api.heartlandportico.com/SecureSubmit.v1/token/2.1/'\n    };\n    \n    /**\n     * Heartland.Messages\n     *\n     * Initializes a new object for wrapping `window.postMessage` and a fallback\n     * method for legacy browsers.\n     */\n    var Messages = (function () {\n        /**\n         * Heartland.Messages (constructor)\n         *\n         * @constructor\n         * @param {Heartland.HPS} hps\n         * @returns {Heartland.Messages}\n         */\n        function Messages(hps) {\n            this.hps = hps;\n            this.intervalId = null;\n            this.lastHash = '';\n            this.pushIntervalStarted = false;\n        }\n        /**\n         * Heartland.Messages.pushMessages\n         *\n         * For legacy browsers, a mailbox (buffer) must be used to ensure all messages\n         * are sent between parent and child windows. When ready, this function builds\n         * the final message, encodes it, sends it, and resets the mailbox to `[]`.\n         *\n         * @param {Heartland.HPS} hps\n         * @returns {function}\n         */\n        Messages.prototype.pushMessages = function (hps) {\n            return function () {\n                var data = [];\n                var messageArr = [];\n                var i = 0;\n                var targetUrl = '';\n                var current;\n                var targetNode;\n                var re = /^#?\\d+&/;\n                var length = hps.mailbox.length;\n                if (!length) {\n                    return;\n                }\n                for (i = 0; i < length; i++) {\n                    current = hps.mailbox.shift();\n                    if (!targetUrl) {\n                        targetUrl = current.targetUrl;\n                        targetNode = current.targetNode;\n                    }\n                    messageArr.push(current.message);\n                }\n                current = null;\n                if (re.test(window.location.hash)) {\n                    current = JSON2.parse(decodeURIComponent(window.location.hash.replace(re, '')));\n                    data.concat(current);\n                }\n                if (messageArr !== []) {\n                    hps.cacheBust = hps.cacheBust || 1;\n                    data.push({ data: messageArr, source: { name: hps.field || 'parent' } });\n                    var message = JSON2.stringify(data);\n                    var url = targetUrl.replace(/#.*$/, '') + '#' +\n                        (+new Date()) + (hps.cacheBust++) + '&' +\n                        encodeURIComponent(message);\n                    if (targetNode.location) {\n                        targetNode.location.href = url;\n                    }\n                    else {\n                        targetNode.src = url;\n                    }\n                }\n                messageArr.length = 0;\n                hps.mailbox.length = 0;\n            };\n        };\n        /**\n         * Heartland.Messages.post\n         *\n         * When present, wraps the built-in `window.postMessage`. When not present,\n         * pushes the message onto the mailbox for eventual sending, and on first use,\n         * starts the interval for `Messages.pushMessages`.\n         *\n         * @param {Object | string} message\n         * @param {string} target\n         */\n        Messages.prototype.post = function (message, target) {\n            var targetNode;\n            message.source = message.source || {};\n            message.source.name = window.name;\n            if (!this.hps.frames) {\n                return;\n            }\n            var frame = this.hps.frames[target] || this.hps[target];\n            if (!frame) {\n                return;\n            }\n            var targetUrl = this.hps.frames[target].url;\n            try {\n                if (typeof frame.targetNode !== 'undefined') {\n                    targetNode = frame.targetNode;\n                }\n                else if (typeof frame.frame !== 'undefined') {\n                    targetNode = frame.frame;\n                }\n            }\n            catch (e) {\n                targetNode = frame;\n            }\n            if (window.postMessage) {\n                targetNode.postMessage(JSON2.stringify(message), targetUrl);\n            }\n            else {\n                this.hps.mailbox = this.hps.mailbox || [];\n                this.hps.mailbox.push({\n                    message: message,\n                    targetNode: targetNode,\n                    targetUrl: targetUrl\n                });\n                if (!this.pushIntervalStarted) {\n                    setInterval(this.pushMessages(this.hps), 10);\n                }\n            }\n        };\n        /**\n         * Heartland.Messages.receive\n         *\n         * When present, wraps the built-in `window.postMesage`'s `message` or\n         * `onmessage` window events. When not present, uses a single interval to\n         * check for changes to `window.location.hash` when the other window sends a\n         * message and will decode the JSON and URI encoded hash.\n         *\n         * @param {Function} callback\n         * @param {string} sourceOrigin\n         */\n        Messages.prototype.receive = function (callback, sourceOrigin) {\n            if (window.postMessage) {\n                this.callback = function (m) {\n                    try {\n                        callback(JSON2.parse(m.data));\n                    }\n                    catch (e) { }\n                };\n                if (window.addEventListener) {\n                    window.addEventListener('message', this.callback, !1);\n                }\n                else {\n                    window.attachEvent('onmessage', this.callback);\n                }\n            }\n            else {\n                if (this.intervalId) {\n                    clearInterval(this.intervalId);\n                }\n                this.intervalId = null;\n                if (callback) {\n                    this.intervalId = setInterval(function () {\n                        var hash = document.location.hash, re = /^#?\\d+&/;\n                        if (hash !== this.lastHash && re.test(hash)) {\n                            var data = JSON2.parse(decodeURIComponent(hash.replace(re, '')));\n                            this.lastHash = hash;\n                            for (var i in data) {\n                                var m = data[i];\n                                if (Object.prototype.toString.call(m.data) !== '[object Array]') {\n                                    callback(m);\n                                    continue;\n                                }\n                                for (var j in m.data) {\n                                    callback({ data: m.data[j], source: m.source });\n                                }\n                            }\n                        }\n                    }, 100);\n                }\n            }\n            Events.trigger('receiveMessageHandlerAdded', document);\n        };\n        /**\n         * Heartland.Messages.removeReceiver\n         *\n         * Removes active `message` event handler function.\n         */\n        Messages.prototype.removeReceiver = function () {\n            if (window.addEventListener) {\n                window.removeEventListener('message', this.callback, !1);\n            }\n            else {\n                window.detachEvent('onmessage', this.callback);\n            }\n        };\n        /**\n         * Heartland.Messages.dispose\n         *\n         * Removes active `message` event handler function and any\n         * active intervals.\n         */\n        Messages.prototype.dispose = function () {\n            this.removeReceiver();\n            if (this.intervalId) {\n                clearInterval(this.intervalId);\n            }\n        };\n        return Messages;\n    }());\n    \n    /**\n     * @namespace Heartland.Styles\n     */\n    var Styles;\n    (function (Styles) {\n        /**\n         * Heartland.Styles.Defaults\n         *\n         * Collection of helper functions for applying default styles to a child\n         * window's fields. Serves as an example of these methods' use in merchant\n         * modifications. Each function expects a `Heartland.HPS` object to be passed\n         * as an argument.\n         */\n        Styles.Defaults = {\n            body: function (hps) {\n                hps.setStyle('heartland-body', 'margin: 0;' +\n                    'font-family: Arial, \\'Helvetica Neue\\', Helvetica, sans-serif;' +\n                    'color: #666;');\n            },\n            cvv: function (hps) {\n                hps.appendStyle('heartland-cvv', 'width: 110px;');\n            },\n            cvvContainer: function (hps) {\n                hps.setStyle('heartland-cvv-container', 'width: 110px;' +\n                    'display: inline-block;' +\n                    'float: left;');\n            },\n            fieldset: function (hps) {\n                hps.setStyle('heartland-expiration-date-container', 'border: 0;' +\n                    'margin: 0 25px 0px 1px;' +\n                    'padding: 0;' +\n                    'width: 173px;' +\n                    'display: inline-block;' +\n                    'float:  left;');\n            },\n            inputsAndSelects: function (hps) {\n                var ids = [\n                    'heartland-card-number',\n                    'heartland-expiration-month',\n                    'heartland-expiration-year',\n                    'heartland-cvv'\n                ];\n                var length = ids.length;\n                var i = 0;\n                for (i; i < length; i++) {\n                    hps.setStyle(ids[i], 'width: 309px;' +\n                        'padding: 5px;' +\n                        'font-size: 14px;' +\n                        'margin: 3px 0px 15px 0px;' +\n                        'border: 1px #ccc solid;' +\n                        /* IE10 Consumer Preview */\n                        'background-image: -ms-linear-gradient(bottom, #F7F7F7 0%, #EFEFEF 100%);' +\n                        /* Mozilla Firefox */\n                        'background-image: -moz-linear-gradient(bottom, #F7F7F7 0%, #EFEFEF 100%);' +\n                        /* Opera */\n                        'background-image: -o-linear-gradient(bottom, #F7F7F7 0%, #EFEFEF 100%);' +\n                        /* Webkit (Safari/Chrome 10) */\n                        'background-image: -webkit-gradient(linear, left bottom, left top, color-stop(0, #F7F7F7), color-stop(1, #EFEFEF));' +\n                        /* Webkit (Chrome 11+) */\n                        'background-image: -webkit-linear-gradient(bottom, #F7F7F7 0%, #EFEFEF 100%);' +\n                        /* W3C Markup, IE10 Release Preview */\n                        'background-image: linear-gradient(to top, #F7F7F7 0%, #EFEFEF 100%);');\n                }\n            },\n            labelsAndLegend: function (hps) {\n                var ids = [\n                    'heartland-card-number-label',\n                    'heartland-expiration-date-legend',\n                    'heartland-expiration-month-label',\n                    'heartland-expiration-year-label',\n                    'heartland-cvv-label'\n                ];\n                var length = ids.length;\n                var i = 0;\n                for (i; i < length; i++) {\n                    hps.setStyle(ids[i], 'font-size: 13px;' +\n                        'text-transform: uppercase;' +\n                        'font-weight: bold;' +\n                        'display: block;' +\n                        'width: 100%;' +\n                        'clear: both;');\n                }\n            },\n            selectLabels: function (hps) {\n                var ids = ['heartland-expiration-month-label', 'heartland-expiration-year-label'];\n                var length = ids.length;\n                var i = 0;\n                for (i; i < length; i++) {\n                    hps.setStyle(ids[i], 'position:absolute;' +\n                        'width:1px;' +\n                        'height:1px;' +\n                        'padding:0;' +\n                        'margin:-1px;' +\n                        'overflow:hidden;' +\n                        'clip:rect(0,0,0,0);' +\n                        'border:0;');\n                }\n            },\n            selects: function (hps) {\n                var ids = ['heartland-expiration-month', 'heartland-expiration-year'];\n                var length = ids.length;\n                var i = 0;\n                for (i; i < length; i++) {\n                    hps.appendStyle(ids[i], 'border: 0;' +\n                        'outline: 1px solid #ccc;' +\n                        'height: 28px;' +\n                        'width: 80px;' +\n                        '-webkit-appearance: none;' +\n                        '-moz-appearance: none;' +\n                        '-webkit-border-radius: 0px;' +\n                        /* tslint:disable:max-line-length */\n                        'background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAGCAYAAAD68A/GAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyhpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDE0IDc5LjE1Njc5NywgMjAxNC8wOC8yMC0wOTo1MzowMiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTQgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QzA5MTZFN0RFMDY2MTFFNEIyODZFMURFRTA3REUxMjciIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6QzA5MTZFN0VFMDY2MTFFNEIyODZFMURFRTA3REUxMjciPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpDMDkxNkU3QkUwNjYxMUU0QjI4NkUxREVFMDdERTEyNyIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpDMDkxNkU3Q0UwNjYxMUU0QjI4NkUxREVFMDdERTEyNyIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PvMrdUAAAABiSURBVHjaYkxLS3vNwMAgwoAfvGUCEjkMhEE285kzZ65u2bLlJ5DjgkNRxUwgYPz//z+Yl56ePhNIpaEpAqnJADGYkASzgHgnEn8HyEoYB24i1FReILUPynUEmvYFJgcQYACYah+uDhpKGAAAAABJRU5ErkJggg==);' +\n                        /* tslint:enable:max-line-length */\n                        'background-position: 65px 12px;' +\n                        'background-repeat: no-repeat;' +\n                        'background-color:  #F7F7F7;' +\n                        'float: left;' +\n                        'margin-right: 6px');\n                }\n            }\n        };\n    })(Styles || (Styles = {}));\n    \n    /**\n     * @namespace Heartland.Frames\n     */\n    var Frames = (function () {\n        function Frames() {\n        }\n        /**\n         * Heartland.Frames.configureIframe\n         *\n         * Prepares the pages iFrames for communication with the parent window.\n         *\n         * @param {Heartland.HPS} hps\n         * @listens click\n         * @listens message\n         */\n        Frames.configureIframe = function (hps) {\n            var frame;\n            var options = hps.options;\n            var target;\n            var useDefaultStyles = true;\n            hps.Messages = hps.Messages || new Messages(hps);\n            if (options.env === 'cert') {\n                hps.iframe_url = urls.iframeCERT;\n            }\n            else {\n                hps.iframe_url = urls.iframePROD;\n            }\n            if (options.fields !== defaults.fields) {\n                Frames.makeFieldsAndLink(hps);\n            }\n            if (options.fields === defaults.fields && options.iframeTarget) {\n                target = document.getElementById(options.iframeTarget);\n                if (options.targetType === 'myframe') {\n                    frame = target;\n                    hps.iframe_url = frame.src;\n                }\n                else {\n                    frame = DOM.makeFrame('heartland-frame-securesubmit');\n                    target.appendChild(frame);\n                }\n                hps.iframe_url = hps.iframe_url + '#' + encodeURIComponent(document.location.href.split('#')[0]);\n                frame.src = hps.iframe_url;\n                hps.frames.child = {\n                    frame: window.postMessage ? frame.contentWindow : frame,\n                    name: 'child',\n                    url: hps.iframe_url\n                };\n            }\n            if (options.useDefaultStyles === false) {\n                useDefaultStyles = false;\n            }\n            if (options.buttonTarget) {\n                hps.clickHandler = function (e) {\n                    e.preventDefault();\n                    hps.Messages.post({\n                        accumulateData: !!hps.frames.cardNumber,\n                        action: 'tokenize',\n                        data: { publicKey: options.publicKey }\n                    }, hps.frames.cardNumber ? 'cardNumber' : 'child');\n                    return false;\n                };\n                Events.addHandler(options.buttonTarget, 'click', hps.clickHandler);\n            }\n            hps.Messages.receive(function (data) {\n                var fieldFrame;\n                try {\n                    fieldFrame = hps.frames[data.source.name === 'heartland-frame-securesubmit' ? 'parent' : data.source.name];\n                }\n                catch (e) {\n                    return;\n                }\n                switch (data.action) {\n                    case 'requestTokenize':\n                        hps.Messages.post({\n                            accumulateData: !!hps.frames.cardNumber,\n                            action: 'tokenize',\n                            data: options\n                        }, hps.frames.cardNumber ? 'cardNumber' : 'child');\n                        break;\n                    case 'onTokenSuccess':\n                        options.onTokenSuccess(data.response);\n                        break;\n                    case 'onTokenError':\n                        options.onTokenError(data.response);\n                        break;\n                    case 'resize':\n                        if (fieldFrame) {\n                            hps.resizeIFrame(fieldFrame.frame, data.height);\n                        }\n                        else {\n                            hps.resizeIFrame(frame, data.height);\n                        }\n                        break;\n                    case 'receiveMessageHandlerAdded':\n                        if (!options.fields && useDefaultStyles) {\n                            Styles.Defaults.body(hps);\n                            Styles.Defaults.labelsAndLegend(hps);\n                            Styles.Defaults.inputsAndSelects(hps);\n                            Styles.Defaults.fieldset(hps);\n                            Styles.Defaults.selects(hps);\n                            Styles.Defaults.selectLabels(hps);\n                            Styles.Defaults.cvvContainer(hps);\n                            Styles.Defaults.cvv(hps);\n                        }\n                        if (fieldFrame && fieldFrame.options.placeholder) {\n                            hps.Messages.post({\n                                action: 'setPlaceholder',\n                                id: 'heartland-field',\n                                text: fieldFrame.options.placeholder\n                            }, fieldFrame.name);\n                        }\n                        if (fieldFrame && fieldFrame.options.value) {\n                            hps.Messages.post({\n                                action: 'setValue',\n                                id: 'heartland-field',\n                                text: fieldFrame.options.value\n                            }, fieldFrame.name);\n                        }\n                        if (options.style) {\n                            var css = options.styleString\n                                || (options.styleString = DOM.json2css(options.style));\n                            hps.Messages.post({\n                                action: 'addStylesheet',\n                                data: css\n                            }, fieldFrame.name);\n                        }\n                        Events.trigger('securesubmitIframeReady', document);\n                        break;\n                    case 'accumulateData':\n                        for (var i in hps.frames) {\n                            if ('submit' === i || 'cardNumber' === i) {\n                                continue;\n                            }\n                            var field = hps.frames[i];\n                            hps.Messages.post({\n                                action: 'getFieldData',\n                                id: 'heartland-field'\n                            }, field.name);\n                        }\n                        break;\n                    case 'passData':\n                        var cardNumberFieldFrame = hps.frames.cardNumber;\n                        if (!cardNumberFieldFrame) {\n                            break;\n                        }\n                        hps.Messages.post({\n                            action: 'setFieldData',\n                            id: fieldFrame.name,\n                            value: data.value\n                        }, cardNumberFieldFrame.name);\n                        break;\n                    case 'fieldEvent':\n                        if (!options.onEvent) {\n                            break;\n                        }\n                        options.onEvent(data.event);\n                        break;\n                    case 'error':\n                        if (!options.onError) {\n                            break;\n                        }\n                        options.onError(data);\n                        break;\n                }\n            }, '*');\n        };\n        /**\n         * Heartland.Frames.makeFieldsAndLink\n         *\n         * Creates a set of single field iFrames and stores a reference to\n         * them in the parent window's state.\n         *\n         * @param {Heartland.HPS} hps\n         */\n        Frames.makeFieldsAndLink = function (hps) {\n            var options = hps.options;\n            var fieldsLength = fields.length;\n            var baseUrl = hps.iframe_url.replace('index.html', '');\n            for (var i = 0; i < fieldsLength; i++) {\n                var field = fields[i];\n                var fieldOptions = options.fields[field];\n                if (!fieldOptions) {\n                    return;\n                }\n                var frame = DOM.makeFrame(field);\n                var url = baseUrl;\n                if (field === 'submit') {\n                    url = url + 'button.html';\n                }\n                else if (options.cca && options.env === 'cert') {\n                    url = url + 'fieldCca.cert.html';\n                }\n                else if (options.cca && options.env === 'prod') {\n                    url = url + 'fieldCca.prod.html';\n                }\n                else {\n                    url = url + 'field.html';\n                }\n                url = url + '#' + field + ':' + encodeURIComponent(document.location.href.split('#')[0]);\n                frame.src = url;\n                document\n                    .getElementById(fieldOptions.target)\n                    .appendChild(frame);\n                hps.frames[field] = {\n                    frame: frame,\n                    name: field,\n                    options: fieldOptions,\n                    target: fieldOptions.target,\n                    targetNode: window.postMessage ? frame.contentWindow : frame,\n                    url: url\n                };\n            }\n        };\n        /**\n         * Heartland.Frames.monitorFieldEvents\n         *\n         * @param {Heartland.HPS} hps\n         * @param {string | EventTarget} target\n         */\n        Frames.monitorFieldEvents = function (hps, target) {\n            var events = ['click', 'blur', 'focus', 'change', 'keypress', 'keydown', 'keyup'];\n            var i = 0, length = events.length;\n            for (i; i < length; i++) {\n                var event = events[i];\n                Events.addHandler(target, event, function (e) {\n                    var field = document.getElementById('heartland-field');\n                    var classes = [];\n                    var data = {};\n                    if (field.className !== '') {\n                        classes = field.className.split(' ');\n                    }\n                    if (e.keyCode) {\n                        data.keyCode = e.keyCode;\n                    }\n                    hps.Messages.post({\n                        action: 'fieldEvent',\n                        event: {\n                            classes: classes,\n                            data: data,\n                            source: window.name,\n                            type: e.type\n                        }\n                    }, 'parent');\n                });\n            }\n        };\n        return Frames;\n    }());\n    \n    /**\n     * @namespace Heartland.Util\n     */\n    var Util = (function () {\n        function Util() {\n        }\n        /**\n         * Heartland.Util.getCardType\n         *\n         * Parses a credit card number to obtain the card type/brand.\n         *\n         * @param {string} tokenizationType\n         * @param {Heartland.Options} options\n         */\n        Util.getCardType = function (tokenizationType, options) {\n            var cardType;\n            var data = '';\n            var type = 'unknown';\n            switch (tokenizationType) {\n                case 'swipe':\n                    data = options.track;\n                    cardType = Card.typeByTrack(data);\n                    break;\n                case 'encrypted':\n                    data = options.track;\n                    cardType = Card.typeByTrack(data, true, options.trackNumber);\n                    break;\n                default:\n                    data = options.cardNumber;\n                    cardType = Card.typeByNumber(data);\n                    break;\n            }\n            if (cardType) {\n                type = cardType.code;\n            }\n            return type;\n        };\n        /**\n         * Heartland.Util.applyOptions\n         *\n         * Creates a single object by merging a `source` (default) and `properties`\n         * obtained elsewhere, e.g. a function argument in `HPS`. Any properties in\n         * `properties` will overwrite matching properties in `source`.\n         *\n         * @param {Heartland.Options} source\n         * @param {Heartland.Options} properties\n         * @returns {Heartland.Options}\n         */\n        Util.applyOptions = function (source, properties) {\n            var destination = {};\n            if (!source) {\n                source = {};\n            }\n            for (var property in source) {\n                if (source.hasOwnProperty(property)) {\n                    destination[property] = source[property];\n                }\n            }\n            for (var property in properties) {\n                if (properties.hasOwnProperty(property)) {\n                    destination[property] = properties[property];\n                }\n            }\n            return destination;\n        };\n        /**\n         * Heartland.Util.throwError\n         *\n         * Allows a merchant-defined error handler to be used in cases where the\n         * tokenization process fails. If not provided, we throw the message as a\n         * JS runtime error.\n         *\n         * @param {Heartland.Options} options\n         * @param {string | Heartland.TokenizationResponse} errorMessage\n         */\n        Util.throwError = function (options, errorMessage) {\n            if (typeof (options.error) === 'function') {\n                options.error(errorMessage);\n                return;\n            }\n            if (errorMessage.error) {\n                throw new Error(errorMessage.error.message);\n            }\n            throw new Error(errorMessage);\n        };\n        /**\n         * Heartland.Util.getItemByPropertyValue\n         *\n         * Enumerates over a `collection` to retreive an item whose `property` is\n         * a given `value`.\n         *\n         * @param {any} collection\n         * @param {string} property\n         * @param {any} value\n         * @returns {any}\n         */\n        Util.getItemByPropertyValue = function (collection, property, value) {\n            var length = collection.length;\n            var i = 0;\n            for (i; i < length; i++) {\n                if (collection[i][property] === value) {\n                    return collection[i];\n                }\n            }\n        };\n        /**\n         * Heartland.Util.getParams\n         *\n         * Builds param list for a particular `type` from expected properties in\n         * `data`.\n         *\n         * @param {string} type - The tokenization type\n         * @param {Heartland.Options} data\n         * @returns {string}\n         */\n        Util.getParams = function (type, data) {\n            var params = [];\n            switch (type) {\n                case 'iframe':\n                case 'pan':\n                    params.push('token_type=supt', 'object=token', '_method=post', 'api_key=' + data.publicKey.replace(/^\\s+|\\s+$/g, ''), 'card%5Bnumber%5D=' + data.cardNumber.replace(/\\s/g, ''), 'card%5Bexp_month%5D=' + data.cardExpMonth.replace(/^\\s+|\\s+$/g, ''), 'card%5Bexp_year%5D=' + data.cardExpYear.replace(/^\\s+|\\s+$/g, ''), 'card%5Bcvc%5D=' + data.cardCvv.replace(/^\\s+|\\s+$/g, ''));\n                    break;\n                case 'swipe':\n                    params.push('token_type=supt', 'object=token', '_method=post', 'api_key=' + data.publicKey.replace(/^\\s+|\\s+$/g, ''), 'card%5Btrack_method%5D=swipe', 'card%5Btrack%5D=' + encodeURIComponent(data.track.replace(/^\\s+|\\s+$/g, '')));\n                    break;\n                case 'encrypted':\n                    params.push('token_type=supt', 'object=token', '_method=post', 'api_key=' + data.publicKey.replace(/^\\s+|\\s+$/g, ''), 'encryptedcard%5Btrack_method%5D=swipe', 'encryptedcard%5Btrack%5D=' + encodeURIComponent(data.track.replace(/^\\s+|\\s+$/g, '')), 'encryptedcard%5Btrack_number%5D=' + encodeURIComponent(data.trackNumber.replace(/^\\s+|\\s+$/g, '')), 'encryptedcard%5Bktb%5D=' + encodeURIComponent(data.ktb.replace(/^\\s+|\\s+$/g, '')), 'encryptedcard%5Bpin_block%5D=' + encodeURIComponent(data.pinBlock.replace(/^\\s+|\\s+$/g, '')));\n                    break;\n                default:\n                    Util.throwError(data, 'unknown params type');\n                    break;\n            }\n            return params.join('&');\n        };\n        /**\n         * Heartland.Util.getUrlByEnv\n         *\n         * Selects the appropriate tokenization service URL for the\n         * active `publicKey`.\n         *\n         * @param {Heartland.Options} options\n         * @returns {string}\n         */\n        Util.getUrlByEnv = function (options) {\n            options.env = options.publicKey.split('_')[1];\n            if (options.env === 'cert') {\n                options.gatewayUrl = urls.CERT;\n            }\n            else {\n                options.gatewayUrl = urls.PROD;\n            }\n            return options;\n        };\n        /**\n         * Heartland.Util.addFormHandler\n         *\n         * Creates and adds an event handler function for the submission for a given\n         * form (`options.form_id`).\n         *\n         * @param {Heartland.Options} options\n         * @listens submit\n         */\n        Util.addFormHandler = function (options) {\n            var payment_form = document.getElementById(options.formId);\n            var code = function (e) {\n                if (e.preventDefault) {\n                    e.preventDefault();\n                }\n                else if (window.event) {\n                    window.event.returnValue = false;\n                }\n                var fields = Util.getFields(options.formId);\n                var cardType = Util.getCardType(fields.number, 'pan');\n                options.cardNumber = fields.number;\n                options.cardExpMonth = fields.expMonth;\n                options.cardExpYear = fields.expYear;\n                options.cardCvv = fields.cvv;\n                options.cardType = cardType;\n                Ajax.call('pan', options);\n            };\n            Events.addHandler(payment_form, 'submit', code);\n            DOM.addField(options.formId, 'hidden', 'publicKey', options.publicKey);\n        };\n        /**\n         * Heartland.Util.getFields\n         *\n         * Extracts card information from the fields with names `card_number`,\n         * `card_expiration_month`, `card_expiration_year`, and `card_cvc` and\n         * expects them to be present as children of `formParent`.\n         *\n         * @param {string} formParent\n         * @returns {Heartland.CardData}\n         */\n        Util.getFields = function (formParent) {\n            var form = document.getElementById(formParent);\n            var fields = {};\n            var i;\n            var length = form.childElementCount;\n            for (i = 0; i < length; i++) {\n                var element = form.children[i];\n                if (element.id === 'card_number') {\n                    fields.number = element.value;\n                }\n                else if (element.id === 'card_expiration_month') {\n                    fields.expMonth = element.value;\n                }\n                else if (element.id === 'card_expiration_year') {\n                    fields.expYear = element.value;\n                }\n                else if (element.id === 'card_cvc') {\n                    fields.cvv = element.value;\n                }\n            }\n            return fields;\n        };\n        return Util;\n    }());\n    \n    var HeartlandTokenService = (function () {\n        function HeartlandTokenService(url, type) {\n            if (type === void 0) { type = \"pan\"; }\n            this.url = url;\n            this.type = type;\n        }\n        HeartlandTokenService.prototype.tokenize = function (data, callback) {\n            var _this = this;\n            this.requestData = data;\n            Ajax.jsonp(this.buildRequest(data), function (response) {\n                callback(_this.deserializeResponseData(response));\n            });\n        };\n        HeartlandTokenService.prototype.buildRequest = function (data) {\n            return new JsonpRequest(this.url, this.serializeRequestData(data));\n        };\n        HeartlandTokenService.prototype.serializeRequestData = function (data) {\n            return Util.getParams(this.type, data);\n        };\n        HeartlandTokenService.prototype.deserializeResponseData = function (data) {\n            if (data.error) {\n                return data;\n            }\n            var cardType = Util.getCardType(this.type, this.requestData);\n            var card = data.card || data.encryptedcard;\n            var lastfour = card.number.slice(-4);\n            data.last_four = lastfour;\n            data.card_type = cardType;\n            data.exp_month = this.requestData.cardExpMonth;\n            data.exp_year = this.requestData.cardExpYear;\n            return data;\n        };\n        return HeartlandTokenService;\n    }());\n    \n    var CardinalTokenService = (function () {\n        function CardinalTokenService(jwt) {\n            this.jwt = jwt;\n        }\n        CardinalTokenService.prototype.tokenize = function (data, callback) {\n            var _this = this;\n            var request = this.buildRequest(data);\n            var cardinal = window.Cardinal;\n            var cb = function (responseData, jwt) {\n                responseData.jwt = jwt;\n                callback(_this.deserializeResponseData(responseData));\n            };\n            // init only once per frame\n            if (!cardinal.__secureSubmitFrameInit) {\n                cardinal.setup('init', { jwt: this.jwt });\n                cardinal.on('payments.validated', cb);\n                cardinal.__secureSubmitFrameInit = true;\n            }\n            cardinal.trigger('jwt.update', this.jwt);\n            cardinal.start('cca', request.payload);\n        };\n        CardinalTokenService.prototype.buildRequest = function (data) {\n            return new NullRequest({\n                Consumer: {\n                    Account: {\n                        AccountNumber: data.cardNumber.replace(/\\D/g, ''),\n                        CardCode: data.cardCvv.replace(/^\\s+|\\s+$/g, ''),\n                        ExpirationMonth: data.cardExpMonth.replace(/^\\s+|\\s+$/g, ''),\n                        ExpirationYear: data.cardExpYear.replace(/^\\s+|\\s+$/g, '')\n                    }\n                },\n                Options: {\n                    EnableCCA: false\n                },\n                OrderDetails: {\n                    OrderNumber: data.cca.orderNumber\n                }\n            });\n        };\n        CardinalTokenService.prototype.serializeRequestData = function (data) {\n            return data;\n        };\n        CardinalTokenService.prototype.deserializeResponseData = function (data) {\n            if (typeof data.Token !== \"undefined\" &&\n                data.Token.Token !== \"undefined\" &&\n                data.Token.ReasonCode === \"0\") {\n                return this.deserializeSuccessResponse(data);\n            }\n            return this.deserializeFailureResponse(data);\n        };\n        CardinalTokenService.prototype.deserializeSuccessResponse = function (data) {\n            return {\n                jwt: data.jwt,\n                token_value: data.Token.Token\n            };\n        };\n        CardinalTokenService.prototype.deserializeFailureResponse = function (data) {\n            var message = data.ErrorDescription;\n            if (data.Token && data.Token.ReasonDescription !== \"\") {\n                message = data.Token.ReasonDescription;\n            }\n            return {\n                error: {\n                    message: message\n                }\n            };\n        };\n        return CardinalTokenService;\n    }());\n    \n    /**\n     * Heartland.HPS\n     *\n     * Initializes options and adds the default form handler if a `formId` is\n     * passed as an option. This expects the default fields (see `getFields`) to\n     * be present as children of `formId`.\n     */\n    var HPS = (function () {\n        /**\n         * Heartland.HPS (constructor)\n         *\n         * @constructor\n         * @param {Heartland.Options} options [optional]\n         * @returns {Heartland.HPS}\n         */\n        function HPS(options) {\n            if (!options && window.parent) {\n                return;\n            }\n            this.options = Util.applyOptions(defaults, options);\n            this.options = Util.getUrlByEnv(this.options);\n            if (this.options.formId.length > 0) {\n                Util.addFormHandler(this.options);\n            }\n            this.frames = {};\n            if (this.options.type === 'iframe') {\n                this.iframe_url = '';\n                this.Messages = new Messages(this);\n                this.mailbox = [];\n                this.cacheBust = 1;\n                Frames.configureIframe(this);\n                if (this.options.env === \"cert\") {\n                    if (this.options.iframeTarget !== \"\") {\n                        DOM.addCertAlert(this.options.iframeTarget);\n                    }\n                    else {\n                        DOM.addCertAlert(this.options.fields.cardNumber.target);\n                    }\n                }\n            }\n            return this;\n        }\n        /**\n         * Heartland.HPS.tokenize\n         *\n         * Tokenizes card data. Used in manual integrations where the merchant's\n         * credit card fields cannot/do not match the names expected in the default\n         * form handler (see `getFields`).\n         *\n         * @param {Heartland.Options} options [optional]\n         */\n        HPS.prototype.tokenize = function (options) {\n            var _this = this;\n            options = options || {};\n            if (options) {\n                this.options = Util.applyOptions(this.options, options);\n                this.options = Util.getUrlByEnv(this.options);\n            }\n            if (this.options.type === 'iframe' && !!this.frames.cardNumber) {\n                this.Messages.post({\n                    accumulateData: !!this.frames.cardNumber,\n                    action: 'tokenize',\n                    data: { publicKey: this.options.publicKey }\n                }, 'cardNumber');\n                return;\n            }\n            else if (this.options.type === 'iframe') {\n                this.Messages.post({\n                    action: 'tokenize',\n                    data: { publicKey: this.options.publicKey }\n                }, 'child');\n                return;\n            }\n            var tokens = {\n                cardinal: null,\n                heartland: null\n            };\n            var callback = function (response) {\n                if (response.error) {\n                    Util.throwError(_this.options, response);\n                }\n                else {\n                    if (_this.options.formId && _this.options.formId.length > 0) {\n                        var heartland = response.heartland || response;\n                        DOM.addField(_this.options.formId, 'hidden', 'token_value', heartland.token_value);\n                        DOM.addField(_this.options.formId, 'hidden', 'last_four', heartland.last_four);\n                        DOM.addField(_this.options.formId, 'hidden', 'card_exp_year', heartland.exp_year);\n                        DOM.addField(_this.options.formId, 'hidden', 'card_exp_month', heartland.exp_month);\n                        DOM.addField(_this.options.formId, 'hidden', 'card_type', heartland.card_type);\n                    }\n                    _this.options.success(response);\n                }\n            };\n            var callbackWrapper = function (type) {\n                return function (response) {\n                    tokens[type] = response;\n                    if (_this.options.cca && tokens.cardinal && tokens.heartland) {\n                        callback(tokens);\n                    }\n                    if (!_this.options.cca && tokens.heartland) {\n                        callback(tokens.heartland);\n                    }\n                };\n            };\n            (new HeartlandTokenService(this.options.gatewayUrl, this.options.type))\n                .tokenize(this.options, callbackWrapper('heartland'));\n            if (this.options.cca) {\n                (new CardinalTokenService(this.options.cca.jwt))\n                    .tokenize(this.options, callbackWrapper('cardinal'));\n            }\n        };\n        /**\n         * Heartland.HPS.configureInternalIframe\n         *\n         * Sets up a child iframe window to prepare it for communication with the\n         * parent and for tokenization.\n         *\n         * @param {Heartland.Options} options\n         */\n        HPS.prototype.configureInternalIframe = function (options) {\n            this.Messages = new Messages(this);\n            this.parent = window.parent;\n            this.frames = this.frames || {};\n            this.frames.parent = {\n                frame: window.parent,\n                name: 'parent',\n                url: decodeURIComponent(document.location.hash.replace(/^#/, ''))\n            };\n            this.loadHandler = (function (hps) {\n                return function () {\n                    DOM.resizeFrame(hps);\n                };\n            }(this));\n            this.receiveMessageHandlerAddedHandler = (function (hps) {\n                return function () {\n                    hps.Messages.post({ action: 'receiveMessageHandlerAdded' }, 'parent');\n                };\n            }(this));\n            Events.addHandler(window, 'load', this.loadHandler);\n            Events.addHandler(document, 'receiveMessageHandlerAdded', this.receiveMessageHandlerAddedHandler);\n            this.Messages.receive(Events.frameHandleWith(this), '*');\n        };\n        ;\n        /**\n         * Heartland.HPS.configureButtonFieldIframe\n         *\n         * Same as `Heartland.HPS.configureFieldIframe` excet the added click event\n         * handler for the button.\n         *\n         * @param {Heartland.Options} options\n         */\n        HPS.prototype.configureButtonFieldIframe = function (options) {\n            this.configureFieldIframe(options);\n            Events.addHandler('heartland-field', 'click', (function (hps) {\n                return function (e) {\n                    e.preventDefault ? e.preventDefault() : (e.returnValue = false);\n                    hps.Messages.post({ action: 'requestTokenize' }, 'parent');\n                };\n            }(this)));\n        };\n        /**\n         * Heartland.HPS.configureFieldIframe\n         *\n         * Sets up a child iframe window to prepare it for communication with the\n         * parent and for tokenization.\n         *\n         * @param {Heartland.Options} options\n         */\n        HPS.prototype.configureFieldIframe = function (options) {\n            var hash = document.location.hash.replace(/^#/, '');\n            var split = hash.split(':');\n            this.Messages = new Messages(this);\n            this.field = split.shift();\n            this.parent = window.parent;\n            this.frames = this.frames || {};\n            this.frames.parent = {\n                frame: window.parent,\n                name: 'parent',\n                url: decodeURIComponent(split.join(':').replace(/^:/, ''))\n            };\n            window.onerror = (function (hps) {\n                return function (errorMsg, url, lineNumber, column, errorObj) {\n                    hps.Messages.post({\n                        action: 'error',\n                        data: {\n                            column: column,\n                            errorMsg: errorMsg,\n                            lineNumber: lineNumber,\n                            url: url\n                        }\n                    }, 'parent');\n                    return true;\n                };\n            }(this));\n            this.loadHandler = (function (hps) {\n                return function () {\n                    DOM.resizeFrame(hps);\n                    DOM.configureField(hps);\n                    var method = 'attach' + window.name.replace('card', '') + 'Events';\n                    if (Card[method]) {\n                        Card[method]('#heartland-field');\n                    }\n                };\n            }(this));\n            this.receiveMessageHandlerAddedHandler = (function (hps) {\n                return function () {\n                    hps.Messages.post({ action: 'receiveMessageHandlerAdded' }, 'parent');\n                };\n            }(this));\n            Events.addHandler(window, 'load', this.loadHandler);\n            Events.addHandler(document, 'receiveMessageHandlerAdded', this.receiveMessageHandlerAddedHandler);\n            Frames.monitorFieldEvents(this, 'heartland-field');\n            this.Messages.receive(Events.frameHandleWith(this), '*');\n        };\n        ;\n        /**\n         * Heartland.HPS.resizeIFrame\n         *\n         * Called automatically when the child iframe window alerts the parent to\n         * resize.\n         *\n         * @param {HTMLIFrameElement} frame\n         * @param {string} height\n         */\n        HPS.prototype.resizeIFrame = function (frame, height) {\n            if (!frame) {\n                return;\n            }\n            frame.style.height = (parseInt(height, 10)) + 'px';\n        };\n        ;\n        /**\n         * Heartland.HPS.setText\n         *\n         * Public API for setting an element's inner text.\n         *\n         * @param {string} elementid\n         * @param {string} elementtext\n         */\n        HPS.prototype.setText = function (elementid, elementtext) {\n            this.Messages.post({ action: 'setText', id: elementid, text: elementtext }, 'child');\n        };\n        ;\n        /**\n         * Heartland.HPS.setStyle\n         *\n         * Public API for setting an element's style.\n         *\n         * @param {string} elementid\n         * @param {string} elementstyle\n         */\n        HPS.prototype.setStyle = function (elementid, elementstyle) {\n            this.Messages.post({ action: 'setStyle', id: elementid, style: elementstyle }, 'child');\n        };\n        ;\n        /**\n         * Heartland.HPS.appendStyle\n         *\n         * Public API for appending to an element's style.\n         *\n         * @param {string} elementid\n         * @param {string} elementstyle\n         */\n        HPS.prototype.appendStyle = function (elementid, elementstyle) {\n            this.Messages.post({ action: 'appendStyle', id: elementid, style: elementstyle }, 'child');\n        };\n        ;\n        /**\n         * Heartland.HPS.setFocus\n         *\n         * Public API for appending to an element's style.\n         *\n         * @param {string} elementid\n         */\n        HPS.prototype.setFocus = function (elementid) {\n            this.Messages.post({ action: 'setFocus' }, elementid);\n        };\n        ;\n        /**\n         * Heartland.HPS.dispose\n         *\n         * Removes all iframes and event listeners from the DOM.\n         */\n        HPS.prototype.dispose = function () {\n            this.Messages.dispose();\n            this.Messages = null;\n            if (this.frames.cardNumber && this.frames.cardNumber.targetNode) {\n                this.removeNode(this.frames.cardNumber.frame);\n            }\n            if (this.frames.cardExpiration && this.frames.cardExpiration.frame) {\n                this.removeNode(this.frames.cardExpiration.frame);\n            }\n            if (this.frames.cardCvv && this.frames.cardCvv.frame) {\n                this.removeNode(this.frames.cardCvv.frame);\n            }\n            if (this.frames.child && this.frames.child.frame) {\n                this.removeNode(this.frames.child.frame);\n            }\n            if (this.clickHandler) {\n                Events.removeHandler(this.options.buttonTarget, 'click', this.clickHandler);\n            }\n            if (this.loadHandler) {\n                Events.removeHandler(window, 'load', this.loadHandler);\n            }\n            if (this.receiveMessageHandlerAddedHandler) {\n                Events.removeHandler(document, 'receiveMessageHandlerAdded', this.receiveMessageHandlerAddedHandler);\n            }\n        };\n        ;\n        HPS.prototype.removeNode = function (node) {\n            if (node.remove) {\n                node.remove();\n            }\n            else if (node.parentNode && node.parentNode.removeChild) {\n                node.parentNode.removeChild(node);\n            }\n        };\n        return HPS;\n    }());\n    \n    var Validator = {\n        CardNumber: CardNumber$1,\n        Cvv: Cvv,\n        Expiration: Expiration$1\n    };\n    \n    window.HPS = HPS;\n    var index = {\n        Ajax: Ajax,\n        Card: Card,\n        DOM: DOM,\n        Events: Events,\n        Formatter: Formatter,\n        Frames: Frames,\n        HPS: HPS,\n        JSON: JSON2,\n        Messages: Messages,\n        Styles: Styles,\n        Util: Util,\n        Validator: Validator\n    };\n    \n    return index;\n    \n    }());\n    //# sourceMappingURL=securesubmit.js.map\n    export default Heartland;"]}]}