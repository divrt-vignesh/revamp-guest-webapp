{"remainingRequest":"/home/vignesh/DIVRT/guest-webapp/node_modules/babel-loader/lib/index.js!/home/vignesh/DIVRT/guest-webapp/node_modules/cache-loader/dist/cjs.js??ref--0-0!/home/vignesh/DIVRT/guest-webapp/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vignesh/DIVRT/guest-webapp/src/views/CheckedIn.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vignesh/DIVRT/guest-webapp/src/views/CheckedIn.vue","mtime":1687518715325},{"path":"/home/vignesh/DIVRT/guest-webapp/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vignesh/DIVRT/guest-webapp/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/vignesh/DIVRT/guest-webapp/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vignesh/DIVRT/guest-webapp/node_modules/vue-loader/lib/index.js","mtime":499162500000},{"path":"/home/vignesh/DIVRT/guest-webapp/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vignesh/DIVRT/guest-webapp/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/vignesh/DIVRT/guest-webapp/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vignesh/DIVRT/guest-webapp/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9zbGljZWRUb0FycmF5IGZyb20gIi9ob21lL3ZpZ25lc2gvRElWUlQvZ3Vlc3Qtd2ViYXBwL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9zbGljZWRUb0FycmF5IjsKaW1wb3J0IF9hc3luY1RvR2VuZXJhdG9yIGZyb20gIi9ob21lL3ZpZ25lc2gvRElWUlQvZ3Vlc3Qtd2ViYXBwL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9hc3luY1RvR2VuZXJhdG9yIjsKaW1wb3J0IF9vYmplY3RTcHJlYWQgZnJvbSAiL2hvbWUvdmlnbmVzaC9ESVZSVC9ndWVzdC13ZWJhcHAvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL29iamVjdFNwcmVhZDIiOwppbXBvcnQgInJlZ2VuZXJhdG9yLXJ1bnRpbWUvcnVudGltZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5rZXlzLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5jbHVkZXMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuaW5jbHVkZXMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5udW1iZXIuY29uc3RydWN0b3IuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuZXhlYy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5zcGxpdC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5yZXBsYWNlLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC50by1zdHJpbmcuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5jb25jYXQuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcucGFkLXN0YXJ0LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmluZC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmZ1bmN0aW9uLm5hbWUuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuc3RhcnRzLXdpdGguanMiOwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwppbXBvcnQgQ2FsZW5kYXIgZnJvbSAnLi4vdWlDb21wb25lbnRzL0NhbGVuZGFyL0NhbGVuZGFyJzsKaW1wb3J0IEVzdGltYXRlIGZyb20gJy4uL2NvbXBvbmVudHMvRXN0aW1hdGUudnVlJzsKaW1wb3J0IEFQSUhlbHBlciBmcm9tICIuLi9hcGlIZWxwZXIiOwppbXBvcnQgInByaW1ldnVlL3Jlc291cmNlcy90aGVtZXMvc2FnYS1ibHVlL3RoZW1lLmNzcyI7IC8vdGhlbWUKCmltcG9ydCAicHJpbWV2dWUvcmVzb3VyY2VzL3ByaW1ldnVlLm1pbi5jc3MiOyAvL2NvcmUgY3NzCgppbXBvcnQgInByaW1laWNvbnMvcHJpbWVpY29ucy5jc3MiOwppbXBvcnQgR29vZ2xlUGF5IGZyb20gIi4vR29vZ2xlUGF5LnZ1ZSI7IC8vIGltcG9ydCBsb2dnZXJIZWxwZXIgZnJvbSAiLi4vbG9nZ2VySGVscGVyIjsKCmltcG9ydCB7IG1hcEdldHRlcnMgfSBmcm9tICJ2dWV4IjsgLy8gaW1wb3J0IHsgUXJjb2RlU3RyZWFtIH0gZnJvbSAidnVlLXFyY29kZS1yZWFkZXIiOwoKaW1wb3J0IFFyQ29kZVNjYW5uZXIgZnJvbSAiQC92aWV3cy9RckNvZGVTY2FubmVyLnZ1ZSI7CmltcG9ydCBWYWxpZGF0aW9uUXJDb2RlU2Nhbm5lciBmcm9tICJAL3ZpZXdzL1ZhbGlkYXRpb25RckNvZGVTY2FubmVyLnZ1ZSI7CmltcG9ydCBBcHBsZVBheSBmcm9tICJAL3ZpZXdzL0FwcGxlUGF5LnZ1ZSI7CmltcG9ydCB7IGZvcm1hdERhdGVUaW1lIH0gZnJvbSAiQC91dGlscy9mb3JtYXREYXRlVGltZSI7CmltcG9ydCB7IEV2ZW50QnVzIH0gZnJvbSAiQC9saWIvRXZlbnRCdXMiOwppbXBvcnQgeyBzZWNvbmRzVG9IbXMgfSBmcm9tICJAL3V0aWxzL2Zvcm1hdERhdGVUaW1lIjsKaW1wb3J0IHsgYWRkTWludXRlcywgYWRkRGF5cywgYWRkSG91cnMsIHNldCB9IGZyb20gImRhdGUtZm5zIjsKaW1wb3J0IHsgZm9ybWF0LCBpc1ZhbGlkIH0gZnJvbSAiZGF0ZS1mbnMiOwppbXBvcnQgeyBkYXRlVG9UaW1lWm9uZURhdGUgfSBmcm9tICJAL3V0aWxzL2Zvcm1hdERhdGVUaW1lIjsgLy8gaW1wb3J0IFFyU2Nhbm5lciBmcm9tICdxci1zY2FubmVyJzsKCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAiQ2hlY2tJbiIsCiAgY29tcG9uZW50czogewogICAgUXJDb2RlU2Nhbm5lcjogUXJDb2RlU2Nhbm5lciwKICAgIFZhbGlkYXRpb25RckNvZGVTY2FubmVyOiBWYWxpZGF0aW9uUXJDb2RlU2Nhbm5lciwKICAgIEFwcGxlUGF5OiBBcHBsZVBheSwKICAgIEdvb2dsZVBheTogR29vZ2xlUGF5LAogICAgQ2FsZW5kYXI6IENhbGVuZGFyLAogICAgRXN0aW1hdGU6IEVzdGltYXRlCiAgfSwKICBkYXRhOiBmdW5jdGlvbiBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgLy8gcnVsZXM6IHsKICAgICAgLy8gICBjb3VudGVyOiB2YWx1ZSA9PiB2YWx1ZS5sZW5ndGggPD0gNiB8fCAiTWF4IDYgY2hhcmFjdGVycyIKICAgICAgLy8gfSwKICAgICAgdGltZTogIiIsCiAgICAgIG9wZW5UaW1lUGlja2VyOiBmYWxzZSwKICAgICAgb3BlbkRhdGVQaWNrZXI6IGZhbHNlLAogICAgICBtaW5UaW1lRGF0ZTogbnVsbCwKICAgICAgbWF4VGltZURhdGU6IG51bGwsCiAgICAgIGJlZm9yZUVzdGltYXRlOiBudWxsLAogICAgICBjdXJyZW50RGF0ZTogZm9ybWF0KG5ldyBEYXRlKCksICd5eXl5LU1NLWRkJyksCiAgICAgIGxveWFsdHkyNGtudW06ICIiLAogICAgICBhbGVydEljb246ICJtZGktY2hlY2stY2lyY2xlIiwKICAgICAgYWxlcnREaWFsb2c6IGZhbHNlLAogICAgICBhbGVydE1zZzogIiIsCiAgICAgIGxveWFsdHk6IGZhbHNlLAogICAgICBleHREYXRlQW5kVGltZTogbnVsbCwKICAgICAgZXh0ZW5kQnRuTG9hZGluZzogZmFsc2UsCiAgICAgIGxvYWRpbmc6IGZhbHNlLAogICAgICBleHRlbnNpb25EaWFsb2c6IGZhbHNlLAogICAgICBzdG9wVGltZTogIiIsCiAgICAgIGV4aXRUaW1lU2VsZWN0ZWQ6IHt9LAogICAgICB0aW1lUGlja2VySHJSYW5nZTogbnVsbCwKICAgICAgdGltZUV4Y2VlZGVkOiBmYWxzZSwKICAgICAgdGltZVBpY2tlck1pblJhbmdlOiBudWxsLAogICAgICBtaW5EYXRlOiBudWxsLAogICAgICBtYXhEYXRlOiBudWxsLAogICAgICBUaW1lbWVudTogZmFsc2UsCiAgICAgIHN0YXJ0RGF0ZTogIiIsCiAgICAgIG1heERhdGVUaW1lOiBudWxsLAogICAgICBlc3RpbWF0ZTogbnVsbCwKICAgICAgRGF0ZW1lbnU6IGZhbHNlLAogICAgICBleGl0RGF0ZTogbnVsbCwKICAgICAgZGF0ZUZvcm1hdHRlZDogbnVsbCwKICAgICAgZXhpdERhdGVUaW1lOiAwLAogICAgICBleGl0VGltZUludGVydmFsOiBudWxsLAogICAgICBpb3NEZXZpY2U6IGZhbHNlLAogICAgICBpbnZhbGlkVmFsaWRhdGlvblFSRGlhbG9nOiBmYWxzZSwKICAgICAgY2FtZXJhU3RhdHVzOiBmYWxzZSwKICAgICAgdmFsaWRhdGlvbkNhbWVyYVN0YXR1czogZmFsc2UsCiAgICAgIHZhbGlkYXRlZERhdGVUaW1lOiAwLAogICAgICBncmFjZVBlcmlvZFRpbWU6IDAsCiAgICAgIHZhbGlkYXRlZEludGVydmFsOiAiIiwKICAgICAgZHVyYXRpb246IDMwMCwKICAgICAgb2Zmc2V0OiAwLAogICAgICBwZWRlc3RyaWFuQWNjZXNzRGlhbG9nOiBmYWxzZSwKICAgICAgcGVkZXN0cmlhbkFjY2Vzc1RleHQ6ICIiLAogICAgICBlYXNpbmc6ICJlYXNlSW5PdXRDdWJpYyIsCiAgICAgIHBhZ2VIZWlnaHQ6IHdpbmRvdy5vdXRlckhlaWdodCwKICAgICAgcXJDb2RlRGlhbG9nOiBmYWxzZSwKICAgICAgY291bnRVcFRpbWU6ICIiLAogICAgICBpbnRlcnZhbDogIiIsCiAgICAgIGlzVmFsaWQ6IHVuZGVmaW5lZCwKICAgICAgY2FtZXJhOiAiYXV0byIsCiAgICAgIHNtc1RleHQ6ICIiLAogICAgICBzbXNEaWFsb2c6IGZhbHNlLAogICAgICBkaWFsZXJEaWFsb2c6IGZhbHNlLAogICAgICBpbnZhbGlkUVJNc2c6ICIiLAogICAgICBpbnZhbGlkVmFsaWRhdGlvblFSTXNnOiAiIiwKICAgICAgaW52YWxpZFFSRGlhbG9nOiBmYWxzZSwKICAgICAgaW52YWxpZFNNU01zZzogIiIsCiAgICAgIGludmFsaWRTTVNEaWFsb2c6IGZhbHNlLAogICAgICBzbXNQZW5kaW5nOiBmYWxzZSwKICAgICAgdmFsaWRhdGVCb29raW5nUGVuZGluZzogZmFsc2UsCiAgICAgIHZhbGlkYXRlQm9va2luZ0RpYWxvZzogZmFsc2UsCiAgICAgIHZhbGlkYXRlQm9va2luZ1R4dDogIiIsCiAgICAgIHZhbGlkYXRlUVJDb2RlUGVuZGluZzogZmFsc2UsCiAgICAgIHZhbGlkYXRlUVJDb2RlRGlhbG9nOiBmYWxzZQogICAgfTsKICB9LAogIGNvbXB1dGVkOiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIG1hcEdldHRlcnMoewogICAgYm9va2luZ0lkOiAiZ2V0dGVyQm9va2luZ0lkIiwKICAgIGJvb2tpbmdEZXRhaWxzOiAiZ2V0dGVyQm9va2luZ0RldGFpbHMiLAogICAgem9uZURldGFpbHM6ICJnZXR0ZXJab25lRGV0YWlscyIsCiAgICBlbnRyeVRpbWU6ICJnZXR0ZXJFbnRyeVRpbWUiLAogICAgZXhpdEdhdGVDb2RlczogImdldHRlckV4aXRHYXRlQ29kZXMiLAogICAgaXNQUVJFbmRSZXNlcnZhdGlvbjogImdldHRlclpvbmVJc1BRUkVuZFJlc2VydmF0aW9uIgogIH0pKSwge30sIHsKICAgIGxvZ29IZWlnaHQ6IGZ1bmN0aW9uIGxvZ29IZWlnaHQoKSB7CiAgICAgIHJldHVybiBPYmplY3QuaGFzT3duUHJvcGVydHkuY2FsbCh0aGlzLmJvb2tpbmdEZXRhaWxzLCAnYm9va2luZycpICYmIE9iamVjdC5oYXNPd25Qcm9wZXJ0eS5jYWxsKHRoaXMuYm9va2luZ0RldGFpbHMuYm9va2luZywgJ1R5cGVPZkJvb2tpbmcnKSAmJiB0aGlzLmJvb2tpbmdEZXRhaWxzLmJvb2tpbmcuVHlwZU9mQm9va2luZyA9PSAnU2VsZiByZXNlcnZhdGlvbicgPyAnMTAwcHgnIDogJzE1MHB4JzsKICAgIH0sCiAgICBjb21wdXRlZERhdGVGb3JtYXR0ZWQ6IGZ1bmN0aW9uIGNvbXB1dGVkRGF0ZUZvcm1hdHRlZCgpIHsKICAgICAgcmV0dXJuIHRoaXMudGltZSAhPT0gbnVsbCAmJiB0aGlzLnRpbWUgIT09ICIiICYmIHRoaXMudGltZSAhPT0gdW5kZWZpbmVkID8gZm9ybWF0KHRoaXMudGltZSwgJ3l5eXkvTU0vZGQnKSA6IG5ldyBEYXRlKCk7CiAgICB9LAogICAgZm9ybWF0dGVkVGltZTogZnVuY3Rpb24gZm9ybWF0dGVkVGltZSgpIHsKICAgICAgcmV0dXJuIHRoaXMudGltZSA/IGZvcm1hdCh0aGlzLnRpbWUsICdoaDptbSBhYScpIDogIiI7CiAgICB9LAogICAgZm9ybWF0dGVkRGF0ZVRpbWU6IGZ1bmN0aW9uIGZvcm1hdHRlZERhdGVUaW1lKCkgewogICAgICByZXR1cm4gdGhpcy50aW1lICE9PSBudWxsICYmIHRoaXMudGltZSAhPT0gIiIgPyBmb3JtYXQodGhpcy50aW1lLCAnaWlpLCBMTEwgZGQnKSA6ICIiOwogICAgfSwKICAgIGZvcm1hdHRlZFllYXI6IGZ1bmN0aW9uIGZvcm1hdHRlZFllYXIoKSB7CiAgICAgIHJldHVybiB0aGlzLnRpbWUgIT09IG51bGwgJiYgdGhpcy50aW1lICE9PSAiIiA/IGZvcm1hdCh0aGlzLnRpbWUsICd5eXl5JykgOiAiIjsKICAgIH0sCiAgICBmb3JtYXR0ZWRFbnRyeURpc3BsYXlUaW1lOiBmdW5jdGlvbiBmb3JtYXR0ZWRFbnRyeURpc3BsYXlUaW1lKCkgewogICAgICB2YXIgX3RoaXMkYm9va2luZ0RldGFpbHMsIF90aGlzJGJvb2tpbmdEZXRhaWxzJCwgX3RoaXMkYm9va2luZ0RldGFpbHMyLCBfdGhpcyRib29raW5nRGV0YWlsczM7CgogICAgICByZXR1cm4gT2JqZWN0Lmhhc093blByb3BlcnR5LmNhbGwodGhpcy5ib29raW5nRGV0YWlscywgJ2Jvb2tpbmcnKSAmJiBPYmplY3QuaGFzT3duUHJvcGVydHkuY2FsbCh0aGlzLmJvb2tpbmdEZXRhaWxzLmJvb2tpbmcsICdlbnRyeXRpbWUnKSAmJiB0aGlzLmJvb2tpbmdEZXRhaWxzLmJvb2tpbmcuZW50cnl0aW1lICE9PSBudWxsICYmIHRoaXMuYm9va2luZ0RldGFpbHMuYm9va2luZy5lbnRyeXRpbWUgIT09IHVuZGVmaW5lZCAmJiB0aGlzLmJvb2tpbmdEZXRhaWxzLmJvb2tpbmcuZW50cnl0aW1lICE9PSAiIiA/IGZvcm1hdChuZXcgRGF0ZSh0aGlzLmZvcm1hdEV4aXREYXRlVGltZSgoX3RoaXMkYm9va2luZ0RldGFpbHMgPSB0aGlzLmJvb2tpbmdEZXRhaWxzKSA9PT0gbnVsbCB8fCBfdGhpcyRib29raW5nRGV0YWlscyA9PT0gdm9pZCAwID8gdm9pZCAwIDogKF90aGlzJGJvb2tpbmdEZXRhaWxzJCA9IF90aGlzJGJvb2tpbmdEZXRhaWxzLmJvb2tpbmcpID09PSBudWxsIHx8IF90aGlzJGJvb2tpbmdEZXRhaWxzJCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3RoaXMkYm9va2luZ0RldGFpbHMkLmVudHJ5dGltZSwgJ2RhdGUnKSksICJoaDptbSBhIikgOiBmb3JtYXQoZGF0ZVRvVGltZVpvbmVEYXRlKG5ldyBEYXRlKCksIChfdGhpcyRib29raW5nRGV0YWlsczIgPSB0aGlzLmJvb2tpbmdEZXRhaWxzKSA9PT0gbnVsbCB8fCBfdGhpcyRib29raW5nRGV0YWlsczIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IChfdGhpcyRib29raW5nRGV0YWlsczMgPSBfdGhpcyRib29raW5nRGV0YWlsczIuem9uZSkgPT09IG51bGwgfHwgX3RoaXMkYm9va2luZ0RldGFpbHMzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfdGhpcyRib29raW5nRGV0YWlsczMudGltZXpvbmUpLCAnaGg6bW0gYScpOwogICAgfSwKICAgIHNpbmdsZVF1b3RlczogZnVuY3Rpb24gc2luZ2xlUXVvdGVzKCkgewogICAgICByZXR1cm4gT2JqZWN0Lmhhc093blByb3BlcnR5LmNhbGwodGhpcy5ib29raW5nRGV0YWlscywgJ3pvbmUnKSAmJiBPYmplY3QuaGFzT3duUHJvcGVydHkuY2FsbCh0aGlzLmJvb2tpbmdEZXRhaWxzLnpvbmUsICd0aW1lUGlja2VyQ29uZmlndXJhdGlvbicpICYmIHRoaXMuYm9va2luZ0RldGFpbHMuem9uZS50aW1lUGlja2VyQ29uZmlndXJhdGlvbiA9PSAiMCIgPyB0aGlzLnRpbWUgIT09IG51bGwgJiYgdGhpcy50aW1lICE9PSB1bmRlZmluZWQgJiYgdGhpcy50aW1lICE9PSAiIiAmJiB0aGlzLm1pbkRhdGUgIT09IG51bGwgJiYgdGhpcy5taW5EYXRlICE9PSB1bmRlZmluZWQgJiYgdGhpcy5taW5EYXRlICE9PSAiIiAmJiBmb3JtYXQodGhpcy50aW1lLCAneXl5eS1NTS1kZCcpID09IGZvcm1hdCh0aGlzLm1pbkRhdGUsICd5eXl5LU1NLWRkJykgfHwgdGhpcy5iZWZvcmVFc3RpbWF0ZSAhPT0gbnVsbCAmJiB0aGlzLmJlZm9yZUVzdGltYXRlICE9PSB1bmRlZmluZWQgJiYgdGhpcy5iZWZvcmVFc3RpbWF0ZSAhPT0gIiIgJiYgdGhpcy5lc3RpbWF0ZSAhPT0gbnVsbCAmJiB0aGlzLmVzdGltYXRlICE9PSB1bmRlZmluZWQgJiYgdGhpcy5lc3RpbWF0ZSAhPT0gIiIgJiYgdGhpcy5iZWZvcmVFc3RpbWF0ZS5ncmFuZFRvdGFsID09IHRoaXMuZXN0aW1hdGUuZ3JhbmRUb3RhbCA6IHRydWU7CiAgICB9LAogICAgZG91YmxlUXVvdGVzOiBmdW5jdGlvbiBkb3VibGVRdW90ZXMoKSB7CiAgICAgIHJldHVybiBPYmplY3QuaGFzT3duUHJvcGVydHkuY2FsbCh0aGlzLmJvb2tpbmdEZXRhaWxzLCAnem9uZScpICYmIE9iamVjdC5oYXNPd25Qcm9wZXJ0eS5jYWxsKHRoaXMuYm9va2luZ0RldGFpbHMuem9uZSwgJ3RpbWVQaWNrZXJDb25maWd1cmF0aW9uJykgJiYgdGhpcy5ib29raW5nRGV0YWlscy56b25lLnRpbWVQaWNrZXJDb25maWd1cmF0aW9uID09ICIwIiA/IHRoaXMudGltZSAhPT0gbnVsbCAmJiB0aGlzLnRpbWUgIT09IHVuZGVmaW5lZCAmJiB0aGlzLnRpbWUgIT09ICIiICYmIHRoaXMubWluRGF0ZSAhPT0gbnVsbCAmJiB0aGlzLm1pbkRhdGUgIT09IHVuZGVmaW5lZCAmJiB0aGlzLm1pbkRhdGUgIT09ICIiICYmIGZvcm1hdCh0aGlzLnRpbWUsICd5eXl5LU1NLWRkJykgIT0gZm9ybWF0KHRoaXMubWluRGF0ZSwgJ3l5eXktTU0tZGQnKSAmJiB0aGlzLmJlZm9yZUVzdGltYXRlICE9PSBudWxsICYmIHRoaXMuYmVmb3JlRXN0aW1hdGUgIT09IHVuZGVmaW5lZCAmJiB0aGlzLmJlZm9yZUVzdGltYXRlICE9PSAiIiAmJiB0aGlzLmVzdGltYXRlICE9PSBudWxsICYmIHRoaXMuZXN0aW1hdGUgIT09IHVuZGVmaW5lZCAmJiB0aGlzLmVzdGltYXRlICE9PSAiIiAmJiB0aGlzLmJlZm9yZUVzdGltYXRlLmdyYW5kVG90YWwgIT0gdGhpcy5lc3RpbWF0ZS5ncmFuZFRvdGFsIDogZmFsc2U7CiAgICB9LAogICAgZGlzYWJsZUxveWFsdHk6IGZ1bmN0aW9uIGRpc2FibGVMb3lhbHR5KCkgewogICAgICB2YXIgZGlzYWJsZWQgPSB0aGlzLmxveWFsdHkyNGtudW0gPT09IHVuZGVmaW5lZCB8fCB0aGlzLmxveWFsdHkyNGtudW0gPT09IG51bGwgfHwgdGhpcy5sb3lhbHR5MjRrbnVtID09ICIiOwogICAgICByZXR1cm4gZGlzYWJsZWQ7CiAgICB9LAogICAgZGlzYWJsZUV4dGVuZDogZnVuY3Rpb24gZGlzYWJsZUV4dGVuZCgpIHsKICAgICAgdmFyIF90aGlzJGJvb2tpbmdEZXRhaWxzNCwgX3RoaXMkYm9va2luZ0RldGFpbHM1OwoKICAgICAgdmFyIGRpc2FibGVkID0gdGhpcy50aW1lID09PSBudWxsIHx8IHRoaXMudGltZSA9PT0gIiIgfHwgdGhpcy50aW1lID09PSB1bmRlZmluZWQgfHwgdGhpcy5lc3RpbWF0ZSA9PT0gbnVsbCB8fCB0aGlzLmVzdGltYXRlID09PSB1bmRlZmluZWQgfHwgT2JqZWN0LmtleXModGhpcy5lc3RpbWF0ZSkubGVuZ3RoID09PSAwIHx8ICgoKF90aGlzJGJvb2tpbmdEZXRhaWxzNCA9IHRoaXMuYm9va2luZ0RldGFpbHMpID09PSBudWxsIHx8IF90aGlzJGJvb2tpbmdEZXRhaWxzNCA9PT0gdm9pZCAwID8gdm9pZCAwIDogKF90aGlzJGJvb2tpbmdEZXRhaWxzNSA9IF90aGlzJGJvb2tpbmdEZXRhaWxzNC56b25lKSA9PT0gbnVsbCB8fCBfdGhpcyRib29raW5nRGV0YWlsczUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF90aGlzJGJvb2tpbmdEZXRhaWxzNS50aW1lUGlja2VyQ29uZmlndXJhdGlvbikgPT0gJzAnICYmIGZvcm1hdCh0aGlzLnRpbWUsICd5eXl5LU1NLWRkJykgPT0gZm9ybWF0KHRoaXMubWF4RGF0ZSwgJ3l5eXktTU0tZGQnKSA/IHRydWUgOiBmYWxzZSk7CiAgICAgIHJldHVybiBkaXNhYmxlZDsKICAgIH0sCiAgICBjb3VudERvd25FeGl0VGltZTogZnVuY3Rpb24gY291bnREb3duRXhpdFRpbWUoKSB7CiAgICAgIGlmICh0aGlzLmV4aXREYXRlVGltZSA8IDApIHsKICAgICAgICB0aGlzLiRzdG9yZS5jb21taXQoIlNFVF9WQUxJREFURURfVElNRV9TVEFUVVMiLCB0cnVlKTsKICAgICAgICBjbGVhckludGVydmFsKHRoaXMuZXhpdFRpbWVJbnRlcnZhbCk7CiAgICAgIH0KCiAgICAgIHJldHVybiBzZWNvbmRzVG9IbXModGhpcy5leGl0RGF0ZVRpbWUgLyAxMDAwICsgNTkpOwogICAgfSwKICAgIGNvdW50RG93bkVzdGltYXRlVGltZTogZnVuY3Rpb24gY291bnREb3duRXN0aW1hdGVUaW1lKCkgewogICAgICBpZiAodGhpcy5leGl0RGF0ZVRpbWUgPCAwKSB7CiAgICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCJTRVRfVkFMSURBVEVEX1RJTUVfU1RBVFVTIiwgdHJ1ZSk7CiAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLmV4aXRUaW1lSW50ZXJ2YWwpOwogICAgICB9CgogICAgICByZXR1cm4gc2Vjb25kc1RvSG1zKHRoaXMuZXhpdERhdGVUaW1lIC8gMTAwMCArIDU5KTsKICAgIH0sCiAgICBpc0V4dHJhOiBmdW5jdGlvbiBpc0V4dHJhKCkgewogICAgICByZXR1cm4gd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lLmluY2x1ZGVzKCIvZ3gvIik7CiAgICB9LAogICAgb3B0aW9uczogZnVuY3Rpb24gb3B0aW9ucygpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBkdXJhdGlvbjogdGhpcy5kdXJhdGlvbiwKICAgICAgICBvZmZzZXQ6IHRoaXMub2Zmc2V0LAogICAgICAgIGVhc2luZzogdGhpcy5lYXNpbmcKICAgICAgfTsKICAgIH0sCiAgICBzaG93UGF5bWVudENhcmRBZGRlZDogZnVuY3Rpb24gZ2V0Q2FyZFN0YXR1cygpIHsKICAgICAgdmFyIF90aGlzJGJvb2tpbmdEZXRhaWxzNiwgX3RoaXMkYm9va2luZ0RldGFpbHM3LCBfdGhpcyRib29raW5nRGV0YWlsczgsIF90aGlzJGJvb2tpbmdEZXRhaWxzOTsKCiAgICAgIHZhciBjYXJkT25GaWxlID0gKF90aGlzJGJvb2tpbmdEZXRhaWxzNiA9IHRoaXMuYm9va2luZ0RldGFpbHMpICE9PSBudWxsICYmIF90aGlzJGJvb2tpbmdEZXRhaWxzNiAhPT0gdm9pZCAwICYmIChfdGhpcyRib29raW5nRGV0YWlsczcgPSBfdGhpcyRib29raW5nRGV0YWlsczYuYm9va2luZykgIT09IG51bGwgJiYgX3RoaXMkYm9va2luZ0RldGFpbHM3ICE9PSB2b2lkIDAgJiYgX3RoaXMkYm9va2luZ0RldGFpbHM3LmNhcmRPbmZpbGUgPyB0aGlzLmJvb2tpbmdEZXRhaWxzLmJvb2tpbmcuY2FyZE9uZmlsZSA6IG51bGw7CiAgICAgIHZhciB2YWxpZGF0ZWRTdGF0ZSA9IChfdGhpcyRib29raW5nRGV0YWlsczggPSB0aGlzLmJvb2tpbmdEZXRhaWxzKSAhPT0gbnVsbCAmJiBfdGhpcyRib29raW5nRGV0YWlsczggIT09IHZvaWQgMCAmJiAoX3RoaXMkYm9va2luZ0RldGFpbHM5ID0gX3RoaXMkYm9va2luZ0RldGFpbHM4LmJvb2tpbmcpICE9PSBudWxsICYmIF90aGlzJGJvb2tpbmdEZXRhaWxzOSAhPT0gdm9pZCAwICYmIF90aGlzJGJvb2tpbmdEZXRhaWxzOS52YWxpZGF0ZWQgPyB0aGlzLmJvb2tpbmdEZXRhaWxzLmJvb2tpbmcudmFsaWRhdGVkIDogbnVsbDsKICAgICAgdmFyIHN0YXRlID0gY2FyZE9uRmlsZSA9PSAiMSIgPyB0cnVlIDogY2FyZE9uRmlsZSA9PSAiMiIgJiYgdmFsaWRhdGVkU3RhdGUgPT0gIjEiICYmIHRoaXMudmFsaWRhdGVkRGF0ZVRpbWUgPiAwOwogICAgICByZXR1cm4gc3RhdGU7CiAgICB9LAogICAgdGltZUFnbzogZnVuY3Rpb24gZ2V0VGltZUFnbygpIHsKICAgICAgcmV0dXJuIHRoaXMuY291bnRVcFRpbWU7CiAgICB9LAogICAgdmFsaWRhdGlvblBlbmRpbmc6IGZ1bmN0aW9uIHFyVmFsaWRhdGlvbigpIHsKICAgICAgcmV0dXJuIHRoaXMuaXNWYWxpZCA9PT0gdW5kZWZpbmVkICYmIHRoaXMuY2FtZXJhID09PSAib2ZmIjsKICAgIH0sCiAgICBib29raW5nX2NvbnRlbnQ6IGZ1bmN0aW9uIGJvb2tpbmdfY29udGVudCgpIHsKICAgICAgdmFyIGRhdGVUaW1lID0gZm9ybWF0RGF0ZVRpbWUoTnVtYmVyKHRoaXMuYm9va2luZ0RldGFpbHMuYm9va2luZy5lbnRyeXRpbWUpKTsKICAgICAgcmV0dXJuIGRhdGVUaW1lWzBdICsgIiBvbiAiICsgZGF0ZVRpbWVbMV0gKyAiICIgKyBkYXRlVGltZVsyXTsKICAgIH0sCiAgICBjaGVja2luX2NvbnRlbnQ6IGZ1bmN0aW9uIGNoZWNraW5fY29udGVudCgpIHsKICAgICAgcmV0dXJuIHRoaXMuZm9ybWF0RXhpdERhdGVUaW1lKHRoaXMuYm9va2luZ0RldGFpbHMuYm9va2luZy5lbnRyeXRpbWUsICdjaGVja2luJyk7CiAgICB9LAogICAgY2hlY2tvdXRfY29udGVudDogZnVuY3Rpb24gY2hlY2tvdXRfY29udGVudCgpIHsKICAgICAgcmV0dXJuICdDaGVja291dCBiZWZvcmUgJyArIHRoaXMuZm9ybWF0RXhpdERhdGVUaW1lKHRoaXMuYm9va2luZ0RldGFpbHMuYm9va2luZy5yZXZFbmQsICdleHBpcmUnKTsKICAgIH0sCiAgICB2YWxpZGF0ZWRfY29udGVudDogZnVuY3Rpb24gdmFsaWRhdGVkX2NvbnRlbnQoKSB7CiAgICAgIHZhciBfdGhpcyRib29raW5nRGV0YWlsczEwLCBfdGhpcyRib29raW5nRGV0YWlsczExOwoKICAgICAgaWYgKChfdGhpcyRib29raW5nRGV0YWlsczEwID0gdGhpcy5ib29raW5nRGV0YWlscykgIT09IG51bGwgJiYgX3RoaXMkYm9va2luZ0RldGFpbHMxMCAhPT0gdm9pZCAwICYmIChfdGhpcyRib29raW5nRGV0YWlsczExID0gX3RoaXMkYm9va2luZ0RldGFpbHMxMC56b25lKSAhPT0gbnVsbCAmJiBfdGhpcyRib29raW5nRGV0YWlsczExICE9PSB2b2lkIDAgJiYgX3RoaXMkYm9va2luZ0RldGFpbHMxMS50aW1lem9uZW9mZnNldCkgewogICAgICAgIHZhciBkYXRlVGltZSA9IHRoaXMuYm9va2luZ0RldGFpbHMuYm9va2luZy50eXBlID09ICIxMyIgPyBmb3JtYXREYXRlVGltZShOdW1iZXIodGhpcy5ib29raW5nRGV0YWlscy5ib29raW5nLnJldlN0YXJ0KSArIE51bWJlcih0aGlzLmJvb2tpbmdEZXRhaWxzLmJvb2tpbmcuY291cG9uVmFsaWRUaW1lKSkgOiBmb3JtYXREYXRlVGltZShOdW1iZXIodGhpcy5ib29raW5nRGV0YWlscy5ib29raW5nLmVudHJ5dGltZSkgKyBOdW1iZXIodGhpcy5ib29raW5nRGV0YWlscy5ib29raW5nLmNvdXBvblZhbGlkVGltZSkpOwogICAgICAgIHJldHVybiBkYXRlVGltZVswXSArICIsICIgKyBkYXRlVGltZVsxXSArICIgIiArIGRhdGVUaW1lWzJdOwogICAgICB9CgogICAgICByZXR1cm4gIiI7CiAgICB9LAogICAgY291bnREb3duVmFsaWRhdGVkVGltZTogZnVuY3Rpb24gY291bnREb3duVmFsaWRhdGVkVGltZSgpIHsKICAgICAgaWYgKHRoaXMudmFsaWRhdGVkRGF0ZVRpbWUgPCAwKSB7CiAgICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCJTRVRfVkFMSURBVEVEX1RJTUVfU1RBVFVTIiwgdHJ1ZSk7CiAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLnZhbGlkYXRlZEludGVydmFsKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXMuc2Vjb25kc1RvSG1zKHRoaXMudmFsaWRhdGVkRGF0ZVRpbWUgLyAxMDAwICsgNTkpOwogICAgfSwKICAgIGNvdW50RG93bkdyYWNlUGVyaW9kVGltZTogZnVuY3Rpb24gY291bnREb3duR3JhY2VQZXJpb2RUaW1lKCkgewogICAgICBpZiAodGhpcy5ncmFjZVBlcmlvZFRpbWUgPCAwKSB7CiAgICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCJTRVRfR1JBQ0VfUEVSSU9EX1RJTUVfU1RBVFVTIiwgdHJ1ZSk7CiAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLmdyYWNlUGVyaW9kSW50ZXJ2YWwpOwogICAgICB9IC8vYWRkIDU5IHNlYyB0byBncmFjZXBlcmlvZCB0aW1lIHRvIHNraXAgMCBtaW4uCgoKICAgICAgcmV0dXJuIHRoaXMuc2Vjb25kc1RvSG1zKHRoaXMuZ3JhY2VQZXJpb2RUaW1lIC8gMTAwMCArIDU5KTsKICAgIH0gLy8gZ3JhY2VQZXJpb2RDb3VudERvd25UaW1lLAogICAgLy8gY291bnREb3duVmFsaWRhdGlvbnRpbWUoKXsKICAgIC8vICAgcmV0dXJuCiAgICAvLyB9CgogIH0pLAogIHdhdGNoOiB7CiAgICB0aW1lOiBmdW5jdGlvbiB0aW1lKG5ld1ZhbCwgb2xkVmFsKSB7CiAgICAgIGlmIChvbGRWYWwgIT0gbnVsbCAmJiBuZXdWYWwgIT0gbnVsbCAmJiBvbGRWYWwgIT0gbmV3VmFsICYmIG9sZFZhbCAhPSAiIiAmJiBuZXdWYWwgIT0gIiIgJiYgaXNWYWxpZChuZXdWYWwpKSB7CiAgICAgICAgdmFyIF90aGlzJGJvb2tpbmdEZXRhaWxzMTIsIF90aGlzJGJvb2tpbmdEZXRhaWxzMTM7CgogICAgICAgICgoX3RoaXMkYm9va2luZ0RldGFpbHMxMiA9IHRoaXMuYm9va2luZ0RldGFpbHMpID09PSBudWxsIHx8IF90aGlzJGJvb2tpbmdEZXRhaWxzMTIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IChfdGhpcyRib29raW5nRGV0YWlsczEzID0gX3RoaXMkYm9va2luZ0RldGFpbHMxMi56b25lKSA9PT0gbnVsbCB8fCBfdGhpcyRib29raW5nRGV0YWlsczEzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfdGhpcyRib29raW5nRGV0YWlsczEzLnRpbWVQaWNrZXJDb25maWd1cmF0aW9uKSA9PSAnMScgPyB0aGlzLnJvdW5kKG5ld1ZhbCkgOiBzZXQobmV3VmFsLCB7CiAgICAgICAgICBob3VyOiAyMywKICAgICAgICAgIG1pbnV0ZXM6IDU5LAogICAgICAgICAgc2Vjb25kczogNTkKICAgICAgICB9KTsKICAgICAgfQogICAgfQogIH0sCiAgY3JlYXRlZDogZnVuY3Rpb24gY3JlYXRlZCgpIHt9LAogIG1vdW50ZWQ6IGZ1bmN0aW9uIG1vdW50ZWQoKSB7CiAgICB2YXIgX3RoaXMgPSB0aGlzLAogICAgICAgIF90aGlzJGJvb2tpbmdEZXRhaWxzMTYsCiAgICAgICAgX3RoaXMkYm9va2luZ0RldGFpbHMxNywKICAgICAgICBfdGhpcyRib29raW5nRGV0YWlsczE4LAogICAgICAgIF90aGlzJGJvb2tpbmdEZXRhaWxzMTksCiAgICAgICAgX3RoaXMkYm9va2luZ0RldGFpbHMyMCwKICAgICAgICBfdGhpcyRib29raW5nRGV0YWlsczIxLAogICAgICAgIF90aGlzJGJvb2tpbmdEZXRhaWxzMjgsCiAgICAgICAgX3RoaXMkYm9va2luZ0RldGFpbHMyOSwKICAgICAgICBfdGhpcyRib29raW5nRGV0YWlsczMwLAogICAgICAgIF90aGlzJGJvb2tpbmdEZXRhaWxzMzEsCiAgICAgICAgX3RoaXMkYm9va2luZ0RldGFpbHMzMiwKICAgICAgICBfdGhpcyRib29raW5nRGV0YWlsczMzLAogICAgICAgIF90aGlzJGJvb2tpbmdEZXRhaWxzNDAsCiAgICAgICAgX3RoaXMkYm9va2luZ0RldGFpbHM0MSwKICAgICAgICBfdGhpcyRib29raW5nRGV0YWlsczQyLAogICAgICAgIF90aGlzJGJvb2tpbmdEZXRhaWxzNDMsCiAgICAgICAgX3RoaXMkYm9va2luZ0RldGFpbHM0NCwKICAgICAgICBfdGhpcyRib29raW5nRGV0YWlsczQ1LAogICAgICAgIF90aGlzJGJvb2tpbmdEZXRhaWxzNDgsCiAgICAgICAgX3RoaXMkYm9va2luZ0RldGFpbHM0OTsKCiAgICBFdmVudEJ1cy4kb24oJ1NFVF9USU1FJywgZnVuY3Rpb24gKCkgewogICAgICBfdGhpcy5vblRpbWVQaWNrZXJDaGFuZ2UoKTsKICAgIH0pOwogICAgdGhpcy5leGl0RGF0ZVRpbWUgPSB0aGlzLmNhbGN1bGF0ZUV4aXREYXRlVGltZSgpOwogICAgdGhpcy5leGl0VGltZUludGVydmFsID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkgewogICAgICB2YXIgX3RoaXMkYm9va2luZ0RldGFpbHMxNCwgX3RoaXMkYm9va2luZ0RldGFpbHMxNTsKCiAgICAgIGlmICgoX3RoaXMkYm9va2luZ0RldGFpbHMxNCA9IF90aGlzLmJvb2tpbmdEZXRhaWxzKSAhPT0gbnVsbCAmJiBfdGhpcyRib29raW5nRGV0YWlsczE0ICE9PSB2b2lkIDAgJiYgKF90aGlzJGJvb2tpbmdEZXRhaWxzMTUgPSBfdGhpcyRib29raW5nRGV0YWlsczE0LnpvbmUpICE9PSBudWxsICYmIF90aGlzJGJvb2tpbmdEZXRhaWxzMTUgIT09IHZvaWQgMCAmJiBfdGhpcyRib29raW5nRGV0YWlsczE1LnRpbWV6b25lKSB7CiAgICAgICAgX3RoaXMuZXhpdERhdGVUaW1lID0gX3RoaXMuY2FsY3VsYXRlRXhpdERhdGVUaW1lKCk7CiAgICAgIH0KICAgIH0sIDEwMDApOwoKICAgIGlmICh0aGlzLmVudHJ5VGltZSAhPSBudWxsICYmICEoKF90aGlzJGJvb2tpbmdEZXRhaWxzMTYgPSB0aGlzLmJvb2tpbmdEZXRhaWxzKSAhPT0gbnVsbCAmJiBfdGhpcyRib29raW5nRGV0YWlsczE2ICE9PSB2b2lkIDAgJiYgKF90aGlzJGJvb2tpbmdEZXRhaWxzMTcgPSBfdGhpcyRib29raW5nRGV0YWlsczE2LmJvb2tpbmcpICE9PSBudWxsICYmIF90aGlzJGJvb2tpbmdEZXRhaWxzMTcgIT09IHZvaWQgMCAmJiBfdGhpcyRib29raW5nRGV0YWlsczE3LmV4aXR0aW1lKSAmJiAoX3RoaXMkYm9va2luZ0RldGFpbHMxOCA9IHRoaXMuYm9va2luZ0RldGFpbHMpICE9PSBudWxsICYmIF90aGlzJGJvb2tpbmdEZXRhaWxzMTggIT09IHZvaWQgMCAmJiAoX3RoaXMkYm9va2luZ0RldGFpbHMxOSA9IF90aGlzJGJvb2tpbmdEZXRhaWxzMTguem9uZSkgIT09IG51bGwgJiYgX3RoaXMkYm9va2luZ0RldGFpbHMxOSAhPT0gdm9pZCAwICYmIF90aGlzJGJvb2tpbmdEZXRhaWxzMTkudGltZXpvbmUgJiYgKF90aGlzJGJvb2tpbmdEZXRhaWxzMjAgPSB0aGlzLmJvb2tpbmdEZXRhaWxzKSAhPT0gbnVsbCAmJiBfdGhpcyRib29raW5nRGV0YWlsczIwICE9PSB2b2lkIDAgJiYgKF90aGlzJGJvb2tpbmdEZXRhaWxzMjEgPSBfdGhpcyRib29raW5nRGV0YWlsczIwLmJvb2tpbmcpICE9PSBudWxsICYmIF90aGlzJGJvb2tpbmdEZXRhaWxzMjEgIT09IHZvaWQgMCAmJiBfdGhpcyRib29raW5nRGV0YWlsczIxLmdyYWNlUGVyaW9kKSB7CiAgICAgIHRoaXMuY291bnRVcFRpbWUgPSB0aGlzLmNhbGN1bGF0ZVBhcmtpbmdUaW1lKHRoaXMuZW50cnlUaW1lLCB0aGlzLmJvb2tpbmdEZXRhaWxzLmJvb2tpbmcuZ3JhY2VQZXJpb2QsIHRoaXMuYm9va2luZ0RldGFpbHMuem9uZS50aW1lem9uZSk7CiAgICB9CgogICAgdGhpcy5pbnRlcnZhbCA9IHNldEludGVydmFsKGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF90aGlzJGJvb2tpbmdEZXRhaWxzMjIsIF90aGlzJGJvb2tpbmdEZXRhaWxzMjMsIF90aGlzJGJvb2tpbmdEZXRhaWxzMjQsIF90aGlzJGJvb2tpbmdEZXRhaWxzMjUsIF90aGlzJGJvb2tpbmdEZXRhaWxzMjYsIF90aGlzJGJvb2tpbmdEZXRhaWxzMjc7CgogICAgICBpZiAoX3RoaXMuZW50cnlUaW1lICE9IG51bGwgJiYgISgoX3RoaXMkYm9va2luZ0RldGFpbHMyMiA9IF90aGlzLmJvb2tpbmdEZXRhaWxzKSAhPT0gbnVsbCAmJiBfdGhpcyRib29raW5nRGV0YWlsczIyICE9PSB2b2lkIDAgJiYgKF90aGlzJGJvb2tpbmdEZXRhaWxzMjMgPSBfdGhpcyRib29raW5nRGV0YWlsczIyLmJvb2tpbmcpICE9PSBudWxsICYmIF90aGlzJGJvb2tpbmdEZXRhaWxzMjMgIT09IHZvaWQgMCAmJiBfdGhpcyRib29raW5nRGV0YWlsczIzLmV4aXR0aW1lKSAmJiAoX3RoaXMkYm9va2luZ0RldGFpbHMyNCA9IF90aGlzLmJvb2tpbmdEZXRhaWxzKSAhPT0gbnVsbCAmJiBfdGhpcyRib29raW5nRGV0YWlsczI0ICE9PSB2b2lkIDAgJiYgKF90aGlzJGJvb2tpbmdEZXRhaWxzMjUgPSBfdGhpcyRib29raW5nRGV0YWlsczI0LnpvbmUpICE9PSBudWxsICYmIF90aGlzJGJvb2tpbmdEZXRhaWxzMjUgIT09IHZvaWQgMCAmJiBfdGhpcyRib29raW5nRGV0YWlsczI1LnRpbWV6b25lICYmIChfdGhpcyRib29raW5nRGV0YWlsczI2ID0gX3RoaXMuYm9va2luZ0RldGFpbHMpICE9PSBudWxsICYmIF90aGlzJGJvb2tpbmdEZXRhaWxzMjYgIT09IHZvaWQgMCAmJiAoX3RoaXMkYm9va2luZ0RldGFpbHMyNyA9IF90aGlzJGJvb2tpbmdEZXRhaWxzMjYuYm9va2luZykgIT09IG51bGwgJiYgX3RoaXMkYm9va2luZ0RldGFpbHMyNyAhPT0gdm9pZCAwICYmIF90aGlzJGJvb2tpbmdEZXRhaWxzMjcuZ3JhY2VQZXJpb2QpIHsKICAgICAgICBfdGhpcy5jb3VudFVwVGltZSA9IF90aGlzLmNhbGN1bGF0ZVBhcmtpbmdUaW1lKF90aGlzLmVudHJ5VGltZSwgX3RoaXMuYm9va2luZ0RldGFpbHMuYm9va2luZy5ncmFjZVBlcmlvZCwgX3RoaXMuYm9va2luZ0RldGFpbHMuem9uZS50aW1lem9uZSk7CiAgICAgIH0KICAgIH0sIDEwMDApOwoKICAgIGlmICgoX3RoaXMkYm9va2luZ0RldGFpbHMyOCA9IHRoaXMuYm9va2luZ0RldGFpbHMpICE9PSBudWxsICYmIF90aGlzJGJvb2tpbmdEZXRhaWxzMjggIT09IHZvaWQgMCAmJiAoX3RoaXMkYm9va2luZ0RldGFpbHMyOSA9IF90aGlzJGJvb2tpbmdEZXRhaWxzMjguYm9va2luZykgIT09IG51bGwgJiYgX3RoaXMkYm9va2luZ0RldGFpbHMyOSAhPT0gdm9pZCAwICYmIF90aGlzJGJvb2tpbmdEZXRhaWxzMjkuZXhpdHRpbWUgJiYgdGhpcy5ib29raW5nRGV0YWlscy5ib29raW5nLmV4aXR0aW1lICE9IG51bGwgJiYgdGhpcy5ib29raW5nRGV0YWlscy5ib29raW5nLmV4aXR0aW1lICE9ICIiKSB7CiAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5pbnRlcnZhbCk7CiAgICB9CgogICAgaWYgKChfdGhpcyRib29raW5nRGV0YWlsczMwID0gdGhpcy5ib29raW5nRGV0YWlscykgIT09IG51bGwgJiYgX3RoaXMkYm9va2luZ0RldGFpbHMzMCAhPT0gdm9pZCAwICYmIChfdGhpcyRib29raW5nRGV0YWlsczMxID0gX3RoaXMkYm9va2luZ0RldGFpbHMzMC5ib29raW5nKSAhPT0gbnVsbCAmJiBfdGhpcyRib29raW5nRGV0YWlsczMxICE9PSB2b2lkIDAgJiYgX3RoaXMkYm9va2luZ0RldGFpbHMzMS52YWxpZGF0ZWQgJiYgdGhpcy5ib29raW5nRGV0YWlscy5ib29raW5nLnZhbGlkYXRlZCA9PSAiMSIgJiYgKF90aGlzJGJvb2tpbmdEZXRhaWxzMzIgPSB0aGlzLmJvb2tpbmdEZXRhaWxzKSAhPT0gbnVsbCAmJiBfdGhpcyRib29raW5nRGV0YWlsczMyICE9PSB2b2lkIDAgJiYgKF90aGlzJGJvb2tpbmdEZXRhaWxzMzMgPSBfdGhpcyRib29raW5nRGV0YWlsczMyLmJvb2tpbmcpICE9PSBudWxsICYmIF90aGlzJGJvb2tpbmdEZXRhaWxzMzMgIT09IHZvaWQgMCAmJiBfdGhpcyRib29raW5nRGV0YWlsczMzLnZhbGlkYXRpb25UeXBlICYmIHRoaXMuYm9va2luZ0RldGFpbHMuYm9va2luZy52YWxpZGF0aW9uVHlwZSA9PSAiRElWUlQiKSB7CiAgICAgIHRoaXMudmFsaWRhdGVkRGF0ZVRpbWUgPSB0aGlzLmNhbGN1bGF0ZVZhbGlkYXRlZFRpbWUoKTsKICAgIH0KCiAgICB0aGlzLnZhbGlkYXRlZEludGVydmFsID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkgewogICAgICB2YXIgX3RoaXMkYm9va2luZ0RldGFpbHMzNCwgX3RoaXMkYm9va2luZ0RldGFpbHMzNSwgX3RoaXMkYm9va2luZ0RldGFpbHMzNiwgX3RoaXMkYm9va2luZ0RldGFpbHMzNywgX3RoaXMkYm9va2luZ0RldGFpbHMzOCwgX3RoaXMkYm9va2luZ0RldGFpbHMzOTsKCiAgICAgIGlmICgoX3RoaXMkYm9va2luZ0RldGFpbHMzNCA9IF90aGlzLmJvb2tpbmdEZXRhaWxzKSAhPT0gbnVsbCAmJiBfdGhpcyRib29raW5nRGV0YWlsczM0ICE9PSB2b2lkIDAgJiYgKF90aGlzJGJvb2tpbmdEZXRhaWxzMzUgPSBfdGhpcyRib29raW5nRGV0YWlsczM0LnpvbmUpICE9PSBudWxsICYmIF90aGlzJGJvb2tpbmdEZXRhaWxzMzUgIT09IHZvaWQgMCAmJiBfdGhpcyRib29raW5nRGV0YWlsczM1LnRpbWV6b25lICYmIChfdGhpcyRib29raW5nRGV0YWlsczM2ID0gX3RoaXMuYm9va2luZ0RldGFpbHMpICE9PSBudWxsICYmIF90aGlzJGJvb2tpbmdEZXRhaWxzMzYgIT09IHZvaWQgMCAmJiAoX3RoaXMkYm9va2luZ0RldGFpbHMzNyA9IF90aGlzJGJvb2tpbmdEZXRhaWxzMzYuYm9va2luZykgIT09IG51bGwgJiYgX3RoaXMkYm9va2luZ0RldGFpbHMzNyAhPT0gdm9pZCAwICYmIF90aGlzJGJvb2tpbmdEZXRhaWxzMzcudmFsaWRhdGVkICYmIF90aGlzLmJvb2tpbmdEZXRhaWxzLmJvb2tpbmcudmFsaWRhdGVkID09ICIxIiAmJiAoX3RoaXMkYm9va2luZ0RldGFpbHMzOCA9IF90aGlzLmJvb2tpbmdEZXRhaWxzKSAhPT0gbnVsbCAmJiBfdGhpcyRib29raW5nRGV0YWlsczM4ICE9PSB2b2lkIDAgJiYgKF90aGlzJGJvb2tpbmdEZXRhaWxzMzkgPSBfdGhpcyRib29raW5nRGV0YWlsczM4LmJvb2tpbmcpICE9PSBudWxsICYmIF90aGlzJGJvb2tpbmdEZXRhaWxzMzkgIT09IHZvaWQgMCAmJiBfdGhpcyRib29raW5nRGV0YWlsczM5LnZhbGlkYXRpb25UeXBlICYmIF90aGlzLmJvb2tpbmdEZXRhaWxzLmJvb2tpbmcudmFsaWRhdGlvblR5cGUgPT0gIkRJVlJUIikgewogICAgICAgIF90aGlzLnZhbGlkYXRlZERhdGVUaW1lID0gX3RoaXMuY2FsY3VsYXRlVmFsaWRhdGVkVGltZSgpOwogICAgICB9CiAgICB9LCAxMDAwKTsKCiAgICBpZiAoKF90aGlzJGJvb2tpbmdEZXRhaWxzNDAgPSB0aGlzLmJvb2tpbmdEZXRhaWxzKSAhPT0gbnVsbCAmJiBfdGhpcyRib29raW5nRGV0YWlsczQwICE9PSB2b2lkIDAgJiYgKF90aGlzJGJvb2tpbmdEZXRhaWxzNDEgPSBfdGhpcyRib29raW5nRGV0YWlsczQwLmJvb2tpbmcpICE9PSBudWxsICYmIF90aGlzJGJvb2tpbmdEZXRhaWxzNDEgIT09IHZvaWQgMCAmJiBfdGhpcyRib29raW5nRGV0YWlsczQxLnZhbGlkYXRlZCAmJiB0aGlzLmJvb2tpbmdEZXRhaWxzLmJvb2tpbmcudmFsaWRhdGVkID09ICIxIiAmJiAoX3RoaXMkYm9va2luZ0RldGFpbHM0MiA9IHRoaXMuYm9va2luZ0RldGFpbHMpICE9PSBudWxsICYmIF90aGlzJGJvb2tpbmdEZXRhaWxzNDIgIT09IHZvaWQgMCAmJiAoX3RoaXMkYm9va2luZ0RldGFpbHM0MyA9IF90aGlzJGJvb2tpbmdEZXRhaWxzNDIuYm9va2luZykgIT09IG51bGwgJiYgX3RoaXMkYm9va2luZ0RldGFpbHM0MyAhPT0gdm9pZCAwICYmIF90aGlzJGJvb2tpbmdEZXRhaWxzNDMudmFsaWRhdGlvblR5cGUgJiYgdGhpcy5ib29raW5nRGV0YWlscy5ib29raW5nLnZhbGlkYXRpb25UeXBlID09ICJESVZSVCIpIHsKICAgICAgaWYgKHRoaXMudmFsaWRhdGVkRGF0ZVRpbWUgPCAwKSB7CiAgICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCJTRVRfVkFMSURBVEVEX1RJTUVfU1RBVFVTIiwgdHJ1ZSk7CiAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLnZhbGlkYXRlZEludGVydmFsKTsKICAgICAgfQogICAgfQoKICAgIGlmICgoKF90aGlzJGJvb2tpbmdEZXRhaWxzNDQgPSB0aGlzLmJvb2tpbmdEZXRhaWxzKSA9PT0gbnVsbCB8fCBfdGhpcyRib29raW5nRGV0YWlsczQ0ID09PSB2b2lkIDAgPyB2b2lkIDAgOiAoX3RoaXMkYm9va2luZ0RldGFpbHM0NSA9IF90aGlzJGJvb2tpbmdEZXRhaWxzNDQuYm9va2luZykgPT09IG51bGwgfHwgX3RoaXMkYm9va2luZ0RldGFpbHM0NSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3RoaXMkYm9va2luZ0RldGFpbHM0NS5ncmFjZVBlcmlvZCkgPiAwKSB7CiAgICAgIHRoaXMuZ3JhY2VQZXJpb2RUaW1lID0gdGhpcy5jYWxjdWxhdGVHcmFjZVBlcmlvZFRpbWUoKTsKICAgIH0KCiAgICB0aGlzLmdyYWNlUGVyaW9kSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfdGhpcyRib29raW5nRGV0YWlsczQ2LCBfdGhpcyRib29raW5nRGV0YWlsczQ3OwoKICAgICAgaWYgKChfdGhpcyRib29raW5nRGV0YWlsczQ2ID0gX3RoaXMuYm9va2luZ0RldGFpbHMpICE9PSBudWxsICYmIF90aGlzJGJvb2tpbmdEZXRhaWxzNDYgIT09IHZvaWQgMCAmJiAoX3RoaXMkYm9va2luZ0RldGFpbHM0NyA9IF90aGlzJGJvb2tpbmdEZXRhaWxzNDYuem9uZSkgIT09IG51bGwgJiYgX3RoaXMkYm9va2luZ0RldGFpbHM0NyAhPT0gdm9pZCAwICYmIF90aGlzJGJvb2tpbmdEZXRhaWxzNDcudGltZXpvbmUpIHsKICAgICAgICBfdGhpcy5ncmFjZVBlcmlvZFRpbWUgPSBfdGhpcy5jYWxjdWxhdGVHcmFjZVBlcmlvZFRpbWUoKTsKICAgICAgfQogICAgfSwgMTAwMCk7CgogICAgaWYgKCgoX3RoaXMkYm9va2luZ0RldGFpbHM0OCA9IHRoaXMuYm9va2luZ0RldGFpbHMpID09PSBudWxsIHx8IF90aGlzJGJvb2tpbmdEZXRhaWxzNDggPT09IHZvaWQgMCA/IHZvaWQgMCA6IChfdGhpcyRib29raW5nRGV0YWlsczQ5ID0gX3RoaXMkYm9va2luZ0RldGFpbHM0OC5ib29raW5nKSA9PT0gbnVsbCB8fCBfdGhpcyRib29raW5nRGV0YWlsczQ5ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfdGhpcyRib29raW5nRGV0YWlsczQ5LmdyYWNlUGVyaW9kKSA+IDApIHsKICAgICAgaWYgKHRoaXMuZ3JhY2VQZXJpb2RUaW1lIDwgMCkgewogICAgICAgIHRoaXMuJHN0b3JlLmNvbW1pdCgiU0VUX0dSQUNFX1BFUklPRF9USU1FX1NUQVRVUyIsIHRydWUpOwogICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5ncmFjZVBlcmlvZEludGVydmFsKTsKICAgICAgfQogICAgfQoKICAgIEV2ZW50QnVzLiRvbigic21zLXFyLXJlc3VsdCIsIGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgX3RoaXMub25EZWNvZGUocmVzdWx0KTsKICAgIH0pOwogICAgRXZlbnRCdXMuJG9uKCJ2YWxpZGF0aW9uLXFyLXJlc3VsdCIsIGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgX3RoaXMub25WYWxpZGF0ZVFSQ29kZShyZXN1bHQpOwogICAgfSk7IC8vIGlmKHRoaXMuYm9va2luZ0RldGFpbHM/LnpvbmU/LmlzUGVkZXN0cmlhbj09JzEnKXsKICAgIC8vICAgdGhpcy5wZWRlc3RyaWFuQWNjZXNzPXRydWUKICAgIC8vIH0KICB9LAogIGRlc3Ryb3llZDogZnVuY3Rpb24gZGVzdHJveWVkKCkgewogICAgY2xlYXJJbnRlcnZhbCh0aGlzLmludGVydmFsKTsKICAgIGNsZWFySW50ZXJ2YWwodGhpcy52YWxpZGF0ZWRJbnRlcnZhbCk7CiAgICBjbGVhckludGVydmFsKHRoaXMuZ3JhY2VQZXJpb2RJbnRlcnZhbCk7CiAgfSwKICBiZWZvcmVSb3V0ZUVudGVyOiBmdW5jdGlvbiBiZWZvcmVSb3V0ZUVudGVyKHRvLCBmcm9tLCBuZXh0KSB7CiAgICBuZXh0KCAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogICAgICB2YXIgX3JlZiA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZSh2bSkgewogICAgICAgIHZhciBfdm0kYm9va2luZ0RldGFpbHMsIF92bSRib29raW5nRGV0YWlscyRibywgX3ZtJGJvb2tpbmdEZXRhaWxzMiwgX3ZtJGJvb2tpbmdEZXRhaWxzMiRiOwoKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICB2bS5nZXRNb2JpbGVPcGVyYXRpbmdTeXN0ZW0oKSA9PT0gJ2lPUycgPyB2bS5pb3NEZXZpY2UgPSB0cnVlIDogdm0uaW9zRGV2aWNlID0gZmFsc2U7CgogICAgICAgICAgICAgICAgaWYgKChfdm0kYm9va2luZ0RldGFpbHMgPSB2bS5ib29raW5nRGV0YWlscykgIT09IG51bGwgJiYgX3ZtJGJvb2tpbmdEZXRhaWxzICE9PSB2b2lkIDAgJiYgKF92bSRib29raW5nRGV0YWlscyRibyA9IF92bSRib29raW5nRGV0YWlscy5ib29raW5nKSAhPT0gbnVsbCAmJiBfdm0kYm9va2luZ0RldGFpbHMkYm8gIT09IHZvaWQgMCAmJiBfdm0kYm9va2luZ0RldGFpbHMkYm8uZXhpdHRpbWUgJiYgdm0uYm9va2luZ0RldGFpbHMuYm9va2luZy5leGl0dGltZSAhPSBudWxsICYmIHZtLmJvb2tpbmdEZXRhaWxzLmJvb2tpbmcuZXhpdHRpbWUgIT0gIiIpIHsKICAgICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbCh2bS5pbnRlcnZhbCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKCgoX3ZtJGJvb2tpbmdEZXRhaWxzMiA9IHZtLmJvb2tpbmdEZXRhaWxzKSA9PT0gbnVsbCB8fCBfdm0kYm9va2luZ0RldGFpbHMyID09PSB2b2lkIDAgPyB2b2lkIDAgOiAoX3ZtJGJvb2tpbmdEZXRhaWxzMiRiID0gX3ZtJGJvb2tpbmdEZXRhaWxzMi5ib29raW5nKSA9PT0gbnVsbCB8fCBfdm0kYm9va2luZ0RldGFpbHMyJGIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF92bSRib29raW5nRGV0YWlsczIkYi52YWxpZGF0ZWQpID09ICIwIikgewogICAgICAgICAgICAgICAgICBpZiAodm0udmFsaWRhdGVkRGF0ZVRpbWUgPCAwKSB7CiAgICAgICAgICAgICAgICAgICAgdm0uJHN0b3JlLmNvbW1pdCgiU0VUX1ZBTElEQVRFRF9USU1FX1NUQVRVUyIsIHRydWUpOwogICAgICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwodm0udmFsaWRhdGVkSW50ZXJ2YWwpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUpOwogICAgICB9KSk7CgogICAgICByZXR1cm4gZnVuY3Rpb24gKF94KSB7CiAgICAgICAgcmV0dXJuIF9yZWYuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfTsKICAgIH0oKSk7CiAgfSwKICBtZXRob2RzOiB7CiAgICBmb3JtYXRFeGl0RGF0ZVRpbWU6IGZ1bmN0aW9uIGZvcm1hdEV4aXREYXRlVGltZSh0aW1lLCB2YWwpIHsKICAgICAgaWYgKHRpbWUgIT09IG51bGwgJiYgdGltZSAhPT0gdW5kZWZpbmVkICYmIHRpbWUgIT0gJycpIHsKICAgICAgICB2YXIgdXRjRGF0ZSA9IG5ldyBEYXRlKHRpbWUgKiAxMDAwKS50b1VUQ1N0cmluZygpOyAvLyJXZWQsIDI3IEphbiAyMDIxIDEzOjU5OjA0IEdNVCIKCiAgICAgICAgdmFyIG1vbnRoID0gdXRjRGF0ZS5zcGxpdCgiLCIpWzFdLnNwbGl0KCIgIilbMl07IC8vIEphbgoKICAgICAgICB2YXIgZGF0ZSA9IHV0Y0RhdGUuc3BsaXQoIiwiKVsxXS5zcGxpdCgiICIpWzFdOyAvLyAyNwoKICAgICAgICB2YXIgeWVhciA9IHV0Y0RhdGUuc3BsaXQoIiwiKVsxXS5zcGxpdCgiICIpWzNdOwogICAgICAgIHZhciBociA9IHV0Y0RhdGUuc3BsaXQoIiwiKVsxXS5zcGxpdCgiICIpWzRdLnNwbGl0KCI6IilbMF07IC8vIDEzCgogICAgICAgIHZhciBtaW4gPSB1dGNEYXRlLnNwbGl0KCIsIilbMV0uc3BsaXQoIiAiKVs0XS5zcGxpdCgiOiIpWzFdOyAvLzU5CgogICAgICAgIHZhciBmb3JtYXRIciA9IE51bWJlcihocikgPiAxMiA/IE51bWJlcihocikgLSAxMiA6IE51bWJlcihocik7IC8vIDEKCiAgICAgICAgZm9ybWF0SHIgPSBOdW1iZXIoaHIpID09IDAgPyAxMiA6IGZvcm1hdEhyOwogICAgICAgIGZvcm1hdEhyID0gTnVtYmVyKGZvcm1hdEhyKSA+PSAxMCA/IE51bWJlcihmb3JtYXRIcikgOiAnMCcgKyBmb3JtYXRIcjsgLy8wMQoKICAgICAgICB2YXIgYW1PcnBtID0gTnVtYmVyKGhyKSA+PSAxMiA/ICJwIiA6ICJhIjsgLy9QTQoKICAgICAgICB2YXIgYW1wbSA9IE51bWJlcihocikgPj0gMTIgPyAiUE0iIDogIkFNIjsKCiAgICAgICAgc3dpdGNoICh2YWwpIHsKICAgICAgICAgIGNhc2UgJ2hvdXInOgogICAgICAgICAgICB7CiAgICAgICAgICAgICAgcmV0dXJuIGZvcm1hdEhyICsgYW1PcnBtOwogICAgICAgICAgICB9CgogICAgICAgICAgY2FzZSAnbWlucyc6CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICByZXR1cm4gbWluOwogICAgICAgICAgICB9CgogICAgICAgICAgY2FzZSAnZGF0ZSc6CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICByZXR1cm4gbW9udGggKyAiICIgKyBkYXRlICsgIiwgIiArIHllYXIgKyAiICIgKyBmb3JtYXRIciArICI6IiArIG1pbiArICIgIiArIGFtcG07CiAgICAgICAgICAgIH0KCiAgICAgICAgICBjYXNlICdleHBpcmUnOgogICAgICAgICAgICB7CiAgICAgICAgICAgICAgcmV0dXJuIGZvcm1hdEhyICsgIjoiICsgbWluICsgIiAiICsgYW1wbSArICcgb24gJyArIG1vbnRoICsgIiAiICsgZGF0ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgIGNhc2UgJ2NoZWNraW4nOgogICAgICAgICAgICB7CiAgICAgICAgICAgICAgcmV0dXJuIGZvcm1hdEhyICsgIjoiICsgbWluICsgIiAiICsgYW1wbSArICcgb24gJyArIG1vbnRoICsgIiAiICsgZGF0ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSAvL0phbiAyNywgMDE6NTkgUE0KCiAgICB9LAogICAgcm91bmQ6IGZ1bmN0aW9uIHJvdW5kKHRpbWUpIHsKICAgICAgdmFyIGV4aXRkYXRlID0gdGltZSAhPT0gbnVsbCAmJiB0aW1lICE9PSAnJyA/IGZvcm1hdCh0aW1lLCAneXl5eS9NTS9kZCcpIDogbmV3IERhdGUoKTsKICAgICAgdmFyIHNlbGVjdGVkTWlucyA9IHRpbWUgIT09IG51bGwgJiYgdGltZSAhPT0gJycgPyBmb3JtYXQodGltZSwgJ21tJykgOiBuZXcgRGF0ZSgpOwogICAgICB2YXIgc2VsZWN0ZWRIb3VycyA9IHRpbWUgIT09IG51bGwgJiYgdGltZSAhPT0gJycgPyBmb3JtYXQodGltZSwgJ2hoJykgOiBuZXcgRGF0ZSgpOwogICAgICB2YXIgc2VsZWN0ZWRBTVBNID0gdGltZSAhPT0gbnVsbCAmJiB0aW1lICE9PSAnJyA/IGZvcm1hdCh0aW1lLCAnYScpIDogbmV3IERhdGUoKTsKCiAgICAgIGlmIChleGl0ZGF0ZSAhPSBudWxsICYmIHNlbGVjdGVkTWlucyAhPSAnMTUnICYmIHNlbGVjdGVkTWlucyAhPSAnMzAnICYmIHNlbGVjdGVkTWlucyAhPSAnNDUnICYmIHNlbGVjdGVkTWlucyAhPSAnMDAnICYmIHNlbGVjdGVkTWlucyAhPSBudWxsICYmIHNlbGVjdGVkTWlucyAhPSAiIiAmJiBzZWxlY3RlZEhvdXJzICE9IG51bGwgJiYgc2VsZWN0ZWRIb3VycyAhPSAiIiAmJiBzZWxlY3RlZEFNUE0gIT0gbnVsbCAmJiBzZWxlY3RlZEFNUE0gIT0gIiIpIHsKICAgICAgICB2YXIgaW50ZXJ2YWxNaWxsaXNlY29uZHMgPSA5MDAwMDA7CiAgICAgICAgdmFyIGRhdGV0aW1lID0gbmV3IERhdGUoZXhpdGRhdGUgKyAiICIgKyBzZWxlY3RlZEhvdXJzICsgIjoiICsgc2VsZWN0ZWRNaW5zICsgIiAiICsgc2VsZWN0ZWRBTVBNKTsKICAgICAgICB2YXIgaW50ZXJ2YWwgPSBkYXRldGltZS5nZXRUaW1lKCkgJSBpbnRlcnZhbE1pbGxpc2Vjb25kczsKICAgICAgICB2YXIgZGVsdGEgPSBpbnRlcnZhbCA9PT0gMCA/IDAgOiBkYXRldGltZS5nZXRUaW1lKCkgLSBpbnRlcnZhbDsKICAgICAgICBkZWx0YSArPSBpbnRlcnZhbE1pbGxpc2Vjb25kczsgLy8gdGhpcy5leGl0VGltZVNlbGVjdGVkID0gT2JqZWN0LmFzc2lnbih0aGlzLmV4aXRUaW1lU2VsZWN0ZWQsIHsgaGg6IGZvcm1hdChuZXcgRGF0ZShkZWx0YSksICdoaCcpLCBtbTogZm9ybWF0KG5ldyBEYXRlKGRlbHRhKSwgJ21tJyksIGE6IGZvcm1hdChuZXcgRGF0ZShkZWx0YSksICdhJyksIH0pCgogICAgICAgIHJldHVybiBuZXcgRGF0ZShkZWx0YSk7CiAgICAgIH0KICAgIH0sCiAgICBsb3lhbHR5VmFsaWQ6IGZ1bmN0aW9uIGxveWFsdHlWYWxpZCgpIHsKICAgICAgaWYgKCEvXlthLXowLTldKyQvaS50ZXN0KHRoaXMubG95YWx0eTI0a251bSkpIHsKICAgICAgICB0aGlzLmxveWFsdHkyNGtudW0gPSB0aGlzLmxveWFsdHkyNGtudW0ucmVwbGFjZSgvW15cd1xzXS9naSwgJycpOwogICAgICB9CiAgICB9LAogICAgc3VibWl0TG95YWx0eTogZnVuY3Rpb24gc3VibWl0TG95YWx0eShjb2RlKSB7CiAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgcmV0dXJuIF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIoKSB7CiAgICAgICAgdmFyIHJlc3VsdCwgX3Jlc3VsdCRkYXRhLCBfcmVzdWx0JGRhdGEyOwoKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTIkKF9jb250ZXh0MikgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDIucHJldiA9IF9jb250ZXh0Mi5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgX2NvbnRleHQyLnByZXYgPSAwOwogICAgICAgICAgICAgICAgX3RoaXMyLnZhbGlkYXRlQm9va2luZ1BlbmRpbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA0OwogICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzMi52YWxpZGF0ZUJvb2tpbmcoY29kZSk7CgogICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgIHJlc3VsdCA9IF9jb250ZXh0Mi5zZW50OwoKICAgICAgICAgICAgICAgIGlmICghcmVzdWx0LmRhdGEuc3RhdHVzKSB7CiAgICAgICAgICAgICAgICAgIF90aGlzMi5pbnZhbGlkU01TTXNnID0gcmVzdWx0ICE9PSBudWxsICYmIHJlc3VsdCAhPT0gdm9pZCAwICYmIChfcmVzdWx0JGRhdGEgPSByZXN1bHQuZGF0YSkgIT09IG51bGwgJiYgX3Jlc3VsdCRkYXRhICE9PSB2b2lkIDAgJiYgX3Jlc3VsdCRkYXRhLm1lc3NhZ2UgPyByZXN1bHQuZGF0YS5tZXNzYWdlIDogIlZhbGlkYXRpb24gbm90IHJlY29nbml6ZWQuIFBsZWFzZSB0cnkgYWdhaW4iOwogICAgICAgICAgICAgICAgICBfdGhpczIuaW52YWxpZFNNU0RpYWxvZyA9IHRydWU7CiAgICAgICAgICAgICAgICAgIF90aGlzMi52YWxpZGF0ZUJvb2tpbmdQZW5kaW5nID0gZmFsc2U7CgogICAgICAgICAgICAgICAgICBfdGhpczIucG9zdFRvTG9nZ2VyQVBJKHsKICAgICAgICAgICAgICAgICAgICBwaG9uZTogX3RoaXMyLmJvb2tpbmdEZXRhaWxzLnVzZXIuY29udGFjdCwKICAgICAgICAgICAgICAgICAgICByZWZJZDogX3RoaXMyLmJvb2tpbmdJZCwKICAgICAgICAgICAgICAgICAgICBlcnJvcjogX3RoaXMyLmludmFsaWRTTVNNc2csCiAgICAgICAgICAgICAgICAgICAgaWNvbjogInJlZGVlbSIsCiAgICAgICAgICAgICAgICAgICAgc3RhdHVzVGV4dDogIkVycm9yIGluIHZhbGlkYXRpbmcgdGhlIHNlc3Npb24gb24gZW50ZXJpbmcgdmFsaWRhdGlvbiBjb2RlIC0gIiArIF90aGlzMi52YWxpZGF0ZUJvb2tpbmdUeHQKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBfdGhpczIucG9zdFRvTG9nZ2VyQVBJKHsKICAgICAgICAgICAgICAgICAgICBwaG9uZTogX3RoaXMyLmJvb2tpbmdEZXRhaWxzLnVzZXIuY29udGFjdCwKICAgICAgICAgICAgICAgICAgICByZWZJZDogX3RoaXMyLmJvb2tpbmdJZCwKICAgICAgICAgICAgICAgICAgICBpY29uOiAicmVkZWVtIiwKICAgICAgICAgICAgICAgICAgICBzdGF0dXNUZXh0OiAiUGFya2VyIHZhbGlkYXRlZCB0aGUgc2Vzc2lvbiBzdWNjZXNzZnVsbHkgYnkgZW50ZXJpbmcgdmFsaWRhdGlvbiBjb2RlIC0gIiArIF90aGlzMi52YWxpZGF0ZUJvb2tpbmdUeHQKICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICBfdGhpczIudmFsaWRhdGVCb29raW5nUGVuZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICBfdGhpczIudmFsaWRhdGVCb29raW5nRGlhbG9nID0gZmFsc2U7CgogICAgICAgICAgICAgICAgICBfdGhpczIuJHN0b3JlLmNvbW1pdCgiU0VUX1ZBTElEQVRFRF9NRVJDSEFOVCIsIHJlc3VsdCA9PT0gbnVsbCB8fCByZXN1bHQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IChfcmVzdWx0JGRhdGEyID0gcmVzdWx0LmRhdGEpID09PSBudWxsIHx8IF9yZXN1bHQkZGF0YTIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9yZXN1bHQkZGF0YTIubWVyY2hhbnROYW1lKTsKCiAgICAgICAgICAgICAgICAgIF90aGlzMi4kcm91dGVyLnJlcGxhY2UoewogICAgICAgICAgICAgICAgICAgIHBhdGg6ICIvdmFsaWRhdGVzdWNjZXNzIgogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDEyOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5wcmV2ID0gODsKICAgICAgICAgICAgICAgIF9jb250ZXh0Mi50MCA9IF9jb250ZXh0MlsiY2F0Y2giXSgwKTsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKF9jb250ZXh0Mi50MCk7CiAgICAgICAgICAgICAgICBfdGhpczIudmFsaWRhdGVCb29raW5nUGVuZGluZyA9IGZhbHNlOwoKICAgICAgICAgICAgICBjYXNlIDEyOgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUyLCBudWxsLCBbWzAsIDhdXSk7CiAgICAgIH0pKSgpOwogICAgfSwKICAgIGNsb3NlQWxlcnREaWFsb2c6IGZ1bmN0aW9uIGNsb3NlQWxlcnREaWFsb2coKSB7CiAgICAgIHRoaXMuYWxlcnREaWFsb2cgPSBmYWxzZTsKICAgIH0sCiAgICBnZXRQYXltZW50VHlwZTogZnVuY3Rpb24gZ2V0UGF5bWVudFR5cGUodHlwZSkgewogICAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgICBjYXNlICdBUFBMRV9QQVknOgogICAgICAgICAgewogICAgICAgICAgICByZXR1cm4gJ0FwcGxlIFBheSc7CiAgICAgICAgICB9CgogICAgICAgIGNhc2UgJ0dPT0dMRV9QQVknOgogICAgICAgICAgewogICAgICAgICAgICByZXR1cm4gJ0dvb2dsZSBQYXknOwogICAgICAgICAgfQoKICAgICAgICBjYXNlICdDYXJkJzoKICAgICAgICAgIHsKICAgICAgICAgICAgcmV0dXJuICdDYXJkJzsKICAgICAgICAgIH0KICAgICAgfQogICAgfSwKCiAgICAvKiogQG1ldGhvZHMgdG8gZmluZCB0aGUgdGhlIFVUQyBkYXRlIAogICAgQHBhcmFtcyB0aGUgYm9va2luZ3MgZGF0ZSB2YWx1ZSAsIHR5cGUgJ2V4aXQgKDIwMjMtMTItMDIpJyBvciAnZm9ybWF0ZGF0ZSAoMTIvMDIvMjAyMyknCiAgICAqLwogICAgZm9ybWF0VVRDRGVmYXVsdERhdGU6IGZ1bmN0aW9uIGZvcm1hdFVUQ0RlZmF1bHREYXRlKGRlZmF1bHREYXRlLCB0eXBlKSB7CiAgICAgIHZhciB1dGNEYXRlID0gbmV3IERhdGUoZGVmYXVsdERhdGUgKiAxMDAwKS50b1VUQ1N0cmluZygpOwogICAgICB2YXIgbW9udGggPSB1dGNEYXRlLnNwbGl0KCIsIilbMV0uc3BsaXQoIiAiKVsyXTsgLy8gSmFuCgogICAgICB2YXIgZGF0ZSA9IHV0Y0RhdGUuc3BsaXQoIiwiKVsxXS5zcGxpdCgiICIpWzFdOyAvLyAyNwoKICAgICAgdmFyIHllYXIgPSB1dGNEYXRlLnNwbGl0KCIsIilbMV0uc3BsaXQoIiAiKVszXTsgLy8yMDIzCgogICAgICB2YXIgZXhpdGZvcm1hdCA9IGZvcm1hdChuZXcgRGF0ZShtb250aCArICIgIiArIGRhdGUgKyAiICIgKyB5ZWFyKSwgJ3l5eXktTU0tZGQnKTsKICAgICAgdmFyIGRhdGVmb3JtYXQgPSBmb3JtYXQobmV3IERhdGUobW9udGggKyAiICIgKyBkYXRlICsgIiAiICsgeWVhciksICJNTS9kZC95eXl5Iik7CiAgICAgIHJldHVybiB0eXBlID09PSAiZXhpdCIgPyBleGl0Zm9ybWF0IDogZGF0ZWZvcm1hdDsKICAgIH0sCiAgICBleHRlbmRFRFQ6IGZ1bmN0aW9uIGV4dGVuZEVEVCgpIHsKICAgICAgdmFyIF90aGlzMyA9IHRoaXM7CgogICAgICByZXR1cm4gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMygpIHsKICAgICAgICB2YXIgX3RoaXMzJGJvb2tpbmdEZXRhaWxzLCBfdGhpczMkYm9va2luZ0RldGFpbHMyLCBfdGhpczMkYm9va2luZ0RldGFpbHMzLCBfdGhpczMkYm9va2luZ0RldGFpbHM0LCBfZXh0ZW5kU2Vzc2lvblJlcyRkYXQsIHRpbWVjb25maWcsIHRpbWUsIGV4aXREYXRlVGltZSwgZGF0YSwgZXh0ZW5kU2Vzc2lvblJlcywgX2V4dGVuZFNlc3Npb25SZXMkZGF0MjsKCiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUzJChfY29udGV4dDMpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQzLnByZXYgPSBfY29udGV4dDMubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIF9jb250ZXh0My5wcmV2ID0gMDsKICAgICAgICAgICAgICAgIC8vZm9ybWF0KG5ldyBEYXRlKHRoaXMuY2hlY2tpbkRhdGUpLCAieXl5eS1NTS1kZCdUJ0hIOm1tOnNzIik7CiAgICAgICAgICAgICAgICBfdGhpczMuZXh0ZW5kQnRuTG9hZGluZyA9IHRydWU7CiAgICAgICAgICAgICAgICB0aW1lY29uZmlnID0gZm9ybWF0KF90aGlzMy50aW1lLCAneXl5eS9NTS9kZCcpICsgIiAiICsgIjExOjU5IFBNIjsKICAgICAgICAgICAgICAgIHRpbWUgPSAoKF90aGlzMyRib29raW5nRGV0YWlscyA9IF90aGlzMy5ib29raW5nRGV0YWlscykgPT09IG51bGwgfHwgX3RoaXMzJGJvb2tpbmdEZXRhaWxzID09PSB2b2lkIDAgPyB2b2lkIDAgOiAoX3RoaXMzJGJvb2tpbmdEZXRhaWxzMiA9IF90aGlzMyRib29raW5nRGV0YWlscy56b25lKSA9PT0gbnVsbCB8fCBfdGhpczMkYm9va2luZ0RldGFpbHMyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfdGhpczMkYm9va2luZ0RldGFpbHMyLnRpbWVQaWNrZXJDb25maWd1cmF0aW9uKSA9PSAnMCcgPyBuZXcgRGF0ZSh0aW1lY29uZmlnKSA6IF90aGlzMy50aW1lOwogICAgICAgICAgICAgICAgZXhpdERhdGVUaW1lID0gdGltZSAhPSBudWxsIHx8IHRpbWUgIT09IHVuZGVmaW5lZCB8fCB0aW1lICE9ICIiID8gZm9ybWF0KHRpbWUsICd5eXl5L01NL2RkJykgKyAiICIgKyBmb3JtYXQodGltZSwgJ2hoOm1tIGEnKSA6IG5ldyBEYXRlKCk7CiAgICAgICAgICAgICAgICBkYXRhID0gewogICAgICAgICAgICAgICAgICBiaWQ6IChfdGhpczMkYm9va2luZ0RldGFpbHMzID0gX3RoaXMzLmJvb2tpbmdEZXRhaWxzKSA9PT0gbnVsbCB8fCBfdGhpczMkYm9va2luZ0RldGFpbHMzID09PSB2b2lkIDAgPyB2b2lkIDAgOiAoX3RoaXMzJGJvb2tpbmdEZXRhaWxzNCA9IF90aGlzMyRib29raW5nRGV0YWlsczMuYm9va2luZykgPT09IG51bGwgfHwgX3RoaXMzJGJvb2tpbmdEZXRhaWxzNCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3RoaXMzJGJvb2tpbmdEZXRhaWxzNC5iaWQsCiAgICAgICAgICAgICAgICAgIGV4dGVuZGVkVGltZTogZm9ybWF0KG5ldyBEYXRlKGV4aXREYXRlVGltZSksICJ5eXl5LU1NLWRkIEhIOm1tOnNzIikgLy8iMjAyMi0xMi0yOVQwMjoyNjowMC4wMDAiLAoKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDg7CiAgICAgICAgICAgICAgICByZXR1cm4gQVBJSGVscGVyKCJQT1NUIiwgIi9hcGkvdjEvcHJlcGFpZC9leHRlbmRSZXNlcnZhdGlvbiIsIGRhdGEpOwoKICAgICAgICAgICAgICBjYXNlIDg6CiAgICAgICAgICAgICAgICBleHRlbmRTZXNzaW9uUmVzID0gX2NvbnRleHQzLnNlbnQ7CgogICAgICAgICAgICAgICAgaWYgKCEoKGV4dGVuZFNlc3Npb25SZXMgPT09IG51bGwgfHwgZXh0ZW5kU2Vzc2lvblJlcyA9PT0gdm9pZCAwID8gdm9pZCAwIDogKF9leHRlbmRTZXNzaW9uUmVzJGRhdCA9IGV4dGVuZFNlc3Npb25SZXMuZGF0YSkgPT09IG51bGwgfHwgX2V4dGVuZFNlc3Npb25SZXMkZGF0ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZXh0ZW5kU2Vzc2lvblJlcyRkYXQubWVzc2FnZSkgPT0gIlN1Y2Nlc3NmdWxseSB1cGRhdGVkISEiKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDE2OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDEyOwogICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzMy5nZXRCb29raW5nRGV0YWlscygpOwoKICAgICAgICAgICAgICBjYXNlIDEyOgogICAgICAgICAgICAgICAgX3RoaXMzLmV4dGVuZEJ0bkxvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgIF90aGlzMy5leHRlbnNpb25EaWFsb2cgPSBmYWxzZTsKICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMTg7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAxNjoKICAgICAgICAgICAgICAgIF90aGlzMy5hbGVydERpYWxvZyA9IHRydWU7CiAgICAgICAgICAgICAgICBfdGhpczMuYWxlcnRNc2cgPSAoZXh0ZW5kU2Vzc2lvblJlcyA9PT0gbnVsbCB8fCBleHRlbmRTZXNzaW9uUmVzID09PSB2b2lkIDAgPyB2b2lkIDAgOiAoX2V4dGVuZFNlc3Npb25SZXMkZGF0MiA9IGV4dGVuZFNlc3Npb25SZXMuZGF0YSkgPT09IG51bGwgfHwgX2V4dGVuZFNlc3Npb25SZXMkZGF0MiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2V4dGVuZFNlc3Npb25SZXMkZGF0Mi5tZXNzYWdlKSB8fCAiRXJyb3IgaW4gZXh0ZW5kaW5nIHRoZSBzZXNzaW9uIjsKCiAgICAgICAgICAgICAgY2FzZSAxODoKICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMjQ7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAyMDoKICAgICAgICAgICAgICAgIF9jb250ZXh0My5wcmV2ID0gMjA7CiAgICAgICAgICAgICAgICBfY29udGV4dDMudDAgPSBfY29udGV4dDNbImNhdGNoIl0oMCk7CiAgICAgICAgICAgICAgICBfdGhpczMuZXh0ZW5kQnRuTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgY29uc29sZS5sb2coX2NvbnRleHQzLnQwKTsKCiAgICAgICAgICAgICAgY2FzZSAyNDoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMywgbnVsbCwgW1swLCAyMF1dKTsKICAgICAgfSkpKCk7CiAgICB9LAogICAgZm9ybWF0RGF0ZTogZnVuY3Rpb24gZm9ybWF0RGF0ZShkYXRlKSB7CiAgICAgIHZhciBzdHJpbmdkYXRlID0gZGF0ZS50b1N0cmluZygpOwogICAgICBpZiAoIWRhdGUpIHJldHVybiBudWxsOwoKICAgICAgdmFyIF9zdHJpbmdkYXRlJHNwbGl0ID0gc3RyaW5nZGF0ZS5zcGxpdCgiLSIpLAogICAgICAgICAgX3N0cmluZ2RhdGUkc3BsaXQyID0gX3NsaWNlZFRvQXJyYXkoX3N0cmluZ2RhdGUkc3BsaXQsIDMpLAogICAgICAgICAgeWVhciA9IF9zdHJpbmdkYXRlJHNwbGl0MlswXSwKICAgICAgICAgIG1vbnRoID0gX3N0cmluZ2RhdGUkc3BsaXQyWzFdLAogICAgICAgICAgZGF5ID0gX3N0cmluZ2RhdGUkc3BsaXQyWzJdOwoKICAgICAgcmV0dXJuICIiLmNvbmNhdChtb250aCwgIi8iKS5jb25jYXQoZGF5LCAiLyIpLmNvbmNhdCh5ZWFyKTsKICAgIH0sCiAgICBwYXJzZURhdGU6IGZ1bmN0aW9uIHBhcnNlRGF0ZShkYXRlKSB7CiAgICAgIGlmICghZGF0ZSkgcmV0dXJuIG51bGw7CgogICAgICB2YXIgX2RhdGUkc3BsaXQgPSBkYXRlLnNwbGl0KCIvIiksCiAgICAgICAgICBfZGF0ZSRzcGxpdDIgPSBfc2xpY2VkVG9BcnJheShfZGF0ZSRzcGxpdCwgMyksCiAgICAgICAgICBtb250aCA9IF9kYXRlJHNwbGl0MlswXSwKICAgICAgICAgIGRheSA9IF9kYXRlJHNwbGl0MlsxXSwKICAgICAgICAgIHllYXIgPSBfZGF0ZSRzcGxpdDJbMl07CgogICAgICByZXR1cm4gIiIuY29uY2F0KHllYXIsICItIikuY29uY2F0KG1vbnRoLnBhZFN0YXJ0KDIsICIwIiksICItIikuY29uY2F0KGRheS5wYWRTdGFydCgyLCAiMCIpKTsKICAgIH0sCiAgICBvcGVuRXh0RGlhbG9nOiBmdW5jdGlvbiBvcGVuRXh0RGlhbG9nKCkgewogICAgICB2YXIgX3RoaXM0ID0gdGhpczsKCiAgICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU0KCkgewogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNCQoX2NvbnRleHQ0KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NC5wcmV2ID0gX2NvbnRleHQ0Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAvLyBhd2FpdCBheGlvcy5nZXQoCiAgICAgICAgICAgICAgICAvLyAgIHByb2Nlc3MuZW52LlZVRV9BUFBfT05fREVNQU5EX1VSTCArICIvIiArICIzMjg5OSIrICIuanNvbiIKICAgICAgICAgICAgICAgIC8vICk7CiAgICAgICAgICAgICAgICBfdGhpczQuc2V0RGVmYXVsdERhdGUoKTsKCiAgICAgICAgICAgICAgICBfdGhpczQuc2V0RGF0ZVBpY2tlcigpOyAvLyB0aGlzLnNldFRpbWVQaWNrZXIoKTsKCgogICAgICAgICAgICAgICAgX3RoaXM0LmV4dGVuc2lvbkRpYWxvZyA9IHRydWU7CiAgICAgICAgICAgICAgICBfdGhpczQuZXh0ZW5kQnRuTG9hZGluZyA9IGZhbHNlOwoKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTQpOwogICAgICB9KSkoKTsKICAgIH0sCiAgICBzZXREZWZhdWx0RGF0ZTogZnVuY3Rpb24gc2V0RGVmYXVsdERhdGUoKSB7CiAgICAgIHZhciBfdGhpcyRib29raW5nRGV0YWlsczUwLCBfdGhpcyRib29raW5nRGV0YWlsczUxLCBfdGhpcyRib29raW5nRGV0YWlsczUyLCBfdGhpcyRib29raW5nRGV0YWlsczUzLCBfdGhpcyRib29raW5nRGV0YWlsczU0LCBfdGhpcyRib29raW5nRGV0YWlsczU1LCBfdGhpcyRib29raW5nRGV0YWlsczU2LCBfdGhpcyRib29raW5nRGV0YWlsczU3OwoKICAgICAgLy9mb3JtYXR0ZWQgZXhpdCBkYXRlIHZhbHVlIHRvIGRpc3BsYXkKICAgICAgdGhpcy5kYXRlRm9ybWF0dGVkID0gKF90aGlzJGJvb2tpbmdEZXRhaWxzNTAgPSB0aGlzLmJvb2tpbmdEZXRhaWxzKSAhPT0gbnVsbCAmJiBfdGhpcyRib29raW5nRGV0YWlsczUwICE9PSB2b2lkIDAgJiYgKF90aGlzJGJvb2tpbmdEZXRhaWxzNTEgPSBfdGhpcyRib29raW5nRGV0YWlsczUwLmJvb2tpbmcpICE9PSBudWxsICYmIF90aGlzJGJvb2tpbmdEZXRhaWxzNTEgIT09IHZvaWQgMCAmJiBfdGhpcyRib29raW5nRGV0YWlsczUxLnJlc2VydmF0aW9uRW5kRGF0ZSA/IHRoaXMuZm9ybWF0VVRDRGVmYXVsdERhdGUoKF90aGlzJGJvb2tpbmdEZXRhaWxzNTIgPSB0aGlzLmJvb2tpbmdEZXRhaWxzKSA9PT0gbnVsbCB8fCBfdGhpcyRib29raW5nRGV0YWlsczUyID09PSB2b2lkIDAgPyB2b2lkIDAgOiAoX3RoaXMkYm9va2luZ0RldGFpbHM1MyA9IF90aGlzJGJvb2tpbmdEZXRhaWxzNTIuYm9va2luZykgPT09IG51bGwgfHwgX3RoaXMkYm9va2luZ0RldGFpbHM1MyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3RoaXMkYm9va2luZ0RldGFpbHM1My5yZXZFbmQsICdmb3JtYXQnKSA6ICIiOwogICAgICB0aGlzLnRpbWUgPSBuZXcgRGF0ZSh0aGlzLmZvcm1hdEV4aXREYXRlVGltZSgoX3RoaXMkYm9va2luZ0RldGFpbHM1NCA9IHRoaXMuYm9va2luZ0RldGFpbHMpID09PSBudWxsIHx8IF90aGlzJGJvb2tpbmdEZXRhaWxzNTQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IChfdGhpcyRib29raW5nRGV0YWlsczU1ID0gX3RoaXMkYm9va2luZ0RldGFpbHM1NC5ib29raW5nKSA9PT0gbnVsbCB8fCBfdGhpcyRib29raW5nRGV0YWlsczU1ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfdGhpcyRib29raW5nRGV0YWlsczU1LnJldkVuZCwgJ2RhdGUnKSk7CiAgICAgIHRoaXMuZXhpdERhdGUgPSB0aGlzLnRpbWU7CiAgICAgIHZhciBmaWZ0ZWVuVGltZSA9IHRoaXMudGltZTsKICAgICAgdGhpcy50aW1lID0gZm9ybWF0KHRoaXMudGltZSwgJ21tJykgPT0gJzE1JyB8fCBmb3JtYXQodGhpcy50aW1lLCAnbW0nKSA9PSAnMzAnIHx8IGZvcm1hdCh0aGlzLnRpbWUsICdtbScpID09ICc0NScgfHwgZm9ybWF0KHRoaXMudGltZSwgJ21tJykgPT0gJzAwJyA/IGZpZnRlZW5UaW1lIDogKChfdGhpcyRib29raW5nRGV0YWlsczU2ID0gdGhpcy5ib29raW5nRGV0YWlscykgPT09IG51bGwgfHwgX3RoaXMkYm9va2luZ0RldGFpbHM1NiA9PT0gdm9pZCAwID8gdm9pZCAwIDogKF90aGlzJGJvb2tpbmdEZXRhaWxzNTcgPSBfdGhpcyRib29raW5nRGV0YWlsczU2LnpvbmUpID09PSBudWxsIHx8IF90aGlzJGJvb2tpbmdEZXRhaWxzNTcgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF90aGlzJGJvb2tpbmdEZXRhaWxzNTcudGltZVBpY2tlckNvbmZpZ3VyYXRpb24pID09ICcxJyA/IHRoaXMucm91bmQodGhpcy50aW1lKSA6IHNldCh0aGlzLnRpbWUsIHsKICAgICAgICBob3VyOiAyMywKICAgICAgICBtaW51dGVzOiA1OSwKICAgICAgICBzZWNvbmRzOiA1OQogICAgICB9KTsgLy8gdGhpcy5kYXRlVGltZUNoYW5nZSgpCiAgICAgIC8vIE9iamVjdC5oYXNPd25Qcm9wZXJ0eS5jYWxsKHRoaXMuYm9va2luZ0RldGFpbHMuYm9va2luZywgJ2lzR2F0ZWQnKSAmJiB0aGlzLmJvb2tpbmdEZXRhaWxzLmJvb2tpbmc/LmlzR2F0ZWQgPT0gIjEiICYmIGZvcm1hdCh0aGlzLnRpbWUsICd5eXl5LU1NLWRkJykgIT0gZm9ybWF0KGRhdGVUb1RpbWVab25lRGF0ZShuZXcgRGF0ZSgpLCB0aGlzLmJvb2tpbmdEZXRhaWxzPy56b25lPy50aW1lem9uZSksICd5eXl5LU1NLWRkJykgPyB0aGlzLmJlZm9yZURhdGVUaW1lQ2hhbmdlKCkgOiAiIjsKICAgIH0sCiAgICBvblRpbWVQaWNrZXJDaGFuZ2U6IGZ1bmN0aW9uIG9uVGltZVBpY2tlckNoYW5nZSgpIHsKICAgICAgdmFyIGV4aXRkYXRlID0gdGhpcy50aW1lICE9PSBudWxsICYmIHRoaXMudGltZSAhPT0gdW5kZWZpbmVkICYmIHRoaXMudGltZSAhPT0gIiIgPyBmb3JtYXQodGhpcy50aW1lLCAneXl5eS9NTS9kZCcpIDogIiI7CiAgICAgIHZhciBzZWxlY3RlZE1pbnMgPSB0aGlzLnRpbWUgIT09IG51bGwgJiYgdGhpcy50aW1lICE9PSB1bmRlZmluZWQgJiYgdGhpcy50aW1lICE9PSAiIiA/IGZvcm1hdCh0aGlzLnRpbWUsICdtbScpIDogIiI7CiAgICAgIHZhciBzZWxlY3RlZEhvdXJzID0gdGhpcy50aW1lICE9PSBudWxsICYmIHRoaXMudGltZSAhPT0gdW5kZWZpbmVkICYmIHRoaXMudGltZSAhPT0gIiIgPyBmb3JtYXQodGhpcy50aW1lLCAnSEgnKSA6ICIiOwogICAgICB2YXIgc2VsZWN0ZWRBTVBNID0gdGhpcy50aW1lICE9PSBudWxsICYmIHRoaXMudGltZSAhPT0gdW5kZWZpbmVkICYmIHRoaXMudGltZSAhPT0gIiIgPyBmb3JtYXQodGhpcy50aW1lLCAnYScpIDogIiI7CiAgICAgIHRoaXMuc3RvcFRpbWUgPSBzZWxlY3RlZE1pbnMgIT0gbnVsbCAmJiBzZWxlY3RlZE1pbnMgIT0gIiIgJiYgc2VsZWN0ZWRIb3VycyAhPSBudWxsICYmIHNlbGVjdGVkSG91cnMgIT0gIiIgJiYgc2VsZWN0ZWRBTVBNICE9IG51bGwgJiYgc2VsZWN0ZWRBTVBNICE9ICIiID8gc2VsZWN0ZWRIb3VycyArICI6IiArIHNlbGVjdGVkTWlucyArICI6IiArICIwMCIgOiAiIjsKICAgICAgdmFyIGN1cnJlblRpbWUgPSB0aGlzLmJvb2tpbmdEZXRhaWxzLnpvbmUudGltZXpvbmUgPyBmb3JtYXQoZGF0ZVRvVGltZVpvbmVEYXRlKG5ldyBEYXRlKCksIHRoaXMuYm9va2luZ0RldGFpbHMuem9uZS50aW1lem9uZSksICJ5eXl5LU1NLWRkIEhIOm1tOnNzIikgOiBmb3JtYXQobmV3IERhdGUoKSwgInl5eXktTU0tZGQgIEhIOm1tOnNzIik7CgogICAgICBpZiAoc2VsZWN0ZWRNaW5zICE9IG51bGwgJiYgc2VsZWN0ZWRNaW5zICE9ICIiICYmIHNlbGVjdGVkSG91cnMgIT0gbnVsbCAmJiBzZWxlY3RlZEhvdXJzICE9ICIiICYmIHNlbGVjdGVkQU1QTSAhPSBudWxsICYmIHNlbGVjdGVkQU1QTSAhPSAiIiAmJiBuZXcgRGF0ZShleGl0ZGF0ZSArICIgIiArIHRoaXMuc3RvcFRpbWUpLmdldFRpbWUoKSA+IG5ldyBEYXRlKGN1cnJlblRpbWUpLmdldFRpbWUoKSkgewogICAgICAgIGZvcm1hdCh0aGlzLnRpbWUsICd5eXl5LU1NLWRkJykgIT0gZm9ybWF0KHRoaXMubWluRGF0ZSwgJ3l5eXktTU0tZGQnKSA/IHRoaXMuYmVmb3JlRGF0ZVRpbWVDaGFuZ2UoKSA6ICIiOwogICAgICAgIHRoaXMuZGF0ZVRpbWVDaGFuZ2UoKTsKICAgICAgfQogICAgfSwKICAgIHNldERhdGVQaWNrZXI6IGZ1bmN0aW9uIHNldERhdGVQaWNrZXIoKSB7CiAgICAgIHZhciBfdGhpcyRib29raW5nRGV0YWlsczU4LCBfdGhpcyRib29raW5nRGV0YWlsczU5LCBfdGhpcyRib29raW5nRGV0YWlsczYwLCBfdGhpcyRib29raW5nRGV0YWlsczYxLCBfdGhpcyRib29raW5nRGV0YWlsczYyLCBfdGhpcyRib29raW5nRGV0YWlsczYzLCBfdGhpcyRib29raW5nRGV0YWlsczY0LCBfdGhpcyRib29raW5nRGV0YWlsczY1LCBfdGhpcyRib29raW5nRGV0YWlsczY2LCBfdGhpcyRib29raW5nRGV0YWlsczY3LCBfdGhpcyRib29raW5nRGV0YWlsczY4LCBfdGhpcyRib29raW5nRGV0YWlsczY5LCBfdGhpcyRib29raW5nRGV0YWlsczcwOwoKICAgICAgLy9zZXQgdGhlIG1pbmltdW0gZGF0ZSB0byB0b2RheSBkYXRlKHpvbmUgdGltZSB6b25lIGRhdGUpCiAgICAgIHRoaXMubWluRGF0ZSA9IHRoaXMuYm9va2luZ0RldGFpbHMuem9uZS50aW1lem9uZSA/IG5ldyBEYXRlKHRoaXMuZm9ybWF0RXhpdERhdGVUaW1lKChfdGhpcyRib29raW5nRGV0YWlsczU4ID0gdGhpcy5ib29raW5nRGV0YWlscykgPT09IG51bGwgfHwgX3RoaXMkYm9va2luZ0RldGFpbHM1OCA9PT0gdm9pZCAwID8gdm9pZCAwIDogKF90aGlzJGJvb2tpbmdEZXRhaWxzNTkgPSBfdGhpcyRib29raW5nRGV0YWlsczU4LmJvb2tpbmcpID09PSBudWxsIHx8IF90aGlzJGJvb2tpbmdEZXRhaWxzNTkgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF90aGlzJGJvb2tpbmdEZXRhaWxzNTkucmV2RW5kLCAnZGF0ZScpKSA6IGRhdGVUb1RpbWVab25lRGF0ZShuZXcgRGF0ZShOdW1iZXIoKF90aGlzJGJvb2tpbmdEZXRhaWxzNjAgPSB0aGlzLmJvb2tpbmdEZXRhaWxzKSA9PT0gbnVsbCB8fCBfdGhpcyRib29raW5nRGV0YWlsczYwID09PSB2b2lkIDAgPyB2b2lkIDAgOiAoX3RoaXMkYm9va2luZ0RldGFpbHM2MSA9IF90aGlzJGJvb2tpbmdEZXRhaWxzNjAuYm9va2luZykgPT09IG51bGwgfHwgX3RoaXMkYm9va2luZ0RldGFpbHM2MSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3RoaXMkYm9va2luZ0RldGFpbHM2MS5yZXZFbmQpICogMTAwMCAtIE51bWJlcih0aGlzLmJvb2tpbmdEZXRhaWxzLnpvbmUudGltZXpvbmVvZmZzZXQpICogMTAwMCksIHRoaXMuYm9va2luZ0RldGFpbHMuem9uZS50aW1lem9uZSk7IC8vY2FsY3VsYXRlIG1heCBwYXJraWduIHRpbWUgaW4gc2Vjb25kcwoKICAgICAgdmFyIG1heFBhcmsgPSB0aGlzLmJvb2tpbmdEZXRhaWxzICE9IG51bGwgPyAoX3RoaXMkYm9va2luZ0RldGFpbHM2MiA9IHRoaXMuYm9va2luZ0RldGFpbHMpID09PSBudWxsIHx8IF90aGlzJGJvb2tpbmdEZXRhaWxzNjIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IChfdGhpcyRib29raW5nRGV0YWlsczYzID0gX3RoaXMkYm9va2luZ0RldGFpbHM2Mi56b25lKSA9PT0gbnVsbCB8fCBfdGhpcyRib29raW5nRGV0YWlsczYzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfdGhpcyRib29raW5nRGV0YWlsczYzLm1heFBhcmtpbmdUaW1lIDogbnVsbDsKICAgICAgdmFyIGFkZGVkZGF5cyA9IGFkZERheXMobmV3IERhdGUoKSwgbWF4UGFyayA9PT0gbnVsbCB8fCBtYXhQYXJrID09PSB2b2lkIDAgPyB2b2lkIDAgOiBtYXhQYXJrLmRheXMpOwogICAgICB2YXIgYWRkZWRob3VycyA9IGFkZEhvdXJzKGFkZGVkZGF5cywgbWF4UGFyayA9PT0gbnVsbCB8fCBtYXhQYXJrID09PSB2b2lkIDAgPyB2b2lkIDAgOiBtYXhQYXJrLmhvdXJzKTsKICAgICAgdmFyIGFkZGVkbWlucyA9IGFkZE1pbnV0ZXMoYWRkZWRob3VycywgbWF4UGFyayA9PT0gbnVsbCB8fCBtYXhQYXJrID09PSB2b2lkIDAgPyB2b2lkIDAgOiBtYXhQYXJrLm1pbnV0ZXMpOyAvL2dldCBtYXggZGF0ZSBpbiBzZWNvbmRzIGJhc2VkIG9uIG1heCBwYXJraW5nIHRpbWUKCiAgICAgIHZhciBtYXhab25lRGF0ZSA9IGFkZGVkbWluczsKICAgICAgdGhpcy5tYXhEYXRlID0gKF90aGlzJGJvb2tpbmdEZXRhaWxzNjQgPSB0aGlzLmJvb2tpbmdEZXRhaWxzKSAhPT0gbnVsbCAmJiBfdGhpcyRib29raW5nRGV0YWlsczY0ICE9PSB2b2lkIDAgJiYgX3RoaXMkYm9va2luZ0RldGFpbHM2NC56b25lLnRpbWV6b25lID8gZGF0ZVRvVGltZVpvbmVEYXRlKG1heFpvbmVEYXRlLCAoX3RoaXMkYm9va2luZ0RldGFpbHM2NSA9IHRoaXMuYm9va2luZ0RldGFpbHMpID09PSBudWxsIHx8IF90aGlzJGJvb2tpbmdEZXRhaWxzNjUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IChfdGhpcyRib29raW5nRGV0YWlsczY2ID0gX3RoaXMkYm9va2luZ0RldGFpbHM2NS56b25lKSA9PT0gbnVsbCB8fCBfdGhpcyRib29raW5nRGV0YWlsczY2ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfdGhpcyRib29raW5nRGV0YWlsczY2LnRpbWV6b25lKSA6IG5ldyBEYXRlKG1heFpvbmVEYXRlKTsgLy9nZXQgbWF4IGRhdGUgd2l0aCB0aW1lIGFuZCBzZXQgaXQgdG8gbWF4RGF0ZVRpbWUKCiAgICAgIHRoaXMubWF4RGF0ZVRpbWUgPSAoX3RoaXMkYm9va2luZ0RldGFpbHM2NyA9IHRoaXMuYm9va2luZ0RldGFpbHMpICE9PSBudWxsICYmIF90aGlzJGJvb2tpbmdEZXRhaWxzNjcgIT09IHZvaWQgMCAmJiAoX3RoaXMkYm9va2luZ0RldGFpbHM2OCA9IF90aGlzJGJvb2tpbmdEZXRhaWxzNjcuem9uZSkgIT09IG51bGwgJiYgX3RoaXMkYm9va2luZ0RldGFpbHM2OCAhPT0gdm9pZCAwICYmIF90aGlzJGJvb2tpbmdEZXRhaWxzNjgudGltZXpvbmUgPyBmb3JtYXQoZGF0ZVRvVGltZVpvbmVEYXRlKG5ldyBEYXRlKG1heFpvbmVEYXRlKSwgKF90aGlzJGJvb2tpbmdEZXRhaWxzNjkgPSB0aGlzLmJvb2tpbmdEZXRhaWxzKSA9PT0gbnVsbCB8fCBfdGhpcyRib29raW5nRGV0YWlsczY5ID09PSB2b2lkIDAgPyB2b2lkIDAgOiAoX3RoaXMkYm9va2luZ0RldGFpbHM3MCA9IF90aGlzJGJvb2tpbmdEZXRhaWxzNjkuem9uZSkgPT09IG51bGwgfHwgX3RoaXMkYm9va2luZ0RldGFpbHM3MCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3RoaXMkYm9va2luZ0RldGFpbHM3MC50aW1lem9uZSksICJ5eXl5LU1NLWRkIGhoOm1tIGFhYWFhIikgOiBmb3JtYXQobmV3IERhdGUoKSwgInl5eXktTU0tZGQgaGg6bW0gYWFhYWEiKTsKICAgIH0sCiAgICAvLyBvbk9wZW4oKSB7CiAgICAvLyAgIHRoaXMuc2V0VGltZVBpY2tlcih0aGlzLmV4aXRUaW1lU2VsZWN0ZWQpOwogICAgLy8gfSwKCiAgICAvKiogQG1ldGhvZHMgdG8gZmluZCB0aGUgZXN0aW1hdGUgcmF0ZSAKICAgIEBwYXJhbXMgc3RhcnREYXRlICwgc3RvcERhdGUsemNvZGUsIHR5cGUgLCBlbnZfb3ZlclJpZGUKICAgICovCiAgICBiZWZvcmVEYXRlVGltZUNoYW5nZTogZnVuY3Rpb24gYmVmb3JlRGF0ZVRpbWVDaGFuZ2UoKSB7CiAgICAgIHZhciBfdGhpczUgPSB0aGlzOwoKICAgICAgcmV0dXJuIF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTUoKSB7CiAgICAgICAgdmFyIF90aGlzNSRib29raW5nRGV0YWlscywgX3RoaXM1JGJvb2tpbmdEZXRhaWxzMiwgX3RoaXM1JGJvb2tpbmdEZXRhaWxzMywgX3RoaXM1JGJvb2tpbmdEZXRhaWxzNCwgX3RoaXM1JGJvb2tpbmdEZXRhaWxzNSwgX3RoaXM1JGJvb2tpbmdEZXRhaWxzNiwgX2dldFJhdGUkZGF0YSwgX2dldFJhdGUkZGF0YTMsIGVkdEVudHJ5VGltZSwgc3RvcFRpbWUsIHNlbGVjdGVkSG91cnMsIHNlbGVjdGVkTWlucywgZXhpdHRpbWUsIGV4aXRkYXRlLCBzdG9wRGF0ZSwgZGF0YSwgZ2V0UmF0ZSwgX2dldFJhdGUkZGF0YTI7CgogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNSQoX2NvbnRleHQ1KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NS5wcmV2ID0gX2NvbnRleHQ1Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBpZiAoX3RoaXM1LmJvb2tpbmdEZXRhaWxzLnpvbmUuemNvZGUpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ1Lm5leHQgPSAyOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ1LmFicnVwdCgicmV0dXJuIik7CgogICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgIF9jb250ZXh0NS5wcmV2ID0gMjsKICAgICAgICAgICAgICAgIC8vIGZvcm1hdChuZXcgRGF0ZSh0aGlzLmNoZWNraW5EYXRlKSwgInl5eXktTU0tZGQnVCdISDptbTpzcyIpOwogICAgICAgICAgICAgICAgZWR0RW50cnlUaW1lID0gKF90aGlzNSRib29raW5nRGV0YWlscyA9IF90aGlzNS5ib29raW5nRGV0YWlscykgPT09IG51bGwgfHwgX3RoaXM1JGJvb2tpbmdEZXRhaWxzID09PSB2b2lkIDAgPyB2b2lkIDAgOiAoX3RoaXM1JGJvb2tpbmdEZXRhaWxzMiA9IF90aGlzNSRib29raW5nRGV0YWlscy5ib29raW5nKSA9PT0gbnVsbCB8fCBfdGhpczUkYm9va2luZ0RldGFpbHMyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfdGhpczUkYm9va2luZ0RldGFpbHMyLmVudHJ5dGltZTsKICAgICAgICAgICAgICAgIF90aGlzNS5zdGFydERhdGUgPSBlZHRFbnRyeVRpbWUgIT09IG51bGwgJiYgZWR0RW50cnlUaW1lICE9PSB1bmRlZmluZWQgJiYgZWR0RW50cnlUaW1lICE9PSAiIiA/IGZvcm1hdChuZXcgRGF0ZShfdGhpczUuZm9ybWF0RXhpdERhdGVUaW1lKGVkdEVudHJ5VGltZSwgJ2RhdGUnKSksICJ5eXl5LU1NLWRkJ1QnSEg6bW06c3MiKSA6IF90aGlzNS5ib29raW5nRGV0YWlscy56b25lLnRpbWV6b25lID8gZm9ybWF0KGRhdGVUb1RpbWVab25lRGF0ZShuZXcgRGF0ZSgpLCBfdGhpczUuYm9va2luZ0RldGFpbHMuem9uZS50aW1lem9uZSksICJ5eXl5LU1NLWRkJ1QnSEg6bW06c3MiKSA6IGZvcm1hdChuZXcgRGF0ZSgpLCAieXl5eS1NTS1kZCdUJ0hIOm1tOnNzIik7CiAgICAgICAgICAgICAgICBzdG9wVGltZSA9IF90aGlzNS5zdG9wVGltZTsKICAgICAgICAgICAgICAgIHNlbGVjdGVkSG91cnMgPSBfdGhpczUuYm9va2luZ0RldGFpbHMuYm9va2luZy5lbnRyeXRpbWUgIT0gbnVsbCAmJiBfdGhpczUuYm9va2luZ0RldGFpbHMuYm9va2luZy5lbnRyeXRpbWUgIT09IHVuZGVmaW5lZCAmJiBfdGhpczUuYm9va2luZ0RldGFpbHMuYm9va2luZy5lbnRyeXRpbWUgIT0gIiIgPyBmb3JtYXQobmV3IERhdGUoX3RoaXM1LmZvcm1hdEV4aXREYXRlVGltZSgoX3RoaXM1JGJvb2tpbmdEZXRhaWxzMyA9IF90aGlzNS5ib29raW5nRGV0YWlscykgPT09IG51bGwgfHwgX3RoaXM1JGJvb2tpbmdEZXRhaWxzMyA9PT0gdm9pZCAwID8gdm9pZCAwIDogKF90aGlzNSRib29raW5nRGV0YWlsczQgPSBfdGhpczUkYm9va2luZ0RldGFpbHMzLmJvb2tpbmcpID09PSBudWxsIHx8IF90aGlzNSRib29raW5nRGV0YWlsczQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF90aGlzNSRib29raW5nRGV0YWlsczQuZW50cnl0aW1lLCAnZGF0ZScpKSwgIkhIIikgOiBmb3JtYXQoZGF0ZVRvVGltZVpvbmVEYXRlKG5ldyBEYXRlKCksIF90aGlzNS5ib29raW5nRGV0YWlscy56b25lLnRpbWV6b25lKSwgJ0hIJyk7CiAgICAgICAgICAgICAgICBzZWxlY3RlZE1pbnMgPSBfdGhpczUuYm9va2luZ0RldGFpbHMuYm9va2luZy5lbnRyeXRpbWUgIT0gbnVsbCAmJiBfdGhpczUuYm9va2luZ0RldGFpbHMuYm9va2luZy5lbnRyeXRpbWUgIT09IHVuZGVmaW5lZCAmJiBfdGhpczUuYm9va2luZ0RldGFpbHMuYm9va2luZy5lbnRyeXRpbWUgIT0gIiIgPyBmb3JtYXQobmV3IERhdGUoX3RoaXM1LmZvcm1hdEV4aXREYXRlVGltZSgoX3RoaXM1JGJvb2tpbmdEZXRhaWxzNSA9IF90aGlzNS5ib29raW5nRGV0YWlscykgPT09IG51bGwgfHwgX3RoaXM1JGJvb2tpbmdEZXRhaWxzNSA9PT0gdm9pZCAwID8gdm9pZCAwIDogKF90aGlzNSRib29raW5nRGV0YWlsczYgPSBfdGhpczUkYm9va2luZ0RldGFpbHM1LmJvb2tpbmcpID09PSBudWxsIHx8IF90aGlzNSRib29raW5nRGV0YWlsczYgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF90aGlzNSRib29raW5nRGV0YWlsczYuZW50cnl0aW1lLCAnZGF0ZScpKSwgIm1tIikgOiBmb3JtYXQoZGF0ZVRvVGltZVpvbmVEYXRlKG5ldyBEYXRlKCksIF90aGlzNS5ib29raW5nRGV0YWlscy56b25lLnRpbWV6b25lKSwgJ21tJyk7CiAgICAgICAgICAgICAgICBleGl0dGltZSA9IE9iamVjdC5oYXNPd25Qcm9wZXJ0eS5jYWxsKF90aGlzNS5ib29raW5nRGV0YWlscywgJ3pvbmUnKSAmJiBPYmplY3QuaGFzT3duUHJvcGVydHkuY2FsbChfdGhpczUuYm9va2luZ0RldGFpbHMuem9uZSwgJ3RpbWVQaWNrZXJDb25maWd1cmF0aW9uJykgJiYgX3RoaXM1LmJvb2tpbmdEZXRhaWxzLnpvbmUudGltZVBpY2tlckNvbmZpZ3VyYXRpb24gPT0gJzEnID8gJ1QnICsgc3RvcFRpbWUgOiAnVCcgKyBzZWxlY3RlZEhvdXJzICsgIjoiICsgc2VsZWN0ZWRNaW5zICsgIjowMCI7CiAgICAgICAgICAgICAgICBleGl0ZGF0ZSA9IGZvcm1hdChfdGhpczUudGltZSwgJ3l5eXktTU0tZGQnKTsKICAgICAgICAgICAgICAgIHN0b3BEYXRlID0gZXhpdGRhdGUgKyBleGl0dGltZTsKICAgICAgICAgICAgICAgIGRhdGEgPSB7CiAgICAgICAgICAgICAgICAgIHN0YXJ0QXQ6IF90aGlzNS5zdGFydERhdGUsCiAgICAgICAgICAgICAgICAgIHN0b3BBdDogc3RvcERhdGUsCiAgICAgICAgICAgICAgICAgIHpjb2RlOiBfdGhpczUuYm9va2luZ0RldGFpbHMuem9uZS56Y29kZQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIF90aGlzNS5hZGRQYXltZW50QnRuTG9hZGluZyA9IHRydWU7CiAgICAgICAgICAgICAgICBfY29udGV4dDUubmV4dCA9IDE1OwogICAgICAgICAgICAgICAgcmV0dXJuIEFQSUhlbHBlcigiUE9TVCIsICIvYXBpL3YyL2dldFJhdGUiLCBkYXRhKTsKCiAgICAgICAgICAgICAgY2FzZSAxNToKICAgICAgICAgICAgICAgIGdldFJhdGUgPSBfY29udGV4dDUuc2VudDsKCiAgICAgICAgICAgICAgICAvL2NvbmRpdGlvbiB0byBjaGVjayBpZiB0aGUgZGF0ZSB0aW1lIHNlbGVjdGVkIGlzIGxlc3NlciB0aGFuIGN1cnJlbnQgdGltZQogICAgICAgICAgICAgICAgaWYgKCEoZ2V0UmF0ZSAhPT0gbnVsbCAmJiBnZXRSYXRlICE9PSB2b2lkIDAgJiYgKF9nZXRSYXRlJGRhdGEgPSBnZXRSYXRlLmRhdGEpICE9PSBudWxsICYmIF9nZXRSYXRlJGRhdGEgIT09IHZvaWQgMCAmJiBfZ2V0UmF0ZSRkYXRhLnN0YXR1cykgJiYgIV90aGlzNS5nZXRSYXRlQ2FsbCkgewogICAgICAgICAgICAgICAgICBfdGhpczUuZGlzYWJsZUFkZFBheW1lbnRCdG4gPSB0cnVlOwogICAgICAgICAgICAgICAgICBfdGhpczUuYWxlcnREaWFsb2cgPSB0cnVlOwogICAgICAgICAgICAgICAgICBfdGhpczUuYWxlcnRNc2cgPSAoZ2V0UmF0ZSA9PT0gbnVsbCB8fCBnZXRSYXRlID09PSB2b2lkIDAgPyB2b2lkIDAgOiAoX2dldFJhdGUkZGF0YTIgPSBnZXRSYXRlLmRhdGEpID09PSBudWxsIHx8IF9nZXRSYXRlJGRhdGEyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZ2V0UmF0ZSRkYXRhMi5tZXNzYWdlKSB8fCAiRXJyb3IgaW4gZ2V0dGluZyByYXRlIGRldGFpbHMiOwogICAgICAgICAgICAgICAgICBfdGhpczUub3BlbkRhdGVQaWNrZXIgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgX3RoaXM1Lm9wZW5UaW1lUGlja2VyID0gZmFsc2U7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBfdGhpczUuZGlzYWJsZUFkZFBheW1lbnRCdG4gPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgX3RoaXM1Lm9wZW5EYXRlUGlja2VyID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgIF90aGlzNS5vcGVuVGltZVBpY2tlciA9IGZhbHNlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIF90aGlzNS5iZWZvcmVFc3RpbWF0ZSA9IE9iamVjdC5hc3NpZ24oe30sIGdldFJhdGUgPT09IG51bGwgfHwgZ2V0UmF0ZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogKF9nZXRSYXRlJGRhdGEzID0gZ2V0UmF0ZS5kYXRhKSA9PT0gbnVsbCB8fCBfZ2V0UmF0ZSRkYXRhMyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2dldFJhdGUkZGF0YTMuZGF0YSk7IC8vIGVzdGltYXRlZFZhbCAhPSAiIiAmJgogICAgICAgICAgICAgICAgLy8gZXN0aW1hdGVkVmFsICE9IG51bGwgJiYKICAgICAgICAgICAgICAgIC8vIGVzdGltYXRlZFZhbCAhPSB1bmRlZmluZWQKICAgICAgICAgICAgICAgIC8vICAgPyBOdW1iZXIoZXN0aW1hdGVkVmFsKS50b0ZpeGVkKDIpCiAgICAgICAgICAgICAgICAvLyAgIDogZXN0aW1hdGVkVmFsOwoKICAgICAgICAgICAgICAgIF90aGlzNS5hZGRQYXltZW50QnRuTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgX2NvbnRleHQ1Lm5leHQgPSAyNTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDIxOgogICAgICAgICAgICAgICAgX2NvbnRleHQ1LnByZXYgPSAyMTsKICAgICAgICAgICAgICAgIF9jb250ZXh0NS50MCA9IF9jb250ZXh0NVsiY2F0Y2giXSgyKTsKICAgICAgICAgICAgICAgIF90aGlzNS5hZGRQYXltZW50QnRuTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgY29uc29sZS5sb2coX2NvbnRleHQ1LnQwKTsKCiAgICAgICAgICAgICAgY2FzZSAyNToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NS5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlNSwgbnVsbCwgW1syLCAyMV1dKTsKICAgICAgfSkpKCk7CiAgICB9LAogICAgZGF0ZVRpbWVDaGFuZ2U6IGZ1bmN0aW9uIGRhdGVUaW1lQ2hhbmdlKCkgewogICAgICB2YXIgX3RoaXM2ID0gdGhpczsKCiAgICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU2KCkgewogICAgICAgIHZhciBfdGhpczYkYm9va2luZ0RldGFpbHMsIF90aGlzNiRib29raW5nRGV0YWlsczIsIF90aGlzNiRib29raW5nRGV0YWlsczMsIF90aGlzNiRib29raW5nRGV0YWlsczQsIF90aGlzNiRib29raW5nRGV0YWlsczUsIF90aGlzNiRib29raW5nRGV0YWlsczYsIF9nZXRSYXRlJGRhdGE0LCBfZ2V0UmF0ZSRkYXRhNiwgZWR0RW50cnlUaW1lLCBzZWxlY3RlZEhvdXJzLCBzZWxlY3RlZE1pbnMsIGV4aXRkYXRlLCBleGl0dGltZSwgc3RvcERhdGUsIGRhdGEsIGdldFJhdGUsIF9nZXRSYXRlJGRhdGE1OwoKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTYkKF9jb250ZXh0NikgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDYucHJldiA9IF9jb250ZXh0Ni5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgaWYgKF90aGlzNi5ib29raW5nRGV0YWlscy56b25lLnpjb2RlKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gMjsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5hYnJ1cHQoInJldHVybiIpOwoKICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICBfdGhpczYuZXh0ZW5kQnRuTG9hZGluZyA9IHRydWU7CiAgICAgICAgICAgICAgICBfY29udGV4dDYucHJldiA9IDM7CiAgICAgICAgICAgICAgICAvLyBmb3JtYXQobmV3IERhdGUodGhpcy5jaGVja2luRGF0ZSksICJ5eXl5LU1NLWRkJ1QnSEg6bW06c3MiKTsKICAgICAgICAgICAgICAgIGVkdEVudHJ5VGltZSA9IChfdGhpczYkYm9va2luZ0RldGFpbHMgPSBfdGhpczYuYm9va2luZ0RldGFpbHMpID09PSBudWxsIHx8IF90aGlzNiRib29raW5nRGV0YWlscyA9PT0gdm9pZCAwID8gdm9pZCAwIDogKF90aGlzNiRib29raW5nRGV0YWlsczIgPSBfdGhpczYkYm9va2luZ0RldGFpbHMuYm9va2luZykgPT09IG51bGwgfHwgX3RoaXM2JGJvb2tpbmdEZXRhaWxzMiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3RoaXM2JGJvb2tpbmdEZXRhaWxzMi5lbnRyeXRpbWU7CiAgICAgICAgICAgICAgICBfdGhpczYuc3RhcnREYXRlID0gZWR0RW50cnlUaW1lICE9PSBudWxsICYmIGVkdEVudHJ5VGltZSAhPT0gdW5kZWZpbmVkICYmIGVkdEVudHJ5VGltZSAhPT0gIiIgPyBmb3JtYXQobmV3IERhdGUoX3RoaXM2LmZvcm1hdEV4aXREYXRlVGltZShlZHRFbnRyeVRpbWUsICdkYXRlJykpLCAieXl5eS1NTS1kZCdUJ0hIOm1tOnNzIikgOiBfdGhpczYuYm9va2luZ0RldGFpbHMuem9uZS50aW1lem9uZSA/IGZvcm1hdChkYXRlVG9UaW1lWm9uZURhdGUobmV3IERhdGUoKSwgX3RoaXM2LmJvb2tpbmdEZXRhaWxzLnpvbmUudGltZXpvbmUpLCAieXl5eS1NTS1kZCdUJ0hIOm1tOnNzIikgOiBmb3JtYXQoZGF0ZVRvVGltZVpvbmVEYXRlKG5ldyBEYXRlKCksIF90aGlzNi5ib29raW5nRGV0YWlscy56b25lLnRpbWV6b25lKSwgInl5eXktTU0tZGQnVCdISDptbTpzcyIpOyAvLyBjb25zb2xlLmxvZyh0aGlzLmV4aXRUaW1lU2VsZWN0ZWQ/LmhoKyI6Iit0aGlzLmV4aXRUaW1lU2VsZWN0ZWQubW0rIjowMCIpCiAgICAgICAgICAgICAgICAvLyB0aGlzLmV4aXREYXRlICsgIlQyMzo1OTowMCI7CgogICAgICAgICAgICAgICAgc2VsZWN0ZWRIb3VycyA9IF90aGlzNi50aW1lICE9PSBudWxsICYmIF90aGlzNi50aW1lICE9PSAiIiAmJiBfdGhpczYudGltZSAhPT0gdW5kZWZpbmVkID8gZm9ybWF0KF90aGlzNi50aW1lLCAnSEgnKSA6IGZvcm1hdChkYXRlVG9UaW1lWm9uZURhdGUobmV3IERhdGUoKSwgX3RoaXM2LmJvb2tpbmdEZXRhaWxzLnpvbmUudGltZXpvbmUpLCAnSEgnKTsKICAgICAgICAgICAgICAgIHNlbGVjdGVkTWlucyA9IF90aGlzNi50aW1lICE9PSBudWxsICYmIF90aGlzNi50aW1lICE9PSAiIiAmJiBfdGhpczYudGltZSAhPT0gdW5kZWZpbmVkID8gZm9ybWF0KF90aGlzNi50aW1lLCAnbW0nKSA6IGZvcm1hdChkYXRlVG9UaW1lWm9uZURhdGUobmV3IERhdGUoKSwgX3RoaXM2LmJvb2tpbmdEZXRhaWxzLnpvbmUudGltZXpvbmUpLCAnbW0nKTsKICAgICAgICAgICAgICAgIGV4aXRkYXRlID0gX3RoaXM2LnRpbWUgIT09IG51bGwgJiYgX3RoaXM2LnRpbWUgIT09ICIiICYmIF90aGlzNi50aW1lICE9PSB1bmRlZmluZWQgPyBmb3JtYXQoX3RoaXM2LnRpbWUsICd5eXl5LU1NLWRkJykgOiAiIjsKICAgICAgICAgICAgICAgIGV4aXR0aW1lID0gT2JqZWN0Lmhhc093blByb3BlcnR5LmNhbGwoX3RoaXM2LmJvb2tpbmdEZXRhaWxzLCAnem9uZScpICYmIE9iamVjdC5oYXNPd25Qcm9wZXJ0eS5jYWxsKF90aGlzNi5ib29raW5nRGV0YWlscy56b25lLCAndGltZVBpY2tlckNvbmZpZ3VyYXRpb24nKSAmJiAoKF90aGlzNiRib29raW5nRGV0YWlsczMgPSBfdGhpczYuYm9va2luZ0RldGFpbHMpID09PSBudWxsIHx8IF90aGlzNiRib29raW5nRGV0YWlsczMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IChfdGhpczYkYm9va2luZ0RldGFpbHM0ID0gX3RoaXM2JGJvb2tpbmdEZXRhaWxzMy56b25lKSA9PT0gbnVsbCB8fCBfdGhpczYkYm9va2luZ0RldGFpbHM0ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfdGhpczYkYm9va2luZ0RldGFpbHM0LnRpbWVQaWNrZXJDb25maWd1cmF0aW9uKSA9PSAnMScgPyAnVCcgKyBzZWxlY3RlZEhvdXJzICsgIjoiICsgc2VsZWN0ZWRNaW5zICsgIjowMCIgOiAiVDIzOjU5OjAwIjsKICAgICAgICAgICAgICAgIHN0b3BEYXRlID0gZXhpdGRhdGUgKyBleGl0dGltZTsKICAgICAgICAgICAgICAgIGRhdGEgPSB7CiAgICAgICAgICAgICAgICAgIHN0YXJ0QXQ6IF90aGlzNi5zdGFydERhdGUsCiAgICAgICAgICAgICAgICAgIHN0b3BBdDogc3RvcERhdGUsCiAgICAgICAgICAgICAgICAgIHpjb2RlOiAoX3RoaXM2JGJvb2tpbmdEZXRhaWxzNSA9IF90aGlzNi5ib29raW5nRGV0YWlscykgPT09IG51bGwgfHwgX3RoaXM2JGJvb2tpbmdEZXRhaWxzNSA9PT0gdm9pZCAwID8gdm9pZCAwIDogKF90aGlzNiRib29raW5nRGV0YWlsczYgPSBfdGhpczYkYm9va2luZ0RldGFpbHM1LnpvbmUpID09PSBudWxsIHx8IF90aGlzNiRib29raW5nRGV0YWlsczYgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF90aGlzNiRib29raW5nRGV0YWlsczYuemNvZGUKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBfdGhpczYuYWRkUGF5bWVudEJ0bkxvYWRpbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSAxNTsKICAgICAgICAgICAgICAgIHJldHVybiBBUElIZWxwZXIoIlBPU1QiLCAiL2FwaS92Mi9nZXRSYXRlIiwgZGF0YSk7CgogICAgICAgICAgICAgIGNhc2UgMTU6CiAgICAgICAgICAgICAgICBnZXRSYXRlID0gX2NvbnRleHQ2LnNlbnQ7CiAgICAgICAgICAgICAgICBfdGhpczYuZXh0ZW5kQnRuTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgX3RoaXM2LmV4dERhdGVBbmRUaW1lID0gc3RvcERhdGU7IC8vY29uZGl0aW9uIHRvIGNoZWNrIGlmIHRoZSBkYXRlIHRpbWUgc2VsZWN0ZWQgaXMgbGVzc2VyIHRoYW4gY3VycmVudCB0aW1lCgogICAgICAgICAgICAgICAgaWYgKCEoZ2V0UmF0ZSAhPT0gbnVsbCAmJiBnZXRSYXRlICE9PSB2b2lkIDAgJiYgKF9nZXRSYXRlJGRhdGE0ID0gZ2V0UmF0ZS5kYXRhKSAhPT0gbnVsbCAmJiBfZ2V0UmF0ZSRkYXRhNCAhPT0gdm9pZCAwICYmIF9nZXRSYXRlJGRhdGE0LnN0YXR1cykgJiYgIV90aGlzNi5nZXRSYXRlQ2FsbCkgewogICAgICAgICAgICAgICAgICBfdGhpczYuZGlzYWJsZUFkZFBheW1lbnRCdG4gPSB0cnVlOwogICAgICAgICAgICAgICAgICBfdGhpczYuYWxlcnREaWFsb2cgPSB0cnVlOwogICAgICAgICAgICAgICAgICBfdGhpczYuYWxlcnRNc2cgPSAoZ2V0UmF0ZSA9PT0gbnVsbCB8fCBnZXRSYXRlID09PSB2b2lkIDAgPyB2b2lkIDAgOiAoX2dldFJhdGUkZGF0YTUgPSBnZXRSYXRlLmRhdGEpID09PSBudWxsIHx8IF9nZXRSYXRlJGRhdGE1ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZ2V0UmF0ZSRkYXRhNS5tZXNzYWdlKSB8fCAiRXJyb3IgaW4gZ2V0dGluZyByYXRlIGRldGFpbHMiOwogICAgICAgICAgICAgICAgICBfdGhpczYub3BlbkRhdGVQaWNrZXIgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgX3RoaXM2Lm9wZW5UaW1lUGlja2VyID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgIEV2ZW50QnVzLiRlbWl0KCdkYXRldGltZS1zZXQnKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIF90aGlzNi5kaXNhYmxlQWRkUGF5bWVudEJ0biA9IGZhbHNlOwogICAgICAgICAgICAgICAgICBfdGhpczYub3BlbkRhdGVQaWNrZXIgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgX3RoaXM2Lm9wZW5UaW1lUGlja2VyID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgIEV2ZW50QnVzLiRlbWl0KCdkYXRldGltZS1zZXQnKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfdGhpczYuZXN0aW1hdGUgPSBPYmplY3QuYXNzaWduKHt9LCBnZXRSYXRlID09PSBudWxsIHx8IGdldFJhdGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IChfZ2V0UmF0ZSRkYXRhNiA9IGdldFJhdGUuZGF0YSkgPT09IG51bGwgfHwgX2dldFJhdGUkZGF0YTYgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9nZXRSYXRlJGRhdGE2LmRhdGEpOyAvLyBlc3RpbWF0ZWRWYWwgIT0gIiIgJiYKICAgICAgICAgICAgICAgIC8vIGVzdGltYXRlZFZhbCAhPSBudWxsICYmCiAgICAgICAgICAgICAgICAvLyBlc3RpbWF0ZWRWYWwgIT0gdW5kZWZpbmVkCiAgICAgICAgICAgICAgICAvLyAgID8gTnVtYmVyKGVzdGltYXRlZFZhbCkudG9GaXhlZCgyKQogICAgICAgICAgICAgICAgLy8gICA6IGVzdGltYXRlZFZhbDsKCiAgICAgICAgICAgICAgICBfdGhpczYuYWRkUGF5bWVudEJ0bkxvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gMjc7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAyMzoKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5wcmV2ID0gMjM7CiAgICAgICAgICAgICAgICBfY29udGV4dDYudDAgPSBfY29udGV4dDZbImNhdGNoIl0oMyk7CiAgICAgICAgICAgICAgICBfdGhpczYuYWRkUGF5bWVudEJ0bkxvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKF9jb250ZXh0Ni50MCk7CgogICAgICAgICAgICAgIGNhc2UgMjc6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDYuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTYsIG51bGwsIFtbMywgMjNdXSk7CiAgICAgIH0pKSgpOwogICAgfSwKICAgIGNhbGN1bGF0ZUV4aXREYXRlVGltZTogZnVuY3Rpb24gY2FsY3VsYXRlRXhpdERhdGVUaW1lKCkgewogICAgICB2YXIgX3RoaXMkYm9va2luZ0RldGFpbHM3MSwgX3RoaXMkYm9va2luZ0RldGFpbHM3MjsKCiAgICAgIGlmICgoX3RoaXMkYm9va2luZ0RldGFpbHM3MSA9IHRoaXMuYm9va2luZ0RldGFpbHMpICE9PSBudWxsICYmIF90aGlzJGJvb2tpbmdEZXRhaWxzNzEgIT09IHZvaWQgMCAmJiAoX3RoaXMkYm9va2luZ0RldGFpbHM3MiA9IF90aGlzJGJvb2tpbmdEZXRhaWxzNzEuem9uZSkgIT09IG51bGwgJiYgX3RoaXMkYm9va2luZ0RldGFpbHM3MiAhPT0gdm9pZCAwICYmIF90aGlzJGJvb2tpbmdEZXRhaWxzNzIudGltZXpvbmUpIHsKICAgICAgICAvLyAgIHZhciBjdXJyZW50VGltZSA9CiAgICAgICAgLy8gbmV3IERhdGUoKS5nZXRUaW1lKCkgKwogICAgICAgIC8vIChOdW1iZXIodGhpcy5ib29raW5nRGV0YWlscy56b25lLnRpbWV6b25lb2Zmc2V0KSAqIDEwMDAgKwogICAgICAgIC8vICAgTnVtYmVyKHRoaXMuYm9va2luZ0RldGFpbHMuem9uZS50aW1lem9uZWRzdG9mZnNldCkgKiAxMDAwKTsKICAgICAgICB2YXIgY3VycmVudFRpbWUgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKSArIChOdW1iZXIodGhpcy5ib29raW5nRGV0YWlscy56b25lLnRpbWV6b25lb2Zmc2V0KSAqIDEwMDAgKyBOdW1iZXIodGhpcy5ib29raW5nRGV0YWlscy56b25lLnRpbWV6b25lZHN0b2Zmc2V0KSAqIDEwMDApOwogICAgICAgIHZhciBleGl0VGltZSA9IG5ldyBEYXRlKHRoaXMuYm9va2luZ0RldGFpbHMuYm9va2luZy5yZXNlcnZhdGlvbkVuZERhdGUpLmdldFRpbWUoKTsKICAgICAgICB0aGlzLiRzdG9yZS5jb21taXQoIlNFVF9FWElUX1RJTUVfVElNRV9TVEFUVVMiLCB0aGlzLmV4aXREYXRlVGltZSA8IDApOwogICAgICAgIGV4aXRUaW1lIC0gY3VycmVudFRpbWUgPCAwID8gY2xlYXJJbnRlcnZhbCh0aGlzLmV4aXRJbnRlcnZhbCkgOiAiIjsKICAgICAgICByZXR1cm4gZXhpdFRpbWUgLSBjdXJyZW50VGltZTsKICAgICAgfQoKICAgICAgcmV0dXJuIDA7CiAgICB9LAogICAgaG90ZWxHdWVzdDogZnVuY3Rpb24gaG90ZWxHdWVzdCgpIHsKICAgICAgdmFyIF90aGlzJGJvb2tpbmdEZXRhaWxzNzMsIF90aGlzJGJvb2tpbmdEZXRhaWxzNzQsIF90aGlzJGJvb2tpbmdEZXRhaWxzNzUsIF90aGlzJGJvb2tpbmdEZXRhaWxzNzYsIF90aGlzJGJvb2tpbmdEZXRhaWxzNzcsIF90aGlzJGJvb2tpbmdEZXRhaWxzNzgsIF90aGlzJGJvb2tpbmdEZXRhaWxzNzksIF90aGlzJGJvb2tpbmdEZXRhaWxzODAsIF90aGlzJGJvb2tpbmdEZXRhaWxzODEsIF90aGlzJGJvb2tpbmdEZXRhaWxzODI7CgogICAgICB2YXIgdXJsID0gd2luZG93LmxvY2F0aW9uLm9yaWdpbiArICc/emNvZGU9JyArICgoX3RoaXMkYm9va2luZ0RldGFpbHM3MyA9IHRoaXMuYm9va2luZ0RldGFpbHMpID09PSBudWxsIHx8IF90aGlzJGJvb2tpbmdEZXRhaWxzNzMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IChfdGhpcyRib29raW5nRGV0YWlsczc0ID0gX3RoaXMkYm9va2luZ0RldGFpbHM3My56b25lKSA9PT0gbnVsbCB8fCBfdGhpcyRib29raW5nRGV0YWlsczc0ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfdGhpcyRib29raW5nRGV0YWlsczc0LmxvY2F0aW9uQ29kZSkgKyAnIy9jcmVhdGVzZXNzaW9uJzsKICAgICAgdmFyIHBsYXRlID0gKChfdGhpcyRib29raW5nRGV0YWlsczc1ID0gdGhpcy5ib29raW5nRGV0YWlscykgPT09IG51bGwgfHwgX3RoaXMkYm9va2luZ0RldGFpbHM3NSA9PT0gdm9pZCAwID8gdm9pZCAwIDogKF90aGlzJGJvb2tpbmdEZXRhaWxzNzYgPSBfdGhpcyRib29raW5nRGV0YWlsczc1LmJvb2tpbmcpID09PSBudWxsIHx8IF90aGlzJGJvb2tpbmdEZXRhaWxzNzYgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF90aGlzJGJvb2tpbmdEZXRhaWxzNzYudmVoaWNsZU5vKSB8fCAiIjsKICAgICAgdmFyIHBob25lID0gKChfdGhpcyRib29raW5nRGV0YWlsczc3ID0gdGhpcy5ib29raW5nRGV0YWlscykgPT09IG51bGwgfHwgX3RoaXMkYm9va2luZ0RldGFpbHM3NyA9PT0gdm9pZCAwID8gdm9pZCAwIDogKF90aGlzJGJvb2tpbmdEZXRhaWxzNzggPSBfdGhpcyRib29raW5nRGV0YWlsczc3LnVzZXIpID09PSBudWxsIHx8IF90aGlzJGJvb2tpbmdEZXRhaWxzNzggPT09IHZvaWQgMCA/IHZvaWQgMCA6IF90aGlzJGJvb2tpbmdEZXRhaWxzNzguY29udGFjdCkgfHwgIiI7CiAgICAgIHZhciBiaWQgPSAoKF90aGlzJGJvb2tpbmdEZXRhaWxzNzkgPSB0aGlzLmJvb2tpbmdEZXRhaWxzKSA9PT0gbnVsbCB8fCBfdGhpcyRib29raW5nRGV0YWlsczc5ID09PSB2b2lkIDAgPyB2b2lkIDAgOiAoX3RoaXMkYm9va2luZ0RldGFpbHM4MCA9IF90aGlzJGJvb2tpbmdEZXRhaWxzNzkuYm9va2luZykgPT09IG51bGwgfHwgX3RoaXMkYm9va2luZ0RldGFpbHM4MCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3RoaXMkYm9va2luZ0RldGFpbHM4MC5iaWQpIHx8ICIiOwogICAgICB2YXIgY2hlY2tpbmRhdGUgPSAoKF90aGlzJGJvb2tpbmdEZXRhaWxzODEgPSB0aGlzLmJvb2tpbmdEZXRhaWxzKSA9PT0gbnVsbCB8fCBfdGhpcyRib29raW5nRGV0YWlsczgxID09PSB2b2lkIDAgPyB2b2lkIDAgOiAoX3RoaXMkYm9va2luZ0RldGFpbHM4MiA9IF90aGlzJGJvb2tpbmdEZXRhaWxzODEuYm9va2luZykgPT09IG51bGwgfHwgX3RoaXMkYm9va2luZ0RldGFpbHM4MiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3RoaXMkYm9va2luZ0RldGFpbHM4Mi5lbnRyeXRpbWUpIHx8ICIiOwogICAgICB2YXIgcGFyYW1zID0gJy8/cGhvbmU9JyArIHBob25lICsgJyZiaWQ9JyArIGJpZCArICcmcGxhdGU9JyArIHBsYXRlICsgJyZlbnRyeXRpbWU9JyArIGNoZWNraW5kYXRlOwogICAgICB3aW5kb3cubG9jYXRpb24ucmVwbGFjZSh1cmwgKyBwYXJhbXMpOyAvLyB0aGlzLiRyb3V0ZXIucmVwbGFjZSh7cGF0aDonLyd9KTsKICAgIH0sCiAgICBjbG9zZVFSQ29kZURpYWxvZzogZnVuY3Rpb24gY2xvc2VRUkNvZGVEaWFsb2coKSB7CiAgICAgIHRoaXMucXJDb2RlRGlhbG9nID0gZmFsc2U7CiAgICAgIHRoaXMuY2FtZXJhU3RhdHVzID0gZmFsc2U7CiAgICB9LAogICAgY2xvc2VWYWxpZGF0aW9uUVJEaWFsb2c6IGZ1bmN0aW9uIGNsb3NlVmFsaWRhdGlvblFSRGlhbG9nKCkgewogICAgICB0aGlzLnZhbGlkYXRpb25DYW1lcmFTdGF0dXMgPSBmYWxzZTsKICAgICAgdGhpcy52YWxpZGF0ZUJvb2tpbmdEaWFsb2cgPSB0cnVlOwogICAgICB0aGlzLnZhbGlkYXRlUVJDb2RlRGlhbG9nID0gZmFsc2U7CiAgICB9LAogICAgcmVTY2FuUVI6IGZ1bmN0aW9uIHJlU2NhblFSKCkgewogICAgICB0aGlzLmludmFsaWRRUkRpYWxvZyA9IGZhbHNlOwogICAgICB0aGlzLmNhbWVyYVN0YXR1cyA9IHRydWU7CiAgICB9LAogICAgcmVTY2FuVmFsaWRhdGlvblFSOiBmdW5jdGlvbiByZVNjYW5WYWxpZGF0aW9uUVIoKSB7CiAgICAgIHRoaXMuaW52YWxpZFZhbGlkYXRpb25RUkRpYWxvZyA9IGZhbHNlOwogICAgICB0aGlzLnZhbGlkYXRpb25DYW1lcmFTdGF0dXMgPSB0cnVlOwogICAgfSwKICAgIG9wZW5TbXNRclNjYW5uZXI6IGZ1bmN0aW9uIG9wZW5TbXNRclNjYW5uZXIoKSB7CiAgICAgIHRoaXMucXJDb2RlRGlhbG9nID0gdHJ1ZTsKICAgICAgdGhpcy5jYW1lcmFTdGF0dXMgPSB0cnVlOwogICAgfSwKICAgIG9wZW5TTVNEaWFsb2c6IGZ1bmN0aW9uIG9wZW5TTVNEaWFsb2coKSB7CiAgICAgIHZhciBfdGhpcyRib29raW5nRGV0YWlsczgzLCBfdGhpcyRib29raW5nRGV0YWlsczg0OwoKICAgICAgdGhpcy5zbXNEaWFsb2cgPSB0cnVlOwogICAgICB2YXIgZXhpdExhbmVzID0gdGhpcy5leGl0R2F0ZUNvZGVzLmxlbmd0aCA+IDAgPyB0aGlzLmV4aXRHYXRlQ29kZXMuZmlsdGVyKGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIGEuaXNQZWRlc3RyaWFuID09ICIwIjsKICAgICAgfSkgOiBbXTsKCiAgICAgIGlmICgoX3RoaXMkYm9va2luZ0RldGFpbHM4MyA9IHRoaXMuYm9va2luZ0RldGFpbHMpICE9PSBudWxsICYmIF90aGlzJGJvb2tpbmdEZXRhaWxzODMgIT09IHZvaWQgMCAmJiAoX3RoaXMkYm9va2luZ0RldGFpbHM4NCA9IF90aGlzJGJvb2tpbmdEZXRhaWxzODMuYm9va2luZykgIT09IG51bGwgJiYgX3RoaXMkYm9va2luZ0RldGFpbHM4NCAhPT0gdm9pZCAwICYmIF90aGlzJGJvb2tpbmdEZXRhaWxzODQucHJlUG9wdWxhdGVHYXRlQ29kZXMgJiYgdGhpcy5ib29raW5nRGV0YWlscy5ib29raW5nLnByZVBvcHVsYXRlR2F0ZUNvZGVzID09ICIxIikgewogICAgICAgIHRoaXMuc21zVGV4dCA9IGV4aXRMYW5lcy5sZW5ndGggPT0gMSA/IGV4aXRMYW5lc1swXS5zbXNfY29kZSA6ICIiOwogICAgICB9CiAgICB9LAogICAgc2Nyb2xsVG9TdWJtaXQ6IGZ1bmN0aW9uIHNjcm9sbFRvU3VibWl0KCkgewogICAgICB2YXIgZWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjc3VibWl0c21zYnRuIik7CgogICAgICBpZiAoZWwpIHsKICAgICAgICBlbC5zY3JvbGxJbnRvVmlldyh0aGlzLm9wdGlvbnMpOwogICAgICB9CiAgICB9LAogICAgc2Nyb2xsVG9WYWxpZGF0ZUJ0bjogZnVuY3Rpb24gc2Nyb2xsVG9WYWxpZGF0ZUJ0bigpIHsKICAgICAgdmFyIGVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI3ZhbGlkYXRlYm9va2luZ2J0biIpOwoKICAgICAgaWYgKGVsKSB7CiAgICAgICAgZWwuc2Nyb2xsSW50b1ZpZXcodGhpcy5vcHRpb25zKTsKICAgICAgfQogICAgfSwKICAgIGNhbGN1bGF0ZUdyYWNlUGVyaW9kVGltZTogZnVuY3Rpb24gY2FsY3VsYXRlR3JhY2VQZXJpb2RUaW1lKCkgewogICAgICB2YXIgY3VycmVudFRpbWUgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKSArIChOdW1iZXIodGhpcy5ib29raW5nRGV0YWlscy56b25lLnRpbWV6b25lb2Zmc2V0KSAqIDEwMDAgKyBOdW1iZXIodGhpcy5ib29raW5nRGV0YWlscy56b25lLnRpbWV6b25lZHN0b2Zmc2V0KSAqIDEwMDApOwogICAgICB2YXIgZ3JhY2VQZXJpb2RUaW1lID0gKE51bWJlcih0aGlzLmJvb2tpbmdEZXRhaWxzLmJvb2tpbmcuZW50cnl0aW1lKSArIE51bWJlcih0aGlzLmJvb2tpbmdEZXRhaWxzLmJvb2tpbmcuZ3JhY2VQZXJpb2QpKSAqIDEwMDA7IC8vCgogICAgICB0aGlzLiRzdG9yZS5jb21taXQoIlNFVF9HUkFDRV9QRVJJT0RfVElNRV9TVEFUVVMiLCB0aGlzLmdyYWNlUGVyaW9kVGltZSA8PSAwKTsKICAgICAgcmV0dXJuIGdyYWNlUGVyaW9kVGltZSAtIGN1cnJlbnRUaW1lOwogICAgfSwKICAgIGNhbGN1bGF0ZVZhbGlkYXRlZFRpbWU6IGZ1bmN0aW9uIGNhbGN1bGF0ZVZhbGlkYXRlZFRpbWUoKSB7CiAgICAgIHZhciBjdXJyZW50VGltZSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpICsgKE51bWJlcih0aGlzLmJvb2tpbmdEZXRhaWxzLnpvbmUudGltZXpvbmVvZmZzZXQpICogMTAwMCArIE51bWJlcih0aGlzLmJvb2tpbmdEZXRhaWxzLnpvbmUudGltZXpvbmVkc3RvZmZzZXQpICogMTAwMCk7CiAgICAgIHZhciB2YWxpZGF0ZWRUaW1lID0gdGhpcy5ib29raW5nRGV0YWlscy5ib29raW5nLnR5cGUgPT0gIjEzIiA/IChOdW1iZXIodGhpcy5ib29raW5nRGV0YWlscy5ib29raW5nLnJldlN0YXJ0KSArIE51bWJlcih0aGlzLmJvb2tpbmdEZXRhaWxzLmJvb2tpbmcuY291cG9uVmFsaWRUaW1lKSkgKiAxMDAwIDogKE51bWJlcih0aGlzLmJvb2tpbmdEZXRhaWxzLmJvb2tpbmcuZW50cnl0aW1lKSArIE51bWJlcih0aGlzLmJvb2tpbmdEZXRhaWxzLmJvb2tpbmcuY291cG9uVmFsaWRUaW1lKSkgKiAxMDAwOwogICAgICB0aGlzLiRzdG9yZS5jb21taXQoIlNFVF9WQUxJREFURURfVElNRV9TVEFUVVMiLCB0aGlzLnZhbGlkYXRlZFRpbWUgPCAwKTsKICAgICAgdmFsaWRhdGVkVGltZSAtIGN1cnJlbnRUaW1lIDwgMCA/IGNsZWFySW50ZXJ2YWwodGhpcy52YWxpZGF0ZWRJbnRlcnZhbCkgOiAiIjsKICAgICAgcmV0dXJuIHZhbGlkYXRlZFRpbWUgLSBjdXJyZW50VGltZTsKICAgIH0sCiAgICBjYWxjdWxhdGVQYXJraW5nVGltZTogZnVuY3Rpb24gY2FsY3VsYXRlUGFya2luZ1RpbWUocGFya2luZ1N0YXJ0VGltZSwgZ3JhY2VQZXJpb2QsIHpvbmUpIHsKICAgICAgdmFyIGN1cnJlbnRUaW1lID0gbmV3IERhdGUoKTsKICAgICAgY3VycmVudFRpbWUudG9Mb2NhbGVTdHJpbmcoImVuLVVTIiwgewogICAgICAgIHRpbWVab25lOiB6b25lCiAgICAgIH0pOwogICAgICB2YXIgZGlmZmVyZW5jZVRpbWUgPSBncmFjZVBlcmlvZCA+IDAgPyBjdXJyZW50VGltZS5nZXRUaW1lKCkgLSBwYXJraW5nU3RhcnRUaW1lICogMTAwMCAvLyAtIGdyYWNlUGVyaW9kICogMTAwMCB0byBleGNsdWRlIGdyYWNlIHBlcmlvZAogICAgICA6IGN1cnJlbnRUaW1lLmdldFRpbWUoKSAtIHBhcmtpbmdTdGFydFRpbWUgKiAxMDAwOwogICAgICB2YXIgcGFya2VkVGltZSA9IHRoaXMuc2Vjb25kc1RvSG1zKGRpZmZlcmVuY2VUaW1lIC8gMTAwMCk7CiAgICAgIHJldHVybiBwYXJrZWRUaW1lOwogICAgfSwKICAgIHNlY29uZHNUb0htczogZnVuY3Rpb24gc2Vjb25kc1RvSG1zKHRpbWVEaWZmZXJlbmNlKSB7CiAgICAgIHZhciBkID0gTnVtYmVyKHRpbWVEaWZmZXJlbmNlKTsgLy8gaWYgKHRpbWVEaWZmZXJlbmNlID49IDg2NDAwKSB7CiAgICAgIC8vICAgdmFyIGRheXMgPSBNYXRoLmZsb29yKGQgLyA4NjQwMCk7CiAgICAgIC8vICAgdmFyIGhycyA9IE1hdGguZmxvb3IoKGQgJSA4NjQwMCkgLyAzNjAwKTsKICAgICAgLy8gICB2YXIgZGF5RGlzcGxheSA9CiAgICAgIC8vICAgICBkYXlzID4gMCA/IGRheXMgKyAoZGF5cyA9PSAxID8gIiBkYXkgIiA6ICIgZGF5cyAiKSA6ICIiOwogICAgICAvLyAgIHZhciBockRpc3BsYXkgPSBocnMgPiAwID8gaHJzICsgKGhycyA9PSAxID8gIiBociAiIDogIiBocnMgIikgOiAiIjsKICAgICAgLy8gICByZXR1cm4gZGF5RGlzcGxheSArIGhyRGlzcGxheTsKICAgICAgLy8gfQoKICAgICAgdmFyIGggPSBNYXRoLmZsb29yKGQgLyAzNjAwKTsKICAgICAgdmFyIG0gPSBNYXRoLmZsb29yKGQgJSAzNjAwIC8gNjApOyAvLyB2YXIgcyA9IE1hdGguZmxvb3IoZCAlIDM2MDAgJSA2MCk7CgogICAgICB2YXIgaERpc3BsYXkgPSBoID4gMCA/IGggKyAiIGggIiA6ICIiOwogICAgICB2YXIgbURpc3BsYXkgPSBtID4gMCA/IG0gKyAobSA9PSAxID8gIiBtaW4gIiA6ICIgbWluIikgOiAiIDAgbWluIjsgLy8gdmFyIHNEaXNwbGF5ID0gcyA+IDAgPyBzICsgKHMgPT0gMSA/ICIgc2Vjb25kIiA6ICIgc2Vjb25kcyIpIDogIiI7CgogICAgICByZXR1cm4gaERpc3BsYXkgKyBtRGlzcGxheTsKICAgIH0sCiAgICBpc0NoZWNrb3V0RW5hYmxlZDogZnVuY3Rpb24gaXNDaGVja291dEVuYWJsZWQodHlwZSkgewogICAgICBpZiAoT2JqZWN0Lmhhc093blByb3BlcnR5LmNhbGwodGhpcy5ib29raW5nRGV0YWlscywgJ2V4aXRPcHRpb25zJykgJiYgdGhpcy5ib29raW5nRGV0YWlscy5leGl0T3B0aW9ucy5sZW5ndGggIT0gMCkgewogICAgICAgIHZhciBvcHRpb24gPSB0aGlzLmJvb2tpbmdEZXRhaWxzLmV4aXRPcHRpb25zLnNvbWUoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHJldHVybiB0LnRlY2hUeXBlID09IHR5cGU7CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIG9wdGlvbjsKICAgICAgfQoKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfSwKICAgIGdldEJvb2tpbmdEZXRhaWxzOiBmdW5jdGlvbiBnZXRCb29raW5nRGV0YWlscygpIHsKICAgICAgdmFyIF90aGlzNyA9IHRoaXM7CgogICAgICByZXR1cm4gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNygpIHsKICAgICAgICB2YXIgX2Jvb2tpbmdEZXRhaWxzJGRhdGEsIGJvb2tpbmdJZCwgYm9va2luZ0RldGFpbHM7CgogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNyQoX2NvbnRleHQ3KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Ny5wcmV2ID0gX2NvbnRleHQ3Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBfY29udGV4dDcucHJldiA9IDA7CiAgICAgICAgICAgICAgICBib29raW5nSWQgPSB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUuc3Vic3RyaW5nKDMpOwogICAgICAgICAgICAgICAgX2NvbnRleHQ3Lm5leHQgPSA0OwogICAgICAgICAgICAgICAgcmV0dXJuIEFQSUhlbHBlcigiR0VUIiwgIi9hcGkvdjEvYm9va2luZy9jb25maWcvIiArIGJvb2tpbmdJZCk7CgogICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgIGJvb2tpbmdEZXRhaWxzID0gX2NvbnRleHQ3LnNlbnQ7CgogICAgICAgICAgICAgICAgX3RoaXM3LiRzdG9yZS5jb21taXQoIlNFVF9CT09LSU5HX0RFVEFJTFMiLCAoX2Jvb2tpbmdEZXRhaWxzJGRhdGEgPSBib29raW5nRGV0YWlscy5kYXRhKSAhPT0gbnVsbCAmJiBfYm9va2luZ0RldGFpbHMkZGF0YSAhPT0gdm9pZCAwICYmIF9ib29raW5nRGV0YWlscyRkYXRhLmRhdGEgPyBib29raW5nRGV0YWlscy5kYXRhLmRhdGEgOiBudWxsKTsKCiAgICAgICAgICAgICAgICBfY29udGV4dDcubmV4dCA9IDExOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICAgIF9jb250ZXh0Ny5wcmV2ID0gODsKICAgICAgICAgICAgICAgIF9jb250ZXh0Ny50MCA9IF9jb250ZXh0N1siY2F0Y2giXSgwKTsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKF9jb250ZXh0Ny50MCk7CgogICAgICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDcuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTcsIG51bGwsIFtbMCwgOF1dKTsKICAgICAgfSkpKCk7CiAgICB9LAogICAgZ2V0cGVkZXN0cmlhbkFjY2VzczogZnVuY3Rpb24gZ2V0cGVkZXN0cmlhbkFjY2VzcygpIHsKICAgICAgdmFyIF90aGlzOCA9IHRoaXM7CgogICAgICByZXR1cm4gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlOCgpIHsKICAgICAgICB2YXIgX3BlZGVzQWNjZXNzJGRhdGEsIHBlZGVzQWNjZXNzOwoKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTgkKF9jb250ZXh0OCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDgucHJldiA9IF9jb250ZXh0OC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgX2NvbnRleHQ4LnByZXYgPSAwOwogICAgICAgICAgICAgICAgX2NvbnRleHQ4Lm5leHQgPSAzOwogICAgICAgICAgICAgICAgcmV0dXJuIEFQSUhlbHBlcigiUE9TVCIsICJhcGkvdjEvb3Blbi8iICsgX3RoaXM4LmJvb2tpbmdJZCwgewogICAgICAgICAgICAgICAgICBzb3VyY2U6ICJ3ZWJWaWV3IgogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgIHBlZGVzQWNjZXNzID0gX2NvbnRleHQ4LnNlbnQ7CgogICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2cocGVkZXNBY2Nlc3MpCiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhwZWRlc0FjY2Vzcz8uZGF0YT8uc3RhdHVzKQogICAgICAgICAgICAgICAgaWYgKHBlZGVzQWNjZXNzICE9PSBudWxsICYmIHBlZGVzQWNjZXNzICE9PSB2b2lkIDAgJiYgKF9wZWRlc0FjY2VzcyRkYXRhID0gcGVkZXNBY2Nlc3MuZGF0YSkgIT09IG51bGwgJiYgX3BlZGVzQWNjZXNzJGRhdGEgIT09IHZvaWQgMCAmJiBfcGVkZXNBY2Nlc3MkZGF0YS5zdGF0dXMpIHsKICAgICAgICAgICAgICAgICAgX3RoaXM4LnBvc3RUb0xvZ2dlckFQSSh7CiAgICAgICAgICAgICAgICAgICAgcGhvbmU6IF90aGlzOC5ib29raW5nRGV0YWlscy51c2VyLmNvbnRhY3QsCiAgICAgICAgICAgICAgICAgICAgcmVmSWQ6IF90aGlzOC5ib29raW5nSWQsCiAgICAgICAgICAgICAgICAgICAgaW1hZ2U6ICJodHRwczovL3NwcGwtZGV2LmRpdnJ0LmNvL2ltZy9wZWRlc3RyYWluX2Rvb3IuMDQyZjA5MjcucG5nIiwKICAgICAgICAgICAgICAgICAgICBzdGF0dXNUZXh0OiAiUGFya2VyIGFjY2Vzc2VkIHBlZGVzdHJpYW4gZG9vciBzdWNjZXNzZnVsbHkuIgogICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgIF90aGlzOC4kcm91dGVyLnJlcGxhY2UoewogICAgICAgICAgICAgICAgICAgIHBhdGg6ICIvcGVkZXN0cmlhbmFjY2VzcyIKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBfdGhpczgucGVkZXN0cmlhbkFjY2Vzc1RleHQgPSBwZWRlc0FjY2Vzcy5kYXRhLm1lc3NhZ2U7CgogICAgICAgICAgICAgICAgICBfdGhpczgucG9zdFRvTG9nZ2VyQVBJKHsKICAgICAgICAgICAgICAgICAgICBwaG9uZTogX3RoaXM4LmJvb2tpbmdEZXRhaWxzLnVzZXIuY29udGFjdCwKICAgICAgICAgICAgICAgICAgICByZWZJZDogX3RoaXM4LmJvb2tpbmdJZCwKICAgICAgICAgICAgICAgICAgICBlcnJvcjogX3RoaXM4LnBlZGVzdHJpYW5BY2Nlc3NUZXh0LAogICAgICAgICAgICAgICAgICAgIGltYWdlOiAiaHR0cHM6Ly9zcHBsLWRldi5kaXZydC5jby9pbWcvcGVkZXN0cmFpbl9kb29yLjA0MmYwOTI3LnBuZyIsCiAgICAgICAgICAgICAgICAgICAgc3RhdHVzVGV4dDogIkVycm9yIGluIG9wZW5pbmcgdGhlIHBlZGVzdHJpYW4gZG9vci4iCiAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgX3RoaXM4LnBlZGVzdHJpYW5BY2Nlc3NEaWFsb2cgPSB0cnVlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIF9jb250ZXh0OC5uZXh0ID0gMTA7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgX2NvbnRleHQ4LnByZXYgPSA3OwogICAgICAgICAgICAgICAgX2NvbnRleHQ4LnQwID0gX2NvbnRleHQ4WyJjYXRjaCJdKDApOwogICAgICAgICAgICAgICAgY29uc29sZS5sb2coX2NvbnRleHQ4LnQwKTsKCiAgICAgICAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlOCwgbnVsbCwgW1swLCA3XV0pOwogICAgICB9KSkoKTsKICAgIH0sCiAgICBuYXZpZ2F0ZVRvQWRkUGF5bWVudDogZnVuY3Rpb24gbmF2aWdhdGVUb0FkZFBheW1lbnQoKSB7CiAgICAgIHRoaXMucG9zdFRvTG9nZ2VyQVBJKHsKICAgICAgICBwaG9uZTogdGhpcy5ib29raW5nRGV0YWlscy51c2VyLmNvbnRhY3QsCiAgICAgICAgcmVmSWQ6IHRoaXMuYm9va2luZ0lkLAogICAgICAgIHN0YXR1c1RleHQ6ICJQYXJrZXIgY2xpY2tlZCBvbiBBREQgQ1JFRElUIENBUkQgYnRuLiIKICAgICAgfSk7CiAgICAgIHRoaXMuJHJvdXRlci5yZXBsYWNlKHsKICAgICAgICBwYXRoOiAiL2FkZHBheW1lbnQiCiAgICAgIH0pOwogICAgfSwKICAgIG9wZW5WYWxpZGF0aW9uRGlhbG9nOiBmdW5jdGlvbiBvcGVuVmFsaWRhdGlvbkRpYWxvZygpIHsKICAgICAgdGhpcy52YWxpZGF0ZUJvb2tpbmdEaWFsb2cgPSB0cnVlOwogICAgfSwKICAgIG9wZW5TTVNBcHA6IGZ1bmN0aW9uIG9wZW5TTVNBcHAoKSB7CiAgICAgIHZhciBfdGhpczkgPSB0aGlzOwoKICAgICAgcmV0dXJuIF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTkoKSB7CiAgICAgICAgdmFyIF9wcmVWYWxpZGF0ZVNlbmRTTVMkZCwgcHJlVmFsaWRhdGVTZW5kU01TLCBfc2VuZFNNUyRkYXRhLCBzZW5kU01TLCBfc2VuZFNNUyRkYXRhMiwgX3ByZVZhbGlkYXRlU2VuZFNNUyRkMjsKCiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU5JChfY29udGV4dDkpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ5LnByZXYgPSBfY29udGV4dDkubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIF90aGlzOS5wb3N0VG9Mb2dnZXJBUEkoewogICAgICAgICAgICAgICAgICBwaG9uZTogX3RoaXM5LmJvb2tpbmdEZXRhaWxzLnVzZXIuY29udGFjdCwKICAgICAgICAgICAgICAgICAgcmVmSWQ6IF90aGlzOS5ib29raW5nSWQsCiAgICAgICAgICAgICAgICAgIHN0YXR1c1RleHQ6ICJQYXJrZXIgY2xpY2tlZCBvbiBTTVMgc3VibWl0IGJ0bi4iCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBpZiAoIShfdGhpczkuc21zVGV4dCA9PSBudWxsIHx8IF90aGlzOS5zbXNUZXh0ID09ICIiKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDkubmV4dCA9IDY7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIF90aGlzOS5pbnZhbGlkU01TTXNnID0gIkdhdGUgY29kZSBjYW5ub3QgYmUgZW1wdHkiOwogICAgICAgICAgICAgICAgX3RoaXM5LmludmFsaWRTTVNEaWFsb2cgPSB0cnVlOwogICAgICAgICAgICAgICAgX2NvbnRleHQ5Lm5leHQgPSAzNTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgICBfY29udGV4dDkucHJldiA9IDY7CiAgICAgICAgICAgICAgICBfdGhpczkuc21zUGVuZGluZyA9IHRydWU7CiAgICAgICAgICAgICAgICBfY29udGV4dDkubmV4dCA9IDEwOwogICAgICAgICAgICAgICAgcmV0dXJuIEFQSUhlbHBlcigiUE9TVCIsICIvcmVjZWl2ZV9zbXMiLCB7CiAgICAgICAgICAgICAgICAgIGJpZDogX3RoaXM5LmJvb2tpbmdJZCwKICAgICAgICAgICAgICAgICAgRnJvbTogX3RoaXM5LmJvb2tpbmdEZXRhaWxzLnVzZXIuY29udGFjdCwKICAgICAgICAgICAgICAgICAgVGV4dDogX3RoaXM5LnNtc1RleHQsCiAgICAgICAgICAgICAgICAgIFRvOiBfdGhpczkuYm9va2luZ0RldGFpbHMuem9uZS5Ub01vYmlsZU5vLAogICAgICAgICAgICAgICAgICBNb2RlOiAiU01TIiwKICAgICAgICAgICAgICAgICAgd2ViVmlldzogIjEiLAogICAgICAgICAgICAgICAgICBwcmVWYWxpZGF0ZTogMQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgICAgICBwcmVWYWxpZGF0ZVNlbmRTTVMgPSBfY29udGV4dDkuc2VudDsKICAgICAgICAgICAgICAgIF90aGlzOS5zbXNQZW5kaW5nID0gZmFsc2U7CgogICAgICAgICAgICAgICAgaWYgKCEocHJlVmFsaWRhdGVTZW5kU01TICE9PSBudWxsICYmIHByZVZhbGlkYXRlU2VuZFNNUyAhPT0gdm9pZCAwICYmIChfcHJlVmFsaWRhdGVTZW5kU01TJGQgPSBwcmVWYWxpZGF0ZVNlbmRTTVMuZGF0YSkgIT09IG51bGwgJiYgX3ByZVZhbGlkYXRlU2VuZFNNUyRkICE9PSB2b2lkIDAgJiYgX3ByZVZhbGlkYXRlU2VuZFNNUyRkLnN0YXR1cyAmJiBwcmVWYWxpZGF0ZVNlbmRTTVMuZGF0YS5zdGF0dXMpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0OS5uZXh0ID0gMjc7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIF90aGlzOS5zbXNEaWFsb2cgPSBmYWxzZTsKCiAgICAgICAgICAgICAgICBfdGhpczkuJHJvdXRlci5yZXBsYWNlKHsKICAgICAgICAgICAgICAgICAgcGF0aDogIi9zdWNjZXNzIgogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgX2NvbnRleHQ5LnByZXYgPSAxNTsKICAgICAgICAgICAgICAgIF9jb250ZXh0OS5uZXh0ID0gMTg7CiAgICAgICAgICAgICAgICByZXR1cm4gQVBJSGVscGVyKCJQT1NUIiwgIi9yZWNlaXZlX3NtcyIsIHsKICAgICAgICAgICAgICAgICAgYmlkOiBfdGhpczkuYm9va2luZ0lkLAogICAgICAgICAgICAgICAgICBGcm9tOiBfdGhpczkuYm9va2luZ0RldGFpbHMudXNlci5jb250YWN0LAogICAgICAgICAgICAgICAgICBUZXh0OiBfdGhpczkuc21zVGV4dCwKICAgICAgICAgICAgICAgICAgVG86IF90aGlzOS5ib29raW5nRGV0YWlscy56b25lLlRvTW9iaWxlTm8sCiAgICAgICAgICAgICAgICAgIE1vZGU6ICJTTVMiLAogICAgICAgICAgICAgICAgICB3ZWJWaWV3OiAiMSIKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDE4OgogICAgICAgICAgICAgICAgc2VuZFNNUyA9IF9jb250ZXh0OS5zZW50OwoKICAgICAgICAgICAgICAgIGlmIChzZW5kU01TICE9PSBudWxsICYmIHNlbmRTTVMgIT09IHZvaWQgMCAmJiAoX3NlbmRTTVMkZGF0YSA9IHNlbmRTTVMuZGF0YSkgIT09IG51bGwgJiYgX3NlbmRTTVMkZGF0YSAhPT0gdm9pZCAwICYmIF9zZW5kU01TJGRhdGEuc3RhdHVzICYmIHNlbmRTTVMuZGF0YS5zdGF0dXMpIHsKICAgICAgICAgICAgICAgICAgX3RoaXM5LnNtc0RpYWxvZyA9IGZhbHNlOwoKICAgICAgICAgICAgICAgICAgX3RoaXM5LnBvc3RUb0xvZ2dlckFQSSh7CiAgICAgICAgICAgICAgICAgICAgcGhvbmU6IF90aGlzOS5ib29raW5nRGV0YWlscy51c2VyLmNvbnRhY3QsCiAgICAgICAgICAgICAgICAgICAgcmVmSWQ6IF90aGlzOS5ib29raW5nSWQsCiAgICAgICAgICAgICAgICAgICAgaWNvbjogImxvZ291dCIsCiAgICAgICAgICAgICAgICAgICAgc3RhdHVzVGV4dDogIlBhcmtlciBjaGVja2VkIG91dCBzdWNjZXNzZnVsbHkgdXNpbmcgU01TIC0gIiArIF90aGlzOS5zbXNUZXh0CiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgX3RoaXM5LmludmFsaWRTTVNNc2cgPSBzZW5kU01TICE9PSBudWxsICYmIHNlbmRTTVMgIT09IHZvaWQgMCAmJiAoX3NlbmRTTVMkZGF0YTIgPSBzZW5kU01TLmRhdGEpICE9PSBudWxsICYmIF9zZW5kU01TJGRhdGEyICE9PSB2b2lkIDAgJiYgX3NlbmRTTVMkZGF0YTIubWVzc2FnZSA/IHNlbmRTTVMuZGF0YS5tZXNzYWdlIDogIlBsZWFzZSB0cnkgYWdhaW4iOwogICAgICAgICAgICAgICAgICBfdGhpczkuaW52YWxpZFNNU0RpYWxvZyA9IHRydWU7CgogICAgICAgICAgICAgICAgICBfdGhpczkucG9zdFRvTG9nZ2VyQVBJKHsKICAgICAgICAgICAgICAgICAgICBwaG9uZTogX3RoaXM5LmJvb2tpbmdEZXRhaWxzLnVzZXIuY29udGFjdCwKICAgICAgICAgICAgICAgICAgICByZWZJZDogX3RoaXM5LmJvb2tpbmdJZCwKICAgICAgICAgICAgICAgICAgICBlcnJvcjogX3RoaXM5LmludmFsaWRTTVNNc2csCiAgICAgICAgICAgICAgICAgICAgaWNvbjogImxvZ291dCIsCiAgICAgICAgICAgICAgICAgICAgc3RhdHVzVGV4dDogIkVycm9yIG9jY3VyZWQgd2hpbGUgY2hlY2tpbmcgb3V0IHVzaW5nIFNNUyAtICIgKyBfdGhpczkuc21zVGV4dAogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfY29udGV4dDkubmV4dCA9IDI1OwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMjI6CiAgICAgICAgICAgICAgICBfY29udGV4dDkucHJldiA9IDIyOwogICAgICAgICAgICAgICAgX2NvbnRleHQ5LnQwID0gX2NvbnRleHQ5WyJjYXRjaCJdKDE1KTsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKF9jb250ZXh0OS50MCk7CgogICAgICAgICAgICAgIGNhc2UgMjU6CiAgICAgICAgICAgICAgICBfY29udGV4dDkubmV4dCA9IDMwOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMjc6CiAgICAgICAgICAgICAgICBfdGhpczkuaW52YWxpZFNNU01zZyA9IHByZVZhbGlkYXRlU2VuZFNNUyAhPT0gbnVsbCAmJiBwcmVWYWxpZGF0ZVNlbmRTTVMgIT09IHZvaWQgMCAmJiAoX3ByZVZhbGlkYXRlU2VuZFNNUyRkMiA9IHByZVZhbGlkYXRlU2VuZFNNUy5kYXRhKSAhPT0gbnVsbCAmJiBfcHJlVmFsaWRhdGVTZW5kU01TJGQyICE9PSB2b2lkIDAgJiYgX3ByZVZhbGlkYXRlU2VuZFNNUyRkMi5tZXNzYWdlID8gcHJlVmFsaWRhdGVTZW5kU01TLmRhdGEubWVzc2FnZSA6ICJQbGVhc2UgdHJ5IGFnYWluIjsKICAgICAgICAgICAgICAgIF90aGlzOS5pbnZhbGlkU01TRGlhbG9nID0gdHJ1ZTsKCiAgICAgICAgICAgICAgICBfdGhpczkucG9zdFRvTG9nZ2VyQVBJKHsKICAgICAgICAgICAgICAgICAgcGhvbmU6IF90aGlzOS5ib29raW5nRGV0YWlscy51c2VyLmNvbnRhY3QsCiAgICAgICAgICAgICAgICAgIHJlZklkOiBfdGhpczkuYm9va2luZ0lkLAogICAgICAgICAgICAgICAgICBlcnJvcjogX3RoaXM5LmludmFsaWRTTVNNc2csCiAgICAgICAgICAgICAgICAgIGljb246ICJsb2dvdXQiLAogICAgICAgICAgICAgICAgICBzdGF0dXNUZXh0OiAiRXJyb3Igb2NjdXJlZCB3aGlsZSBjaGVja2luZyBvdXQgdXNpbmcgU01TIC0gIiArIF90aGlzOS5zbXNUZXh0CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSAzMDoKICAgICAgICAgICAgICAgIF9jb250ZXh0OS5uZXh0ID0gMzU7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAzMjoKICAgICAgICAgICAgICAgIF9jb250ZXh0OS5wcmV2ID0gMzI7CiAgICAgICAgICAgICAgICBfY29udGV4dDkudDEgPSBfY29udGV4dDlbImNhdGNoIl0oNik7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhfY29udGV4dDkudDEpOwoKICAgICAgICAgICAgICBjYXNlIDM1OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ5LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU5LCBudWxsLCBbWzYsIDMyXSwgWzE1LCAyMl1dKTsKICAgICAgfSkpKCk7CiAgICB9LAogICAgZ2V0TW9iaWxlT3BlcmF0aW5nU3lzdGVtOiBmdW5jdGlvbiBnZXRNb2JpbGVPcGVyYXRpbmdTeXN0ZW0oKSB7CiAgICAgIHZhciB1c2VyQWdlbnQgPSBuYXZpZ2F0b3IudXNlckFnZW50IHx8IG5hdmlnYXRvci52ZW5kb3IgfHwgd2luZG93Lm9wZXJhOyAvLyBXaW5kb3dzIFBob25lIG11c3QgY29tZSBmaXJzdCBiZWNhdXNlIGl0cyBVQSBhbHNvIGNvbnRhaW5zICJBbmRyb2lkIgoKICAgICAgaWYgKC93aW5kb3dzIHBob25lL2kudGVzdCh1c2VyQWdlbnQpKSB7CiAgICAgICAgcmV0dXJuICJXaW5kb3dzIFBob25lIjsKICAgICAgfQoKICAgICAgaWYgKC9hbmRyb2lkL2kudGVzdCh1c2VyQWdlbnQpKSB7CiAgICAgICAgcmV0dXJuICJBbmRyb2lkIjsKICAgICAgfSAvLyBpT1MgZGV0ZWN0aW9uIGZyb206IGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9hLzkwMzk4ODUvMTc3NzEwCgoKICAgICAgaWYgKC9pUGFkfGlQaG9uZXxpUG9kLy50ZXN0KHVzZXJBZ2VudCkgJiYgIXdpbmRvdy5NU1N0cmVhbSkgewogICAgICAgIHJldHVybiAiaU9TIjsKICAgICAgfQoKICAgICAgcmV0dXJuICJ1bmtub3duIjsKICAgIH0sCiAgICBnZXRFeGl0SWNvbjogZnVuY3Rpb24gZ2V0RXhpdEljb24oZXhpdElkKSB7CiAgICAgIHZhciBleGl0RGV0YWlscyA9IHRoaXMuYm9va2luZ0RldGFpbHMuZXhpdE9wdGlvbnMuZmluZChmdW5jdGlvbiAocCkgewogICAgICAgIHJldHVybiBwLnRlY2hUeXBlID09IGV4aXRJZDsKICAgICAgfSk7CiAgICAgIHJldHVybiBleGl0RGV0YWlscy5pY29uOwogICAgfSwKICAgIGdldEV4aXRUZXh0OiBmdW5jdGlvbiBnZXRFeGl0VGV4dChleGl0SWQpIHsKICAgICAgdmFyIGV4aXREZXRhaWxzID0gdGhpcy5ib29raW5nRGV0YWlscy5leGl0T3B0aW9ucy5maW5kKGZ1bmN0aW9uIChwKSB7CiAgICAgICAgcmV0dXJuIHAudGVjaFR5cGUgPT0gZXhpdElkOwogICAgICB9KTsKICAgICAgcmV0dXJuIGV4aXREZXRhaWxzLm5hbWU7CiAgICB9LAogICAgb3BlbkRpYWxlckFwcDogZnVuY3Rpb24gb3BlbkRpYWxlckFwcCgpIHsKICAgICAgdGhpcy5wb3N0VG9Mb2dnZXJBUEkoewogICAgICAgIHBob25lOiB0aGlzLmJvb2tpbmdEZXRhaWxzLnVzZXIuY29udGFjdCwKICAgICAgICByZWZJZDogdGhpcy5ib29raW5nSWQsCiAgICAgICAgc3RhdHVzVGV4dDogIlBhcmtlciBjbGlja2VkIG9uIGRpYWxlciBzdWJtaXQgYnRuLiIKICAgICAgfSk7CiAgICAgIHRoaXMuZGlhbGVyRGlhbG9nID0gZmFsc2U7CiAgICAgIHZhciB1cmwgPSAidGVsOiIgKyB0aGlzLmJvb2tpbmdEZXRhaWxzLnpvbmUuVG9Nb2JpbGVObzsKICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSB1cmw7CgogICAgICBpZiAodGhpcy5nZXRNb2JpbGVPcGVyYXRpbmdTeXN0ZW0oKSA9PSAiQW5kcm9pZCIpIHsKICAgICAgICB3aW5kb3cuY2xvc2UoKTsKICAgICAgfQogICAgfSwKICAgIHR1cm5DYW1lcmFPbjogZnVuY3Rpb24gdHVybkNhbWVyYU9uKCkgewogICAgICB0aGlzLmNhbWVyYSA9ICJhdXRvIjsKICAgIH0sCiAgICB0dXJuQ2FtZXJhT2ZmOiBmdW5jdGlvbiB0dXJuQ2FtZXJhT2ZmKCkgewogICAgICB0aGlzLmNhbWVyYSA9ICJvZmYiOwogICAgfSwKICAgIHZhbGlkYXRlRGVjb2RlZFN0cmluZzogZnVuY3Rpb24gdmFsaWRhdGVEZWNvZGVkU3RyaW5nKHN0cikgewogICAgICB2YXIgdmFsaWRhdGVEaXZydFN0ciA9IHN0ci5zdGFydHNXaXRoKCJkaXZydDovLyIpOwogICAgICB2YXIgdmFsaWRhdGVNTUlEID0gc3RyLnNwbGl0KCIvIilbMl0gPT0gdGhpcy5ib29raW5nRGV0YWlscy5ib29raW5nLm1taWQ7CiAgICAgIHZhciB2YWxpZGF0ZU1ham9ySWQgPSBzdHIuc3BsaXQoIi8iKVszXSA9PSB0aGlzLmJvb2tpbmdEZXRhaWxzLmJvb2tpbmcubWFqb3JpZDsKICAgICAgdmFyIHZhbGlkYXRlTWlub3JJZCA9IHRoaXMuYm9va2luZ0RldGFpbHMuYm9va2luZy5taW5vcl9pZHMuaW5jbHVkZXMoc3RyLnNwbGl0KCIvIilbNF0pOwogICAgICByZXR1cm4gdmFsaWRhdGVEaXZydFN0ciAmJiB2YWxpZGF0ZU1NSUQgJiYgdmFsaWRhdGVNYWpvcklkICYmIHZhbGlkYXRlTWlub3JJZDsKICAgIH0sCiAgICBvbkRlY29kZTogZnVuY3Rpb24gb25EZWNvZGUoZGVjb2RlZFN0cmluZykgewogICAgICB2YXIgX3RoaXMxMCA9IHRoaXM7CgogICAgICByZXR1cm4gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMTAoKSB7CiAgICAgICAgdmFyIHNlbGYsIHByZVZhbGlkYXRlUXJSZXN1bHQsIHFyUmVzdWx0LCBfcXJSZXN1bHQkZGF0YSwgX3ByZVZhbGlkYXRlUXJSZXN1bHQkOwoKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTEwJChfY29udGV4dDEwKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MTAucHJldiA9IF9jb250ZXh0MTAubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIHNlbGYgPSBfdGhpczEwOwogICAgICAgICAgICAgICAgX3RoaXMxMC5xckNvZGUgPSBkZWNvZGVkU3RyaW5nOwogICAgICAgICAgICAgICAgX3RoaXMxMC5jYW1lcmFTdGF0dXMgPSBmYWxzZTsKICAgICAgICAgICAgICAgIF9jb250ZXh0MTAucHJldiA9IDM7CiAgICAgICAgICAgICAgICBfY29udGV4dDEwLm5leHQgPSA2OwogICAgICAgICAgICAgICAgcmV0dXJuIEFQSUhlbHBlcigiUE9TVCIsICIvYXBpL3YxL2NoZWNrb3V0LyIgKyBfdGhpczEwLmJvb2tpbmdJZCwgewogICAgICAgICAgICAgICAgICBiZWFjb25JZDogZGVjb2RlZFN0cmluZywKICAgICAgICAgICAgICAgICAgcHJlVmFsaWRhdGU6IDEsCiAgICAgICAgICAgICAgICAgIHppZDogX3RoaXMxMC5ib29raW5nRGV0YWlscy56b25lLmxvY2F0aW9uQ29kZQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICAgIHByZVZhbGlkYXRlUXJSZXN1bHQgPSBfY29udGV4dDEwLnNlbnQ7CgogICAgICAgICAgICAgICAgaWYgKCFwcmVWYWxpZGF0ZVFyUmVzdWx0LmRhdGEuc3RhdHVzKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0MTAubmV4dCA9IDIxOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfY29udGV4dDEwLnByZXYgPSA4OwogICAgICAgICAgICAgICAgc2VsZi4kcm91dGVyLnJlcGxhY2UoewogICAgICAgICAgICAgICAgICBwYXRoOiAiL3N1Y2Nlc3MiCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIF9jb250ZXh0MTAubmV4dCA9IDEyOwogICAgICAgICAgICAgICAgcmV0dXJuIEFQSUhlbHBlcigiUE9TVCIsICIvYXBpL3YxL2NoZWNrb3V0LyIgKyBfdGhpczEwLmJvb2tpbmdJZCwgewogICAgICAgICAgICAgICAgICBiZWFjb25JZDogZGVjb2RlZFN0cmluZywKICAgICAgICAgICAgICAgICAgemlkOiBfdGhpczEwLmJvb2tpbmdEZXRhaWxzLnpvbmUubG9jYXRpb25Db2RlCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSAxMjoKICAgICAgICAgICAgICAgIHFyUmVzdWx0ID0gX2NvbnRleHQxMC5zZW50OwoKICAgICAgICAgICAgICAgIGlmIChxclJlc3VsdC5kYXRhLnN0YXR1cykgewogICAgICAgICAgICAgICAgICBfdGhpczEwLnBvc3RUb0xvZ2dlckFQSSh7CiAgICAgICAgICAgICAgICAgICAgcGhvbmU6IHNlbGYuYm9va2luZ0RldGFpbHMudXNlci5jb250YWN0LAogICAgICAgICAgICAgICAgICAgIHJlZklkOiBzZWxmLmJvb2tpbmdJZCwKICAgICAgICAgICAgICAgICAgICBpY29uOiAibG9nb3V0IiwKICAgICAgICAgICAgICAgICAgICBzdGF0dXNUZXh0OiAiUGFya2VyIHN1Y2Nlc3NmdWxseSBjaGVja2VkIG91dCB1c2luZyBRUiAtICIgKyBkZWNvZGVkU3RyaW5nCiAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgX3RoaXMxMC4kc3RvcmUuY29tbWl0KCJTRVRfQ0hFQ0tPVVQiLCB0cnVlKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIF90aGlzMTAuaW52YWxpZFFSTXNnID0gcXJSZXN1bHQgIT09IG51bGwgJiYgcXJSZXN1bHQgIT09IHZvaWQgMCAmJiAoX3FyUmVzdWx0JGRhdGEgPSBxclJlc3VsdC5kYXRhKSAhPT0gbnVsbCAmJiBfcXJSZXN1bHQkZGF0YSAhPT0gdm9pZCAwICYmIF9xclJlc3VsdCRkYXRhLm1lc3NhZ2UgPyBxclJlc3VsdC5kYXRhLm1lc3NhZ2UgOiAiUGxlYXNlIHRyeSBhZ2FpbiI7CiAgICAgICAgICAgICAgICAgIF90aGlzMTAuaW52YWxpZFFSRGlhbG9nID0gdHJ1ZTsKCiAgICAgICAgICAgICAgICAgIF90aGlzMTAucG9zdFRvTG9nZ2VyQVBJKHsKICAgICAgICAgICAgICAgICAgICBwaG9uZTogc2VsZi5ib29raW5nRGV0YWlscy51c2VyLmNvbnRhY3QsCiAgICAgICAgICAgICAgICAgICAgcmVmSWQ6IHNlbGYuYm9va2luZ0lkLAogICAgICAgICAgICAgICAgICAgIGVycm9yOiBzZWxmLmludmFsaWRRUk1zZywKICAgICAgICAgICAgICAgICAgICBpY29uOiAibG9nb3V0IiwKICAgICAgICAgICAgICAgICAgICBzdGF0dXNUZXh0OiAiRXJyb3IgT2NjdXJlZCB3aGlsZSBjaGVja2luZyBvdXQgdXNpbmcgUVIgLSAiICsgZGVjb2RlZFN0cmluZwogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfY29udGV4dDEwLm5leHQgPSAxOTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDE2OgogICAgICAgICAgICAgICAgX2NvbnRleHQxMC5wcmV2ID0gMTY7CiAgICAgICAgICAgICAgICBfY29udGV4dDEwLnQwID0gX2NvbnRleHQxMFsiY2F0Y2giXSg4KTsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKF9jb250ZXh0MTAudDApOwoKICAgICAgICAgICAgICBjYXNlIDE5OgogICAgICAgICAgICAgICAgX2NvbnRleHQxMC5uZXh0ID0gMjQ7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAyMToKICAgICAgICAgICAgICAgIF90aGlzMTAuaW52YWxpZFFSTXNnID0gcHJlVmFsaWRhdGVRclJlc3VsdCAhPT0gbnVsbCAmJiBwcmVWYWxpZGF0ZVFyUmVzdWx0ICE9PSB2b2lkIDAgJiYgKF9wcmVWYWxpZGF0ZVFyUmVzdWx0JCA9IHByZVZhbGlkYXRlUXJSZXN1bHQuZGF0YSkgIT09IG51bGwgJiYgX3ByZVZhbGlkYXRlUXJSZXN1bHQkICE9PSB2b2lkIDAgJiYgX3ByZVZhbGlkYXRlUXJSZXN1bHQkLm1lc3NhZ2UgPyBwcmVWYWxpZGF0ZVFyUmVzdWx0LmRhdGEubWVzc2FnZSA6ICJQbGVhc2UgdHJ5IGFnYWluIjsKICAgICAgICAgICAgICAgIF90aGlzMTAuaW52YWxpZFFSRGlhbG9nID0gdHJ1ZTsKCiAgICAgICAgICAgICAgICBfdGhpczEwLnBvc3RUb0xvZ2dlckFQSSh7CiAgICAgICAgICAgICAgICAgIHBob25lOiBzZWxmLmJvb2tpbmdEZXRhaWxzLnVzZXIuY29udGFjdCwKICAgICAgICAgICAgICAgICAgcmVmSWQ6IHNlbGYuYm9va2luZ0lkLAogICAgICAgICAgICAgICAgICBpY29uOiAibG9nb3V0IiwKICAgICAgICAgICAgICAgICAgZXJyb3I6IHNlbGYuaW52YWxpZFFSTXNnLAogICAgICAgICAgICAgICAgICBzdGF0dXNUZXh0OiAiRXJyb3IgT2NjdXJlZCB3aGlsZSBjaGVja2luZyBvdXQgdXNpbmcgUVIgLSAiICsgZGVjb2RlZFN0cmluZwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgMjQ6CiAgICAgICAgICAgICAgICBfY29udGV4dDEwLm5leHQgPSAyOTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDI2OgogICAgICAgICAgICAgICAgX2NvbnRleHQxMC5wcmV2ID0gMjY7CiAgICAgICAgICAgICAgICBfY29udGV4dDEwLnQxID0gX2NvbnRleHQxMFsiY2F0Y2giXSgzKTsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKF9jb250ZXh0MTAudDEpOwoKICAgICAgICAgICAgICBjYXNlIDI5OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMTAsIG51bGwsIFtbMywgMjZdLCBbOCwgMTZdXSk7CiAgICAgIH0pKSgpOwogICAgfSwKICAgIG9uSW5pdDogZnVuY3Rpb24gb25Jbml0KHByb21pc2UpIHsKICAgICAgdmFyIF90aGlzMTEgPSB0aGlzOwoKICAgICAgcmV0dXJuIF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTExKCkgewogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMTEkKF9jb250ZXh0MTEpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQxMS5wcmV2ID0gX2NvbnRleHQxMS5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgX2NvbnRleHQxMS5wcmV2ID0gMDsKICAgICAgICAgICAgICAgIF9jb250ZXh0MTEubmV4dCA9IDM7CiAgICAgICAgICAgICAgICByZXR1cm4gcHJvbWlzZTsKCiAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgX2NvbnRleHQxMS5uZXh0ID0gOTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICBfY29udGV4dDExLnByZXYgPSA1OwogICAgICAgICAgICAgICAgX2NvbnRleHQxMS50MCA9IF9jb250ZXh0MTFbImNhdGNoIl0oMCk7CgogICAgICAgICAgICAgICAgaWYgKF9jb250ZXh0MTEudDAubmFtZSA9PT0gIk5vdEFsbG93ZWRFcnJvciIpIHsKICAgICAgICAgICAgICAgICAgX3RoaXMxMS5pbnZhbGlkUVJNc2cgPSAiUGxlYXNlIGdyYW50IGNhbWVyYSBhY2Nlc3MgcGVybWlzc29uIjsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoX2NvbnRleHQxMS50MC5uYW1lID09PSAiTm90Rm91bmRFcnJvciIpIHsKICAgICAgICAgICAgICAgICAgX3RoaXMxMS5pbnZhbGlkUVJNc2cgPSAiTm8gY2FtZXJhIGZvdW5kIG9uIHRoaXMgZGV2aWNlIjsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoX2NvbnRleHQxMS50MC5uYW1lID09PSAiTm90U3VwcG9ydGVkRXJyb3IiKSB7CiAgICAgICAgICAgICAgICAgIF90aGlzMTEuaW52YWxpZFFSTXNnID0gIlNlY3VyZSBjb250ZXh0IHJlcXVpcmVkIChIVFRQUywgbG9jYWxob3N0KSI7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKF9jb250ZXh0MTEudDAubmFtZSA9PT0gIk5vdFJlYWRhYmxlRXJyb3IiKSB7CiAgICAgICAgICAgICAgICAgIF90aGlzMTEuaW52YWxpZFFSTXNnID0gIklzIHRoZSBjYW1lcmEgYWxyZWFkeSBpbiB1c2U/IFBsZWFzZSBjaGVjay4iOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChfY29udGV4dDExLnQwLm5hbWUgPT09ICJPdmVyY29uc3RyYWluZWRFcnJvciIpIHsKICAgICAgICAgICAgICAgICAgX3RoaXMxMS5pbnZhbGlkUVJNc2cgPSAiSW5zdGFsbGVkIGNhbWVyYSBpcyBub3Qgc3VpdGFibGUiOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChfY29udGV4dDExLnQwLm5hbWUgPT09ICJTdHJlYW1BcGlOb3RTdXBwb3J0ZWRFcnJvciIpIHsKICAgICAgICAgICAgICAgICAgX3RoaXMxMS5pbnZhbGlkUVJNc2cgPSAiU3RyZWFtIEFQSSBpcyBub3Qgc3VwcG9ydGVkIGluIHRoaXMgYnJvd3NlciI7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgX3RoaXMxMS5pbnZhbGlkUVJEaWFsb2cgPSB0cnVlOwoKICAgICAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDExLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUxMSwgbnVsbCwgW1swLCA1XV0pOwogICAgICB9KSkoKTsKICAgIH0sCiAgICBvblZhbGlkYXRlVGV4dDogZnVuY3Rpb24gb25WYWxpZGF0ZVRleHQoKSB7CiAgICAgIHZhciBfdGhpczEyID0gdGhpczsKCiAgICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxMigpIHsKICAgICAgICB2YXIgcmVzdWx0LCBfcmVzdWx0JGRhdGEzLCBfcmVzdWx0JGRhdGE0OwoKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTEyJChfY29udGV4dDEyKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MTIucHJldiA9IF9jb250ZXh0MTIubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIF90aGlzMTIudmFsaWRhdGVCb29raW5nUGVuZGluZyA9IHRydWU7CiAgICAgICAgICAgICAgICBfY29udGV4dDEyLm5leHQgPSAzOwogICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzMTIudmFsaWRhdGVCb29raW5nKF90aGlzMTIudmFsaWRhdGVCb29raW5nVHh0KTsKCiAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgcmVzdWx0ID0gX2NvbnRleHQxMi5zZW50OwoKICAgICAgICAgICAgICAgIGlmICghcmVzdWx0LmRhdGEuc3RhdHVzKSB7CiAgICAgICAgICAgICAgICAgIF90aGlzMTIuaW52YWxpZFNNU01zZyA9IHJlc3VsdCAhPT0gbnVsbCAmJiByZXN1bHQgIT09IHZvaWQgMCAmJiAoX3Jlc3VsdCRkYXRhMyA9IHJlc3VsdC5kYXRhKSAhPT0gbnVsbCAmJiBfcmVzdWx0JGRhdGEzICE9PSB2b2lkIDAgJiYgX3Jlc3VsdCRkYXRhMy5tZXNzYWdlID8gcmVzdWx0LmRhdGEubWVzc2FnZSA6ICJWYWxpZGF0aW9uIG5vdCByZWNvZ25pemVkLiBQbGVhc2UgdHJ5IGFnYWluIjsKICAgICAgICAgICAgICAgICAgX3RoaXMxMi5pbnZhbGlkU01TRGlhbG9nID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgX3RoaXMxMi52YWxpZGF0ZUJvb2tpbmdQZW5kaW5nID0gZmFsc2U7CgogICAgICAgICAgICAgICAgICBfdGhpczEyLnBvc3RUb0xvZ2dlckFQSSh7CiAgICAgICAgICAgICAgICAgICAgcGhvbmU6IF90aGlzMTIuYm9va2luZ0RldGFpbHMudXNlci5jb250YWN0LAogICAgICAgICAgICAgICAgICAgIHJlZklkOiBfdGhpczEyLmJvb2tpbmdJZCwKICAgICAgICAgICAgICAgICAgICBlcnJvcjogX3RoaXMxMi5pbnZhbGlkU01TTXNnLAogICAgICAgICAgICAgICAgICAgIGljb246ICJyZWRlZW0iLAogICAgICAgICAgICAgICAgICAgIHN0YXR1c1RleHQ6ICJFcnJvciBpbiB2YWxpZGF0aW5nIHRoZSBzZXNzaW9uIG9uIGVudGVyaW5nIHZhbGlkYXRpb24gY29kZSAtICIgKyBfdGhpczEyLnZhbGlkYXRlQm9va2luZ1R4dAogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIF90aGlzMTIucG9zdFRvTG9nZ2VyQVBJKHsKICAgICAgICAgICAgICAgICAgICBwaG9uZTogX3RoaXMxMi5ib29raW5nRGV0YWlscy51c2VyLmNvbnRhY3QsCiAgICAgICAgICAgICAgICAgICAgcmVmSWQ6IF90aGlzMTIuYm9va2luZ0lkLAogICAgICAgICAgICAgICAgICAgIGljb246ICJyZWRlZW0iLAogICAgICAgICAgICAgICAgICAgIHN0YXR1c1RleHQ6ICJQYXJrZXIgdmFsaWRhdGVkIHRoZSBzZXNzaW9uIHN1Y2Nlc3NmdWxseSBieSBlbnRlcmluZyB2YWxpZGF0aW9uIGNvZGUgLSAiICsgX3RoaXMxMi52YWxpZGF0ZUJvb2tpbmdUeHQKICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICBfdGhpczEyLmdvbGRlbk51Z2dldCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICBfdGhpczEyLnZhbGlkYXRlQm9va2luZ1BlbmRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgX3RoaXMxMi52YWxpZGF0ZUJvb2tpbmdEaWFsb2cgPSBmYWxzZTsKCiAgICAgICAgICAgICAgICAgIF90aGlzMTIuJHN0b3JlLmNvbW1pdCgiU0VUX1ZBTElEQVRFRF9NRVJDSEFOVCIsIHJlc3VsdCA9PT0gbnVsbCB8fCByZXN1bHQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IChfcmVzdWx0JGRhdGE0ID0gcmVzdWx0LmRhdGEpID09PSBudWxsIHx8IF9yZXN1bHQkZGF0YTQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9yZXN1bHQkZGF0YTQubWVyY2hhbnROYW1lKTsKCiAgICAgICAgICAgICAgICAgIF90aGlzMTIuJHJvdXRlci5yZXBsYWNlKHsKICAgICAgICAgICAgICAgICAgICBwYXRoOiAiL3ZhbGlkYXRlc3VjY2VzcyIKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTIuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTEyKTsKICAgICAgfSkpKCk7CiAgICB9LAogICAgdmFsaWRhdGVCb29raW5nOiBmdW5jdGlvbiB2YWxpZGF0ZUJvb2tpbmcoY29kZSkgewogICAgICB2YXIgX3RoaXMxMyA9IHRoaXM7CgogICAgICByZXR1cm4gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMTMoKSB7CiAgICAgICAgdmFyIHZhbGlkYXRlUmVzdWx0OwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMTMkKF9jb250ZXh0MTMpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQxMy5wcmV2ID0gX2NvbnRleHQxMy5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgX2NvbnRleHQxMy5wcmV2ID0gMDsKICAgICAgICAgICAgICAgIF9jb250ZXh0MTMubmV4dCA9IDM7CiAgICAgICAgICAgICAgICByZXR1cm4gQVBJSGVscGVyKCJQT1NUIiwgIi9hcGkvdjEvdmFsaWRhdGUvIiArIF90aGlzMTMuYm9va2luZ0lkLCB7CiAgICAgICAgICAgICAgICAgIGNvdXBvbjogY29kZSwKICAgICAgICAgICAgICAgICAgemlkOiBfdGhpczEzLmJvb2tpbmdEZXRhaWxzLnpvbmUubG9jYXRpb25Db2RlCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgdmFsaWRhdGVSZXN1bHQgPSBfY29udGV4dDEzLnNlbnQ7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMy5hYnJ1cHQoInJldHVybiIsIHZhbGlkYXRlUmVzdWx0KTsKCiAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgX2NvbnRleHQxMy5wcmV2ID0gNzsKICAgICAgICAgICAgICAgIF9jb250ZXh0MTMudDAgPSBfY29udGV4dDEzWyJjYXRjaCJdKDApOwogICAgICAgICAgICAgICAgY29uc29sZS5sb2coX2NvbnRleHQxMy50MCk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMy5hYnJ1cHQoInJldHVybiIsIF9jb250ZXh0MTMudDApOwoKICAgICAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMy5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMTMsIG51bGwsIFtbMCwgN11dKTsKICAgICAgfSkpKCk7CiAgICB9LAogICAgb3BlblNjYW5WYWxpZGF0aW9uQ29kZTogZnVuY3Rpb24gb3BlblNjYW5WYWxpZGF0aW9uQ29kZSgpIHsKICAgICAgdmFyIF90aGlzMTQgPSB0aGlzOwoKICAgICAgcmV0dXJuIF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTE0KCkgewogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMTQkKF9jb250ZXh0MTQpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQxNC5wcmV2ID0gX2NvbnRleHQxNC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgX3RoaXMxNC52YWxpZGF0ZUJvb2tpbmdEaWFsb2cgPSBmYWxzZTsKICAgICAgICAgICAgICAgIF90aGlzMTQudmFsaWRhdGVCb29raW5nVHh0ID0gIiI7CiAgICAgICAgICAgICAgICBfdGhpczE0LnZhbGlkYXRlUVJDb2RlRGlhbG9nID0gdHJ1ZTsKICAgICAgICAgICAgICAgIF90aGlzMTQudmFsaWRhdGlvbkNhbWVyYVN0YXR1cyA9IHRydWU7CgogICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTQuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTE0KTsKICAgICAgfSkpKCk7CiAgICB9LAogICAgb25WYWxpZGF0ZVFSQ29kZTogZnVuY3Rpb24gb25WYWxpZGF0ZVFSQ29kZShkZWNvZGVkU3RyaW5nKSB7CiAgICAgIHZhciBfdGhpczE1ID0gdGhpczsKCiAgICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxNSgpIHsKICAgICAgICB2YXIgcmVzdWx0LCBfcmVzdWx0JGRhdGE1LCBfcmVzdWx0JGRhdGE2OwoKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTE1JChfY29udGV4dDE1KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MTUucHJldiA9IF9jb250ZXh0MTUubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIF90aGlzMTUudmFsaWRhdGlvbkNhbWVyYVN0YXR1cyA9IGZhbHNlOwogICAgICAgICAgICAgICAgX3RoaXMxNS52YWxpZGF0ZVFSQ29kZVBlbmRpbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgX2NvbnRleHQxNS5wcmV2ID0gMjsKICAgICAgICAgICAgICAgIF9jb250ZXh0MTUubmV4dCA9IDU7CiAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMxNS52YWxpZGF0ZUJvb2tpbmcoZGVjb2RlZFN0cmluZyk7CgogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgIHJlc3VsdCA9IF9jb250ZXh0MTUuc2VudDsKCiAgICAgICAgICAgICAgICBpZiAoIXJlc3VsdC5kYXRhLnN0YXR1cykgewogICAgICAgICAgICAgICAgICBfdGhpczE1LmludmFsaWRWYWxpZGF0aW9uUVJNc2cgPSByZXN1bHQgIT09IG51bGwgJiYgcmVzdWx0ICE9PSB2b2lkIDAgJiYgKF9yZXN1bHQkZGF0YTUgPSByZXN1bHQuZGF0YSkgIT09IG51bGwgJiYgX3Jlc3VsdCRkYXRhNSAhPT0gdm9pZCAwICYmIF9yZXN1bHQkZGF0YTUubWVzc2FnZSA/IHJlc3VsdC5kYXRhLm1lc3NhZ2UgOiAiVmFsaWRhdGlvbiBub3QgcmVjb2duaXplZC4gUGxlYXNlIHRyeSBhZ2FpbiI7CiAgICAgICAgICAgICAgICAgIF90aGlzMTUuaW52YWxpZFZhbGlkYXRpb25RUkRpYWxvZyA9IHRydWU7CiAgICAgICAgICAgICAgICAgIF90aGlzMTUudmFsaWRhdGVRUkNvZGVQZW5kaW5nID0gZmFsc2U7CgogICAgICAgICAgICAgICAgICBfdGhpczE1LnBvc3RUb0xvZ2dlckFQSSh7CiAgICAgICAgICAgICAgICAgICAgcGhvbmU6IF90aGlzMTUuYm9va2luZ0RldGFpbHMudXNlci5jb250YWN0LAogICAgICAgICAgICAgICAgICAgIHJlZklkOiBfdGhpczE1LmJvb2tpbmdJZCwKICAgICAgICAgICAgICAgICAgICBlcnJvcjogX3RoaXMxNS5pbnZhbGlkUVJNc2csCiAgICAgICAgICAgICAgICAgICAgaWNvbjogInJlZGVlbSIsCiAgICAgICAgICAgICAgICAgICAgc3RhdHVzVGV4dDogIkVycm9yIGluIHZhbGlkYXRpbmcgdGhlIHNlc3Npb24gb24gc2Nhbm5pbmcgdmFsaWRhdGlvbiBRUiAtICIgKyBkZWNvZGVkU3RyaW5nCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgX3RoaXMxNS5wb3N0VG9Mb2dnZXJBUEkoewogICAgICAgICAgICAgICAgICAgIHBob25lOiBfdGhpczE1LmJvb2tpbmdEZXRhaWxzLnVzZXIuY29udGFjdCwKICAgICAgICAgICAgICAgICAgICByZWZJZDogX3RoaXMxNS5ib29raW5nSWQsCiAgICAgICAgICAgICAgICAgICAgaWNvbjogInJlZGVlbSIsCiAgICAgICAgICAgICAgICAgICAgc3RhdHVzVGV4dDogIlBhcmtlciB2YWxpZGF0ZWQgdGhlIHNlc3Npb24gc3VjY2Vzc2Z1bGx5IGJ5IHNjYW5uaW5nIHZhbGlkYXRpb24gUVIgLSAiICsgZGVjb2RlZFN0cmluZwogICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgIF90aGlzMTUudmFsaWRhdGVRUkNvZGVQZW5kaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgIF90aGlzMTUudmFsaWRhdGVRUkNvZGVEaWFsb2cgPSBmYWxzZTsKCiAgICAgICAgICAgICAgICAgIF90aGlzMTUuJHN0b3JlLmNvbW1pdCgiU0VUX1ZBTElEQVRFRF9NRVJDSEFOVCIsIHJlc3VsdCA9PT0gbnVsbCB8fCByZXN1bHQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IChfcmVzdWx0JGRhdGE2ID0gcmVzdWx0LmRhdGEpID09PSBudWxsIHx8IF9yZXN1bHQkZGF0YTYgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9yZXN1bHQkZGF0YTYubWVyY2hhbnROYW1lKTsKCiAgICAgICAgICAgICAgICAgIF90aGlzMTUuJHJvdXRlci5yZXBsYWNlKHsKICAgICAgICAgICAgICAgICAgICBwYXRoOiAiL3ZhbGlkYXRlc3VjY2VzcyIKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgX2NvbnRleHQxNS5uZXh0ID0gMTI7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgICAgX2NvbnRleHQxNS5wcmV2ID0gOTsKICAgICAgICAgICAgICAgIF9jb250ZXh0MTUudDAgPSBfY29udGV4dDE1WyJjYXRjaCJdKDIpOwogICAgICAgICAgICAgICAgY29uc29sZS5sb2coX2NvbnRleHQxNS50MCk7CgogICAgICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDE1LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUxNSwgbnVsbCwgW1syLCA5XV0pOwogICAgICB9KSkoKTsKICAgIH0KICB9Cn07"},null]}